RunDate	EndTime	Source	Elapsed	Rows	Result	Notes	SQL Statement	SQL Type	User Id	DBMS Time	Fetch Time	Seq
10/11/2012	12:52:09	NTL_PRD_ALLVM	00:00:27	1466			"select  a.activity_mth ,a.activity_type ,a.activity_dt as activity_dt ,a.area_desc as customer_area ,a.region_desc as customer_region ,cal.nm_first||'   '||cal.nm_last AS cust_name ,cal.mtn ,a.cust_id ,a.cust_line_seq_id ,a.prod_nm_prev ,case when cal.Device_type_cd like '%4GS%' then cal.device_prod_nm  else cal.prod_nm  END AS unmasked_prod_nm ,case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill ,case  when a.sls_outlet_id = '3008' then 'NA'  else outlet.area_desc  end as sls_area ,case  when a.sls_outlet_id = '3008' then 'NA' else outlet.region_desc  end as sls_region ,a.sls_outlet_id ,outlet.channel ,outlet.location ,CASE WHEN cc.acss_call_ctr_desc IN ('NE Columbia SC 2', 'NE Columbia SC') THEN 'NE Columbia'             ELSE cc.acss_call_ctr_desc END AS Center ,u.nm_last||', '||u.nm_first AS rep_nm        ,u.acss_user_id       ,ad.acss_dept_desc ,a.acss_call_dt ,a.acss_call_tm ,a.call_duration ,a.call_period ,sum(case when a.call_period < 3 then (in_type1 + in_type7 +in_other_type + os_type1 + os_type3 + os_type7 + os_other_type) end) calls3 ,sum(case when a.call_period < 32 then (in_type1 + in_type7 + in_other_type +  os_type1 + os_type3 + os_type7 + os_other_type) end) calls31   from ntl_prd_qmtbls.mrs_ndcir_detail as a   join  ntl_prd_secvm.cust_acct_line_dly_hist_v  as cal on a.cust_id = cal.cust_id and a.cust_line_seq_id = cal.cust_line_seq_id and a.activity_dt + 10 BETWEEN cal.eff_dt AND cal.exp_dt   left join ntl_prd_allvm.acss_call_center_v as cc        on a.acss_call_ctr_cd = cc.acss_call_ctr_cd                                  left join ntl_prd_allvm.acss_dept_v as ad   on a.acss_dept_id = ad.acss_dept_id  left join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id =  u.acss_user_id  left outer join   ( select   o.sls_outlet_id  ,o.sls_outlet_nm  ,m.area_desc  ,m.region_desc  ,case   when o.store_type_ind='K' then 'Kiosk'   when o.store_type_ind='S' then 'Store'   when o.store_type_ind='I' then 'In-Store'   when o.store_type_ind='C' then 'Cart'   when o.store_type_ind='V' then 'VZ Experience'   when o.store_type_ind='A' then 'Accesory'   when o.store_type_ind is null then coalesce(agref.master_agent_desc, o.master_agent_id,'-')  end as agent  ,case when agent_type = 'l' then 'Outlet'     when agent_type ='d' then 'Ded Sub Agent'     when agent_type = 's' then 'Sub Agent'     else agent_type end agent_type   ,coalesce(o.master_agent_id,'-') as master_agent_id  ,sdct.sls_dist_chnl_churn_ctgry as channel  ,o.addr_line1  ,coalesce(o.loc_store_nm ,o.city_nm || ' ' || o.state_cd) as location  ,case when o.premium_agent_ind='Y' then 'Premium' else '-' end as premium_agent  ,coalesce(ei.excl_indirect_desc,'-') as excl_ind  ,coalesce(iom.emp_id,o.mgr_emp_id) as emp_id  ,coalesce(he.nm_first || ' ' || he.nm_last,'-') as mgr_name  ,coalesce(he.job_desc,'-') as job_desc  ,coalesce(he.super_nm_lvl1,'-') AS ""Dir""    ,coalesce(he.super_nm_lvl2,'-') AS ""District_Mgr""   ,coalesce(d.district_desc ,'-') as district_desc from ntl_prd_allvm.outlet_v o  left join ntl_prd_allvm.exclusive_indirect_v ei  on o.excl_indirect_ind=ei.excl_indirect_ind  left join ntl_prd_allvm.sales_dist_channel_type_v sdct  on o.sls_dist_chnl_type_cd=sdct.sls_dist_chnl_type_cd  and o.sor_id=sdct.sor_id  left join ntl_prd_allvm.market_v m  on o.sls_outlet_mkt_cd=m.mkt_cd  and o.sor_id=m.sor_id  left join   (select    *  from ntl_prd_allvm.indirect_outlet_manager_v i   where i.end_dt >= current_date   and i.eff_dt = (select max(i1.eff_dt) from ntl_prd_allvm.indirect_outlet_manager_v i1 where i1.sls_outlet_id=i.sls_outlet_id)   and i.emp_id  NOT IN ('999999', 'xxxxxx', 'i99999')   qualify row_number() over (partition by i.sls_outlet_id order by i.sls_outlet_id) = 1) iom  on o.sls_outlet_id=iom.sls_outlet_id  and o.sor_id=iom.sor_id  left join ntl_prd_allvm.hr_employee_v he  on coalesce(iom.emp_id,o.mgr_emp_id) =he.emp_id  left join ntl_prd_allvm.master_agents_xref_v agref   on o.master_agent_id = agref.master_agent_id   and o.master_agent_area_cd = agref.master_agent_area_cd  left outer join ntl_prd_allvm.district_v d  on o.district_cd=d.district_cd ) outlet  on outlet.sls_outlet_id=a.sls_outlet_id  where a.activity_mth = '2012-07-01' and a.sls_outlet_id in ('94866', '84970')  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25"	TERADATA	HABERER	00:00:25	00:00:02	17975
10/11/2012	12:50:35	NTL_PRD_ALLVM	00:00:12	1466			"select  a.activity_mth ,a.activity_type ,a.activity_dt as activity_dt ,a.area_desc as customer_area ,a.region_desc as customer_region ,cal.nm_first||'   '||cal.nm_last AS cust_name ,cal.mtn ,a.cust_id ,a.cust_line_seq_id ,a.prod_nm_prev ,case when cal.Device_type_cd like '%4GS%' then cal.device_prod_nm  else cal.prod_nm  END AS unmasked_prod_nm ,case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill ,case  when a.sls_outlet_id = '3008' then 'NA'  else outlet.area_desc  end as sls_area ,case  when a.sls_outlet_id = '3008' then 'NA' else outlet.region_desc  end as sls_region ,a.sls_outlet_id ,outlet.channel ,outlet.location ,CASE WHEN cc.acss_call_ctr_desc IN ('NE Columbia SC 2', 'NE Columbia SC') THEN 'NE Columbia'             ELSE cc.acss_call_ctr_desc END AS Center ,u.nm_last||', '||u.nm_first AS rep_nm        ,u.acss_user_id       ,ad.acss_dept_desc ,a.acss_call_dt ,a.acss_call_tm ,a.call_duration ,a.call_period ,sum(case when a.call_period < 3 then (in_type1 + in_type7 +in_other_type + os_type1 + os_type3 + os_type7 + os_other_type) end) calls3 ,sum(case when a.call_period < 32 then (in_type1 + in_type7 + in_other_type +  os_type1 + os_type3 + os_type7 + os_other_type) end) calls31   from ntl_prd_qmtbls.mrs_ndcir_detail as a   join  ntl_prd_secvm.cust_acct_line_dly_hist_v  as cal on a.cust_id = cal.cust_id and a.cust_line_seq_id = cal.cust_line_seq_id and a.activity_dt + 7 BETWEEN cal.eff_dt AND cal.exp_dt   left join ntl_prd_allvm.acss_call_center_v as cc        on a.acss_call_ctr_cd = cc.acss_call_ctr_cd                                  left join ntl_prd_allvm.acss_dept_v as ad   on a.acss_dept_id = ad.acss_dept_id  left join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id =  u.acss_user_id  left outer join   ( select   o.sls_outlet_id  ,o.sls_outlet_nm  ,m.area_desc  ,m.region_desc  ,case   when o.store_type_ind='K' then 'Kiosk'   when o.store_type_ind='S' then 'Store'   when o.store_type_ind='I' then 'In-Store'   when o.store_type_ind='C' then 'Cart'   when o.store_type_ind='V' then 'VZ Experience'   when o.store_type_ind='A' then 'Accesory'   when o.store_type_ind is null then coalesce(agref.master_agent_desc, o.master_agent_id,'-')  end as agent  ,case when agent_type = 'l' then 'Outlet'     when agent_type ='d' then 'Ded Sub Agent'     when agent_type = 's' then 'Sub Agent'     else agent_type end agent_type   ,coalesce(o.master_agent_id,'-') as master_agent_id  ,sdct.sls_dist_chnl_churn_ctgry as channel  ,o.addr_line1  ,coalesce(o.loc_store_nm ,o.city_nm || ' ' || o.state_cd) as location  ,case when o.premium_agent_ind='Y' then 'Premium' else '-' end as premium_agent  ,coalesce(ei.excl_indirect_desc,'-') as excl_ind  ,coalesce(iom.emp_id,o.mgr_emp_id) as emp_id  ,coalesce(he.nm_first || ' ' || he.nm_last,'-') as mgr_name  ,coalesce(he.job_desc,'-') as job_desc  ,coalesce(he.super_nm_lvl1,'-') AS ""Dir""    ,coalesce(he.super_nm_lvl2,'-') AS ""District_Mgr""   ,coalesce(d.district_desc ,'-') as district_desc from ntl_prd_allvm.outlet_v o  left join ntl_prd_allvm.exclusive_indirect_v ei  on o.excl_indirect_ind=ei.excl_indirect_ind  left join ntl_prd_allvm.sales_dist_channel_type_v sdct  on o.sls_dist_chnl_type_cd=sdct.sls_dist_chnl_type_cd  and o.sor_id=sdct.sor_id  left join ntl_prd_allvm.market_v m  on o.sls_outlet_mkt_cd=m.mkt_cd  and o.sor_id=m.sor_id  left join   (select    *  from ntl_prd_allvm.indirect_outlet_manager_v i   where i.end_dt >= current_date   and i.eff_dt = (select max(i1.eff_dt) from ntl_prd_allvm.indirect_outlet_manager_v i1 where i1.sls_outlet_id=i.sls_outlet_id)   and i.emp_id  NOT IN ('999999', 'xxxxxx', 'i99999')   qualify row_number() over (partition by i.sls_outlet_id order by i.sls_outlet_id) = 1) iom  on o.sls_outlet_id=iom.sls_outlet_id  and o.sor_id=iom.sor_id  left join ntl_prd_allvm.hr_employee_v he  on coalesce(iom.emp_id,o.mgr_emp_id) =he.emp_id  left join ntl_prd_allvm.master_agents_xref_v agref   on o.master_agent_id = agref.master_agent_id   and o.master_agent_area_cd = agref.master_agent_area_cd  left outer join ntl_prd_allvm.district_v d  on o.district_cd=d.district_cd ) outlet  on outlet.sls_outlet_id=a.sls_outlet_id  where a.activity_mth = '2012-07-01' and a.sls_outlet_id in ('94866', '84970')  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25"	TERADATA	HABERER	00:00:11	00:00:01	17974
10/11/2012	12:50:12	NTL_PRD_ALLVM	00:00:00	0	3706		"select  a.activity_mth ,a.activity_type ,a.activity_dt as activity_dt ,a.area_desc as customer_area ,a.region_desc as customer_region ,cal.nm_first||'   '||cal.nm_last AS cust_name ,cal.mtn ,a.cust_id ,a.cust_line_seq_id ,a.prod_nm_prev ,case when cal.Device_type_cd like '%4GS%' then cal.device_prod_nm  else cal.prod_nm  END AS unmasked_prod_nm ,case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill ,case  when a.sls_outlet_id = '3008' then 'NA'  else outlet.area_desc  end as sls_area ,case  when a.sls_outlet_id = '3008' then 'NA' else outlet.region_desc  end as sls_region ,a.sls_outlet_id ,outlet.channel ,outlet.location ,CASE WHEN cc.acss_call_ctr_desc IN ('NE Columbia SC 2', 'NE Columbia SC') THEN 'NE Columbia'             ELSE cc.acss_call_ctr_desc END AS Center ,u.nm_last||', '||u.nm_first AS rep_nm        ,u.acss_user_id       ,ad.acss_dept_desc ,a.acss_call_dt ,a.acss_call_tm ,a.call_duration ,a.call_period ,sum(case when a.call_period < 3 then (in_type1 + in_type7 +in_other_type + os_type1 + os_type3 + os_type7 + os_other_type) end) calls3 ,sum(case when a.call_period < 32 then (in_type1 + in_type7 + in_other_type +  os_type1 + os_type3 + os_type7 + os_other_type) end) calls31   from ntl_prd_qmtbls.mrs_ndcir_detail as a   ljoin  ntl_prd_secvm.cust_acct_line_dly_hist_v  as cal on a.cust_id = cal.cust_id and a.cust_line_seq_id = cal.cust_line_seq_id and a.activity_dt + 7 BETWEEN cal.eff_dt AND cal.exp_dt   left join ntl_prd_allvm.acss_call_center_v as cc        on a.acss_call_ctr_cd = cc.acss_call_ctr_cd                                  left join ntl_prd_allvm.acss_dept_v as ad   on a.acss_dept_id = ad.acss_dept_id  left join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id =  u.acss_user_id  left outer join   ( select   o.sls_outlet_id  ,o.sls_outlet_nm  ,m.area_desc  ,m.region_desc  ,case   when o.store_type_ind='K' then 'Kiosk'   when o.store_type_ind='S' then 'Store'   when o.store_type_ind='I' then 'In-Store'   when o.store_type_ind='C' then 'Cart'   when o.store_type_ind='V' then 'VZ Experience'   when o.store_type_ind='A' then 'Accesory'   when o.store_type_ind is null then coalesce(agref.master_agent_desc, o.master_agent_id,'-')  end as agent  ,case when agent_type = 'l' then 'Outlet'     when agent_type ='d' then 'Ded Sub Agent'     when agent_type = 's' then 'Sub Agent'     else agent_type end agent_type   ,coalesce(o.master_agent_id,'-') as master_agent_id  ,sdct.sls_dist_chnl_churn_ctgry as channel  ,o.addr_line1  ,coalesce(o.loc_store_nm ,o.city_nm || ' ' || o.state_cd) as location  ,case when o.premium_agent_ind='Y' then 'Premium' else '-' end as premium_agent  ,coalesce(ei.excl_indirect_desc,'-') as excl_ind  ,coalesce(iom.emp_id,o.mgr_emp_id) as emp_id  ,coalesce(he.nm_first || ' ' || he.nm_last,'-') as mgr_name  ,coalesce(he.job_desc,'-') as job_desc  ,coalesce(he.super_nm_lvl1,'-') AS ""Dir""    ,coalesce(he.super_nm_lvl2,'-') AS ""District_Mgr""   ,coalesce(d.district_desc ,'-') as district_desc from ntl_prd_allvm.outlet_v o  left join ntl_prd_allvm.exclusive_indirect_v ei  on o.excl_indirect_ind=ei.excl_indirect_ind  left join ntl_prd_allvm.sales_dist_channel_type_v sdct  on o.sls_dist_chnl_type_cd=sdct.sls_dist_chnl_type_cd  and o.sor_id=sdct.sor_id  left join ntl_prd_allvm.market_v m  on o.sls_outlet_mkt_cd=m.mkt_cd  and o.sor_id=m.sor_id  left join   (select    *  from ntl_prd_allvm.indirect_outlet_manager_v i   where i.end_dt >= current_date   and i.eff_dt = (select max(i1.eff_dt) from ntl_prd_allvm.indirect_outlet_manager_v i1 where i1.sls_outlet_id=i.sls_outlet_id)   and i.emp_id  NOT IN ('999999', 'xxxxxx', 'i99999')   qualify row_number() over (partition by i.sls_outlet_id order by i.sls_outlet_id) = 1) iom  on o.sls_outlet_id=iom.sls_outlet_id  and o.sor_id=iom.sor_id  left join ntl_prd_allvm.hr_employee_v he  on coalesce(iom.emp_id,o.mgr_emp_id) =he.emp_id  left join ntl_prd_allvm.master_agents_xref_v agref   on o.master_agent_id = agref.master_agent_id   and o.master_agent_area_cd = agref.master_agent_area_cd  left outer join ntl_prd_allvm.district_v d  on o.district_cd=d.district_cd ) outlet  on outlet.sls_outlet_id=a.sls_outlet_id  where a.activity_mth = '2012-07-01' and a.sls_outlet_id in ('94866', '84970')  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25"	TERADATA	HABERER	00:00:00	00:00:00	17973
10/11/2012	12:49:02	NTL_PRD_ALLVM	00:00:17	1466			"select  a.activity_mth ,a.activity_type ,a.activity_dt as activity_dt ,a.area_desc as customer_area ,a.region_desc as customer_region ,cal.nm_first||'   '||cal.nm_last AS cust_name ,cal.mtn ,a.cust_id ,a.cust_line_seq_id ,a.prod_nm_prev ,case when cal.Device_type_cd like '%4GS%' then cal.device_prod_nm  else cal.prod_nm  END AS unmasked_prod_nm ,case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill ,case  when a.sls_outlet_id = '3008' then 'NA'  else outlet.area_desc  end as sls_area ,case  when a.sls_outlet_id = '3008' then 'NA' else outlet.region_desc  end as sls_region ,a.sls_outlet_id ,outlet.channel ,outlet.location ,CASE WHEN cc.acss_call_ctr_desc IN ('NE Columbia SC 2', 'NE Columbia SC') THEN 'NE Columbia'             ELSE cc.acss_call_ctr_desc END AS Center ,u.nm_last||', '||u.nm_first AS rep_nm        ,u.acss_user_id       ,ad.acss_dept_desc ,a.acss_call_dt ,a.acss_call_tm ,a.call_duration ,a.call_period ,sum(case when a.call_period < 3 then (in_type1 + in_type7 +in_other_type + os_type1 + os_type3 + os_type7 + os_other_type) end) calls3 ,sum(case when a.call_period < 32 then (in_type1 + in_type7 + in_other_type +  os_type1 + os_type3 + os_type7 + os_other_type) end) calls31   from ntl_prd_qmtbls.mrs_ndcir_detail as a   left join  ntl_prd_secvm.cust_acct_line_dly_hist_v  as cal on a.cust_id = cal.cust_id and a.cust_line_seq_id = cal.cust_line_seq_id and a.activity_dt BETWEEN cal.eff_dt AND cal.exp_dt   left join ntl_prd_allvm.acss_call_center_v as cc        on a.acss_call_ctr_cd = cc.acss_call_ctr_cd                                  left join ntl_prd_allvm.acss_dept_v as ad   on a.acss_dept_id = ad.acss_dept_id  left join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id =  u.acss_user_id  left outer join   ( select   o.sls_outlet_id  ,o.sls_outlet_nm  ,m.area_desc  ,m.region_desc  ,case   when o.store_type_ind='K' then 'Kiosk'   when o.store_type_ind='S' then 'Store'   when o.store_type_ind='I' then 'In-Store'   when o.store_type_ind='C' then 'Cart'   when o.store_type_ind='V' then 'VZ Experience'   when o.store_type_ind='A' then 'Accesory'   when o.store_type_ind is null then coalesce(agref.master_agent_desc, o.master_agent_id,'-')  end as agent  ,case when agent_type = 'l' then 'Outlet'     when agent_type ='d' then 'Ded Sub Agent'     when agent_type = 's' then 'Sub Agent'     else agent_type end agent_type   ,coalesce(o.master_agent_id,'-') as master_agent_id  ,sdct.sls_dist_chnl_churn_ctgry as channel  ,o.addr_line1  ,coalesce(o.loc_store_nm ,o.city_nm || ' ' || o.state_cd) as location  ,case when o.premium_agent_ind='Y' then 'Premium' else '-' end as premium_agent  ,coalesce(ei.excl_indirect_desc,'-') as excl_ind  ,coalesce(iom.emp_id,o.mgr_emp_id) as emp_id  ,coalesce(he.nm_first || ' ' || he.nm_last,'-') as mgr_name  ,coalesce(he.job_desc,'-') as job_desc  ,coalesce(he.super_nm_lvl1,'-') AS ""Dir""    ,coalesce(he.super_nm_lvl2,'-') AS ""District_Mgr""   ,coalesce(d.district_desc ,'-') as district_desc from ntl_prd_allvm.outlet_v o  left join ntl_prd_allvm.exclusive_indirect_v ei  on o.excl_indirect_ind=ei.excl_indirect_ind  left join ntl_prd_allvm.sales_dist_channel_type_v sdct  on o.sls_dist_chnl_type_cd=sdct.sls_dist_chnl_type_cd  and o.sor_id=sdct.sor_id  left join ntl_prd_allvm.market_v m  on o.sls_outlet_mkt_cd=m.mkt_cd  and o.sor_id=m.sor_id  left join   (select    *  from ntl_prd_allvm.indirect_outlet_manager_v i   where i.end_dt >= current_date   and i.eff_dt = (select max(i1.eff_dt) from ntl_prd_allvm.indirect_outlet_manager_v i1 where i1.sls_outlet_id=i.sls_outlet_id)   and i.emp_id  NOT IN ('999999', 'xxxxxx', 'i99999')   qualify row_number() over (partition by i.sls_outlet_id order by i.sls_outlet_id) = 1) iom  on o.sls_outlet_id=iom.sls_outlet_id  and o.sor_id=iom.sor_id  left join ntl_prd_allvm.hr_employee_v he  on coalesce(iom.emp_id,o.mgr_emp_id) =he.emp_id  left join ntl_prd_allvm.master_agents_xref_v agref   on o.master_agent_id = agref.master_agent_id   and o.master_agent_area_cd = agref.master_agent_area_cd  left outer join ntl_prd_allvm.district_v d  on o.district_cd=d.district_cd ) outlet  on outlet.sls_outlet_id=a.sls_outlet_id  where a.activity_mth = '2012-07-01' and a.sls_outlet_id in ('94866', '84970')  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25"	TERADATA	HABERER	00:00:15	00:00:02	17972
10/11/2012	12:45:31	NTL_PRD_ALLVM	00:00:30	1466			"select  a.activity_mth ,a.activity_type ,a.activity_dt as activity_dt ,a.area_desc as customer_area ,a.region_desc as customer_region ,cal.nm_first||'   '||cal.nm_last AS cust_name ,cal.mtn ,a.cust_id ,a.cust_line_seq_id ,a.prod_nm_prev ,case when cal.Device_type_cd like '%4GS%' then cal.device_prod_nm  else cal.prod_nm  END AS unmasked_prod_nm ,case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill ,case  when a.sls_outlet_id = '3008' then 'NA'  else outlet.area_desc  end as sls_area ,case  when a.sls_outlet_id = '3008' then 'NA' else outlet.region_desc  end as sls_region ,a.sls_outlet_id ,outlet.channel ,outlet.location ,CASE WHEN cc.acss_call_ctr_desc IN ('NE Columbia SC 2', 'NE Columbia SC') THEN 'NE Columbia'             ELSE cc.acss_call_ctr_desc END AS Center ,u.nm_last||', '||u.nm_first AS rep_nm        ,u.acss_user_id       ,ad.acss_dept_desc ,a.acss_call_dt ,a.acss_call_tm ,a.call_duration ,a.call_period ,a.acss_call_type_cd ,sum(case when a.call_period < 3 then (in_type1 + in_type7 +in_other_type + os_type1 + os_type3 + os_type7 + os_other_type) end) calls3 ,sum(case when a.call_period < 32 then (in_type1 + in_type7 + in_other_type +  os_type1 + os_type3 + os_type7 + os_other_type) end) calls31   from ntl_prd_qmtbls.mrs_ndcir_detail as a   left join  ntl_prd_secvm.cust_acct_line_dly_hist_v  as cal on a.cust_id = cal.cust_id and a.cust_line_seq_id = cal.cust_line_seq_id and a.activity_dt BETWEEN cal.eff_dt AND cal.exp_dt   left join ntl_prd_allvm.acss_call_center_v as cc        on a.acss_call_ctr_cd = cc.acss_call_ctr_cd                                  left join ntl_prd_allvm.acss_dept_v as ad   on a.acss_dept_id = ad.acss_dept_id  left join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id =  u.acss_user_id  left outer join   ( select   o.sls_outlet_id  ,o.sls_outlet_nm  ,m.area_desc  ,m.region_desc  ,case   when o.store_type_ind='K' then 'Kiosk'   when o.store_type_ind='S' then 'Store'   when o.store_type_ind='I' then 'In-Store'   when o.store_type_ind='C' then 'Cart'   when o.store_type_ind='V' then 'VZ Experience'   when o.store_type_ind='A' then 'Accesory'   when o.store_type_ind is null then coalesce(agref.master_agent_desc, o.master_agent_id,'-')  end as agent  ,case when agent_type = 'l' then 'Outlet'     when agent_type ='d' then 'Ded Sub Agent'     when agent_type = 's' then 'Sub Agent'     else agent_type end agent_type   ,coalesce(o.master_agent_id,'-') as master_agent_id  ,sdct.sls_dist_chnl_churn_ctgry as channel  ,o.addr_line1  ,coalesce(o.loc_store_nm ,o.city_nm || ' ' || o.state_cd) as location  ,case when o.premium_agent_ind='Y' then 'Premium' else '-' end as premium_agent  ,coalesce(ei.excl_indirect_desc,'-') as excl_ind  ,coalesce(iom.emp_id,o.mgr_emp_id) as emp_id  ,coalesce(he.nm_first || ' ' || he.nm_last,'-') as mgr_name  ,coalesce(he.job_desc,'-') as job_desc  ,coalesce(he.super_nm_lvl1,'-') AS ""Dir""    ,coalesce(he.super_nm_lvl2,'-') AS ""District_Mgr""   ,coalesce(d.district_desc ,'-') as district_desc from ntl_prd_allvm.outlet_v o  left join ntl_prd_allvm.exclusive_indirect_v ei  on o.excl_indirect_ind=ei.excl_indirect_ind  left join ntl_prd_allvm.sales_dist_channel_type_v sdct  on o.sls_dist_chnl_type_cd=sdct.sls_dist_chnl_type_cd  and o.sor_id=sdct.sor_id  left join ntl_prd_allvm.market_v m  on o.sls_outlet_mkt_cd=m.mkt_cd  and o.sor_id=m.sor_id  left join   (select    *  from ntl_prd_allvm.indirect_outlet_manager_v i   where i.end_dt >= current_date   and i.eff_dt = (select max(i1.eff_dt) from ntl_prd_allvm.indirect_outlet_manager_v i1 where i1.sls_outlet_id=i.sls_outlet_id)   and i.emp_id  NOT IN ('999999', 'xxxxxx', 'i99999')   qualify row_number() over (partition by i.sls_outlet_id order by i.sls_outlet_id) = 1) iom  on o.sls_outlet_id=iom.sls_outlet_id  and o.sor_id=iom.sor_id  left join ntl_prd_allvm.hr_employee_v he  on coalesce(iom.emp_id,o.mgr_emp_id) =he.emp_id  left join ntl_prd_allvm.master_agents_xref_v agref   on o.master_agent_id = agref.master_agent_id   and o.master_agent_area_cd = agref.master_agent_area_cd  left outer join ntl_prd_allvm.district_v d  on o.district_cd=d.district_cd ) outlet  on outlet.sls_outlet_id=a.sls_outlet_id  where a.activity_mth = '2012-07-01' and a.sls_outlet_id in ('94866', '84970')  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26"	TERADATA	HABERER	00:00:28	00:00:02	17971
10/11/2012	12:32:11	NTL_PRD_ALLVM	00:00:21	1466			"select  a.activity_mth ,a.activity_type ,a.activity_dt as activity_dt ,a.area_desc as customer_area ,a.region_desc as customer_region ,cal.nm_first||'   '||cal.nm_last AS cust_name ,cal.mtn ,a.cust_id ,a.cust_line_seq_id ,a.prod_nm_prev ,case when cal.Device_type_cd like '%4GS%' then cal.device_prod_nm  else cal.prod_nm  END AS unmasked_prod_nm ,case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill ,case  when a.sls_outlet_id = '3008' then 'NA'  else outlet.area_desc  end as sls_area ,case  when a.sls_outlet_id = '3008' then 'NA' else outlet.region_desc  end as sls_region ,a.sls_outlet_id ,outlet.channel ,outlet.location ,CASE WHEN cc.acss_call_ctr_desc IN ('NE Columbia SC 2', 'NE Columbia SC') THEN 'NE Columbia'             ELSE cc.acss_call_ctr_desc END AS Center ,u.nm_last||', '||u.nm_first AS rep_nm        ,u.acss_user_id       ,ad.acss_dept_desc ,a.acss_call_dt ,a.acss_call_tm ,a.call_duration ,a.call_period ,sum(case when a.call_period < 3 then (in_type1 + in_type7 +in_other_type + os_type1 + os_type3 + os_type7 + os_other_type) end) calls3 ,sum(case when a.call_period < 32 then (in_type1 + in_type7 + in_other_type +  os_type1 + os_type3 + os_type7 + os_other_type) end) calls31   from ntl_prd_qmtbls.mrs_ndcir_detail as a   left join  ntl_prd_secvm.cust_acct_line_dly_hist_v  as cal on a.cust_id = cal.cust_id and a.cust_line_seq_id = cal.cust_line_seq_id and a.activity_dt BETWEEN cal.eff_dt AND cal.exp_dt   left join ntl_prd_allvm.acss_call_center_v as cc        on a.acss_call_ctr_cd = cc.acss_call_ctr_cd                                  left join ntl_prd_allvm.acss_dept_v as ad   on a.acss_dept_id = ad.acss_dept_id  left join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id =  u.acss_user_id  left outer join   ( select   o.sls_outlet_id  ,o.sls_outlet_nm  ,m.area_desc  ,m.region_desc  ,case   when o.store_type_ind='K' then 'Kiosk'   when o.store_type_ind='S' then 'Store'   when o.store_type_ind='I' then 'In-Store'   when o.store_type_ind='C' then 'Cart'   when o.store_type_ind='V' then 'VZ Experience'   when o.store_type_ind='A' then 'Accesory'   when o.store_type_ind is null then coalesce(agref.master_agent_desc, o.master_agent_id,'-')  end as agent  ,case when agent_type = 'l' then 'Outlet'     when agent_type ='d' then 'Ded Sub Agent'     when agent_type = 's' then 'Sub Agent'     else agent_type end agent_type   ,coalesce(o.master_agent_id,'-') as master_agent_id  ,sdct.sls_dist_chnl_churn_ctgry as channel  ,o.addr_line1  ,coalesce(o.loc_store_nm ,o.city_nm || ' ' || o.state_cd) as location  ,case when o.premium_agent_ind='Y' then 'Premium' else '-' end as premium_agent  ,coalesce(ei.excl_indirect_desc,'-') as excl_ind  ,coalesce(iom.emp_id,o.mgr_emp_id) as emp_id  ,coalesce(he.nm_first || ' ' || he.nm_last,'-') as mgr_name  ,coalesce(he.job_desc,'-') as job_desc  ,coalesce(he.super_nm_lvl1,'-') AS ""Dir""    ,coalesce(he.super_nm_lvl2,'-') AS ""District_Mgr""   ,coalesce(d.district_desc ,'-') as district_desc from ntl_prd_allvm.outlet_v o  left join ntl_prd_allvm.exclusive_indirect_v ei  on o.excl_indirect_ind=ei.excl_indirect_ind  left join ntl_prd_allvm.sales_dist_channel_type_v sdct  on o.sls_dist_chnl_type_cd=sdct.sls_dist_chnl_type_cd  and o.sor_id=sdct.sor_id  left join ntl_prd_allvm.market_v m  on o.sls_outlet_mkt_cd=m.mkt_cd  and o.sor_id=m.sor_id  left join   (select    *  from ntl_prd_allvm.indirect_outlet_manager_v i   where i.end_dt >= current_date   and i.eff_dt = (select max(i1.eff_dt) from ntl_prd_allvm.indirect_outlet_manager_v i1 where i1.sls_outlet_id=i.sls_outlet_id)   and i.emp_id  NOT IN ('999999', 'xxxxxx', 'i99999')   qualify row_number() over (partition by i.sls_outlet_id order by i.sls_outlet_id) = 1) iom  on o.sls_outlet_id=iom.sls_outlet_id  and o.sor_id=iom.sor_id  left join ntl_prd_allvm.hr_employee_v he  on coalesce(iom.emp_id,o.mgr_emp_id) =he.emp_id  left join ntl_prd_allvm.master_agents_xref_v agref   on o.master_agent_id = agref.master_agent_id   and o.master_agent_area_cd = agref.master_agent_area_cd  left outer join ntl_prd_allvm.district_v d  on o.district_cd=d.district_cd ) outlet  on outlet.sls_outlet_id=a.sls_outlet_id  where a.activity_mth = '2012-07-01' and a.sls_outlet_id in ('94866', '84970')  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25"	TERADATA	HABERER	00:00:19	00:00:02	17970
10/11/2012	11:43:34	NTL_PRD_ALLVM	00:00:17	818			"select  a.activity_mth ,a.activity_type ,a.activity_dt as activity_dt ,a.area_desc as customer_area ,a.region_desc as customer_region ,case when cal.Device_type_cd like '%4GS%' then cal.device_prod_nm  else cal.prod_nm  END AS unmasked_prod_nm ,case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill ,case  when a.sls_outlet_id = '3008' then 'NA'  else outlet.area_desc  end as sls_area ,case  when a.sls_outlet_id = '3008' then 'NA' else outlet.region_desc  end as sls_region ,a.sls_outlet_id ,outlet.channel ,outlet.location ,coalesce(outlet.agent_type,outlet.district_desc) as disctrict_desc ,count(distinct a.cust_id||a.cust_line_seq_id) as totals ,sum(case when a.call_period < 3 then (in_type1 + in_type7 +in_other_type + os_type1 + os_type3 + os_type7 + os_other_type) end) calls3 ,sum(case when a.call_period < 32 then (in_type1 + in_type7 + in_other_type +  os_type1 + os_type3 + os_type7 + os_other_type) end) calls31   from ntl_prd_qmtbls.mrs_ndcir_detail as a   left join  ntl_prd_secvm.cust_acct_line_dly_hist_v  as cal on a.cust_id = cal.cust_id and a.cust_line_seq_id = cal.cust_line_seq_id and a.activity_dt BETWEEN cal.eff_dt AND cal.exp_dt   left outer join   ( select   o.sls_outlet_id  ,o.sls_outlet_nm  ,m.area_desc  ,m.region_desc  ,case   when o.store_type_ind='K' then 'Kiosk'   when o.store_type_ind='S' then 'Store'   when o.store_type_ind='I' then 'In-Store'   when o.store_type_ind='C' then 'Cart'   when o.store_type_ind='V' then 'VZ Experience'   when o.store_type_ind='A' then 'Accesory'   when o.store_type_ind is null then coalesce(agref.master_agent_desc, o.master_agent_id,'-')  end as agent  ,case when agent_type = 'l' then 'Outlet'     when agent_type ='d' then 'Ded Sub Agent'     when agent_type = 's' then 'Sub Agent'     else agent_type end agent_type   ,coalesce(o.master_agent_id,'-') as master_agent_id  ,sdct.sls_dist_chnl_churn_ctgry as channel  ,o.addr_line1  ,coalesce(o.loc_store_nm ,o.city_nm || ' ' || o.state_cd) as location  ,case when o.premium_agent_ind='Y' then 'Premium' else '-' end as premium_agent  ,coalesce(ei.excl_indirect_desc,'-') as excl_ind  ,coalesce(iom.emp_id,o.mgr_emp_id) as emp_id  ,coalesce(he.nm_first || ' ' || he.nm_last,'-') as mgr_name  ,coalesce(he.job_desc,'-') as job_desc  ,coalesce(he.super_nm_lvl1,'-') AS ""Dir""    ,coalesce(he.super_nm_lvl2,'-') AS ""District_Mgr""   ,coalesce(d.district_desc ,'-') as district_desc from ntl_prd_allvm.outlet_v o  left join ntl_prd_allvm.exclusive_indirect_v ei  on o.excl_indirect_ind=ei.excl_indirect_ind  left join ntl_prd_allvm.sales_dist_channel_type_v sdct  on o.sls_dist_chnl_type_cd=sdct.sls_dist_chnl_type_cd  and o.sor_id=sdct.sor_id  left join ntl_prd_allvm.market_v m  on o.sls_outlet_mkt_cd=m.mkt_cd  and o.sor_id=m.sor_id  left join   (select    *  from ntl_prd_allvm.indirect_outlet_manager_v i   where i.end_dt >= current_date   and i.eff_dt = (select max(i1.eff_dt) from ntl_prd_allvm.indirect_outlet_manager_v i1 where i1.sls_outlet_id=i.sls_outlet_id)   and i.emp_id  NOT IN ('999999', 'xxxxxx', 'i99999')   qualify row_number() over (partition by i.sls_outlet_id order by i.sls_outlet_id) = 1) iom  on o.sls_outlet_id=iom.sls_outlet_id  and o.sor_id=iom.sor_id  left join ntl_prd_allvm.hr_employee_v he  on coalesce(iom.emp_id,o.mgr_emp_id) =he.emp_id  left join ntl_prd_allvm.master_agents_xref_v agref   on o.master_agent_id = agref.master_agent_id   and o.master_agent_area_cd = agref.master_agent_area_cd  left outer join ntl_prd_allvm.district_v d  on o.district_cd=d.district_cd ) outlet  on outlet.sls_outlet_id=a.sls_outlet_id  where a.activity_mth = '2012-07-01' and a.sls_outlet_id in ('94866', '84970')  group by 1,2,3,4,5,6,7,8,9,10,11,12,13"	TERADATA	HABERER	00:00:16	00:00:01	17969
10/11/2012	11:42:12	NTL_PRD_ALLVM	00:00:40	818			"select  a.activity_type ,a.activity_dt as activity_dt ,a.area_desc as customer_area ,a.region_desc as customer_region ,case when cal.Device_type_cd like '%4GS%' then cal.device_prod_nm  else cal.prod_nm  END AS unmasked_prod_nm ,case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill ,case  when a.sls_outlet_id = '3008' then 'NA'  else outlet.area_desc  end as sls_area ,case  when a.sls_outlet_id = '3008' then 'NA' else outlet.region_desc  end as sls_region ,a.sls_outlet_id ,outlet.channel ,outlet.location ,coalesce(outlet.agent_type,outlet.district_desc) as disctrict_desc ,count(distinct a.cust_id||a.cust_line_seq_id) as totals ,sum(case when a.call_period < 3 then (in_type1 + in_type7 +in_other_type + os_type1 + os_type3 + os_type7 + os_other_type) end) calls3 ,sum(case when a.call_period < 32 then (in_type1 + in_type7 + in_other_type +  os_type1 + os_type3 + os_type7 + os_other_type) end) calls31   from ntl_prd_qmtbls.mrs_ndcir_detail as a   left join  ntl_prd_secvm.cust_acct_line_dly_hist_v  as cal on a.cust_id = cal.cust_id and a.cust_line_seq_id = cal.cust_line_seq_id and a.activity_dt BETWEEN cal.eff_dt AND cal.exp_dt   left outer join   ( select   o.sls_outlet_id  ,o.sls_outlet_nm  ,m.area_desc  ,m.region_desc  ,case   when o.store_type_ind='K' then 'Kiosk'   when o.store_type_ind='S' then 'Store'   when o.store_type_ind='I' then 'In-Store'   when o.store_type_ind='C' then 'Cart'   when o.store_type_ind='V' then 'VZ Experience'   when o.store_type_ind='A' then 'Accesory'   when o.store_type_ind is null then coalesce(agref.master_agent_desc, o.master_agent_id,'-')  end as agent  ,case when agent_type = 'l' then 'Outlet'     when agent_type ='d' then 'Ded Sub Agent'     when agent_type = 's' then 'Sub Agent'     else agent_type end agent_type   ,coalesce(o.master_agent_id,'-') as master_agent_id  ,sdct.sls_dist_chnl_churn_ctgry as channel  ,o.addr_line1  ,coalesce(o.loc_store_nm ,o.city_nm || ' ' || o.state_cd) as location  ,case when o.premium_agent_ind='Y' then 'Premium' else '-' end as premium_agent  ,coalesce(ei.excl_indirect_desc,'-') as excl_ind  ,coalesce(iom.emp_id,o.mgr_emp_id) as emp_id  ,coalesce(he.nm_first || ' ' || he.nm_last,'-') as mgr_name  ,coalesce(he.job_desc,'-') as job_desc  ,coalesce(he.super_nm_lvl1,'-') AS ""Dir""    ,coalesce(he.super_nm_lvl2,'-') AS ""District_Mgr""   ,coalesce(d.district_desc ,'-') as district_desc from ntl_prd_allvm.outlet_v o  left join ntl_prd_allvm.exclusive_indirect_v ei  on o.excl_indirect_ind=ei.excl_indirect_ind  left join ntl_prd_allvm.sales_dist_channel_type_v sdct  on o.sls_dist_chnl_type_cd=sdct.sls_dist_chnl_type_cd  and o.sor_id=sdct.sor_id  left join ntl_prd_allvm.market_v m  on o.sls_outlet_mkt_cd=m.mkt_cd  and o.sor_id=m.sor_id  left join   (select    *  from ntl_prd_allvm.indirect_outlet_manager_v i   where i.end_dt >= current_date   and i.eff_dt = (select max(i1.eff_dt) from ntl_prd_allvm.indirect_outlet_manager_v i1 where i1.sls_outlet_id=i.sls_outlet_id)   and i.emp_id  NOT IN ('999999', 'xxxxxx', 'i99999')   qualify row_number() over (partition by i.sls_outlet_id order by i.sls_outlet_id) = 1) iom  on o.sls_outlet_id=iom.sls_outlet_id  and o.sor_id=iom.sor_id  left join ntl_prd_allvm.hr_employee_v he  on coalesce(iom.emp_id,o.mgr_emp_id) =he.emp_id  left join ntl_prd_allvm.master_agents_xref_v agref   on o.master_agent_id = agref.master_agent_id   and o.master_agent_area_cd = agref.master_agent_area_cd  left outer join ntl_prd_allvm.district_v d  on o.district_cd=d.district_cd ) outlet  on outlet.sls_outlet_id=a.sls_outlet_id  where a.activity_mth = '2012-07-01' and a.sls_outlet_id in ('94866', '84970')  group by 1,2,3,4,5,6,7,8,9,10,11,12"	TERADATA	HABERER	00:00:39	00:00:01	17968
10/11/2012	11:41:29	NTL_PRD_ALLVM	00:00:00	0	3625		"select  a.activity_type ,a.activity_dt as activity_dt ,a.area_desc as customer_area ,a.region_desc as customer_region ,case when cal.Device_type_cd like '%4GS%' then cal.device_prod_nm  else cal.prod_nm  END AS unmasked_prod_nm ,case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill ,case  when a.sls_outlet_id = '3008' then 'NA'  else outlet.area_desc  end as sls_area ,case  when a.sls_outlet_id = '3008' then 'NA' else outlet.region_desc  end as sls_region ,a.sls_outlet_id ,outlet.channel ,outlet.location ,coalesce(outlet.agent_type,outlet.district_desc) as disctrict_desc ,count(distinct a.cust_id||a.cust_line_seq_id) as totals ,sum(case when a.call_period < 3 then (in_type1 + in_type7 +in_other_type + os_type1 + os_type3 + os_type7 + os_other_type) end) calls3 ,sum(case when a.call_period < 32 then (in_type1 + in_type7 + in_other_type +  os_type1 + os_type3 + os_type7 + os_other_type) end) calls31   from ntl_prd_qmtbls.mrs_ndcir_detail as a   left join  ntl_prd_secvm.cust_acct_line_dly_hist_v  as cal on a.cust_id = cal.cust_id and a.cust_line_seq_id = cal.cust_line_seq_id and a.activity_dt BETWEEN cal.eff_dt AND cal.exp_dt   left outer join   ( select   o.sls_outlet_id  ,o.sls_outlet_nm  ,m.area_desc  ,m.region_desc  ,case   when o.store_type_ind='K' then 'Kiosk'   when o.store_type_ind='S' then 'Store'   when o.store_type_ind='I' then 'In-Store'   when o.store_type_ind='C' then 'Cart'   when o.store_type_ind='V' then 'VZ Experience'   when o.store_type_ind='A' then 'Accesory'   when o.store_type_ind is null then coalesce(agref.master_agent_desc, o.master_agent_id,'-')  end as agent  ,case when agent_type = 'l' then 'Outlet'     when agent_type ='d' then 'Ded Sub Agent'     when agent_type = 's' then 'Sub Agent'     else agent_type end agent_type   ,coalesce(o.master_agent_id,'-') as master_agent_id  ,sdct.sls_dist_chnl_churn_ctgry as channel  ,o.addr_line1  ,coalesce(o.loc_store_nm ,o.city_nm || ' ' || o.state_cd) as location  ,case when o.premium_agent_ind='Y' then 'Premium' else '-' end as premium_agent  ,coalesce(ei.excl_indirect_desc,'-') as excl_ind  ,coalesce(iom.emp_id,o.mgr_emp_id) as emp_id  ,coalesce(he.nm_first || ' ' || he.nm_last,'-') as mgr_name  ,coalesce(he.job_desc,'-') as job_desc  ,coalesce(he.super_nm_lvl1,'-') AS ""Dir""    ,coalesce(he.super_nm_lvl2,'-') AS ""District_Mgr""   ,coalesce(d.district_desc ,'-') as district_desc from ntl_prd_allvm.outlet_v o  left join ntl_prd_allvm.exclusive_indirect_v ei  on o.excl_indirect_ind=ei.excl_indirect_ind  left join ntl_prd_allvm.sales_dist_channel_type_v sdct  on o.sls_dist_chnl_type_cd=sdct.sls_dist_chnl_type_cd  and o.sor_id=sdct.sor_id  left join ntl_prd_allvm.market_v m  on o.sls_outlet_mkt_cd=m.mkt_cd  and o.sor_id=m.sor_id  left join   (select    *  from ntl_prd_allvm.indirect_outlet_manager_v i   where i.end_dt >= current_date   and i.eff_dt = (select max(i1.eff_dt) from ntl_prd_allvm.indirect_outlet_manager_v i1 where i1.sls_outlet_id=i.sls_outlet_id)   and i.emp_id  NOT IN ('999999', 'xxxxxx', 'i99999')   qualify row_number() over (partition by i.sls_outlet_id order by i.sls_outlet_id) = 1) iom  on o.sls_outlet_id=iom.sls_outlet_id  and o.sor_id=iom.sor_id  left join ntl_prd_allvm.hr_employee_v he  on coalesce(iom.emp_id,o.mgr_emp_id) =he.emp_id  left join ntl_prd_allvm.master_agents_xref_v agref   on o.master_agent_id = agref.master_agent_id   and o.master_agent_area_cd = agref.master_agent_area_cd  left outer join ntl_prd_allvm.district_v d  on o.district_cd=d.district_cd ) outlet  on outlet.sls_outlet_id=a.sls_outlet_id  where a.activity_mth = '2012-07-01' and a.sls_outlet_id in ('94866', '84970')  group by 1,2,3,4,5,6,7,8,9,10,11,12,13"	TERADATA	HABERER	00:00:00	00:00:00	17967
10/11/2012	11:39:21	NTL_PRD_ALLVM	00:00:18	826			"select  a.activity_type ,a.activity_dt as activity_dt ,a.area_desc as customer_area ,a.region_desc as customer_region ,a.prod_nm as masked_prod_nm ,case when cal.Device_type_cd like '%4GS%' then cal.device_prod_nm  else cal.prod_nm  END AS unmasked_prod_nm ,case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill ,a.sls_outlet_id ,outlet.sls_outlet_nm as sls_outlet_nm ,outlet.addr_line1 ,case  when a.sls_outlet_id = '3008' then 'NA'  else outlet.area_desc  end as sls_area ,case  when a.sls_outlet_id = '3008' then 'NA' else outlet.region_desc  end as sls_region ,outlet.channel ,outlet.location ,coalesce(outlet.agent_type,outlet.district_desc) as disctrict_desc ,count(distinct a.cust_id||a.cust_line_seq_id) as totals ,sum(case when a.call_period < 3 then (in_type1 + in_type7 +in_other_type + os_type1 + os_type3 + os_type7 + os_other_type) end) calls3 ,sum(case when a.call_period < 32 then (in_type1 + in_type7 + in_other_type +  os_type1 + os_type3 + os_type7 + os_other_type) end) calls31   from ntl_prd_qmtbls.mrs_ndcir_detail as a   left join  ntl_prd_secvm.cust_acct_line_dly_hist_v  as cal on a.cust_id = cal.cust_id and a.cust_line_seq_id = cal.cust_line_seq_id and a.activity_dt BETWEEN cal.eff_dt AND cal.exp_dt   left outer join   ( select   o.sls_outlet_id  ,o.sls_outlet_nm  ,m.area_desc  ,m.region_desc  ,case   when o.store_type_ind='K' then 'Kiosk'   when o.store_type_ind='S' then 'Store'   when o.store_type_ind='I' then 'In-Store'   when o.store_type_ind='C' then 'Cart'   when o.store_type_ind='V' then 'VZ Experience'   when o.store_type_ind='A' then 'Accesory'   when o.store_type_ind is null then coalesce(agref.master_agent_desc, o.master_agent_id,'-')  end as agent  ,case when agent_type = 'l' then 'Outlet'     when agent_type ='d' then 'Ded Sub Agent'     when agent_type = 's' then 'Sub Agent'     else agent_type end agent_type   ,coalesce(o.master_agent_id,'-') as master_agent_id  ,sdct.sls_dist_chnl_churn_ctgry as channel  ,o.addr_line1  ,coalesce(o.loc_store_nm ,o.city_nm || ' ' || o.state_cd) as location  ,case when o.premium_agent_ind='Y' then 'Premium' else '-' end as premium_agent  ,coalesce(ei.excl_indirect_desc,'-') as excl_ind  ,coalesce(iom.emp_id,o.mgr_emp_id) as emp_id  ,coalesce(he.nm_first || ' ' || he.nm_last,'-') as mgr_name  ,coalesce(he.job_desc,'-') as job_desc  ,coalesce(he.super_nm_lvl1,'-') AS ""Dir""    ,coalesce(he.super_nm_lvl2,'-') AS ""District_Mgr""   ,coalesce(d.district_desc ,'-') as district_desc from ntl_prd_allvm.outlet_v o  left join ntl_prd_allvm.exclusive_indirect_v ei  on o.excl_indirect_ind=ei.excl_indirect_ind  left join ntl_prd_allvm.sales_dist_channel_type_v sdct  on o.sls_dist_chnl_type_cd=sdct.sls_dist_chnl_type_cd  and o.sor_id=sdct.sor_id  left join ntl_prd_allvm.market_v m  on o.sls_outlet_mkt_cd=m.mkt_cd  and o.sor_id=m.sor_id  left join   (select    *  from ntl_prd_allvm.indirect_outlet_manager_v i   where i.end_dt >= current_date   and i.eff_dt = (select max(i1.eff_dt) from ntl_prd_allvm.indirect_outlet_manager_v i1 where i1.sls_outlet_id=i.sls_outlet_id)   and i.emp_id  NOT IN ('999999', 'xxxxxx', 'i99999')   qualify row_number() over (partition by i.sls_outlet_id order by i.sls_outlet_id) = 1) iom  on o.sls_outlet_id=iom.sls_outlet_id  and o.sor_id=iom.sor_id  left join ntl_prd_allvm.hr_employee_v he  on coalesce(iom.emp_id,o.mgr_emp_id) =he.emp_id  left join ntl_prd_allvm.master_agents_xref_v agref   on o.master_agent_id = agref.master_agent_id   and o.master_agent_area_cd = agref.master_agent_area_cd  left outer join ntl_prd_allvm.district_v d  on o.district_cd=d.district_cd ) outlet  on outlet.sls_outlet_id=a.sls_outlet_id  where a.activity_mth = '2012-07-01' and a.sls_outlet_id in ('94866', '84970')  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15"	TERADATA	HABERER	00:00:18	00:00:00	17966
10/11/2012	11:38:41	NTL_PRD_ALLVM	00:00:02	0	10053		"select  a.activity_type ,a.activity_dt as activity_dt ,a.area_desc as customer_area ,a.region_desc as customer_region ,a.prod_nm as masked_prod_nm ,case when cal.Device_type_cd like '%4GS%' then cal.device_prod_nm  else cal.prod_nm  END AS unmasked_prod_nm ,case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill ,a.sls_outlet_id ,outlet.sls_outlet_nm as sls_outlet_nm ,outlet.addr_line1 ,case  when a.sls_outlet_id = '3008' then 'NA'  else outlet.area_desc  end as sls_area ,case  when a.sls_outlet_id = '3008' then 'NA' else outlet.region_desc  end as sls_region ,outlet.channel ,outlet.location ,coalesce(outlet.agent_type,outlet.district_desc) as disctrict_desc ,count(distinct a.cust_id||a.cust_line_seq_id) as totals ,sum(case when a.call_period < 3 then (in_type1 + in_type7 +in_other_type + os_type1 + os_type3 + os_type7 + os_other_type) end) calls3 ,sum(case when a.call_period < 32 then (in_type1 + in_type7 + in_other_type +  os_type1 + os_type3 + os_type7 + os_other_type) end) calls31   from ntl_prd_qmtbls.mrs_ndcir_detail as a   left join  ntl_prd_secvm.cust_acct_line_dly_hist_v  as cal on a.cust_id = cal.cust_id and a.cust_line_seq_id = cal.cust_line_seq_id and a.activity_dt BETWEEN cal.eff_dt AND cal.exp_dt   left outer join   ( select   o.sls_outlet_id  ,o.sls_outlet_nm  ,m.area_desc  ,m.region_desc  ,case   when o.store_type_ind='K' then 'Kiosk'   when o.store_type_ind='S' then 'Store'   when o.store_type_ind='I' then 'In-Store'   when o.store_type_ind='C' then 'Cart'   when o.store_type_ind='V' then 'VZ Experience'   when o.store_type_ind='A' then 'Accesory'   when o.store_type_ind is null then coalesce(agref.master_agent_desc, o.master_agent_id,'-')  end as agent  ,case when agent_type = 'l' then 'Outlet'     when agent_type ='d' then 'Ded Sub Agent'     when agent_type = 's' then 'Sub Agent'     else agent_type end agent_type   ,coalesce(o.master_agent_id,'-') as master_agent_id  ,sdct.sls_dist_chnl_churn_ctgry as channel  ,o.addr_line1  ,coalesce(o.loc_store_nm ,o.city_nm || ' ' || o.state_cd) as location  ,case when o.premium_agent_ind='Y' then 'Premium' else '-' end as premium_agent  ,coalesce(ei.excl_indirect_desc,'-') as excl_ind  ,coalesce(iom.emp_id,o.mgr_emp_id) as emp_id  ,coalesce(he.nm_first || ' ' || he.nm_last,'-') as mgr_name  ,coalesce(he.job_desc,'-') as job_desc  ,coalesce(he.super_nm_lvl1,'-') AS ""Dir""    ,coalesce(he.super_nm_lvl2,'-') AS ""District_Mgr""   ,coalesce(d.district_desc ,'-') as district_desc from ntl_prd_allvm.outlet_v o  left join ntl_prd_allvm.exclusive_indirect_v ei  on o.excl_indirect_ind=ei.excl_indirect_ind  left join ntl_prd_allvm.sales_dist_channel_type_v sdct  on o.sls_dist_chnl_type_cd=sdct.sls_dist_chnl_type_cd  and o.sor_id=sdct.sor_id  left join ntl_prd_allvm.market_v m  on o.sls_outlet_mkt_cd=m.mkt_cd  and o.sor_id=m.sor_id  left join   (select    *  from ntl_prd_allvm.indirect_outlet_manager_v i   where i.end_dt >= current_date   and i.eff_dt = (select max(i1.eff_dt) from ntl_prd_allvm.indirect_outlet_manager_v i1 where i1.sls_outlet_id=i.sls_outlet_id)   and i.emp_id  NOT IN ('999999', 'xxxxxx', 'i99999')   qualify row_number() over (partition by i.sls_outlet_id order by i.sls_outlet_id) = 1) iom  on o.sls_outlet_id=iom.sls_outlet_id  and o.sor_id=iom.sor_id  left join ntl_prd_allvm.hr_employee_v he  on coalesce(iom.emp_id,o.mgr_emp_id) =he.emp_id  left join ntl_prd_allvm.master_agents_xref_v agref   on o.master_agent_id = agref.master_agent_id   and o.master_agent_area_cd = agref.master_agent_area_cd  left outer join ntl_prd_allvm.district_v d  on o.district_cd=d.district_cd ) outlet  on outlet.sls_outlet_id=a.sls_outlet_id  where a.activity_mth = '2012-07-01' and a.sls_outlet_id in ('94866', '84970')  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15"	TERADATA	HABERER	00:00:02	00:00:00	17965
10/11/2012	09:27:52	NTL_PRD_ALLVM	00:00:16	1			select min(activity_mth)  from  ntl_prd_qmvm.ndcir_detail_v  --where activity_mth = '2012-03-01'	TERADATA	HABERER	00:00:16	00:00:00	17963
10/11/2012	09:26:36	NTL_PRD_ALLVM	00:00:04	1			select min(activity_mth)  from  ntl_prd_qmtbls.mrs_ndcir_detail  --where activity_mth = '2012-03-01'	TERADATA	HABERER	00:00:04	00:00:00	17962
10/11/2012	09:26:07	NTL_PRD_ALLVM	00:00:01	0			select *  from  ntl_prd_qmtbls.mrs_ndcir_detail  where activity_mth = '2012-03-01'	TERADATA	HABERER	00:00:01	00:00:00	17961
10/11/2012	09:24:48	NTL_PRD_ALLVM	00:00:24	0			"select  a.activity_type ,a.activity_dt as activity_dt ,a.area_desc as customer_area ,a.region_desc as customer_region ,a.prod_nm as masked_prod_nm ,case when cal.Device_type_cd like '%4GS%' then cal.device_prod_nm  else cal.prod_nm  END AS unmasked_prod_nm ,case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill ,a.sls_outlet_id ,outlet.sls_outlet_nm as sls_outlet_nm ,outlet.addr_line1 ,case  when a.sls_outlet_id = '3008' then 'NA'  else outlet.area_desc  end as sls_area ,case  when a.sls_outlet_id = '3008' then 'NA' else outlet.region_desc  end as sls_region ,outlet.channel ,outlet.location ,coalesce(outlet.agent_type,outlet.district_desc) as disctrict_desc ,count(distinct a.cust_id||a.cust_line_seq_id) as totals ,sum(case when a.call_period < 3 then (in_type1 + in_type7 +in_other_type + os_type1 + os_type3 + os_type7 + os_other_type) end) calls3 ,sum(case when a.call_period < 32 then (in_type1 + in_type7 + in_other_type +  os_type1 + os_type3 + os_type7 + os_other_type) end) calls31   from ntl_prd_qmtbls.mrs_ndcir_detail as a   left join  ntl_prd_secvm.cust_acct_line_dly_hist_v  as cal on a.cust_id = cal.cust_id and a.cust_line_seq_id = cal.cust_line_seq_id and a.activity_dt BETWEEN cal.eff_dt AND cal.exp_dt   left outer join   ( select   o.sls_outlet_id  ,o.sls_outlet_nm  ,m.area_desc  ,m.region_desc  ,case   when o.store_type_ind='K' then 'Kiosk'   when o.store_type_ind='S' then 'Store'   when o.store_type_ind='I' then 'In-Store'   when o.store_type_ind='C' then 'Cart'   when o.store_type_ind='V' then 'VZ Experience'   when o.store_type_ind='A' then 'Accesory'   when o.store_type_ind is null then coalesce(agref.master_agent_desc, o.master_agent_id,'-')  end as agent  ,case when agent_type = 'l' then 'Outlet'     when agent_type ='d' then 'Ded Sub Agent'     when agent_type = 's' then 'Sub Agent'     else agent_type end agent_type   ,coalesce(o.master_agent_id,'-') as master_agent_id  ,sdct.sls_dist_chnl_churn_ctgry as channel  ,o.addr_line1  ,coalesce(o.loc_store_nm ,o.city_nm || ' ' || o.state_cd) as location  ,case when o.premium_agent_ind='Y' then 'Premium' else '-' end as premium_agent  ,coalesce(ei.excl_indirect_desc,'-') as excl_ind  ,coalesce(iom.emp_id,o.mgr_emp_id) as emp_id  ,coalesce(he.nm_first || ' ' || he.nm_last,'-') as mgr_name  ,coalesce(he.job_desc,'-') as job_desc  ,coalesce(he.super_nm_lvl1,'-') AS ""Dir""    ,coalesce(he.super_nm_lvl2,'-') AS ""District_Mgr""   ,coalesce(d.district_desc ,'-') as district_desc from ntl_prd_allvm.outlet_v o  left join ntl_prd_allvm.exclusive_indirect_v ei  on o.excl_indirect_ind=ei.excl_indirect_ind  left join ntl_prd_allvm.sales_dist_channel_type_v sdct  on o.sls_dist_chnl_type_cd=sdct.sls_dist_chnl_type_cd  and o.sor_id=sdct.sor_id  left join ntl_prd_allvm.market_v m  on o.sls_outlet_mkt_cd=m.mkt_cd  and o.sor_id=m.sor_id  left join   (select    *  from ntl_prd_allvm.indirect_outlet_manager_v i   where i.end_dt >= current_date   and i.eff_dt = (select max(i1.eff_dt) from ntl_prd_allvm.indirect_outlet_manager_v i1 where i1.sls_outlet_id=i.sls_outlet_id)   and i.emp_id  NOT IN ('999999', 'xxxxxx', 'i99999')   qualify row_number() over (partition by i.sls_outlet_id order by i.sls_outlet_id) = 1) iom  on o.sls_outlet_id=iom.sls_outlet_id  and o.sor_id=iom.sor_id  left join ntl_prd_allvm.hr_employee_v he  on coalesce(iom.emp_id,o.mgr_emp_id) =he.emp_id  left join ntl_prd_allvm.master_agents_xref_v agref   on o.master_agent_id = agref.master_agent_id   and o.master_agent_area_cd = agref.master_agent_area_cd  left outer join ntl_prd_allvm.district_v d  on o.district_cd=d.district_cd ) outlet  on outlet.sls_outlet_id=a.sls_outlet_id  where a.activity_mth = '2012-03-01' and a.sls_outlet_id in ('94866', '84970')  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15"	TERADATA	HABERER	00:00:24	00:00:00	17960
10/11/2012	09:22:48	NTL_PRD_ALLVM	00:00:36	0			"select  a.activity_type ,a.activity_dt as activity_dt ,a.area_desc as customer_area ,a.region_desc as customer_region ,a.prod_nm as masked_prod_nm ,case when cal.Device_type_cd like '%4GS%' then cal.device_prod_nm  else cal.prod_nm  END AS unmasked_prod_nm ,case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill ,a.sls_outlet_id ,outlet.sls_outlet_nm as sls_outlet_nm ,outlet.addr_line1 ,case  when a.sls_outlet_id = '3008' then 'NA'  else outlet.area_desc  end as sls_area ,case  when a.sls_outlet_id = '3008' then 'NA' else outlet.region_desc  end as sls_region ,outlet.channel ,outlet.location ,coalesce(outlet.agent_type,outlet.district_desc) as disctrict_desc ,count(distinct a.cust_id||a.cust_line_seq_id) as totals ,sum(case when a.call_period < 3 then (in_type1 + in_type7 +in_other_type + os_type1 + os_type3 + os_type7 + os_other_type) end) calls3 ,sum(case when a.call_period < 32 then (in_type1 + in_type7 + in_other_type +  os_type1 + os_type3 + os_type7 + os_other_type) end) calls31   from ntl_prd_qmtbls.mrs_ndcir_detail as a   join  ntl_prd_secvm.cust_acct_line_dly_hist_v  as cal on a.cust_id = cal.cust_id and a.cust_line_seq_id = cal.cust_line_seq_id and a.activity_dt BETWEEN cal.eff_dt AND cal.exp_dt   left outer join   ( select   o.sls_outlet_id  ,o.sls_outlet_nm  ,m.area_desc  ,m.region_desc  ,case   when o.store_type_ind='K' then 'Kiosk'   when o.store_type_ind='S' then 'Store'   when o.store_type_ind='I' then 'In-Store'   when o.store_type_ind='C' then 'Cart'   when o.store_type_ind='V' then 'VZ Experience'   when o.store_type_ind='A' then 'Accesory'   when o.store_type_ind is null then coalesce(agref.master_agent_desc, o.master_agent_id,'-')  end as agent  ,case when agent_type = 'l' then 'Outlet'     when agent_type ='d' then 'Ded Sub Agent'     when agent_type = 's' then 'Sub Agent'     else agent_type end agent_type   ,coalesce(o.master_agent_id,'-') as master_agent_id  ,sdct.sls_dist_chnl_churn_ctgry as channel  ,o.addr_line1  ,coalesce(o.loc_store_nm ,o.city_nm || ' ' || o.state_cd) as location  ,case when o.premium_agent_ind='Y' then 'Premium' else '-' end as premium_agent  ,coalesce(ei.excl_indirect_desc,'-') as excl_ind  ,coalesce(iom.emp_id,o.mgr_emp_id) as emp_id  ,coalesce(he.nm_first || ' ' || he.nm_last,'-') as mgr_name  ,coalesce(he.job_desc,'-') as job_desc  ,coalesce(he.super_nm_lvl1,'-') AS ""Dir""    ,coalesce(he.super_nm_lvl2,'-') AS ""District_Mgr""   ,coalesce(d.district_desc ,'-') as district_desc from ntl_prd_allvm.outlet_v o  left join ntl_prd_allvm.exclusive_indirect_v ei  on o.excl_indirect_ind=ei.excl_indirect_ind  left join ntl_prd_allvm.sales_dist_channel_type_v sdct  on o.sls_dist_chnl_type_cd=sdct.sls_dist_chnl_type_cd  and o.sor_id=sdct.sor_id  left join ntl_prd_allvm.market_v m  on o.sls_outlet_mkt_cd=m.mkt_cd  and o.sor_id=m.sor_id  left join   (select    *  from ntl_prd_allvm.indirect_outlet_manager_v i   where i.end_dt >= current_date   and i.eff_dt = (select max(i1.eff_dt) from ntl_prd_allvm.indirect_outlet_manager_v i1 where i1.sls_outlet_id=i.sls_outlet_id)   and i.emp_id  NOT IN ('999999', 'xxxxxx', 'i99999')   qualify row_number() over (partition by i.sls_outlet_id order by i.sls_outlet_id) = 1) iom  on o.sls_outlet_id=iom.sls_outlet_id  and o.sor_id=iom.sor_id  left join ntl_prd_allvm.hr_employee_v he  on coalesce(iom.emp_id,o.mgr_emp_id) =he.emp_id  left join ntl_prd_allvm.master_agents_xref_v agref   on o.master_agent_id = agref.master_agent_id   and o.master_agent_area_cd = agref.master_agent_area_cd  left outer join ntl_prd_allvm.district_v d  on o.district_cd=d.district_cd ) outlet  on outlet.sls_outlet_id=a.sls_outlet_id  where a.activity_mth = '2012-03-01' and a.sls_outlet_id in ('94866', '84970')  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15"	TERADATA	HABERER	00:00:36	00:00:00	17959
10/11/2012	09:15:05	NTL_PRD_ALLVM	00:00:24	772			"select  a.activity_type ,a.activity_dt as activity_dt ,a.area_desc as customer_area ,a.region_desc as customer_region ,a.prod_nm as masked_prod_nm ,case when cal.Device_type_cd like '%4GS%' then cal.device_prod_nm  else cal.prod_nm  END AS unmasked_prod_nm ,case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill ,a.sls_outlet_id ,outlet.sls_outlet_nm as sls_outlet_nm ,outlet.addr_line1 ,case  when a.sls_outlet_id = '3008' then 'NA'  else outlet.area_desc  end as sls_area ,case  when a.sls_outlet_id = '3008' then 'NA' else outlet.region_desc  end as sls_region ,outlet.channel ,outlet.location ,coalesce(outlet.agent_type,outlet.district_desc) as disctrict_desc ,count(distinct a.cust_id||a.cust_line_seq_id) as totals ,sum(case when a.call_period < 3 then (in_type1 + in_type7 +in_other_type + os_type1 + os_type3 + os_type7 + os_other_type) end) calls3 ,sum(case when a.call_period < 32 then (in_type1 + in_type7 + in_other_type +  os_type1 + os_type3 + os_type7 + os_other_type) end) calls31   from ntl_prd_qmtbls.mrs_ndcir_detail as a   join  ntl_prd_secvm.cust_acct_line_dly_hist_v  as cal on a.cust_id = cal.cust_id and a.cust_line_seq_id = cal.cust_line_seq_id and a.activity_dt BETWEEN cal.eff_dt AND cal.exp_dt   left outer join   ( select   o.sls_outlet_id  ,o.sls_outlet_nm  ,m.area_desc  ,m.region_desc  ,case   when o.store_type_ind='K' then 'Kiosk'   when o.store_type_ind='S' then 'Store'   when o.store_type_ind='I' then 'In-Store'   when o.store_type_ind='C' then 'Cart'   when o.store_type_ind='V' then 'VZ Experience'   when o.store_type_ind='A' then 'Accesory'   when o.store_type_ind is null then coalesce(agref.master_agent_desc, o.master_agent_id,'-')  end as agent  ,case when agent_type = 'l' then 'Outlet'     when agent_type ='d' then 'Ded Sub Agent'     when agent_type = 's' then 'Sub Agent'     else agent_type end agent_type   ,coalesce(o.master_agent_id,'-') as master_agent_id  ,sdct.sls_dist_chnl_churn_ctgry as channel  ,o.addr_line1  ,coalesce(o.loc_store_nm ,o.city_nm || ' ' || o.state_cd) as location  ,case when o.premium_agent_ind='Y' then 'Premium' else '-' end as premium_agent  ,coalesce(ei.excl_indirect_desc,'-') as excl_ind  ,coalesce(iom.emp_id,o.mgr_emp_id) as emp_id  ,coalesce(he.nm_first || ' ' || he.nm_last,'-') as mgr_name  ,coalesce(he.job_desc,'-') as job_desc  ,coalesce(he.super_nm_lvl1,'-') AS ""Dir""    ,coalesce(he.super_nm_lvl2,'-') AS ""District_Mgr""   ,coalesce(d.district_desc ,'-') as district_desc from ntl_prd_allvm.outlet_v o  left join ntl_prd_allvm.exclusive_indirect_v ei  on o.excl_indirect_ind=ei.excl_indirect_ind  left join ntl_prd_allvm.sales_dist_channel_type_v sdct  on o.sls_dist_chnl_type_cd=sdct.sls_dist_chnl_type_cd  and o.sor_id=sdct.sor_id  left join ntl_prd_allvm.market_v m  on o.sls_outlet_mkt_cd=m.mkt_cd  and o.sor_id=m.sor_id  left join   (select    *  from ntl_prd_allvm.indirect_outlet_manager_v i   where i.end_dt >= current_date   and i.eff_dt = (select max(i1.eff_dt) from ntl_prd_allvm.indirect_outlet_manager_v i1 where i1.sls_outlet_id=i.sls_outlet_id)   and i.emp_id  NOT IN ('999999', 'xxxxxx', 'i99999')   qualify row_number() over (partition by i.sls_outlet_id order by i.sls_outlet_id) = 1) iom  on o.sls_outlet_id=iom.sls_outlet_id  and o.sor_id=iom.sor_id  left join ntl_prd_allvm.hr_employee_v he  on coalesce(iom.emp_id,o.mgr_emp_id) =he.emp_id  left join ntl_prd_allvm.master_agents_xref_v agref   on o.master_agent_id = agref.master_agent_id   and o.master_agent_area_cd = agref.master_agent_area_cd  left outer join ntl_prd_allvm.district_v d  on o.district_cd=d.district_cd ) outlet  on outlet.sls_outlet_id=a.sls_outlet_id  where a.activity_mth = '2012-08-01' and a.sls_outlet_id in ('94866', '84970')  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15"	TERADATA	HABERER	00:00:23	00:00:01	17958
10/11/2012	09:13:16	NTL_PRD_ALLVM	00:00:22	775			"select  a.activity_type ,a.activity_dt as activity_dt ,a.area_desc as customer_area ,a.region_desc as customer_region ,a.prod_nm as masked_prod_nm ,case when cal.prod_nm like 'Gemalto%' then cal.device_prod_nm else coalesce(cal.prod_nm,cal.device_prod_nm)  end as unmasked_prod_nm ,case when cal.Device_type_cd like '%4GS%' then cal.device_prod_nm  else cal.prod_nm  END AS Device_Nm ,case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill ,a.sls_outlet_id ,outlet.sls_outlet_nm as sls_outlet_nm ,outlet.addr_line1 ,case  when a.sls_outlet_id = '3008' then 'NA'  else outlet.area_desc  end as sls_area ,case  when a.sls_outlet_id = '3008' then 'NA' else outlet.region_desc  end as sls_region ,outlet.channel ,outlet.location ,coalesce(outlet.agent_type,outlet.district_desc) as disctrict_desc ,count(distinct a.cust_id||a.cust_line_seq_id) as totals ,sum(case when a.call_period < 3 then (in_type1 + in_type7 +in_other_type + os_type1 + os_type3 + os_type7 + os_other_type) end) calls3 ,sum(case when a.call_period < 32 then (in_type1 + in_type7 + in_other_type +  os_type1 + os_type3 + os_type7 + os_other_type) end) calls31   from ntl_prd_qmtbls.mrs_ndcir_detail as a   join  ntl_prd_secvm.cust_acct_line_dly_hist_v  as cal on a.cust_id = cal.cust_id and a.cust_line_seq_id = cal.cust_line_seq_id and a.activity_dt BETWEEN cal.eff_dt AND cal.exp_dt   left outer join   ( select   o.sls_outlet_id  ,o.sls_outlet_nm  ,m.area_desc  ,m.region_desc  ,case   when o.store_type_ind='K' then 'Kiosk'   when o.store_type_ind='S' then 'Store'   when o.store_type_ind='I' then 'In-Store'   when o.store_type_ind='C' then 'Cart'   when o.store_type_ind='V' then 'VZ Experience'   when o.store_type_ind='A' then 'Accesory'   when o.store_type_ind is null then coalesce(agref.master_agent_desc, o.master_agent_id,'-')  end as agent  ,case when agent_type = 'l' then 'Outlet'     when agent_type ='d' then 'Ded Sub Agent'     when agent_type = 's' then 'Sub Agent'     else agent_type end agent_type   ,coalesce(o.master_agent_id,'-') as master_agent_id  ,sdct.sls_dist_chnl_churn_ctgry as channel  ,o.addr_line1  ,coalesce(o.loc_store_nm ,o.city_nm || ' ' || o.state_cd) as location  ,case when o.premium_agent_ind='Y' then 'Premium' else '-' end as premium_agent  ,coalesce(ei.excl_indirect_desc,'-') as excl_ind  ,coalesce(iom.emp_id,o.mgr_emp_id) as emp_id  ,coalesce(he.nm_first || ' ' || he.nm_last,'-') as mgr_name  ,coalesce(he.job_desc,'-') as job_desc  ,coalesce(he.super_nm_lvl1,'-') AS ""Dir""    ,coalesce(he.super_nm_lvl2,'-') AS ""District_Mgr""   ,coalesce(d.district_desc ,'-') as district_desc from ntl_prd_allvm.outlet_v o  left join ntl_prd_allvm.exclusive_indirect_v ei  on o.excl_indirect_ind=ei.excl_indirect_ind  left join ntl_prd_allvm.sales_dist_channel_type_v sdct  on o.sls_dist_chnl_type_cd=sdct.sls_dist_chnl_type_cd  and o.sor_id=sdct.sor_id  left join ntl_prd_allvm.market_v m  on o.sls_outlet_mkt_cd=m.mkt_cd  and o.sor_id=m.sor_id  left join   (select    *  from ntl_prd_allvm.indirect_outlet_manager_v i   where i.end_dt >= current_date   and i.eff_dt = (select max(i1.eff_dt) from ntl_prd_allvm.indirect_outlet_manager_v i1 where i1.sls_outlet_id=i.sls_outlet_id)   and i.emp_id  NOT IN ('999999', 'xxxxxx', 'i99999')   qualify row_number() over (partition by i.sls_outlet_id order by i.sls_outlet_id) = 1) iom  on o.sls_outlet_id=iom.sls_outlet_id  and o.sor_id=iom.sor_id  left join ntl_prd_allvm.hr_employee_v he  on coalesce(iom.emp_id,o.mgr_emp_id) =he.emp_id  left join ntl_prd_allvm.master_agents_xref_v agref   on o.master_agent_id = agref.master_agent_id   and o.master_agent_area_cd = agref.master_agent_area_cd  left outer join ntl_prd_allvm.district_v d  on o.district_cd=d.district_cd ) outlet  on outlet.sls_outlet_id=a.sls_outlet_id  where a.activity_mth = '2012-08-01' and a.sls_outlet_id in ('94866', '84970')  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16"	TERADATA	HABERER	00:00:21	00:00:01	17957
10/11/2012	09:08:25	NTL_PRD_ALLVM	00:00:40	680			"select  a.activity_type ,a.activity_dt as activity_dt ,a.area_desc as customer_area ,a.region_desc as customer_region ,a.prod_nm as masked_prod_nm ,case when cal.prod_nm like 'Gemalto%' then cal.device_prod_nm else coalesce(cal.prod_nm,cal.device_prod_nm)  end as unmasked_prod_nm ,case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill ,a.sls_outlet_id ,outlet.sls_outlet_nm as sls_outlet_nm ,outlet.addr_line1 ,case  when a.sls_outlet_id = '3008' then 'NA'  else outlet.area_desc  end as sls_area ,case  when a.sls_outlet_id = '3008' then 'NA' else outlet.region_desc  end as sls_region ,outlet.channel ,outlet.location ,coalesce(outlet.agent_type,outlet.district_desc) as disctrict_desc ,count(distinct a.cust_id||a.cust_line_seq_id) as totals ,sum(case when a.call_period < 3 then (in_type1 + in_type7 +in_other_type + os_type1 + os_type3 + os_type7 + os_other_type) end) calls3 ,sum(case when a.call_period < 32 then (in_type1 + in_type7 + in_other_type +  os_type1 + os_type3 + os_type7 + os_other_type) end) calls31   from ntl_prd_qmtbls.mrs_ndcir_detail as a   join  ntl_prd_secvm.cust_acct_line_dly_hist_v  as cal on a.cust_id = cal.cust_id and a.cust_line_seq_id = cal.cust_line_seq_id and a.activity_dt BETWEEN cal.eff_dt AND cal.exp_dt   left outer join   ( select   o.sls_outlet_id  ,o.sls_outlet_nm  ,m.area_desc  ,m.region_desc  ,case   when o.store_type_ind='K' then 'Kiosk'   when o.store_type_ind='S' then 'Store'   when o.store_type_ind='I' then 'In-Store'   when o.store_type_ind='C' then 'Cart'   when o.store_type_ind='V' then 'VZ Experience'   when o.store_type_ind='A' then 'Accesory'   when o.store_type_ind is null then coalesce(agref.master_agent_desc, o.master_agent_id,'-')  end as agent  ,case when agent_type = 'l' then 'Outlet'     when agent_type ='d' then 'Ded Sub Agent'     when agent_type = 's' then 'Sub Agent'     else agent_type end agent_type   ,coalesce(o.master_agent_id,'-') as master_agent_id  ,sdct.sls_dist_chnl_churn_ctgry as channel  ,o.addr_line1  ,coalesce(o.loc_store_nm ,o.city_nm || ' ' || o.state_cd) as location  ,case when o.premium_agent_ind='Y' then 'Premium' else '-' end as premium_agent  ,coalesce(ei.excl_indirect_desc,'-') as excl_ind  ,coalesce(iom.emp_id,o.mgr_emp_id) as emp_id  ,coalesce(he.nm_first || ' ' || he.nm_last,'-') as mgr_name  ,coalesce(he.job_desc,'-') as job_desc  ,coalesce(he.super_nm_lvl1,'-') AS ""Dir""    ,coalesce(he.super_nm_lvl2,'-') AS ""District_Mgr""   ,coalesce(d.district_desc ,'-') as district_desc from ntl_prd_allvm.outlet_v o  left join ntl_prd_allvm.exclusive_indirect_v ei  on o.excl_indirect_ind=ei.excl_indirect_ind  left join ntl_prd_allvm.sales_dist_channel_type_v sdct  on o.sls_dist_chnl_type_cd=sdct.sls_dist_chnl_type_cd  and o.sor_id=sdct.sor_id  left join ntl_prd_allvm.market_v m  on o.sls_outlet_mkt_cd=m.mkt_cd  and o.sor_id=m.sor_id  left join   (select    *  from ntl_prd_allvm.indirect_outlet_manager_v i   where i.end_dt >= current_date   and i.eff_dt = (select max(i1.eff_dt) from ntl_prd_allvm.indirect_outlet_manager_v i1 where i1.sls_outlet_id=i.sls_outlet_id)   and i.emp_id  NOT IN ('999999', 'xxxxxx', 'i99999')   qualify row_number() over (partition by i.sls_outlet_id order by i.sls_outlet_id) = 1) iom  on o.sls_outlet_id=iom.sls_outlet_id  and o.sor_id=iom.sor_id  left join ntl_prd_allvm.hr_employee_v he  on coalesce(iom.emp_id,o.mgr_emp_id) =he.emp_id  left join ntl_prd_allvm.master_agents_xref_v agref   on o.master_agent_id = agref.master_agent_id   and o.master_agent_area_cd = agref.master_agent_area_cd  left outer join ntl_prd_allvm.district_v d  on o.district_cd=d.district_cd ) outlet  on outlet.sls_outlet_id=a.sls_outlet_id  where a.activity_mth = '2012-08-01' and a.sls_outlet_id in ('94866', '84970')  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15"	TERADATA	HABERER	00:00:40	00:00:00	17956
10/11/2012	09:00:08	NTL_PRD_ALLVM	00:00:29	496			"select  a.activity_type ,a.activity_dt as activity_dt ,a.area_desc as customer_area ,a.region_desc as customer_region ,a.prod_nm ,case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill ,a.sls_outlet_id ,outlet.sls_outlet_nm as sls_outlet_nm ,outlet.addr_line1 ,case  when a.sls_outlet_id = '3008' then 'NA'  else outlet.area_desc  end as sls_area ,case  when a.sls_outlet_id = '3008' then 'NA' else outlet.region_desc  end as sls_region ,outlet.channel ,outlet.location ,coalesce(outlet.agent_type,outlet.district_desc) as disctrict_desc ,count(distinct a.cust_id||a.cust_line_seq_id) as totals ,sum(case when a.call_period < 3 then (in_type1 + in_type7 +in_other_type + os_type1 + os_type3 + os_type7 + os_other_type) end) calls3 ,sum(case when a.call_period < 32 then (in_type1 + in_type7 + in_other_type +  os_type1 + os_type3 + os_type7 + os_other_type) end) calls31   from ntl_prd_qmtbls.mrs_ndcir_detail as a   left outer join   ( select   o.sls_outlet_id  ,o.sls_outlet_nm  ,m.area_desc  ,m.region_desc  ,case   when o.store_type_ind='K' then 'Kiosk'   when o.store_type_ind='S' then 'Store'   when o.store_type_ind='I' then 'In-Store'   when o.store_type_ind='C' then 'Cart'   when o.store_type_ind='V' then 'VZ Experience'   when o.store_type_ind='A' then 'Accesory'   when o.store_type_ind is null then coalesce(agref.master_agent_desc, o.master_agent_id,'-')  end as agent  ,case when agent_type = 'l' then 'Outlet'     when agent_type ='d' then 'Ded Sub Agent'     when agent_type = 's' then 'Sub Agent'     else agent_type end agent_type   ,coalesce(o.master_agent_id,'-') as master_agent_id  ,sdct.sls_dist_chnl_churn_ctgry as channel  ,o.addr_line1  ,coalesce(o.loc_store_nm ,o.city_nm || ' ' || o.state_cd) as location  ,case when o.premium_agent_ind='Y' then 'Premium' else '-' end as premium_agent  ,coalesce(ei.excl_indirect_desc,'-') as excl_ind  ,coalesce(iom.emp_id,o.mgr_emp_id) as emp_id  ,coalesce(he.nm_first || ' ' || he.nm_last,'-') as mgr_name  ,coalesce(he.job_desc,'-') as job_desc  ,coalesce(he.super_nm_lvl1,'-') AS ""Dir""    ,coalesce(he.super_nm_lvl2,'-') AS ""District_Mgr""   ,coalesce(d.district_desc ,'-') as district_desc from ntl_prd_allvm.outlet_v o  left join ntl_prd_allvm.exclusive_indirect_v ei  on o.excl_indirect_ind=ei.excl_indirect_ind  left join ntl_prd_allvm.sales_dist_channel_type_v sdct  on o.sls_dist_chnl_type_cd=sdct.sls_dist_chnl_type_cd  and o.sor_id=sdct.sor_id  left join ntl_prd_allvm.market_v m  on o.sls_outlet_mkt_cd=m.mkt_cd  and o.sor_id=m.sor_id  left join   (select    *  from ntl_prd_allvm.indirect_outlet_manager_v i   where i.end_dt >= current_date   and i.eff_dt = (select max(i1.eff_dt) from ntl_prd_allvm.indirect_outlet_manager_v i1 where i1.sls_outlet_id=i.sls_outlet_id)   and i.emp_id  NOT IN ('999999', 'xxxxxx', 'i99999')   qualify row_number() over (partition by i.sls_outlet_id order by i.sls_outlet_id) = 1) iom  on o.sls_outlet_id=iom.sls_outlet_id  and o.sor_id=iom.sor_id  left join ntl_prd_allvm.hr_employee_v he  on coalesce(iom.emp_id,o.mgr_emp_id) =he.emp_id  left join ntl_prd_allvm.master_agents_xref_v agref   on o.master_agent_id = agref.master_agent_id   and o.master_agent_area_cd = agref.master_agent_area_cd  left outer join ntl_prd_allvm.district_v d  on o.district_cd=d.district_cd ) outlet  on outlet.sls_outlet_id=a.sls_outlet_id  where a.activity_mth = '2012-08-01' and a.sls_outlet_id in ('94866', '84970')  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14"	TERADATA	HABERER	00:00:28	00:00:01	17955
10/11/2012	08:58:49	NTL_PRD_ALLVM	00:00:19	496			"select  a.activity_type ,a.activity_dt as activity_dt ,a.area_desc as customer_area ,a.region_desc as customer_region ,a.prod_nm ,case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill ,a.sls_outlet_id ,outlet.sls_outlet_nm as sls_outlet_nm ,outlet.master_agent_id ,outlet.addr_line1 ,case  when a.sls_outlet_id = '3008' then 'NA'  else outlet.area_desc  end as sls_area ,case  when a.sls_outlet_id = '3008' then 'NA' else outlet.region_desc  end as sls_region ,outlet.channel ,outlet.location ,coalesce(outlet.agent_type,outlet.district_desc) as disctrict_desc ,count(distinct a.cust_id||a.cust_line_seq_id) as totals ,sum(case when a.call_period < 3 then (in_type1 + in_type7 +in_other_type + os_type1 + os_type3 + os_type7 + os_other_type) end) calls3 ,sum(case when a.call_period < 32 then (in_type1 + in_type7 + in_other_type +  os_type1 + os_type3 + os_type7 + os_other_type) end) calls31   from ntl_prd_qmtbls.mrs_ndcir_detail as a   left outer join   ( select   o.sls_outlet_id  ,o.sls_outlet_nm  ,m.area_desc  ,m.region_desc  ,case   when o.store_type_ind='K' then 'Kiosk'   when o.store_type_ind='S' then 'Store'   when o.store_type_ind='I' then 'In-Store'   when o.store_type_ind='C' then 'Cart'   when o.store_type_ind='V' then 'VZ Experience'   when o.store_type_ind='A' then 'Accesory'   when o.store_type_ind is null then coalesce(agref.master_agent_desc, o.master_agent_id,'-')  end as agent  ,case when agent_type = 'l' then 'Outlet'     when agent_type ='d' then 'Ded Sub Agent'     when agent_type = 's' then 'Sub Agent'     else agent_type end agent_type   ,coalesce(o.master_agent_id,'-') as master_agent_id  ,sdct.sls_dist_chnl_churn_ctgry as channel  ,o.addr_line1  ,coalesce(o.loc_store_nm ,o.city_nm || ' ' || o.state_cd) as location  ,case when o.premium_agent_ind='Y' then 'Premium' else '-' end as premium_agent  ,coalesce(ei.excl_indirect_desc,'-') as excl_ind  ,coalesce(iom.emp_id,o.mgr_emp_id) as emp_id  ,coalesce(he.nm_first || ' ' || he.nm_last,'-') as mgr_name  ,coalesce(he.job_desc,'-') as job_desc  ,coalesce(he.super_nm_lvl1,'-') AS ""Dir""    ,coalesce(he.super_nm_lvl2,'-') AS ""District_Mgr""   ,coalesce(d.district_desc ,'-') as district_desc from ntl_prd_allvm.outlet_v o  left join ntl_prd_allvm.exclusive_indirect_v ei  on o.excl_indirect_ind=ei.excl_indirect_ind  left join ntl_prd_allvm.sales_dist_channel_type_v sdct  on o.sls_dist_chnl_type_cd=sdct.sls_dist_chnl_type_cd  and o.sor_id=sdct.sor_id  left join ntl_prd_allvm.market_v m  on o.sls_outlet_mkt_cd=m.mkt_cd  and o.sor_id=m.sor_id  left join   (select    *  from ntl_prd_allvm.indirect_outlet_manager_v i   where i.end_dt >= current_date   and i.eff_dt = (select max(i1.eff_dt) from ntl_prd_allvm.indirect_outlet_manager_v i1 where i1.sls_outlet_id=i.sls_outlet_id)   and i.emp_id  NOT IN ('999999', 'xxxxxx', 'i99999')   qualify row_number() over (partition by i.sls_outlet_id order by i.sls_outlet_id) = 1) iom  on o.sls_outlet_id=iom.sls_outlet_id  and o.sor_id=iom.sor_id  left join ntl_prd_allvm.hr_employee_v he  on coalesce(iom.emp_id,o.mgr_emp_id) =he.emp_id  left join ntl_prd_allvm.master_agents_xref_v agref   on o.master_agent_id = agref.master_agent_id   and o.master_agent_area_cd = agref.master_agent_area_cd  left outer join ntl_prd_allvm.district_v d  on o.district_cd=d.district_cd ) outlet  on outlet.sls_outlet_id=a.sls_outlet_id  where a.activity_mth = '2012-08-01' and a.sls_outlet_id in ('94866', '84970')  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15"	TERADATA	HABERER	00:00:19	00:00:00	17954
10/11/2012	08:51:14	NTL_PRD_ALLVM	00:00:01	1			select (scal.calendar_date-day_of_week)+7 from sys_calendar.calendar scal where scal.calendar_date=date - 7	TERADATA	HABERER	00:00:00	00:00:01	17953
10/11/2012	08:50:45	NTL_PRD_ALLVM	00:00:01	1			select scal.calendar_date - day_of_week from sys_calendar.calendar scal where scal.calendar_date = date - 7	TERADATA	HABERER	00:00:00	00:00:01	17952
10/11/2012	08:34:36	NTL_PRD_ALLVM	00:00:09	1335			select a.activity_mth, a.activity_type, a.district_cd, a.outlet, a.cust_area, a.cust_region, cal.nm_first||'   '||cal.nm_last AS cust_name, cal.mtn, a.cust_id, a.cust_line_seq_id, a.activity_dt, a.prod_nm_prev, a.prod_nm, case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill,  CASE WHEN cc.acss_call_ctr_desc IN ('NE Columbia SC 2', 'NE Columbia SC') THEN 'NE Columbia'             ELSE cc.acss_call_ctr_desc END AS Center,  u.nm_last||', '||u.nm_first AS rep_nm,         u.acss_user_id,        ad.acss_dept_desc,  a.acss_call_dt, a.acss_call_tm, a.call_duration, a.call_period, a.acss_call_type_cd, case when a.acss_call_id is not null then '1' else '0' end as call_count, sum(case when a.call_period < 3 then (in_type1 + in_type7 +in_other_type + os_type1 + os_type3 + os_type7 + os_other_type) end) calls3,   sum(case when a.call_period < 32 then (in_type1 + in_type7 + in_other_type +  os_type1 + os_type3 + os_type7 + os_other_type) end) calls31    from  ntl_prd_qmvm.ndcir_detail_v as a  join  ntl_prd_allvm.cust_acct_line_dly_hist_v  as cal on a.cust_id = cal.cust_id and a.cust_line_seq_id = cal.cust_line_seq_id and a.activity_dt BETWEEN cal.eff_dt AND cal.exp_dt   left join ntl_prd_allvm.acss_call_center_v as cc        on a.acss_call_ctr_cd = cc.acss_call_ctr_cd                                  left join ntl_prd_allvm.acss_dept_v as ad   on a.acss_dept_id = ad.acss_dept_id  left join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id =  u.acss_user_id    where a.activity_mth = '2012-08-01' and a.sls_outlet_id in ('94866', '84970')   group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24 order by cal.mtn, a.activity_dt asc;	TERADATA	HABERER	00:00:08	00:00:01	17951
10/11/2012	07:52:59	NTL_PRD_ALLVM	00:00:10	496			select a.activity_mth, a.activity_dt, a.activity_type, a.cust_area, a.cust_region, a.outlet, a.prod_nm, case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill, count(distinct(a.cust_id||a.cust_line_seq_id)) as line, sum(case when a.call_period < 3 then (in_type1 + in_type7 + in_other_type + os_type1 + os_type3 + os_type7 + os_other_type) end) calls3, sum(case when a.call_period < 32 then (in_type1 + in_type7 + in_other_type + os_type1 + os_type3 + os_type7 + os_other_type) end) calls31  from  ntl_prd_qmvm.ndcir_detail_v as a  join  ntl_prd_allvm.cust_acct_line_dly_hist_v  as cal on a.cust_id = cal.cust_id and a.cust_line_seq_id = cal.cust_line_seq_id and a.activity_dt BETWEEN cal.eff_dt AND cal.exp_dt   left join ntl_prd_allvm.acss_call_center_v as cc        on a.acss_call_ctr_cd = cc.acss_call_ctr_cd                                  left join ntl_prd_allvm.acss_dept_v as ad   on a.acss_dept_id = ad.acss_dept_id  left join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id =  u.acss_user_id    where a.activity_mth = '2012-08-01' and a.sls_outlet_id in ('94866', '84970')   group by 1,2,3,4,5,6,7,8	TERADATA	HABERER	00:00:10	00:00:00	17950
10/11/2012	07:29:16	NTL_PRD_ALLVM	00:00:04	1335			select a.activity_mth, a.activity_type, a.outlet, a.cust_area, a.cust_region, cal.nm_first||'   '||cal.nm_last AS cust_name, cal.mtn, a.cust_id, a.cust_line_seq_id, a.activity_dt, a.prod_nm_prev, a.prod_nm, case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill,  CASE WHEN cc.acss_call_ctr_desc IN ('NE Columbia SC 2', 'NE Columbia SC') THEN 'NE Columbia'             ELSE cc.acss_call_ctr_desc END AS Center,  u.nm_last||', '||u.nm_first AS rep_nm,         u.acss_user_id,        ad.acss_dept_desc,  a.acss_call_dt, a.acss_call_tm, a.call_duration, a.call_period, a.acss_call_type_cd, case when a.acss_call_id is not null then '1' else '0' end as call_count, sum(case when a.call_period < 3 then (in_type1 + in_type7 + in_other_type + os_type1 + os_type3 + os_type7 + os_other_type) end) calls3, sum(case when a.call_period < 32 then (in_type1 + in_type7 + in_other_type + os_type1 + os_type3 + os_type7 + os_other_type) end) calls31    from  ntl_prd_qmvm.ndcir_detail_v as a  join  ntl_prd_allvm.cust_acct_line_dly_hist_v  as cal on a.cust_id = cal.cust_id and a.cust_line_seq_id = cal.cust_line_seq_id and a.activity_dt BETWEEN cal.eff_dt AND cal.exp_dt   left join ntl_prd_allvm.acss_call_center_v as cc        on a.acss_call_ctr_cd = cc.acss_call_ctr_cd                                  left join ntl_prd_allvm.acss_dept_v as ad   on a.acss_dept_id = ad.acss_dept_id  left join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id =  u.acss_user_id    where a.activity_mth = '2012-08-01' and a.sls_outlet_id in ('94866', '84970')   group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23 order by cal.mtn, a.activity_dt asc	TERADATA	HABERER	00:00:02	00:00:02	17949
10/11/2012	07:28:48	NTL_PRD_ALLVM	00:00:00	0	3706		select a.activity_mth, a.activity_type, a.outlet, a.cust_area, a.cust_region, cal.nm_first||'   '||cal.nm_last AS cust_name, cal.mtn, a.cust_id, a.cust_line_seq_id, a.activity_dt, a.prod_nm_prev, a.prod_nm, case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill,  CASE WHEN cc.acss_call_ctr_desc IN ('NE Columbia SC 2', 'NE Columbia SC') THEN 'NE Columbia'             ELSE cc.acss_call_ctr_desc END AS Center,  u.nm_last||', '||u.nm_first AS rep_nm,         u.acss_user_id,        ad.acss_dept_desc,  a.acss_call_dt, a.acss_call_tm, a.call_duration, a.call_period, a.acss_call_type_cd, case when a.acss_call_id is not null then '1' else '0' end as call_count, sum(case when c.call_period < 3 then (in_type1 + in_type7 + in_other_type + os_type1 + os_type3 + os_type7 + os_other_type) end) calls3 sum(case when c.call_period < 32 then (in_type1 + in_type7 + in_other_type + os_type1 + os_type3 + os_type7 + os_other_type) end) calls31    from  ntl_prd_qmvm.ndcir_detail_v as a  join  ntl_prd_allvm.cust_acct_line_dly_hist_v  as cal on a.cust_id = cal.cust_id and a.cust_line_seq_id = cal.cust_line_seq_id and a.activity_dt BETWEEN cal.eff_dt AND cal.exp_dt   left join ntl_prd_allvm.acss_call_center_v as cc        on a.acss_call_ctr_cd = cc.acss_call_ctr_cd                                  left join ntl_prd_allvm.acss_dept_v as ad   on a.acss_dept_id = ad.acss_dept_id  left join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id =  u.acss_user_id    where a.activity_mth = '2012-08-01' and a.sls_outlet_id in ('94866', '84970')   group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23 order by cal.mtn, a.activity_dt asc	TERADATA	HABERER	00:00:00	00:00:00	17948
10/11/2012	07:25:41	NTL_PRD_ALLVM	00:00:03	1335			select a.activity_mth, a.activity_type, a.outlet, a.cust_area, a.cust_region, cal.nm_first||'   '||cal.nm_last AS cust_name, cal.mtn, a.cust_id, a.cust_line_seq_id, a.activity_dt, a.prod_nm_prev, a.prod_nm, case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill,  CASE WHEN cc.acss_call_ctr_desc IN ('NE Columbia SC 2', 'NE Columbia SC') THEN 'NE Columbia'             ELSE cc.acss_call_ctr_desc END AS Center,  u.nm_last||', '||u.nm_first AS rep_nm,         u.acss_user_id,        ad.acss_dept_desc,  a.acss_call_dt, a.acss_call_tm, a.call_duration, a.call_period, a.acss_call_type_cd, case when a.acss_call_id is not null then '1' else '0' end as call_count    from  ntl_prd_qmvm.ndcir_detail_v as a  join  ntl_prd_allvm.cust_acct_line_dly_hist_v  as cal on a.cust_id = cal.cust_id and a.cust_line_seq_id = cal.cust_line_seq_id and a.activity_dt BETWEEN cal.eff_dt AND cal.exp_dt   left join ntl_prd_allvm.acss_call_center_v as cc        on a.acss_call_ctr_cd = cc.acss_call_ctr_cd                                  left join ntl_prd_allvm.acss_dept_v as ad   on a.acss_dept_id = ad.acss_dept_id  left join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id =  u.acss_user_id    where a.activity_mth = '2012-08-01' and a.sls_outlet_id in ('94866', '84970')  order by cal.mtn, a.activity_dt asc	TERADATA	HABERER	00:00:01	00:00:02	17947
10/11/2012	07:23:32	NTL_PRD_ALLVM	00:00:04	1335			select a.activity_mth, a.activity_type, a.outlet, a.cust_area, a.cust_region, cal.nm_first||'   '||cal.nm_last AS cust_name, cal.mtn, a.cust_id, a.cust_line_seq_id, a.activity_dt, a.prod_nm_prev, a.prod_nm, case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill,  CASE WHEN cc.acss_call_ctr_desc IN ('NE Columbia SC 2', 'NE Columbia SC') THEN 'NE Columbia'             ELSE cc.acss_call_ctr_desc END AS Center,  u.nm_last||', '||u.nm_first AS rep_nm,         u.acss_user_id,        ad.acss_dept_desc,  a.acss_call_dt, a.acss_call_tm, a.call_duration, a.call_period, case when a.acss_call_id is not null then '1' else '0' end as call_count    from  ntl_prd_qmvm.ndcir_detail_v as a  join  ntl_prd_allvm.cust_acct_line_dly_hist_v  as cal on a.cust_id = cal.cust_id and a.cust_line_seq_id = cal.cust_line_seq_id and a.activity_dt BETWEEN cal.eff_dt AND cal.exp_dt   left join ntl_prd_allvm.acss_call_center_v as cc        on a.acss_call_ctr_cd = cc.acss_call_ctr_cd                                  left join ntl_prd_allvm.acss_dept_v as ad   on a.acss_dept_id = ad.acss_dept_id  left join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id =  u.acss_user_id    where a.activity_mth = '2012-08-01' and a.sls_outlet_id in ('94866', '84970')  order by cal.mtn, a.activity_dt asc	TERADATA	HABERER	00:00:02	00:00:02	17946
10/11/2012	07:21:21	NTL_PRD_ALLVM	00:00:06	100			select top 100 *  from  ntl_prd_qmvm.ndcir_detail_v	TERADATA	HABERER	00:00:06	00:00:00	17945
10/10/2012	10:29:33	NTL_PRD_ALLVM	00:00:12	1335			select a.activity_mth, a.activity_type,  a.cust_area, a.cust_region, cal.nm_first||'   '||cal.nm_last AS cust_name, cal.mtn, a.cust_id, a.cust_line_seq_id, a.activity_dt, a.prod_nm_prev, a.prod_nm, case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill,  CASE WHEN cc.acss_call_ctr_desc IN ('NE Columbia SC 2', 'NE Columbia SC') THEN 'NE Columbia'             ELSE cc.acss_call_ctr_desc END AS Center,  u.nm_last||', '||u.nm_first AS rep_nm,         u.acss_user_id,        ad.acss_dept_desc,  a.acss_call_dt, a.acss_call_tm, a.call_duration, a.call_period    from  ntl_prd_qmvm.ndcir_detail_v as a  join  ntl_prd_allvm.cust_acct_line_dly_hist_v  as cal on a.cust_id = cal.cust_id and a.cust_line_seq_id = cal.cust_line_seq_id and a.activity_dt BETWEEN cal.eff_dt AND cal.exp_dt   left join ntl_prd_allvm.acss_call_center_v as cc        on a.acss_call_ctr_cd = cc.acss_call_ctr_cd                                  left join ntl_prd_allvm.acss_dept_v as ad   on a.acss_dept_id = ad.acss_dept_id  left join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id =  u.acss_user_id    where a.activity_mth = '2012-08-01' and a.sls_outlet_id in ('94866', '84970')  order by cal.mtn, a.activity_dt asc	TERADATA	HABERER	00:00:10	00:00:02	17944
10/10/2012	10:29:14	NTL_PRD_ALLVM	00:00:00	0	3810		select a.activity_mth, a.activity_type,  a.cust_area, a.cust_region, cal.nm_first||'   '||cal.nm_last AS cust_name, cal.mtn, a.cust_id, a.cust_line_seq_id, a.activity_dt, a.prod_nm_prev, a.prod_nm, case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill,  CASE WHEN cc.acss_call_ctr_desc IN ('NE Columbia SC 2', 'NE Columbia SC') THEN 'NE Columbia'             ELSE cc.acss_call_ctr_desc END AS Center,  u.nm_last||', '||u.nm_first AS rep_nm,         u.acss_user_id,        ad.acss_dept_desc,  a.acss_call_dt, a.acss_call_tm, a.call_duration, a.call_period    from  ntl_prd_qmvm.ndcir_detail_v as a  join  ntl_prd_allvm.cust_acct_line_dly_hist_v  as cal on a.cust_id = cal.cust_id and a.cust_line_seq_id = cal.cust_line_seq_id and a.activity_dt BETWEEN cal.eff_dt AND cal.exp_dt   left join ntl_prd_allvm.acss_call_center_v as cc        on a.acss_call_ctr_cd = cc.acss_call_ctr_cd                                  left join ntl_prd_allvm.acss_dept_v as ad   on a.acss_dept_id = ad.acss_dept_id  left join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id =  u.acss_user_id    where a.activity_mth = '2012-08-01' and a.sls_outlet_id in ('94866', '84970')  order by a.mtn, a.activity_dt asc	TERADATA	HABERER	00:00:00	00:00:00	17943
10/10/2012	10:28:21	NTL_PRD_ALLVM	00:00:12	1335			select a.activity_mth, a.activity_type,  a.cust_area, a.cust_region, cal.nm_first||'   '||cal.nm_last AS cust_name, cal.mtn, a.cust_id, a.cust_line_seq_id, a.activity_dt, a.prod_nm_prev, a.prod_nm, case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill,  CASE WHEN cc.acss_call_ctr_desc IN ('NE Columbia SC 2', 'NE Columbia SC') THEN 'NE Columbia'             ELSE cc.acss_call_ctr_desc END AS Center,  u.nm_last||', '||u.nm_first AS rep_nm,         u.acss_user_id,        ad.acss_dept_desc,  a.acss_call_dt, a.acss_call_tm, a.call_duration, a.call_period    from  ntl_prd_qmvm.ndcir_detail_v as a  join  ntl_prd_allvm.cust_acct_line_dly_hist_v  as cal on a.cust_id = cal.cust_id and a.cust_line_seq_id = cal.cust_line_seq_id and a.activity_dt BETWEEN cal.eff_dt AND cal.exp_dt   left join ntl_prd_allvm.acss_call_center_v as cc        on a.acss_call_ctr_cd = cc.acss_call_ctr_cd                                  left join ntl_prd_allvm.acss_dept_v as ad   on a.acss_dept_id = ad.acss_dept_id  left join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id =  u.acss_user_id    where a.activity_mth = '2012-08-01' and a.sls_outlet_id in ('94866', '84970')	TERADATA	HABERER	00:00:11	00:00:01	17942
10/10/2012	10:14:22	NTL_PRD_ALLVM	00:00:19	100			select top 100 *  from  ntl_prd_qmvm.ndcir_detail_v	TERADATA	HABERER	00:00:18	00:00:01	17941
10/10/2012	10:03:13	NTL_PRD_ALLVM	00:00:00	0	3523		select   mnr.activity_mth  ,mnr.activity_type  ,mnr.cust_area as area  ,mnr.cust_region as region  ,mnr.sls_dist_chnl_churn_ctgry as channel_lvl_1  ,case   when mnr.fulfillment_ind = 'F' then 'direct'   when mnr.fulfillment_ind = 'L' then 'local'   else 'unknown'  end as dfill  ,case   when mnr.ecpd_liability_type_cd='C' then 'Business'   else 'Consumer'  end as Consumer_Business  ,ddm.data_tier_fin as phone_type  ,mnr.prod_nm  ,sum(call_count_3day) as call_count_3day  ,sum(call_count_31day) as call_count_31day  ,sum(calls3Day_rpt3Day) as calls3Day_rpt3Day  ,sum(calls3Day_rpt31Day) as calls3Day_rpt31Day  ,sum(calls31Day_rpt3Day) as calls31Day_rpt3Day  ,sum(calls31Day_rpt31Day) as calls31Day_rpt31Day    from ntl_prd_qmtbls.mrs_ndcir_rpts mnr   left join ntl_prd_allvm.device_dp_map_v ddm   on mnr.prod_nm=ddm.prod_nm    where activity_mth = (select rmonth from ntl_prd_qmtbls.stm_nccir_rmonth)    group by 1,2,3,4,5,6,7,8,9;	TERADATA	HABERER	00:00:00	00:00:00	17940
10/10/2012	09:08:39	NTL_PRD_ALLVM	00:00:03	89			Drop Table ANI_NUM_V; Drop Table SA_INUM_V; DROP TABLE Repeat_Reporting_EMH1; DROP TABLE NTL_PRD_QMTBLS. Repeat_Reporting_EMH21; DROP TABLE ndcir_clnr_v;	TERADATA	HABERER	00:00:03	00:00:00	17939
10/10/2012	08:38:19	NTL_PRD_ALLVM	00:16:13	6149			CREATE VOLATILE TABLE Repeat_Reporting_EMH1 AS (SELECT      acc.acss_call_ctr_desc,      acc.acss_call_ctr_cd,      ac.sor_id,      ac.acss_call_type_cd,     acc.acss_area_cd AS ctr_area,      acc.acss_call_ctr_type,      ac.cust_id,      ac.cust_line_seq_id,          ac.acct_num,      ac.mtn,      ac.acss_user_id,      ac.acss_call_dt,          ac.acss_call_tm,           (ac.call_disconnect_tm - ac.call_start_tm) HOUR TO SECOND (0) AS call_duration_tm,      COALESCE(sed.departmenttype,'Other') depttype,           COALESCE(sed.departmentgroup, 'Other') as dept_group,          CASE  WHEN acc.acss_call_ctr_time_zn LIKE 'C%' THEN                       ac.acss_call_tm + INTERVAL '1' HOUR                          WHEN acc.acss_call_ctr_time_zn LIKE 'M%' THEN               ac.acss_call_tm + INTERVAL '2' HOUR                          WHEN acc.acss_call_ctr_time_zn LIKE 'P%' THEN                 ac.acss_call_tm +INTERVAL '3' HOUR                            WHEN acc.acss_call_ctr_time_zn LIKE 'H%' THEN                ac.acss_call_tm + INTERVAL '5' HOUR                           ELSE ac.acss_call_tm         END acss_call_ad,      CAST(          ac.acss_call_dt ||          ' '             ||          CAST(acss_call_ad AS CHAR(8)) AS TIMESTAMP(0)      ) acss_dt_tm,      ad.acss_dept_desc,      ad.acss_dept_id,      ac.acss_call_id,          ac.ivr_call_id,      ac.area_cd,      RANK() OVER (PARTITION BY cust_id, cust_line_seq_id          ORDER BY ac.acss_call_dt, acss_call_ad, acss_call_id) rnk  FROM ntl_prd_allvm.acss_call_v AS ac  JOIN sys_calendar.calendar AS z        ON calendar_date= DATE   JOIN ntl_prd_allvm.acss_call_center_v AS acc      ON ac.acss_call_ctr_cd = acc.acss_call_ctr_cd  left JOIN ntl_prd_allvm.acss_user_v AS au      ON ac.acss_user_id = au.acss_user_id  JOIN ntl_prd_allvm.acss_dept_v AS ad      ON ac.acss_dept_id = ad.acss_dept_id  LEFT JOIN ntl_prd_qmtbls.emh_eccr_dep AS sed    ON ad.acss_dept_id = sed.acssdeptid  LEFT JOIN                  (SELECT a.acss_call_dt,a.acss_call_ctr_cd, a.acss_dept_id FROM                  ntl_prd_allvm.acss_call_v  as a                                  JOIN sys_calendar.calendar AS z                        ON calendar_date= DATE                                   WHERE                  a.acss_call_dt = '2012-10-08'                  AND a.acss_call_type_cd = '1'                  GROUP BY 1,2,3) r  ON          ac.acss_call_dt = r.acss_call_dt          AND ac.acss_call_ctr_cd = r.acss_call_ctr_cd          AND ac.acss_dept_id = r.acss_dept_id  WHERE ac.acss_call_dt = '2012-10-08'  AND COALESCE(sed.departmenttype,'Other') <> 'NA'  AND (      (ac.acss_call_type_cd IN ('1','7')) OR      (          ac.acss_call_type_cd = '3'          AND acc.acss_call_ctr_type = 'O'          AND ad.acss_dept_desc NOT LIKE '%offline%'          AND r.acss_dept_id IS NULL ))  ) WITH DATA PRIMARY INDEX (cust_id, cust_line_seq_id, acss_call_dt, acss_call_id, rnk) ON COMMIT PRESERVE ROWS;   CREATE TABLE NTL_PRD_QMTBLS.Repeat_Reporting_EMH21  AS  (  SELECT      a.sor_id,      a.acss_call_id,          a.ivr_call_id,      a.acss_call_type_cd,      a.ctr_area,      a.acss_call_ctr_type,      m.area_cd,      m.region_desc,      a.cust_id,      a.cust_line_seq_id,      a.mtn,      a.acss_call_dt,          a.acss_call_ad,          a.acss_call_tm,           a.call_duration_tm,      a.rnk,      a.acss_dept_desc as initial_dept_desc,      a.acss_dept_id,      a.acss_user_id,      a.acss_call_ctr_desc,      a.acss_call_ctr_cd,      a.depttype AS orgtype,          a.dept_group as org_dept_group,      b.acss_call_id AS repeat_call_id,      b.acss_dept_desc AS repeat_dept_desc,      b.acss_dept_id AS repeat_dept_id,          b.acss_user_id AS repeat_user_id,          b.acss_call_ctr_desc AS repeat_call_ctr_desc,      b.acss_call_ctr_cd AS repeat_ctr_cd,      b.acss_call_dt AS repeat_dt,          b.acss_call_ad AS repeat_call_ad,         b.acss_call_tm as repeat_call_tm,           b.call_duration_tm as repeat_call_duration_tm,      b.rnk AS repeat_rnk,      b.depttype AS reptype,          b.dept_group as rpt_dept_group,      CASE WHEN b.acss_dt_tm IS NOT NULL THEN        ((b.acss_dt_tm - a.acss_dt_tm) DAY(4) TO MINUTE ) END tsdiff,      CASE WHEN b.acss_dt_tm IS NOT NULL THEN        (EXTRACT(HOUR FROM tsdiff) * 60)        + EXTRACT(MINUTE FROM tsdiff)        + (CAST((CAST ((tsdiff) AS INTERVAL DAY)) AS INTEGER) * 1440) END min_diff  FROM Repeat_Reporting_EMH1 AS a  JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt                 JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)       INNER JOIN Repeat_Reporting_EMH1 AS b          ON  a.cust_id = b.cust_id          AND a.cust_line_seq_id = b.cust_line_seq_id                  AND a.acss_call_dt = b.acss_call_dt                       AND b.rnk = a.rnk + 1          AND b.acss_call_id <> a.acss_call_id                    LEFT JOIN ntl_prd_allvm.acss_call_center_v AS acc      ON b.acss_call_ctr_cd = acc.acss_call_ctr_cd  ) WITH DATA PRIMARY INDEX( sor_id, acss_call_id, ivr_call_id, acss_call_type_cd, ctr_area, acss_call_ctr_type, area_cd, region_desc, cust_id, cust_line_seq_id, mtn, acss_call_dt, acss_call_ad, acss_call_tm, call_duration_tm, rnk, initial_dept_desc, acss_dept_id, acss_user_id, acss_call_ctr_desc, acss_call_ctr_cd, orgtype, org_dept_group, repeat_call_id, repeat_dept_desc, repeat_dept_id, repeat_user_id, repeat_call_ctr_desc, repeat_ctr_cd, repeat_dt, repeat_call_ad, repeat_call_tm, repeat_call_duration_tm, repeat_rnk, reptype, rpt_dept_group, tsdiff, min_diff);  select a.acss_call_ctr_desc, hr1.nm_last || ', ' || hr1.nm_first AS  AD_Nm,  hr2.nm_last || ', ' || hr2.nm_first AS Supv_Nm,    u.nm_last||', '||u.nm_first AS First_Rep_nm,  a.initial_dept_desc,  a.acss_user_id, a.mtn, coalesce(ani.ani_num, '0000000000') as ani_num, sa.inum as initial_cll_inum, a.cust_id, a.area_cd, a.region_desc, coalesce(a.acss_call_dt - nc.activity_dt, 'n/a') as call_period_snc_trans, coalesce(nc.activity_type, 'n/a') as activity_type, coalesce(cast(cast(nc.activity_dt as format 'mm/dd/yyyy') as char(10)), 'n/a') as activity_dt, CASE WHEN cal.Device_type_cd LIKE '%4GS%'  THEN cal.device_prod_nm  ELSE cal.prod_nm END AS Device_Nm, dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, a.orgtype, a.acss_call_dt, a.acss_call_ad, a.acss_call_tm, a.call_duration_tm, a.repeat_call_ctr_desc, u1.nm_last||', '||u1.nm_first AS Repeat_Rep_nm,  a.repeat_dept_desc, a.reptype, a.repeat_dt, a.repeat_call_ad, a.repeat_call_tm, a.repeat_call_duration_tm, sa1.inum as rpt_cll_inum, a.tsdiff, a.min_diff, CASE WHEN (a.repeat_call_ad - a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00' THEN  'Y' ELSE 'N' END AS Rpts_2hrs_and_Under, sa.url_speech as intial_cll_url_speech, sa1.url_speech as rpt_call_url_speech   FROM NTL_PRD_QMTBLS.Repeat_Reporting_EMH21 AS a  JOIN sys_calendar.calendar AS z   ON calendar_date= DATE   JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt       Left join ndcir_clnr_v as nc   on a.cust_id = nc.cust_id   and a.cust_line_seq_id = nc.cust_line_seq_id   and a.acss_call_dt >= nc.activity_dt  and  nc.activity_dt between '2012-09-08' and '2012-10-08'        LEFT JOIN ANI_NUM_V AS ani   on a.sor_id = ani.sor_id   and a.cust_id = ani.cust_id   and a.cust_line_seq_id = ani.cust_line_seq_id   and a.ivr_call_id = ani.ivr_call_id      LEFT JOIN SA_INUM_V AS sa   ON a.cust_id = sa.cust_id   and a.cust_line_seq_id = sa.cust_line_seq_id   and a.acss_call_dt = sa.call_start_dt   and a.acss_call_id = sa.acss_call_id      LEFT JOIN SA_INUM_V AS sa1   ON a.cust_id = sa1.cust_id   and a.cust_line_seq_id = sa1.cust_line_seq_id   and a.repeat_dt = sa1.call_start_dt   and a.repeat_call_id = sa1.acss_call_id      LEFT JOIN ntl_prd_allvm.device_dp_map_v AS dm                     ON (CASE WHEN cal.Device_type_cd LIKE '%4GS%' THEN cal.device_prod_nm ELSE cal.prod_nm END) = dm.prod_nm                JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)  LEFT JOIN ntl_prd_qmtbls.stm_eccr_area AS s    ON a.acss_call_ctr_cd = s.acsscallcentercd    AND a.acss_dept_id = s.acssdeptid      left Join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id = u.acss_user_id    left JOIN ntl_prd_allvm.hr_employee_v AS hr  ON u.hr_employee_id = hr.emp_id    LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr2              ON hr.SUPER_ID_LVL2_EMP_ID = hr2.emp_id                     LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr1           ON hr.SUPER_ID_LVL1_EMP_ID = hr1.emp_id   Left Join ntl_prd_allvm.acss_user_v AS u1  on a.repeat_user_id = u1.acss_user_id  WHERE acss_call_dt BETWEEN '2012-10-01' AND ADD_MONTHS('2012-10-01',1)-1 and a.orgtype IN ('CS','WDTS')  and a.reptype IN ('CS','WDTS')  and a.org_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.rpt_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.acss_call_ctr_desc IN('NE Columbia SC',  'NE Huntsville AL',  'NE Hanover MD',  'NE Rochester NY',  'NE Charleston SC',  'NE Charlotte NC',  'NE Wallingford CT',  'NE Wilmington NC',  'NE Bangor ME',  'NE Columbia SC 2')     GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37 ORDER BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37;  --Drop Table ANI_NUM_V; --Drop Table SA_INUM_V; --DROP TABLE Repeat_Reporting_EMH1; --DROP TABLE NTL_PRD_QMTBLS. Repeat_Reporting_EMH21; --DROP TABLE ndcir_clnr_v;	TERADATA	HABERER	00:00:37	00:15:36	17938
10/10/2012	08:21:05	NTL_PRD_ALLVM	00:00:03	89			DROP TABLE Repeat_Reporting_EMH1; DROP TABLE NTL_PRD_QMTBLS. Repeat_Reporting_EMH21;	TERADATA	HABERER	00:00:03	00:00:00	17937
10/10/2012	08:18:14	NTL_PRD_ALLVM	00:00:19	2601			CREATE VOLATILE TABLE Repeat_Reporting_EMH1 AS (SELECT      acc.acss_call_ctr_desc,      acc.acss_call_ctr_cd,      ac.sor_id,      ac.acss_call_type_cd,     acc.acss_area_cd AS ctr_area,      acc.acss_call_ctr_type,      ac.cust_id,      ac.cust_line_seq_id,          ac.acct_num,      ac.mtn,      ac.acss_user_id,      ac.acss_call_dt,          ac.acss_call_tm,           (ac.call_disconnect_tm - ac.call_start_tm) HOUR TO SECOND (0) AS call_duration_tm,      COALESCE(sed.departmenttype,'Other') depttype,           COALESCE(sed.departmentgroup, 'Other') as dept_group,          CASE  WHEN acc.acss_call_ctr_time_zn LIKE 'C%' THEN                       ac.acss_call_tm + INTERVAL '1' HOUR                          WHEN acc.acss_call_ctr_time_zn LIKE 'M%' THEN               ac.acss_call_tm + INTERVAL '2' HOUR                          WHEN acc.acss_call_ctr_time_zn LIKE 'P%' THEN                 ac.acss_call_tm +INTERVAL '3' HOUR                            WHEN acc.acss_call_ctr_time_zn LIKE 'H%' THEN                ac.acss_call_tm + INTERVAL '5' HOUR                           ELSE ac.acss_call_tm         END acss_call_ad,      CAST(          ac.acss_call_dt ||          ' '             ||          CAST(acss_call_ad AS CHAR(8)) AS TIMESTAMP(0)      ) acss_dt_tm,      ad.acss_dept_desc,      ad.acss_dept_id,      ac.acss_call_id,          ac.ivr_call_id,      ac.area_cd,      RANK() OVER (PARTITION BY cust_id, cust_line_seq_id          ORDER BY ac.acss_call_dt, acss_call_ad, acss_call_id) rnk  FROM ntl_prd_allvm.acss_call_v AS ac  JOIN sys_calendar.calendar AS z        ON calendar_date= DATE   JOIN ntl_prd_allvm.acss_call_center_v AS acc      ON ac.acss_call_ctr_cd = acc.acss_call_ctr_cd  left JOIN ntl_prd_allvm.acss_user_v AS au      ON ac.acss_user_id = au.acss_user_id  JOIN ntl_prd_allvm.acss_dept_v AS ad      ON ac.acss_dept_id = ad.acss_dept_id  LEFT JOIN ntl_prd_qmtbls.emh_eccr_dep AS sed    ON ad.acss_dept_id = sed.acssdeptid  LEFT JOIN                  (SELECT a.acss_call_dt,a.acss_call_ctr_cd, a.acss_dept_id FROM                  ntl_prd_allvm.acss_call_v  as a                                  JOIN sys_calendar.calendar AS z                        ON calendar_date= DATE                                   WHERE                  a.acss_call_dt = '2012-10-07'                  AND a.acss_call_type_cd = '1'                  GROUP BY 1,2,3) r  ON          ac.acss_call_dt = r.acss_call_dt          AND ac.acss_call_ctr_cd = r.acss_call_ctr_cd          AND ac.acss_dept_id = r.acss_dept_id  WHERE ac.acss_call_dt = '2012-10-07'  AND COALESCE(sed.departmenttype,'Other') <> 'NA'  AND (      (ac.acss_call_type_cd IN ('1','7')) OR      (          ac.acss_call_type_cd = '3'          AND acc.acss_call_ctr_type = 'O'          AND ad.acss_dept_desc NOT LIKE '%offline%'          AND r.acss_dept_id IS NULL ))  ) WITH DATA PRIMARY INDEX (cust_id, cust_line_seq_id, acss_call_dt, acss_call_id, rnk) ON COMMIT PRESERVE ROWS;   CREATE TABLE NTL_PRD_QMTBLS.Repeat_Reporting_EMH21  AS  (  SELECT      a.sor_id,      a.acss_call_id,          a.ivr_call_id,      a.acss_call_type_cd,      a.ctr_area,      a.acss_call_ctr_type,      m.area_cd,      m.region_desc,      a.cust_id,      a.cust_line_seq_id,      a.mtn,      a.acss_call_dt,          a.acss_call_ad,          a.acss_call_tm,           a.call_duration_tm,      a.rnk,      a.acss_dept_desc as initial_dept_desc,      a.acss_dept_id,      a.acss_user_id,      a.acss_call_ctr_desc,      a.acss_call_ctr_cd,      a.depttype AS orgtype,          a.dept_group as org_dept_group,      b.acss_call_id AS repeat_call_id,      b.acss_dept_desc AS repeat_dept_desc,      b.acss_dept_id AS repeat_dept_id,          b.acss_user_id AS repeat_user_id,          b.acss_call_ctr_desc AS repeat_call_ctr_desc,      b.acss_call_ctr_cd AS repeat_ctr_cd,      b.acss_call_dt AS repeat_dt,          b.acss_call_ad AS repeat_call_ad,         b.acss_call_tm as repeat_call_tm,           b.call_duration_tm as repeat_call_duration_tm,      b.rnk AS repeat_rnk,      b.depttype AS reptype,          b.dept_group as rpt_dept_group,      CASE WHEN b.acss_dt_tm IS NOT NULL THEN        ((b.acss_dt_tm - a.acss_dt_tm) DAY(4) TO MINUTE ) END tsdiff,      CASE WHEN b.acss_dt_tm IS NOT NULL THEN        (EXTRACT(HOUR FROM tsdiff) * 60)        + EXTRACT(MINUTE FROM tsdiff)        + (CAST((CAST ((tsdiff) AS INTERVAL DAY)) AS INTEGER) * 1440) END min_diff  FROM Repeat_Reporting_EMH1 AS a  JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt                 JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)       INNER JOIN Repeat_Reporting_EMH1 AS b          ON  a.cust_id = b.cust_id          AND a.cust_line_seq_id = b.cust_line_seq_id                  AND a.acss_call_dt = b.acss_call_dt                       AND b.rnk = a.rnk + 1          AND b.acss_call_id <> a.acss_call_id                    LEFT JOIN ntl_prd_allvm.acss_call_center_v AS acc      ON b.acss_call_ctr_cd = acc.acss_call_ctr_cd  ) WITH DATA PRIMARY INDEX( sor_id, acss_call_id, ivr_call_id, acss_call_type_cd, ctr_area, acss_call_ctr_type, area_cd, region_desc, cust_id, cust_line_seq_id, mtn, acss_call_dt, acss_call_ad, acss_call_tm, call_duration_tm, rnk, initial_dept_desc, acss_dept_id, acss_user_id, acss_call_ctr_desc, acss_call_ctr_cd, orgtype, org_dept_group, repeat_call_id, repeat_dept_desc, repeat_dept_id, repeat_user_id, repeat_call_ctr_desc, repeat_ctr_cd, repeat_dt, repeat_call_ad, repeat_call_tm, repeat_call_duration_tm, repeat_rnk, reptype, rpt_dept_group, tsdiff, min_diff);  select a.acss_call_ctr_desc, hr1.nm_last || ', ' || hr1.nm_first AS  AD_Nm,  hr2.nm_last || ', ' || hr2.nm_first AS Supv_Nm,    u.nm_last||', '||u.nm_first AS First_Rep_nm,  a.initial_dept_desc,  a.acss_user_id, a.mtn, coalesce(ani.ani_num, '0000000000') as ani_num, sa.inum as initial_cll_inum, a.cust_id, a.area_cd, a.region_desc, coalesce(a.acss_call_dt - nc.activity_dt, 'n/a') as call_period_snc_trans, coalesce(nc.activity_type, 'n/a') as activity_type, coalesce(cast(cast(nc.activity_dt as format 'mm/dd/yyyy') as char(10)), 'n/a') as activity_dt, CASE WHEN cal.Device_type_cd LIKE '%4GS%'  THEN cal.device_prod_nm  ELSE cal.prod_nm END AS Device_Nm, dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, a.orgtype, a.acss_call_dt, a.acss_call_ad, a.acss_call_tm, a.call_duration_tm, a.repeat_call_ctr_desc, u1.nm_last||', '||u1.nm_first AS Repeat_Rep_nm,  a.repeat_dept_desc, a.reptype, a.repeat_dt, a.repeat_call_ad, a.repeat_call_tm, a.repeat_call_duration_tm, sa1.inum as rpt_cll_inum, a.tsdiff, a.min_diff, CASE WHEN (a.repeat_call_ad - a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00' THEN  'Y' ELSE 'N' END AS Rpts_2hrs_and_Under, sa.url_speech as intial_cll_url_speech, sa1.url_speech as rpt_call_url_speech   FROM NTL_PRD_QMTBLS.Repeat_Reporting_EMH21 AS a  JOIN sys_calendar.calendar AS z   ON calendar_date= DATE   JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt       Left join ndcir_clnr_v as nc   on a.cust_id = nc.cust_id   and a.cust_line_seq_id = nc.cust_line_seq_id   and a.acss_call_dt >= nc.activity_dt  and  nc.activity_dt between '2012-09-07' and '2012-10-07'        LEFT JOIN ANI_NUM_V AS ani   on a.sor_id = ani.sor_id   and a.cust_id = ani.cust_id   and a.cust_line_seq_id = ani.cust_line_seq_id   and a.ivr_call_id = ani.ivr_call_id      LEFT JOIN SA_INUM_V AS sa   ON a.cust_id = sa.cust_id   and a.cust_line_seq_id = sa.cust_line_seq_id   and a.acss_call_dt = sa.call_start_dt   and a.acss_call_id = sa.acss_call_id      LEFT JOIN SA_INUM_V AS sa1   ON a.cust_id = sa1.cust_id   and a.cust_line_seq_id = sa1.cust_line_seq_id   and a.repeat_dt = sa1.call_start_dt   and a.repeat_call_id = sa1.acss_call_id      LEFT JOIN ntl_prd_allvm.device_dp_map_v AS dm                     ON (CASE WHEN cal.Device_type_cd LIKE '%4GS%' THEN cal.device_prod_nm ELSE cal.prod_nm END) = dm.prod_nm                JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)  LEFT JOIN ntl_prd_qmtbls.stm_eccr_area AS s    ON a.acss_call_ctr_cd = s.acsscallcentercd    AND a.acss_dept_id = s.acssdeptid      left Join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id = u.acss_user_id    left JOIN ntl_prd_allvm.hr_employee_v AS hr  ON u.hr_employee_id = hr.emp_id    LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr2              ON hr.SUPER_ID_LVL2_EMP_ID = hr2.emp_id                     LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr1           ON hr.SUPER_ID_LVL1_EMP_ID = hr1.emp_id   Left Join ntl_prd_allvm.acss_user_v AS u1  on a.repeat_user_id = u1.acss_user_id  WHERE acss_call_dt BETWEEN '2012-10-01' AND ADD_MONTHS('2012-10-01',1)-1 and a.orgtype IN ('CS','WDTS')  and a.reptype IN ('CS','WDTS')  and a.org_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.rpt_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.acss_call_ctr_desc IN('NE Columbia SC',  'NE Huntsville AL',  'NE Hanover MD',  'NE Rochester NY',  'NE Charleston SC',  'NE Charlotte NC',  'NE Wallingford CT',  'NE Wilmington NC',  'NE Bangor ME',  'NE Columbia SC 2')     GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37 ORDER BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37;  --Drop Table ANI_NUM_V; --Drop Table SA_INUM_V; --DROP TABLE Repeat_Reporting_EMH1; --DROP TABLE NTL_PRD_QMTBLS. Repeat_Reporting_EMH21; --DROP TABLE ndcir_clnr_v;	TERADATA	HABERER	00:00:14	00:00:05	17936
10/10/2012	08:12:16	NTL_PRD_ALLVM	00:00:00	89			DROP TABLE Repeat_Reporting_EMH1; DROP TABLE NTL_PRD_QMTBLS. Repeat_Reporting_EMH21;	TERADATA	HABERER	00:00:00	00:00:00	17935
10/10/2012	07:56:09	NTL_PRD_ALLVM	00:00:15	6144			select a.acss_call_ctr_desc, hr1.nm_last || ', ' || hr1.nm_first AS  AD_Nm,  hr2.nm_last || ', ' || hr2.nm_first AS Supv_Nm,    u.nm_last||', '||u.nm_first AS First_Rep_nm,  a.initial_dept_desc,  a.acss_user_id, a.mtn, coalesce(ani.ani_num, '0000000000') as ani_num, sa.inum as initial_cll_inum, a.cust_id, a.cust_line_seq_id, a.area_cd, a.region_desc, coalesce(a.acss_call_dt - nc.activity_dt, 'n/a') as call_period_snc_trans, coalesce(nc.activity_type, 'n/a') as activity_type, coalesce(cast(cast(nc.activity_dt as format 'mm/dd/yyyy') as char(10)), 'n/a') as activity_dt, CASE WHEN cal.Device_type_cd LIKE '%4GS%'  THEN cal.device_prod_nm  ELSE cal.prod_nm END AS Device_Nm, dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, a.orgtype, a.acss_call_dt, a.acss_call_ad, a.acss_call_tm, a.call_duration_tm, a.repeat_call_ctr_desc, u1.nm_last||', '||u1.nm_first AS Repeat_Rep_nm,  a.repeat_dept_desc, a.reptype, a.repeat_dt, a.repeat_call_ad, a.repeat_call_tm, a.repeat_call_duration_tm, sa1.inum as rpt_cll_inum, a.tsdiff, a.min_diff, CASE WHEN (a.repeat_call_ad - a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00' THEN  'Y' ELSE 'N' END AS Rpts_2hrs_and_Under, sa.url_speech as intial_cll_url_speech, sa1.url_speech as rpt_call_url_speech   FROM NTL_PRD_QMTBLS.Repeat_Reporting_EMH21 AS a  JOIN sys_calendar.calendar AS z   ON calendar_date= DATE   JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt       Left join ndcir_clnr_v as nc   on a.cust_id = nc.cust_id   and a.cust_line_seq_id = nc.cust_line_seq_id   and a.acss_call_dt >= nc.activity_dt  and  nc.activity_dt between '2012-09-07' and '2012-10-07'        LEFT JOIN ANI_NUM_V AS ani   on a.sor_id = ani.sor_id   and a.cust_id = ani.cust_id   and a.cust_line_seq_id = ani.cust_line_seq_id   and a.ivr_call_id = ani.ivr_call_id      LEFT JOIN SA_INUM_V AS sa   ON a.cust_id = sa.cust_id   and a.cust_line_seq_id = sa.cust_line_seq_id   and a.acss_call_dt = sa.call_start_dt   and a.acss_call_id = sa.acss_call_id      LEFT JOIN SA_INUM_V AS sa1   ON a.cust_id = sa1.cust_id   and a.cust_line_seq_id = sa1.cust_line_seq_id   and a.repeat_dt = sa1.call_start_dt   and a.repeat_call_id = sa1.acss_call_id      LEFT JOIN ntl_prd_allvm.device_dp_map_v AS dm                     ON (CASE WHEN cal.Device_type_cd LIKE '%4GS%' THEN cal.device_prod_nm ELSE cal.prod_nm END) = dm.prod_nm                JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)  LEFT JOIN ntl_prd_qmtbls.stm_eccr_area AS s    ON a.acss_call_ctr_cd = s.acsscallcentercd    AND a.acss_dept_id = s.acssdeptid      left Join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id = u.acss_user_id    left JOIN ntl_prd_allvm.hr_employee_v AS hr  ON u.hr_employee_id = hr.emp_id    LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr2              ON hr.SUPER_ID_LVL2_EMP_ID = hr2.emp_id                     LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr1           ON hr.SUPER_ID_LVL1_EMP_ID = hr1.emp_id   Left Join ntl_prd_allvm.acss_user_v AS u1  on a.repeat_user_id = u1.acss_user_id  WHERE acss_call_dt BETWEEN '2012-10-01' AND ADD_MONTHS('2012-10-01',1)-1 and a.orgtype IN ('CS','WDTS')  and a.reptype IN ('CS','WDTS')  and a.org_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.rpt_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.acss_call_ctr_desc IN('NE Columbia SC',  'NE Huntsville AL',  'NE Hanover MD',  'NE Rochester NY',  'NE Charleston SC',  'NE Charlotte NC',  'NE Wallingford CT',  'NE Wilmington NC',  'NE Bangor ME',  'NE Columbia SC 2')    qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id, a.acss_call_id order by a.cust_id, a.cust_line_seq_id, a.acss_call_id) = 1  --GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38 --ORDER BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39;  --Drop Table ANI_NUM_V; --Drop Table SA_INUM_V; --DROP TABLE Repeat_Reporting_EMH1; --DROP TABLE NTL_PRD_QMTBLS. Repeat_Reporting_EMH21; --DROP TABLE ndcir_clnr_v;	TERADATA	HABERER	00:00:13	00:00:02	17934
10/10/2012	07:55:39	NTL_PRD_ALLVM	00:00:00	0	3504		select a.acss_call_ctr_desc, hr1.nm_last || ', ' || hr1.nm_first AS  AD_Nm,  hr2.nm_last || ', ' || hr2.nm_first AS Supv_Nm,    u.nm_last||', '||u.nm_first AS First_Rep_nm,  a.initial_dept_desc,  a.acss_user_id, a.mtn, coalesce(ani.ani_num, '0000000000') as ani_num, sa.inum as initial_cll_inum, a.cust_id, a.cust_line_seq_id, a.area_cd, a.region_desc, coalesce(a.acss_call_dt - nc.activity_dt, 'n/a') as call_period_snc_trans, coalesce(nc.activity_type, 'n/a') as activity_type, coalesce(cast(cast(nc.activity_dt as format 'mm/dd/yyyy') as char(10)), 'n/a') as activity_dt, CASE WHEN cal.Device_type_cd LIKE '%4GS%'  THEN cal.device_prod_nm  ELSE cal.prod_nm END AS Device_Nm, dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, a.orgtype, a.acss_call_dt, a.acss_call_ad, a.acss_call_tm, a.call_duration_tm, a.repeat_call_ctr_desc, u1.nm_last||', '||u1.nm_first AS Repeat_Rep_nm,  a.repeat_dept_desc, a.reptype, a.repeat_dt, a.repeat_call_ad, a.repeat_call_tm, a.repeat_call_duration_tm, sa1.inum as rpt_cll_inum, a.tsdiff, a.min_diff, CASE WHEN (a.repeat_call_ad - a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00' THEN  'Y' ELSE 'N' END AS Rpts_2hrs_and_Under, sa.url_speech as intial_cll_url_speech, sa1.url_speech as rpt_call_url_speech   FROM NTL_PRD_QMTBLS.Repeat_Reporting_EMH21 AS a  JOIN sys_calendar.calendar AS z   ON calendar_date= DATE   JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt       Left join ndcir_clnr_v as nc   on a.cust_id = nc.cust_id   and a.cust_line_seq_id = nc.cust_line_seq_id   and a.acss_call_dt >= nc.activity_dt  and  nc.activity_dt between '2012-09-07' and '2012-10-07'        LEFT JOIN ANI_NUM_V AS ani   on a.sor_id = ani.sor_id   and a.cust_id = ani.cust_id   and a.cust_line_seq_id = ani.cust_line_seq_id   and a.ivr_call_id = ani.ivr_call_id      LEFT JOIN SA_INUM_V AS sa   ON a.cust_id = sa.cust_id   and a.cust_line_seq_id = sa.cust_line_seq_id   and a.acss_call_dt = sa.call_start_dt   and a.acss_call_id = sa.acss_call_id      LEFT JOIN SA_INUM_V AS sa1   ON a.cust_id = sa1.cust_id   and a.cust_line_seq_id = sa1.cust_line_seq_id   and a.repeat_dt = sa1.call_start_dt   and a.repeat_call_id = sa1.acss_call_id      LEFT JOIN ntl_prd_allvm.device_dp_map_v AS dm                     ON (CASE WHEN cal.Device_type_cd LIKE '%4GS%' THEN cal.device_prod_nm ELSE cal.prod_nm END) = dm.prod_nm                JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)  LEFT JOIN ntl_prd_qmtbls.stm_eccr_area AS s    ON a.acss_call_ctr_cd = s.acsscallcentercd    AND a.acss_dept_id = s.acssdeptid      left Join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id = u.acss_user_id    left JOIN ntl_prd_allvm.hr_employee_v AS hr  ON u.hr_employee_id = hr.emp_id    LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr2              ON hr.SUPER_ID_LVL2_EMP_ID = hr2.emp_id                     LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr1           ON hr.SUPER_ID_LVL1_EMP_ID = hr1.emp_id   Left Join ntl_prd_allvm.acss_user_v AS u1  on a.repeat_user_id = u1.acss_user_id  WHERE acss_call_dt BETWEEN '2012-10-01' AND ADD_MONTHS('2012-10-01',1)-1 and a.orgtype IN ('CS','WDTS')  and a.reptype IN ('CS','WDTS')  and a.org_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.rpt_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.acss_call_ctr_desc IN('NE Columbia SC',  'NE Huntsville AL',  'NE Hanover MD',  'NE Rochester NY',  'NE Charleston SC',  'NE Charlotte NC',  'NE Wallingford CT',  'NE Wilmington NC',  'NE Bangor ME',  'NE Columbia SC 2')    qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id, a.acss_call_id order by a.cust_id, a.cust_line_seq_id, a.acss_call_id) = 1  GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38 --ORDER BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39;  --Drop Table ANI_NUM_V; --Drop Table SA_INUM_V; --DROP TABLE Repeat_Reporting_EMH1; --DROP TABLE NTL_PRD_QMTBLS. Repeat_Reporting_EMH21; --DROP TABLE ndcir_clnr_v;	TERADATA	HABERER	00:00:00	00:00:00	17933
10/10/2012	07:55:20	NTL_PRD_ALLVM	00:00:00	0	3504		select a.acss_call_ctr_desc, hr1.nm_last || ', ' || hr1.nm_first AS  AD_Nm,  hr2.nm_last || ', ' || hr2.nm_first AS Supv_Nm,    u.nm_last||', '||u.nm_first AS First_Rep_nm,  a.initial_dept_desc,  a.acss_user_id, a.mtn, coalesce(ani.ani_num, '0000000000') as ani_num, sa.inum as initial_cll_inum, a.cust_id, a.cust_line_seq_id, a.area_cd, a.region_desc, coalesce(a.acss_call_dt - nc.activity_dt, 'n/a') as call_period_snc_trans, coalesce(nc.activity_type, 'n/a') as activity_type, coalesce(cast(cast(nc.activity_dt as format 'mm/dd/yyyy') as char(10)), 'n/a') as activity_dt, CASE WHEN cal.Device_type_cd LIKE '%4GS%'  THEN cal.device_prod_nm  ELSE cal.prod_nm END AS Device_Nm, dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, a.orgtype, a.acss_call_dt, a.acss_call_ad, a.acss_call_tm, a.call_duration_tm, a.repeat_call_ctr_desc, u1.nm_last||', '||u1.nm_first AS Repeat_Rep_nm,  a.repeat_dept_desc, a.reptype, a.repeat_dt, a.repeat_call_ad, a.repeat_call_tm, a.repeat_call_duration_tm, sa1.inum as rpt_cll_inum, a.tsdiff, a.min_diff, CASE WHEN (a.repeat_call_ad - a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00' THEN  'Y' ELSE 'N' END AS Rpts_2hrs_and_Under, sa.url_speech as intial_cll_url_speech, sa1.url_speech as rpt_call_url_speech   FROM NTL_PRD_QMTBLS.Repeat_Reporting_EMH21 AS a  JOIN sys_calendar.calendar AS z   ON calendar_date= DATE   JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt       Left join ndcir_clnr_v as nc   on a.cust_id = nc.cust_id   and a.cust_line_seq_id = nc.cust_line_seq_id   and a.acss_call_dt >= nc.activity_dt  and  nc.activity_dt between '2012-09-07' and '2012-10-07'        LEFT JOIN ANI_NUM_V AS ani   on a.sor_id = ani.sor_id   and a.cust_id = ani.cust_id   and a.cust_line_seq_id = ani.cust_line_seq_id   and a.ivr_call_id = ani.ivr_call_id      LEFT JOIN SA_INUM_V AS sa   ON a.cust_id = sa.cust_id   and a.cust_line_seq_id = sa.cust_line_seq_id   and a.acss_call_dt = sa.call_start_dt   and a.acss_call_id = sa.acss_call_id      LEFT JOIN SA_INUM_V AS sa1   ON a.cust_id = sa1.cust_id   and a.cust_line_seq_id = sa1.cust_line_seq_id   and a.repeat_dt = sa1.call_start_dt   and a.repeat_call_id = sa1.acss_call_id      LEFT JOIN ntl_prd_allvm.device_dp_map_v AS dm                     ON (CASE WHEN cal.Device_type_cd LIKE '%4GS%' THEN cal.device_prod_nm ELSE cal.prod_nm END) = dm.prod_nm                JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)  LEFT JOIN ntl_prd_qmtbls.stm_eccr_area AS s    ON a.acss_call_ctr_cd = s.acsscallcentercd    AND a.acss_dept_id = s.acssdeptid      left Join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id = u.acss_user_id    left JOIN ntl_prd_allvm.hr_employee_v AS hr  ON u.hr_employee_id = hr.emp_id    LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr2              ON hr.SUPER_ID_LVL2_EMP_ID = hr2.emp_id                     LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr1           ON hr.SUPER_ID_LVL1_EMP_ID = hr1.emp_id   Left Join ntl_prd_allvm.acss_user_v AS u1  on a.repeat_user_id = u1.acss_user_id  WHERE acss_call_dt BETWEEN '2012-10-01' AND ADD_MONTHS('2012-10-01',1)-1 and a.orgtype IN ('CS','WDTS')  and a.reptype IN ('CS','WDTS')  and a.org_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.rpt_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.acss_call_ctr_desc IN('NE Columbia SC',  'NE Huntsville AL',  'NE Hanover MD',  'NE Rochester NY',  'NE Charleston SC',  'NE Charlotte NC',  'NE Wallingford CT',  'NE Wilmington NC',  'NE Bangor ME',  'NE Columbia SC 2')    qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id, a.acss_call_id order by a.cust_id, a.cust_line_seq_id, a.acss_call_id) = 1  GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37 --ORDER BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39;	TERADATA	HABERER	00:00:00	00:00:00	17932
10/10/2012	07:54:42	NTL_PRD_ALLVM	00:00:00	0	3504		select a.acss_call_ctr_desc, hr1.nm_last || ', ' || hr1.nm_first AS  AD_Nm,  hr2.nm_last || ', ' || hr2.nm_first AS Supv_Nm,    u.nm_last||', '||u.nm_first AS First_Rep_nm,  a.initial_dept_desc,  a.acss_user_id, a.mtn, coalesce(ani.ani_num, '0000000000') as ani_num, sa.inum as initial_cll_inum, a.cust_id, a.cust_line_seq_id, a.area_cd, a.region_desc, coalesce(a.acss_call_dt - nc.activity_dt, 'n/a') as call_period_snc_trans, coalesce(nc.activity_type, 'n/a') as activity_type, coalesce(cast(cast(nc.activity_dt as format 'mm/dd/yyyy') as char(10)), 'n/a') as activity_dt, CASE WHEN cal.Device_type_cd LIKE '%4GS%'  THEN cal.device_prod_nm  ELSE cal.prod_nm END AS Device_Nm, dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, a.orgtype, a.acss_call_dt, a.acss_call_ad, a.acss_call_tm, a.call_duration_tm, a.repeat_call_ctr_desc, u1.nm_last||', '||u1.nm_first AS Repeat_Rep_nm,  a.repeat_dept_desc, a.reptype, a.repeat_dt, a.repeat_call_ad, a.repeat_call_tm, a.repeat_call_duration_tm, sa1.inum as rpt_cll_inum, a.tsdiff, a.min_diff, CASE WHEN (a.repeat_call_ad - a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00' THEN  'Y' ELSE 'N' END AS Rpts_2hrs_and_Under, sa.url_speech as intial_cll_url_speech, sa1.url_speech as rpt_call_url_speech   FROM NTL_PRD_QMTBLS.Repeat_Reporting_EMH21 AS a  JOIN sys_calendar.calendar AS z   ON calendar_date= DATE   JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt       Left join ndcir_clnr_v as nc   on a.cust_id = nc.cust_id   and a.cust_line_seq_id = nc.cust_line_seq_id   and a.acss_call_dt >= nc.activity_dt  and  nc.activity_dt between '2012-09-07' and '2012-10-07'        LEFT JOIN ANI_NUM_V AS ani   on a.sor_id = ani.sor_id   and a.cust_id = ani.cust_id   and a.cust_line_seq_id = ani.cust_line_seq_id   and a.ivr_call_id = ani.ivr_call_id      LEFT JOIN SA_INUM_V AS sa   ON a.cust_id = sa.cust_id   and a.cust_line_seq_id = sa.cust_line_seq_id   and a.acss_call_dt = sa.call_start_dt   and a.acss_call_id = sa.acss_call_id      LEFT JOIN SA_INUM_V AS sa1   ON a.cust_id = sa1.cust_id   and a.cust_line_seq_id = sa1.cust_line_seq_id   and a.repeat_dt = sa1.call_start_dt   and a.repeat_call_id = sa1.acss_call_id      LEFT JOIN ntl_prd_allvm.device_dp_map_v AS dm                     ON (CASE WHEN cal.Device_type_cd LIKE '%4GS%' THEN cal.device_prod_nm ELSE cal.prod_nm END) = dm.prod_nm                JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)  LEFT JOIN ntl_prd_qmtbls.stm_eccr_area AS s    ON a.acss_call_ctr_cd = s.acsscallcentercd    AND a.acss_dept_id = s.acssdeptid      left Join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id = u.acss_user_id    left JOIN ntl_prd_allvm.hr_employee_v AS hr  ON u.hr_employee_id = hr.emp_id    LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr2              ON hr.SUPER_ID_LVL2_EMP_ID = hr2.emp_id                     LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr1           ON hr.SUPER_ID_LVL1_EMP_ID = hr1.emp_id   Left Join ntl_prd_allvm.acss_user_v AS u1  on a.repeat_user_id = u1.acss_user_id  WHERE acss_call_dt BETWEEN '2012-10-01' AND ADD_MONTHS('2012-10-01',1)-1 and a.orgtype IN ('CS','WDTS')  and a.reptype IN ('CS','WDTS')  and a.org_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.rpt_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.acss_call_ctr_desc IN('NE Columbia SC',  'NE Huntsville AL',  'NE Hanover MD',  'NE Rochester NY',  'NE Charleston SC',  'NE Charlotte NC',  'NE Wallingford CT',  'NE Wilmington NC',  'NE Bangor ME',  'NE Columbia SC 2')    qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id, a.acss_call_id order by a.cust_id, a.cust_line_seq_id, a.acss_call_id, a.acss_call_dt) = 1  GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37 --ORDER BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39;  --Drop Table ANI_NUM_V; --Drop Table SA_INUM_V; --DROP TABLE Repeat_Reporting_EMH1; --DROP TABLE NTL_PRD_QMTBLS. Repeat_Reporting_EMH21; --DROP TABLE ndcir_clnr_v;	TERADATA	HABERER	00:00:00	00:00:00	17931
10/10/2012	07:54:26	NTL_PRD_ALLVM	00:00:00	0	3883		select a.acss_call_ctr_desc, hr1.nm_last || ', ' || hr1.nm_first AS  AD_Nm,  hr2.nm_last || ', ' || hr2.nm_first AS Supv_Nm,    u.nm_last||', '||u.nm_first AS First_Rep_nm,  a.initial_dept_desc,  a.acss_user_id, a.mtn, coalesce(ani.ani_num, '0000000000') as ani_num, sa.inum as initial_cll_inum, a.cust_id, a.cust_line_seq_id, a.area_cd, a.region_desc, coalesce(a.acss_call_dt - nc.activity_dt, 'n/a') as call_period_snc_trans, coalesce(nc.activity_type, 'n/a') as activity_type, coalesce(cast(cast(nc.activity_dt as format 'mm/dd/yyyy') as char(10)), 'n/a') as activity_dt, CASE WHEN cal.Device_type_cd LIKE '%4GS%'  THEN cal.device_prod_nm  ELSE cal.prod_nm END AS Device_Nm, dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, a.orgtype, a.acss_call_dt, a.acss_call_ad, a.acss_call_tm, a.call_duration_tm, a.repeat_call_ctr_desc, u1.nm_last||', '||u1.nm_first AS Repeat_Rep_nm,  a.repeat_dept_desc, a.reptype, a.repeat_dt, a.repeat_call_ad, a.repeat_call_tm, a.repeat_call_duration_tm, sa1.inum as rpt_cll_inum, a.tsdiff, a.min_diff, CASE WHEN (a.repeat_call_ad - a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00' THEN  'Y' ELSE 'N' END AS Rpts_2hrs_and_Under, sa.url_speech as intial_cll_url_speech, sa1.url_speech as rpt_call_url_speech   FROM NTL_PRD_QMTBLS.Repeat_Reporting_EMH21 AS a  JOIN sys_calendar.calendar AS z   ON calendar_date= DATE   JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt       Left join ndcir_clnr_v as nc   on a.cust_id = nc.cust_id   and a.cust_line_seq_id = nc.cust_line_seq_id   and a.acss_call_dt >= nc.activity_dt  and  nc.activity_dt between '2012-09-07' and '2012-10-07'        LEFT JOIN ANI_NUM_V AS ani   on a.sor_id = ani.sor_id   and a.cust_id = ani.cust_id   and a.cust_line_seq_id = ani.cust_line_seq_id   and a.ivr_call_id = ani.ivr_call_id      LEFT JOIN SA_INUM_V AS sa   ON a.cust_id = sa.cust_id   and a.cust_line_seq_id = sa.cust_line_seq_id   and a.acss_call_dt = sa.call_start_dt   and a.acss_call_id = sa.acss_call_id      LEFT JOIN SA_INUM_V AS sa1   ON a.cust_id = sa1.cust_id   and a.cust_line_seq_id = sa1.cust_line_seq_id   and a.repeat_dt = sa1.call_start_dt   and a.repeat_call_id = sa1.acss_call_id      LEFT JOIN ntl_prd_allvm.device_dp_map_v AS dm                     ON (CASE WHEN cal.Device_type_cd LIKE '%4GS%' THEN cal.device_prod_nm ELSE cal.prod_nm END) = dm.prod_nm                JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)  LEFT JOIN ntl_prd_qmtbls.stm_eccr_area AS s    ON a.acss_call_ctr_cd = s.acsscallcentercd    AND a.acss_dept_id = s.acssdeptid      left Join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id = u.acss_user_id    left JOIN ntl_prd_allvm.hr_employee_v AS hr  ON u.hr_employee_id = hr.emp_id    LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr2              ON hr.SUPER_ID_LVL2_EMP_ID = hr2.emp_id                     LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr1           ON hr.SUPER_ID_LVL1_EMP_ID = hr1.emp_id   Left Join ntl_prd_allvm.acss_user_v AS u1  on a.repeat_user_id = u1.acss_user_id  WHERE acss_call_dt BETWEEN '2012-10-01' AND ADD_MONTHS('2012-10-01',1)-1 and a.orgtype IN ('CS','WDTS')  and a.reptype IN ('CS','WDTS')  and a.org_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.rpt_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.acss_call_ctr_desc IN('NE Columbia SC',  'NE Huntsville AL',  'NE Hanover MD',  'NE Rochester NY',  'NE Charleston SC',  'NE Charlotte NC',  'NE Wallingford CT',  'NE Wilmington NC',  'NE Bangor ME',  'NE Columbia SC 2')    qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id, a.acss_call_id order by a.cust_id, a.cust_line_seq_id, a.acss_call_id, a.acss_call_dt) = 1  GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39 --ORDER BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39;  --Drop Table ANI_NUM_V; --Drop Table SA_INUM_V; --DROP TABLE Repeat_Reporting_EMH1; --DROP TABLE NTL_PRD_QMTBLS. Repeat_Reporting_EMH21; --DROP TABLE ndcir_clnr_v;	TERADATA	HABERER	00:00:00	00:00:00	17930
10/10/2012	07:53:46	NTL_PRD_ALLVM	00:00:00	0	3504		select a.acss_call_ctr_desc, hr1.nm_last || ', ' || hr1.nm_first AS  AD_Nm,  hr2.nm_last || ', ' || hr2.nm_first AS Supv_Nm,    u.nm_last||', '||u.nm_first AS First_Rep_nm,  a.initial_dept_desc,  a.acss_user_id, a.mtn, coalesce(ani.ani_num, '0000000000') as ani_num, sa.inum as initial_cll_inum, a.cust_id, a.cust_line_seq_id, a.area_cd, a.region_desc, coalesce(a.acss_call_dt - nc.activity_dt, 'n/a') as call_period_snc_trans, coalesce(nc.activity_type, 'n/a') as activity_type, coalesce(cast(cast(nc.activity_dt as format 'mm/dd/yyyy') as char(10)), 'n/a') as activity_dt, CASE WHEN cal.Device_type_cd LIKE '%4GS%'  THEN cal.device_prod_nm  ELSE cal.prod_nm END AS Device_Nm, dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, a.orgtype, a.acss_call_dt, a.acss_call_ad, a.acss_call_tm, a.call_duration_tm, a.repeat_call_ctr_desc, u1.nm_last||', '||u1.nm_first AS Repeat_Rep_nm,  a.repeat_dept_desc, a.reptype, a.repeat_dt, a.repeat_call_ad, a.repeat_call_tm, a.repeat_call_duration_tm, sa1.inum as rpt_cll_inum, a.tsdiff, a.min_diff, CASE WHEN (a.repeat_call_ad - a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00' THEN  'Y' ELSE 'N' END AS Rpts_2hrs_and_Under, sa.url_speech as intial_cll_url_speech, sa1.url_speech as rpt_call_url_speech   FROM NTL_PRD_QMTBLS.Repeat_Reporting_EMH21 AS a  JOIN sys_calendar.calendar AS z   ON calendar_date= DATE   JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt       Left join ndcir_clnr_v as nc   on a.cust_id = nc.cust_id   and a.cust_line_seq_id = nc.cust_line_seq_id   and a.acss_call_dt >= nc.activity_dt  and  nc.activity_dt between '2012-09-07' and '2012-10-07'        LEFT JOIN ANI_NUM_V AS ani   on a.sor_id = ani.sor_id   and a.cust_id = ani.cust_id   and a.cust_line_seq_id = ani.cust_line_seq_id   and a.ivr_call_id = ani.ivr_call_id      LEFT JOIN SA_INUM_V AS sa   ON a.cust_id = sa.cust_id   and a.cust_line_seq_id = sa.cust_line_seq_id   and a.acss_call_dt = sa.call_start_dt   and a.acss_call_id = sa.acss_call_id      LEFT JOIN SA_INUM_V AS sa1   ON a.cust_id = sa1.cust_id   and a.cust_line_seq_id = sa1.cust_line_seq_id   and a.repeat_dt = sa1.call_start_dt   and a.repeat_call_id = sa1.acss_call_id      LEFT JOIN ntl_prd_allvm.device_dp_map_v AS dm                     ON (CASE WHEN cal.Device_type_cd LIKE '%4GS%' THEN cal.device_prod_nm ELSE cal.prod_nm END) = dm.prod_nm                JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)  LEFT JOIN ntl_prd_qmtbls.stm_eccr_area AS s    ON a.acss_call_ctr_cd = s.acsscallcentercd    AND a.acss_dept_id = s.acssdeptid      left Join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id = u.acss_user_id    left JOIN ntl_prd_allvm.hr_employee_v AS hr  ON u.hr_employee_id = hr.emp_id    LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr2              ON hr.SUPER_ID_LVL2_EMP_ID = hr2.emp_id                     LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr1           ON hr.SUPER_ID_LVL1_EMP_ID = hr1.emp_id   Left Join ntl_prd_allvm.acss_user_v AS u1  on a.repeat_user_id = u1.acss_user_id  WHERE acss_call_dt BETWEEN '2012-10-01' AND ADD_MONTHS('2012-10-01',1)-1 and a.orgtype IN ('CS','WDTS')  and a.reptype IN ('CS','WDTS')  and a.org_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.rpt_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.acss_call_ctr_desc IN('NE Columbia SC',  'NE Huntsville AL',  'NE Hanover MD',  'NE Rochester NY',  'NE Charleston SC',  'NE Charlotte NC',  'NE Wallingford CT',  'NE Wilmington NC',  'NE Bangor ME',  'NE Columbia SC 2')    qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id, a.acss_call_id order by a.cust_id, a.cust_line_seq_id, a.acss_call_id, a.acss_call_dt) = 1  GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38 --ORDER BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39;  --Drop Table ANI_NUM_V; --Drop Table SA_INUM_V; --DROP TABLE Repeat_Reporting_EMH1; --DROP TABLE NTL_PRD_QMTBLS. Repeat_Reporting_EMH21; --DROP TABLE ndcir_clnr_v;	TERADATA	HABERER	00:00:00	00:00:00	17929
10/10/2012	07:53:33	NTL_PRD_ALLVM	00:00:00	0	3883		select a.acss_call_ctr_desc, hr1.nm_last || ', ' || hr1.nm_first AS  AD_Nm,  hr2.nm_last || ', ' || hr2.nm_first AS Supv_Nm,    u.nm_last||', '||u.nm_first AS First_Rep_nm,  a.initial_dept_desc,  a.acss_user_id, a.mtn, coalesce(ani.ani_num, '0000000000') as ani_num, sa.inum as initial_cll_inum, a.cust_id, a.cust_line_seq_id, a.area_cd, a.region_desc, coalesce(a.acss_call_dt - nc.activity_dt, 'n/a') as call_period_snc_trans, coalesce(nc.activity_type, 'n/a') as activity_type, coalesce(cast(cast(nc.activity_dt as format 'mm/dd/yyyy') as char(10)), 'n/a') as activity_dt, CASE WHEN cal.Device_type_cd LIKE '%4GS%'  THEN cal.device_prod_nm  ELSE cal.prod_nm END AS Device_Nm, dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, a.orgtype, a.acss_call_dt, a.acss_call_ad, a.acss_call_tm, a.call_duration_tm, a.repeat_call_ctr_desc, u1.nm_last||', '||u1.nm_first AS Repeat_Rep_nm,  a.repeat_dept_desc, a.reptype, a.repeat_dt, a.repeat_call_ad, a.repeat_call_tm, a.repeat_call_duration_tm, sa1.inum as rpt_cll_inum, a.tsdiff, a.min_diff, CASE WHEN (a.repeat_call_ad - a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00' THEN  'Y' ELSE 'N' END AS Rpts_2hrs_and_Under, sa.url_speech as intial_cll_url_speech, sa1.url_speech as rpt_call_url_speech   FROM NTL_PRD_QMTBLS.Repeat_Reporting_EMH21 AS a  JOIN sys_calendar.calendar AS z   ON calendar_date= DATE   JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt       Left join ndcir_clnr_v as nc   on a.cust_id = nc.cust_id   and a.cust_line_seq_id = nc.cust_line_seq_id   and a.acss_call_dt >= nc.activity_dt  and  nc.activity_dt between '2012-09-07' and '2012-10-07'        LEFT JOIN ANI_NUM_V AS ani   on a.sor_id = ani.sor_id   and a.cust_id = ani.cust_id   and a.cust_line_seq_id = ani.cust_line_seq_id   and a.ivr_call_id = ani.ivr_call_id      LEFT JOIN SA_INUM_V AS sa   ON a.cust_id = sa.cust_id   and a.cust_line_seq_id = sa.cust_line_seq_id   and a.acss_call_dt = sa.call_start_dt   and a.acss_call_id = sa.acss_call_id      LEFT JOIN SA_INUM_V AS sa1   ON a.cust_id = sa1.cust_id   and a.cust_line_seq_id = sa1.cust_line_seq_id   and a.repeat_dt = sa1.call_start_dt   and a.repeat_call_id = sa1.acss_call_id      LEFT JOIN ntl_prd_allvm.device_dp_map_v AS dm                     ON (CASE WHEN cal.Device_type_cd LIKE '%4GS%' THEN cal.device_prod_nm ELSE cal.prod_nm END) = dm.prod_nm                JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)  LEFT JOIN ntl_prd_qmtbls.stm_eccr_area AS s    ON a.acss_call_ctr_cd = s.acsscallcentercd    AND a.acss_dept_id = s.acssdeptid      left Join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id = u.acss_user_id    left JOIN ntl_prd_allvm.hr_employee_v AS hr  ON u.hr_employee_id = hr.emp_id    LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr2              ON hr.SUPER_ID_LVL2_EMP_ID = hr2.emp_id                     LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr1           ON hr.SUPER_ID_LVL1_EMP_ID = hr1.emp_id   Left Join ntl_prd_allvm.acss_user_v AS u1  on a.repeat_user_id = u1.acss_user_id  WHERE acss_call_dt BETWEEN '2012-10-01' AND ADD_MONTHS('2012-10-01',1)-1 and a.orgtype IN ('CS','WDTS')  and a.reptype IN ('CS','WDTS')  and a.org_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.rpt_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.acss_call_ctr_desc IN('NE Columbia SC',  'NE Huntsville AL',  'NE Hanover MD',  'NE Rochester NY',  'NE Charleston SC',  'NE Charlotte NC',  'NE Wallingford CT',  'NE Wilmington NC',  'NE Bangor ME',  'NE Columbia SC 2')    qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id, a.acss_call_id order by a.cust_id, a.cust_line_seq_id, a.acss_call_id, a.acss_call_dt) = 1  GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39 --ORDER BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39;  --Drop Table ANI_NUM_V; --Drop Table SA_INUM_V; --DROP TABLE Repeat_Reporting_EMH1; --DROP TABLE NTL_PRD_QMTBLS. Repeat_Reporting_EMH21; --DROP TABLE ndcir_clnr_v;	TERADATA	HABERER	00:00:00	00:00:00	17928
10/10/2012	07:53:18	NTL_PRD_ALLVM	00:00:00	0	3637		select a.acss_call_ctr_desc, hr1.nm_last || ', ' || hr1.nm_first AS  AD_Nm,  hr2.nm_last || ', ' || hr2.nm_first AS Supv_Nm,    u.nm_last||', '||u.nm_first AS First_Rep_nm,  a.initial_dept_desc,  a.acss_user_id, a.mtn, coalesce(ani.ani_num, '0000000000') as ani_num, sa.inum as initial_cll_inum, a.cust_id, a.cust_line_seq_id, a.area_cd, a.region_desc, coalesce(a.acss_call_dt - nc.activity_dt, 'n/a') as call_period_snc_trans, coalesce(nc.activity_type, 'n/a') as activity_type, coalesce(cast(cast(nc.activity_dt as format 'mm/dd/yyyy') as char(10)), 'n/a') as activity_dt, CASE WHEN cal.Device_type_cd LIKE '%4GS%'  THEN cal.device_prod_nm  ELSE cal.prod_nm END AS Device_Nm, dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, a.orgtype, a.acss_call_dt, a.acss_call_ad, a.acss_call_tm, a.call_duration_tm, a.repeat_call_ctr_desc, u1.nm_last||', '||u1.nm_first AS Repeat_Rep_nm,  a.repeat_dept_desc, a.reptype, a.repeat_dt, a.repeat_call_ad, a.repeat_call_tm, a.repeat_call_duration_tm, sa1.inum as rpt_cll_inum, a.tsdiff, a.min_diff, CASE WHEN (a.repeat_call_ad - a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00' THEN  'Y' ELSE 'N' END AS Rpts_2hrs_and_Under, sa.url_speech as intial_cll_url_speech, sa1.url_speech as rpt_call_url_speech   FROM NTL_PRD_QMTBLS.Repeat_Reporting_EMH21 AS a  JOIN sys_calendar.calendar AS z   ON calendar_date= DATE   JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt       Left join ndcir_clnr_v as nc   on a.cust_id = nc.cust_id   and a.cust_line_seq_id = nc.cust_line_seq_id   and a.acss_call_dt >= nc.activity_dt  and  nc.activity_dt between '2012-09-07' and '2012-10-07'        LEFT JOIN ANI_NUM_V AS ani   on a.sor_id = ani.sor_id   and a.cust_id = ani.cust_id   and a.cust_line_seq_id = ani.cust_line_seq_id   and a.ivr_call_id = ani.ivr_call_id      LEFT JOIN SA_INUM_V AS sa   ON a.cust_id = sa.cust_id   and a.cust_line_seq_id = sa.cust_line_seq_id   and a.acss_call_dt = sa.call_start_dt   and a.acss_call_id = sa.acss_call_id      LEFT JOIN SA_INUM_V AS sa1   ON a.cust_id = sa1.cust_id   and a.cust_line_seq_id = sa1.cust_line_seq_id   and a.repeat_dt = sa1.call_start_dt   and a.repeat_call_id = sa1.acss_call_id      LEFT JOIN ntl_prd_allvm.device_dp_map_v AS dm                     ON (CASE WHEN cal.Device_type_cd LIKE '%4GS%' THEN cal.device_prod_nm ELSE cal.prod_nm END) = dm.prod_nm                JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)  LEFT JOIN ntl_prd_qmtbls.stm_eccr_area AS s    ON a.acss_call_ctr_cd = s.acsscallcentercd    AND a.acss_dept_id = s.acssdeptid      left Join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id = u.acss_user_id    left JOIN ntl_prd_allvm.hr_employee_v AS hr  ON u.hr_employee_id = hr.emp_id    LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr2              ON hr.SUPER_ID_LVL2_EMP_ID = hr2.emp_id                     LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr1           ON hr.SUPER_ID_LVL1_EMP_ID = hr1.emp_id   Left Join ntl_prd_allvm.acss_user_v AS u1  on a.repeat_user_id = u1.acss_user_id  WHERE acss_call_dt BETWEEN '2012-10-01' AND ADD_MONTHS('2012-10-01',1)-1 and a.orgtype IN ('CS','WDTS')  and a.reptype IN ('CS','WDTS')  and a.org_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.rpt_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.acss_call_ctr_desc IN('NE Columbia SC',  'NE Huntsville AL',  'NE Hanover MD',  'NE Rochester NY',  'NE Charleston SC',  'NE Charlotte NC',  'NE Wallingford CT',  'NE Wilmington NC',  'NE Bangor ME',  'NE Columbia SC 2')    qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id, a.acss_call_id order by a.cust_id, a.cust_line_seq_id, a.acss_call_id, a.acss_call_dt) = 1  GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39 ORDER BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39;  --Drop Table ANI_NUM_V; --Drop Table SA_INUM_V; --DROP TABLE Repeat_Reporting_EMH1; --DROP TABLE NTL_PRD_QMTBLS. Repeat_Reporting_EMH21; --DROP TABLE ndcir_clnr_v;	TERADATA	HABERER	00:00:00	00:00:00	17927
10/10/2012	07:52:39	NTL_PRD_ALLVM	00:00:00	0	3504		select a.acss_call_ctr_desc, hr1.nm_last || ', ' || hr1.nm_first AS  AD_Nm,  hr2.nm_last || ', ' || hr2.nm_first AS Supv_Nm,    u.nm_last||', '||u.nm_first AS First_Rep_nm,  a.initial_dept_desc,  a.acss_user_id, a.mtn, coalesce(ani.ani_num, '0000000000') as ani_num, sa.inum as initial_cll_inum, a.cust_id, a.cust_line_seq_id, a.area_cd, a.region_desc, coalesce(a.acss_call_dt - nc.activity_dt, 'n/a') as call_period_snc_trans, coalesce(nc.activity_type, 'n/a') as activity_type, coalesce(cast(cast(nc.activity_dt as format 'mm/dd/yyyy') as char(10)), 'n/a') as activity_dt, CASE WHEN cal.Device_type_cd LIKE '%4GS%'  THEN cal.device_prod_nm  ELSE cal.prod_nm END AS Device_Nm, dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, a.orgtype, a.acss_call_dt, a.acss_call_ad, a.acss_call_tm, a.call_duration_tm, a.repeat_call_ctr_desc, u1.nm_last||', '||u1.nm_first AS Repeat_Rep_nm,  a.repeat_dept_desc, a.reptype, a.repeat_dt, a.repeat_call_ad, a.repeat_call_tm, a.repeat_call_duration_tm, sa1.inum as rpt_cll_inum, a.tsdiff, a.min_diff, CASE WHEN (a.repeat_call_ad - a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00' THEN  'Y' ELSE 'N' END AS Rpts_2hrs_and_Under, sa.url_speech as intial_cll_url_speech, sa1.url_speech as rpt_call_url_speech   FROM NTL_PRD_QMTBLS.Repeat_Reporting_EMH21 AS a  JOIN sys_calendar.calendar AS z   ON calendar_date= DATE   JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt       Left join ndcir_clnr_v as nc   on a.cust_id = nc.cust_id   and a.cust_line_seq_id = nc.cust_line_seq_id   and a.acss_call_dt >= nc.activity_dt  and  nc.activity_dt between '2012-09-07' and '2012-10-07'        LEFT JOIN ANI_NUM_V AS ani   on a.sor_id = ani.sor_id   and a.cust_id = ani.cust_id   and a.cust_line_seq_id = ani.cust_line_seq_id   and a.ivr_call_id = ani.ivr_call_id      LEFT JOIN SA_INUM_V AS sa   ON a.cust_id = sa.cust_id   and a.cust_line_seq_id = sa.cust_line_seq_id   and a.acss_call_dt = sa.call_start_dt   and a.acss_call_id = sa.acss_call_id      LEFT JOIN SA_INUM_V AS sa1   ON a.cust_id = sa1.cust_id   and a.cust_line_seq_id = sa1.cust_line_seq_id   and a.repeat_dt = sa1.call_start_dt   and a.repeat_call_id = sa1.acss_call_id      LEFT JOIN ntl_prd_allvm.device_dp_map_v AS dm                     ON (CASE WHEN cal.Device_type_cd LIKE '%4GS%' THEN cal.device_prod_nm ELSE cal.prod_nm END) = dm.prod_nm                JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)  LEFT JOIN ntl_prd_qmtbls.stm_eccr_area AS s    ON a.acss_call_ctr_cd = s.acsscallcentercd    AND a.acss_dept_id = s.acssdeptid      left Join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id = u.acss_user_id    left JOIN ntl_prd_allvm.hr_employee_v AS hr  ON u.hr_employee_id = hr.emp_id    LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr2              ON hr.SUPER_ID_LVL2_EMP_ID = hr2.emp_id                     LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr1           ON hr.SUPER_ID_LVL1_EMP_ID = hr1.emp_id   Left Join ntl_prd_allvm.acss_user_v AS u1  on a.repeat_user_id = u1.acss_user_id  WHERE acss_call_dt BETWEEN '2012-10-01' AND ADD_MONTHS('2012-10-01',1)-1 and a.orgtype IN ('CS','WDTS')  and a.reptype IN ('CS','WDTS')  and a.org_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.rpt_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.acss_call_ctr_desc IN('NE Columbia SC',  'NE Huntsville AL',  'NE Hanover MD',  'NE Rochester NY',  'NE Charleston SC',  'NE Charlotte NC',  'NE Wallingford CT',  'NE Wilmington NC',  'NE Bangor ME',  'NE Columbia SC 2')    qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id, a.acss_call_id order by a.cust_id, a.cust_line_seq_id, a.acss_call_id, a.acss_call_dt) = 1  GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38 ORDER BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38;  --Drop Table ANI_NUM_V; --Drop Table SA_INUM_V; --DROP TABLE Repeat_Reporting_EMH1; --DROP TABLE NTL_PRD_QMTBLS. Repeat_Reporting_EMH21; --DROP TABLE ndcir_clnr_v;	TERADATA	HABERER	00:00:00	00:00:00	17926
10/10/2012	07:51:40	NTL_PRD_ALLVM	00:00:00	0	3504		select a.acss_call_ctr_desc, hr1.nm_last || ', ' || hr1.nm_first AS  AD_Nm,  hr2.nm_last || ', ' || hr2.nm_first AS Supv_Nm,    u.nm_last||', '||u.nm_first AS First_Rep_nm,  a.initial_dept_desc,  a.acss_user_id, a.mtn, coalesce(ani.ani_num, '0000000000') as ani_num, sa.inum as initial_cll_inum, a.cust_id, a.area_cd, a.region_desc, coalesce(a.acss_call_dt - nc.activity_dt, 'n/a') as call_period_snc_trans, coalesce(nc.activity_type, 'n/a') as activity_type, coalesce(cast(cast(nc.activity_dt as format 'mm/dd/yyyy') as char(10)), 'n/a') as activity_dt, CASE WHEN cal.Device_type_cd LIKE '%4GS%'  THEN cal.device_prod_nm  ELSE cal.prod_nm END AS Device_Nm, dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, a.orgtype, a.acss_call_dt, a.acss_call_ad, a.acss_call_tm, a.call_duration_tm, a.repeat_call_ctr_desc, u1.nm_last||', '||u1.nm_first AS Repeat_Rep_nm,  a.repeat_dept_desc, a.reptype, a.repeat_dt, a.repeat_call_ad, a.repeat_call_tm, a.repeat_call_duration_tm, sa1.inum as rpt_cll_inum, a.tsdiff, a.min_diff, CASE WHEN (a.repeat_call_ad - a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00' THEN  'Y' ELSE 'N' END AS Rpts_2hrs_and_Under, sa.url_speech as intial_cll_url_speech, sa1.url_speech as rpt_call_url_speech   FROM NTL_PRD_QMTBLS.Repeat_Reporting_EMH21 AS a  JOIN sys_calendar.calendar AS z   ON calendar_date= DATE   JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt       Left join ndcir_clnr_v as nc   on a.cust_id = nc.cust_id   and a.cust_line_seq_id = nc.cust_line_seq_id   and a.acss_call_dt >= nc.activity_dt  and  nc.activity_dt between '2012-09-07' and '2012-10-07'        LEFT JOIN ANI_NUM_V AS ani   on a.sor_id = ani.sor_id   and a.cust_id = ani.cust_id   and a.cust_line_seq_id = ani.cust_line_seq_id   and a.ivr_call_id = ani.ivr_call_id      LEFT JOIN SA_INUM_V AS sa   ON a.cust_id = sa.cust_id   and a.cust_line_seq_id = sa.cust_line_seq_id   and a.acss_call_dt = sa.call_start_dt   and a.acss_call_id = sa.acss_call_id      LEFT JOIN SA_INUM_V AS sa1   ON a.cust_id = sa1.cust_id   and a.cust_line_seq_id = sa1.cust_line_seq_id   and a.repeat_dt = sa1.call_start_dt   and a.repeat_call_id = sa1.acss_call_id      LEFT JOIN ntl_prd_allvm.device_dp_map_v AS dm                     ON (CASE WHEN cal.Device_type_cd LIKE '%4GS%' THEN cal.device_prod_nm ELSE cal.prod_nm END) = dm.prod_nm                JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)  LEFT JOIN ntl_prd_qmtbls.stm_eccr_area AS s    ON a.acss_call_ctr_cd = s.acsscallcentercd    AND a.acss_dept_id = s.acssdeptid      left Join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id = u.acss_user_id    left JOIN ntl_prd_allvm.hr_employee_v AS hr  ON u.hr_employee_id = hr.emp_id    LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr2              ON hr.SUPER_ID_LVL2_EMP_ID = hr2.emp_id                     LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr1           ON hr.SUPER_ID_LVL1_EMP_ID = hr1.emp_id   Left Join ntl_prd_allvm.acss_user_v AS u1  on a.repeat_user_id = u1.acss_user_id  WHERE acss_call_dt BETWEEN '2012-10-01' AND ADD_MONTHS('2012-10-01',1)-1 and a.orgtype IN ('CS','WDTS')  and a.reptype IN ('CS','WDTS')  and a.org_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.rpt_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.acss_call_ctr_desc IN('NE Columbia SC',  'NE Huntsville AL',  'NE Hanover MD',  'NE Rochester NY',  'NE Charleston SC',  'NE Charlotte NC',  'NE Wallingford CT',  'NE Wilmington NC',  'NE Bangor ME',  'NE Columbia SC 2')    qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id, a.acss_call_id order by a.cust_id, a.cust_line_seq_id, a.acss_call_id, a.acss_call_dt) = 1  GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37 ORDER BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37;  --Drop Table ANI_NUM_V; --Drop Table SA_INUM_V; --DROP TABLE Repeat_Reporting_EMH1; --DROP TABLE NTL_PRD_QMTBLS. Repeat_Reporting_EMH21; --DROP TABLE ndcir_clnr_v;	TERADATA	HABERER	00:00:00	00:00:00	17925
10/10/2012	07:49:12	NTL_PRD_ALLVM	00:08:52	6145			CREATE VOLATILE TABLE SA_INUM_V AS ( select  a.rpt_mnth ,a.acss_mtn ,a.sa_mtn ,a.cust_id ,a.cust_line_seq_id ,a.call_start_dt   ,a.sa_start_tm ,a.acss_start_tm ,a.acss_user_id ,a.acss_call_id ,a.url_speech ,a.inum ,a.acss_call_type_cd ,a.start_diff ,a.row_num  from (SELECT  (acs.acss_call_dt - (EXTRACT(DAY FROM acs.acss_call_dt) - 1)) rpt_mnth ,acs.mtn as acss_mtn ,sa.mtn as sa_mtn ,acs.cust_id ,acs.cust_line_seq_id ,acs.call_start_dt   ,sa.call_start_tm as sa_start_tm ,acs.call_start_tm as acss_start_tm ,acss_user_id ,acs.acss_call_id ,sa.url_speech ,sa.inum ,acs.acss_call_type_cd ,ABS((sa_start_tm - acss_start_tm) MINUTE(4) TO SECOND) AS start_diff, ROW_NUMBER() OVER (PARTITION BY acs.cust_id, acs.cust_line_seq_id ORDER BY acs.call_start_dt, acs.call_start_tm, acss_call_id ) as row_num  from ntl_prd_allvm.tp_speech_analytics_call_v as sa          join  ntl_prd_allvm.acss_call_v as acs ON acs.call_start_dt=sa.call_start_dt AND acss_user_id=sa.nt_user_id                       left join  ntl_prd_allvm.acss_call_center_v AS  cc                   ON acs.acss_call_ctr_cd = cc.acss_call_ctr_cd                   where rpt_mnth >= '2012-09-01' and start_diff<'2:00.000000'  qualify ROW_NUMBER() OVER (PARTITION BY sa.call_start_dt,sa_start_tm, acss_user_id ORDER BY sa.inum, start_diff) = 1) as a  where row_num = '1' and a.acss_call_type_cd in ('1','7')  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15  ) WITH DATA PRIMARY INDEX (cust_id, cust_line_seq_id, inum, call_start_dt, acss_call_id) ON COMMIT PRESERVE ROWS;   CREATE VOLATILE TABLE ANI_NUM_V AS ( select (ivr.ivr_call_dt - (EXTRACT(DAY FROM ivr.ivr_call_dt) - 1)) rpt_mnth, cal.sor_id, cal.mtn as cal_mtn, ivr.mtn as ivr_mtn, cal.cust_id, cal.cust_line_seq_id, ivr.ivr_call_id, ivr.ani_num   from ntl_prd_allvm.cust_acct_line_dly_hist_v as cal  inner join ntl_prd_allvm.ivr_call_v as ivr        on cal.cust_id = ivr.cust_id      and cal.cust_line_seq_id = ivr.cust_line_seq_id      and ivr.ivr_call_dt BETWEEN cal.eff_dt AND cal.exp_dt       where  rpt_mnth >= '2012-09-01' and cal.sor_id = 'v' and cal.rev_gen_ind = 'Y' and cal.prepaid_ind <> 'Y' and cal.mtn_status_ind in ('a','s')  group by 1,2,3,4,5,6,7,8  ) WITH DATA PRIMARY INDEX (cust_id, cust_line_seq_id, ani_num, sor_id ) ON COMMIT PRESERVE ROWS;   CREATE VOLATILE TABLE ndcir_clnr_v                                         AS(select a.activity_mnth, a.activity_type, a.cust_id,                              a.cust_line_seq_id,                                a.activity_dt   from (SELECT                                                 (p.pymnt_dt - (EXTRACT(DAY FROM p.pymnt_dt) - 1)) activity_mnth, case when  b.item_cd LIKE ANY ('FRU%','CLNR%') then 'clnr' else null end as activity_type, p.cust_id,                              p.cust_line_seq_id,                                min(p.pymnt_dt) as activity_dt                                                                                                                                                                                                                                                                                                                    FROM ntl_prd_allvm.pos_trans_v as p  JOIN ntl_prd_allvm.cust_acct_dly_hist_v AS ca         ON p.cust_id = ca.cust_id       AND p.acct_num = ca.acct_num AND p.pymnt_dt BETWEEN ca.eff_dt AND ca.exp_dt                                        JOIN ntl_prd_allvm.item_v as b                              ON p.item_cd = b.item_cd       AND p.sor_id = b.sor_id           AND p.region_cd = b.region_cd                                   AND b.item_cd LIKE ANY ('FRU%','CLNR%')                                                                         WHERE    activity_mnth >= '2012-09-01'                                              AND p.sold_qty > 0      and (b.IA_ITEM_GROUP_CD like '%DATA%' OR b.IA_ITEM_GROUP_CD like '%PHONE%' OR b.IA_ITEM_GROUP_CD like '%VCP%' )        AND p.cust_id IS NOT NULL AND COALESCE (p.refund_applied_ind, 'E') <> 'R'     --and p.cust_id = '100008270' --and p.cust_line_seq_id = '2'  group by 1,2,3,4) as a   qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id order by a.cust_id, a.cust_line_seq_id, a.activity_dt) = 1  group by 1,2,3,4,5  union all  select activity_mth, activity_type, cust_id, cust_line_seq_id, activity_dt  from ntl_prd_qmvm.ndcir_detail_v  where activity_mth >= '2012-09-01' --and cust_id = '100000050' --and cust_line_seq_id = '1'  qualify row_number() over (partition by cust_id, cust_line_seq_id order by cust_id, cust_line_seq_id, activity_dt) = 1  group by 1,2,3,4,5 )                                                                 WITH DATA                                          PRIMARY INDEX (cust_id, cust_line_seq_id, activity_dt)                                              ON COMMIT PRESERVE ROWS;      CREATE VOLATILE TABLE Repeat_Reporting_EMH1 AS (SELECT      acc.acss_call_ctr_desc,      acc.acss_call_ctr_cd,      ac.sor_id,      ac.acss_call_type_cd,     acc.acss_area_cd AS ctr_area,      acc.acss_call_ctr_type,      ac.cust_id,      ac.cust_line_seq_id,          ac.acct_num,      ac.mtn,      ac.acss_user_id,      ac.acss_call_dt,          ac.acss_call_tm,           (ac.call_disconnect_tm - ac.call_start_tm) HOUR TO SECOND (0) AS call_duration_tm,      COALESCE(sed.departmenttype,'Other') depttype,           COALESCE(sed.departmentgroup, 'Other') as dept_group,          CASE  WHEN acc.acss_call_ctr_time_zn LIKE 'C%' THEN                       ac.acss_call_tm + INTERVAL '1' HOUR                          WHEN acc.acss_call_ctr_time_zn LIKE 'M%' THEN               ac.acss_call_tm + INTERVAL '2' HOUR                          WHEN acc.acss_call_ctr_time_zn LIKE 'P%' THEN                 ac.acss_call_tm +INTERVAL '3' HOUR                            WHEN acc.acss_call_ctr_time_zn LIKE 'H%' THEN                ac.acss_call_tm + INTERVAL '5' HOUR                           ELSE ac.acss_call_tm         END acss_call_ad,      CAST(          ac.acss_call_dt ||          ' '             ||          CAST(acss_call_ad AS CHAR(8)) AS TIMESTAMP(0)      ) acss_dt_tm,      ad.acss_dept_desc,      ad.acss_dept_id,      ac.acss_call_id,          ac.ivr_call_id,      ac.area_cd,      RANK() OVER (PARTITION BY cust_id, cust_line_seq_id          ORDER BY ac.acss_call_dt, acss_call_ad, acss_call_id) rnk  FROM ntl_prd_allvm.acss_call_v AS ac  JOIN sys_calendar.calendar AS z        ON calendar_date= DATE   JOIN ntl_prd_allvm.acss_call_center_v AS acc      ON ac.acss_call_ctr_cd = acc.acss_call_ctr_cd  left JOIN ntl_prd_allvm.acss_user_v AS au      ON ac.acss_user_id = au.acss_user_id  JOIN ntl_prd_allvm.acss_dept_v AS ad      ON ac.acss_dept_id = ad.acss_dept_id  LEFT JOIN ntl_prd_qmtbls.emh_eccr_dep AS sed    ON ad.acss_dept_id = sed.acssdeptid  LEFT JOIN                  (SELECT a.acss_call_dt,a.acss_call_ctr_cd, a.acss_dept_id FROM                  ntl_prd_allvm.acss_call_v  as a                                  JOIN sys_calendar.calendar AS z                        ON calendar_date= DATE                                   WHERE                  a.acss_call_dt BETWEEN (DATE-(2)) AND (DATE-(2))                  AND a.acss_call_type_cd = '1'                  GROUP BY 1,2,3) r  ON          ac.acss_call_dt = r.acss_call_dt          AND ac.acss_call_ctr_cd = r.acss_call_ctr_cd          AND ac.acss_dept_id = r.acss_dept_id  WHERE ac.acss_call_dt BETWEEN (DATE-(2)) AND (DATE-(2))  AND COALESCE(sed.departmenttype,'Other') <> 'NA'  AND (      (ac.acss_call_type_cd IN ('1','7')) OR      (          ac.acss_call_type_cd = '3'          AND acc.acss_call_ctr_type = 'O'          AND ad.acss_dept_desc NOT LIKE '%offline%'          AND r.acss_dept_id IS NULL ))  ) WITH DATA PRIMARY INDEX (cust_id, cust_line_seq_id, acss_call_dt, acss_call_id, rnk) ON COMMIT PRESERVE ROWS;   CREATE TABLE NTL_PRD_QMTBLS.Repeat_Reporting_EMH21  AS  (  SELECT      a.sor_id,      a.acss_call_id,          a.ivr_call_id,      a.acss_call_type_cd,      a.ctr_area,      a.acss_call_ctr_type,      m.area_cd,      m.region_desc,      a.cust_id,      a.cust_line_seq_id,      a.mtn,      a.acss_call_dt,          a.acss_call_ad,          a.acss_call_tm,           a.call_duration_tm,      a.rnk,      a.acss_dept_desc as initial_dept_desc,      a.acss_dept_id,      a.acss_user_id,      a.acss_call_ctr_desc,      a.acss_call_ctr_cd,      a.depttype AS orgtype,          a.dept_group as org_dept_group,      b.acss_call_id AS repeat_call_id,      b.acss_dept_desc AS repeat_dept_desc,      b.acss_dept_id AS repeat_dept_id,          b.acss_user_id AS repeat_user_id,          b.acss_call_ctr_desc AS repeat_call_ctr_desc,      b.acss_call_ctr_cd AS repeat_ctr_cd,      b.acss_call_dt AS repeat_dt,          b.acss_call_ad AS repeat_call_ad,         b.acss_call_tm as repeat_call_tm,           b.call_duration_tm as repeat_call_duration_tm,      b.rnk AS repeat_rnk,      b.depttype AS reptype,          b.dept_group as rpt_dept_group,      CASE WHEN b.acss_dt_tm IS NOT NULL THEN        ((b.acss_dt_tm - a.acss_dt_tm) DAY(4) TO MINUTE ) END tsdiff,      CASE WHEN b.acss_dt_tm IS NOT NULL THEN        (EXTRACT(HOUR FROM tsdiff) * 60)        + EXTRACT(MINUTE FROM tsdiff)        + (CAST((CAST ((tsdiff) AS INTERVAL DAY)) AS INTEGER) * 1440) END min_diff  FROM Repeat_Reporting_EMH1 AS a  JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt                 JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)       INNER JOIN Repeat_Reporting_EMH1 AS b          ON  a.cust_id = b.cust_id          AND a.cust_line_seq_id = b.cust_line_seq_id                  AND a.acss_call_dt = b.acss_call_dt                       AND b.rnk = a.rnk + 1          AND b.acss_call_id <> a.acss_call_id                    LEFT JOIN ntl_prd_allvm.acss_call_center_v AS acc      ON b.acss_call_ctr_cd = acc.acss_call_ctr_cd  ) WITH DATA PRIMARY INDEX( sor_id, acss_call_id, ivr_call_id, acss_call_type_cd, ctr_area, acss_call_ctr_type, area_cd, region_desc, cust_id, cust_line_seq_id, mtn, acss_call_dt, acss_call_ad, acss_call_tm, call_duration_tm, rnk, initial_dept_desc, acss_dept_id, acss_user_id, acss_call_ctr_desc, acss_call_ctr_cd, orgtype, org_dept_group, repeat_call_id, repeat_dept_desc, repeat_dept_id, repeat_user_id, repeat_call_ctr_desc, repeat_ctr_cd, repeat_dt, repeat_call_ad, repeat_call_tm, repeat_call_duration_tm, repeat_rnk, reptype, rpt_dept_group, tsdiff, min_diff);  select a.acss_call_ctr_desc, hr1.nm_last || ', ' || hr1.nm_first AS  AD_Nm,  hr2.nm_last || ', ' || hr2.nm_first AS Supv_Nm,    u.nm_last||', '||u.nm_first AS First_Rep_nm,  a.initial_dept_desc,  a.acss_user_id, a.mtn, coalesce(ani.ani_num, '0000000000') as ani_num, sa.inum as initial_cll_inum, a.cust_id, a.area_cd, a.region_desc, coalesce(a.acss_call_dt - nc.activity_dt, 'n/a') as call_period_snc_trans, coalesce(nc.activity_type, 'n/a') as activity_type, coalesce(cast(cast(nc.activity_dt as format 'mm/dd/yyyy') as char(10)), 'n/a') as activity_dt, CASE WHEN cal.Device_type_cd LIKE '%4GS%'  THEN cal.device_prod_nm  ELSE cal.prod_nm END AS Device_Nm, dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, a.orgtype, a.acss_call_dt, a.acss_call_ad, a.acss_call_tm, a.call_duration_tm, a.repeat_call_ctr_desc, u1.nm_last||', '||u1.nm_first AS Repeat_Rep_nm,  a.repeat_dept_desc, a.reptype, a.repeat_dt, a.repeat_call_ad, a.repeat_call_tm, a.repeat_call_duration_tm, sa1.inum as rpt_cll_inum, a.tsdiff, a.min_diff, CASE WHEN (a.repeat_call_ad - a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00' THEN  'Y' ELSE 'N' END AS Rpts_2hrs_and_Under, sa.url_speech as intial_cll_url_speech, sa1.url_speech as rpt_call_url_speech   FROM NTL_PRD_QMTBLS.Repeat_Reporting_EMH21 AS a  JOIN sys_calendar.calendar AS z   ON calendar_date= DATE   JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt       Left join ndcir_clnr_v as nc   on a.cust_id = nc.cust_id   and a.cust_line_seq_id = nc.cust_line_seq_id   and a.acss_call_dt >= nc.activity_dt  and  nc.activity_dt between '2012-09-07' and '2012-10-07'        LEFT JOIN ANI_NUM_V AS ani   on a.sor_id = ani.sor_id   and a.cust_id = ani.cust_id   and a.cust_line_seq_id = ani.cust_line_seq_id   and a.ivr_call_id = ani.ivr_call_id      LEFT JOIN SA_INUM_V AS sa   ON a.cust_id = sa.cust_id   and a.cust_line_seq_id = sa.cust_line_seq_id   and a.acss_call_dt = sa.call_start_dt   and a.acss_call_id = sa.acss_call_id      LEFT JOIN SA_INUM_V AS sa1   ON a.cust_id = sa1.cust_id   and a.cust_line_seq_id = sa1.cust_line_seq_id   and a.repeat_dt = sa1.call_start_dt   and a.repeat_call_id = sa1.acss_call_id      LEFT JOIN ntl_prd_allvm.device_dp_map_v AS dm                     ON (CASE WHEN cal.Device_type_cd LIKE '%4GS%' THEN cal.device_prod_nm ELSE cal.prod_nm END) = dm.prod_nm                JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)  LEFT JOIN ntl_prd_qmtbls.stm_eccr_area AS s    ON a.acss_call_ctr_cd = s.acsscallcentercd    AND a.acss_dept_id = s.acssdeptid      left Join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id = u.acss_user_id    left JOIN ntl_prd_allvm.hr_employee_v AS hr  ON u.hr_employee_id = hr.emp_id    LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr2              ON hr.SUPER_ID_LVL2_EMP_ID = hr2.emp_id                     LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr1           ON hr.SUPER_ID_LVL1_EMP_ID = hr1.emp_id   Left Join ntl_prd_allvm.acss_user_v AS u1  on a.repeat_user_id = u1.acss_user_id  WHERE acss_call_dt BETWEEN '2012-10-01' AND ADD_MONTHS('2012-10-01',1)-1 and a.orgtype IN ('CS','WDTS')  and a.reptype IN ('CS','WDTS')  and a.org_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.rpt_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.acss_call_ctr_desc IN('NE Columbia SC',  'NE Huntsville AL',  'NE Hanover MD',  'NE Rochester NY',  'NE Charleston SC',  'NE Charlotte NC',  'NE Wallingford CT',  'NE Wilmington NC',  'NE Bangor ME',  'NE Columbia SC 2')    GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37 ORDER BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37;  --Drop Table ANI_NUM_V; --Drop Table SA_INUM_V; --DROP TABLE Repeat_Reporting_EMH1; --DROP TABLE NTL_PRD_QMTBLS. Repeat_Reporting_EMH21; --DROP TABLE ndcir_clnr_v;	TERADATA	HABERER	00:01:35	00:07:17	17924
10/09/2012	15:07:23	NTL_PRD_ALLVM	00:00:02	0	10053		drop table SA_INUM_V;  drop table ANI_NUM_V;	TERADATA	HABERER	00:00:02	00:00:00	17923
10/09/2012	14:41:29	NTL_PRD_ALLVM	00:01:09	14908			select  a.activity_mth,  a.activity_dt,  a.activity_type,  a.sls_area_desc as sales_area,  a.sls_region_desc as sales_region,  a.sls_dist_chnl_churn_ctgry,  a.sls_outlet_id,  o.sls_outlet_nm as outlet,   coalesce(case when heh.nm_mdlin is null then   heh.nm_last||', '||heh.nm_first   else heh.nm_last||', '||heh.nm_first||' '||trim(heh.nm_mdlin)||'.' end, 'Unknown') as sls_rep_nm, heh.job_desc, coalesce(case when heh02.nm_mdlin is null then   heh02.nm_last||', '||heh02.nm_first   else heh02.nm_last||', '||heh02.nm_first||' '||trim(heh02.nm_mdlin)||'.' end, 'Unknown') as sls_rep_direct_mgr,  heh02.email_addr as rep_direct_mgr_email,  heh02.job_desc as direct_mgr_job_desc,  coalesce(case when heh01.nm_mdlin is null then   heh01.nm_last||', '||heh01.nm_first   else heh01.nm_last||', '||heh01.nm_first||' '||trim(heh01.nm_mdlin)||'.' end, 'Unknown') as sls_district_mgr_nm,  heh01.email_addr as district_mgr_email,  heh01.job_desc as district_mgr_job_desc,  o.district_cd as Zone_District_cd,  a.area_desc as cust_area_desc,  a.region_desc as cust_region_desc,  cal.nm_first||'   '||cal.nm_last AS cust_name,  a.lang_pref_ind,  cal.mtn,   a.cust_id,  a.cust_line_seq_id,  a.device_nm_prev,  a.device_nm,  dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, case when a.fulfillement_ind='F' then 'direct' when a.fulfillement_ind='L' then 'local' else 'unknown' end as dfill, case when a.ecpd_liability_type_cd='C' then 'Business' else 'Consumer' end as Consumer_Business, case when dnsh.dns_type_cd is not null then 'Yes' When dnsh.dns_type_cd is null then 'No' end as on_dns_list, case when acs.currentstatus = 'Completed' and acs.mtn is not null then 'Yes'  else 'No' end as After_Cll_Survey  from ndcir_up_nc_emh_v as a  join  ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal ON a.cust_id = cal.cust_id AND a.cust_line_seq_id = cal.cust_line_seq_id AND a.activity_dt  BETWEEN cal.eff_dt AND cal.exp_dt  left join ntl_prd_allvm.cust_acct_line_dns_dly_hist_v as dnsh on a.sor_id = dnsh.sor_id and a.cust_id = dnsh.cust_id and a.cust_line_seq_id = dnsh.cust_line_seq_id and dnsh.dns_type_cd = 'SR' and a.activity_dt + 1 between dnsh.eff_dt and dnsh.exp_dt  left join ntl_prd_qmtbls.after_call_survey_emh_v as acs on cal.mtn = acs.mtn and cal.cust_id = acs.customerid  left join ntl_prd_allvm.hr_employee_hist_v as heh on a.hr_employee_id = heh.emp_id and a.activity_dt between heh.eff_dt and heh.exp_dt  left join ntl_prd_allvm.hr_employee_hist_v AS heh02              on heh.super_id_lvl2_emp_id = heh02.emp_id and a.activity_dt between heh02.eff_dt and heh02.exp_dt                   left join ntl_prd_allvm.hr_employee_hist_v AS heh01          on heh.super_id_lvl1_emp_id  = heh01.emp_id  and a.activity_dt between heh01.eff_dt and heh01.exp_dt    left join  ntl_prd_allvm.dns_type_v as dnsd on dnsh.dns_type_cd = dnsd.dns_type_cd  left join ntl_prd_allvm.outlet_v as o  on a.sls_outlet_id = o.sls_outlet_id   left join  ntl_prd_allvm.device_dp_map_v AS dm                   ON a.device_nm = dm.prod_nm   where  a.activity_mth = '2012-10-01' and a.sls_area_desc = 'Northeast' and a.sls_region_desc = 'New York Metro' and a.sls_dist_chnl_churn_ctgry = 'Stores' and dfill = 'Local' and heh.job_cd in ('65045', 'V51103')     and dm.device_tier not in ('Tablet', 'PC Card', 'Other') and on_dns_list <> 'Yes' and After_Cll_Survey <> 'Yes'  qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id order by a.cust_id, a.cust_line_seq_id, a.activity_dt) = 1  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32 order by a.sls_area_desc, a.sls_region_desc, a.activity_dt asc;  --drop table Reporting_Month; --drop table nccir_base11; --drop table nccir_base1a; --drop table nccir_base11b; --drop table nccir_acts_v; --drop table upcir_base11; --drop table upcir_base22; --drop table upcir_base33; --drop table upcir_base22a; --drop table upcir_base22aa; --drop table upcir_base22b; --drop table upcir_base22bb; --drop table upcir_up_v; --drop table ndcir_up_nc_emh_v;	TERADATA	HABERER	00:00:31	00:00:38	17922
10/09/2012	14:35:17	NTL_PRD_ALLVM	00:09:42	14904			create volatile table Reporting_Month as (  select *  from ntl_prd_qmtbls.month_date_emh_v   where date_range = '2012-10-01'  ) with data primary index(month_range, date_range)  index(date_range) order by values(date_range) on commit preserve rows;   --Table one NC create volatile table nccir_base11 as (  select    'NC' as activity_type   ,(dla.activity_dt - (extract(day from dla.activity_dt)-1)) as activity_mth   ,dla.activity_dt   ,mh.area_desc   ,mh.region_desc   ,dla. ...	TERADATA	HABERER	00:09:18	00:00:24	17921
10/09/2012	14:00:11	NTL_PRD_ALLVM	00:00:10	89			Drop Table ANI_NUM_V; Drop Table SA_INUM_V; DROP TABLE Repeat_Reporting_EMH1; DROP TABLE NTL_PRD_QMTBLS. Repeat_Reporting_EMH21; DROP TABLE ndcir_clnr_v;	TERADATA	HABERER	00:00:10	00:00:00	17920
10/09/2012	13:25:23	NTL_PRD_ALLVM	00:08:02	38808			select a.acss_call_ctr_desc, hr1.nm_last || ', ' || hr1.nm_first AS  AD_Nm,  hr2.nm_last || ', ' || hr2.nm_first AS Supv_Nm,    u.nm_last||', '||u.nm_first AS First_Rep_nm,  a.initial_dept_desc,  a.acss_user_id, a.mtn, coalesce(ani.ani_num, '0000000000') as ani_num, sa.inum as initial_cll_inum, a.cust_id, a.area_cd, a.region_desc, coalesce(a.acss_call_dt - nc.activity_dt, 'n/a') as call_period_snc_trans, coalesce(nc.activity_type, 'n/a') as activity_type, coalesce(cast(cast(nc.activity_dt as format 'mm/dd/yyyy') as char(10)), 'n/a') as activity_dt, CASE WHEN cal.Device_type_cd LIKE '%4GS%'  THEN cal.device_prod_nm  ELSE cal.prod_nm END AS Device_Nm, dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, a.orgtype, a.acss_call_dt, a.acss_call_ad, a.acss_call_tm, a.call_duration_tm, a.repeat_call_ctr_desc, u1.nm_last||', '||u1.nm_first AS Repeat_Rep_nm,  a.repeat_dept_desc, a.reptype, a.repeat_dt, a.repeat_call_ad, a.repeat_call_tm, a.repeat_call_duration_tm, sa1.inum as rpt_cll_inum, a.tsdiff, a.min_diff, CASE WHEN (a.repeat_call_ad - a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00' THEN  'Y' ELSE 'N' END AS Rpts_2hrs_and_Under, sa.url_speech as intial_cll_url_speech, sa1.url_speech as rpt_call_url_speech   FROM NTL_PRD_QMTBLS.Repeat_Reporting_EMH21 AS a  JOIN sys_calendar.calendar AS z   ON calendar_date= DATE   JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt       Left join ndcir_clnr_v as nc   on a.cust_id = nc.cust_id   and a.cust_line_seq_id = nc.cust_line_seq_id   and a.acss_call_dt >= nc.activity_dt  and  nc.activity_dt between '2012-09-06' and '2012-10-06'        LEFT JOIN ANI_NUM_V AS ani   on a.sor_id = ani.sor_id   and a.cust_id = ani.cust_id   and a.cust_line_seq_id = ani.cust_line_seq_id   and a.ivr_call_id = ani.ivr_call_id      LEFT JOIN SA_INUM_V AS sa   ON a.cust_id = sa.cust_id   and a.cust_line_seq_id = sa.cust_line_seq_id   and a.acss_call_dt = sa.call_start_dt   and a.acss_call_id = sa.acss_call_id      LEFT JOIN SA_INUM_V AS sa1   ON a.cust_id = sa1.cust_id   and a.cust_line_seq_id = sa1.cust_line_seq_id   and a.repeat_dt = sa1.call_start_dt   and a.repeat_call_id = sa1.acss_call_id      LEFT JOIN ntl_prd_allvm.device_dp_map_v AS dm                     ON (CASE WHEN cal.Device_type_cd LIKE '%4GS%' THEN cal.device_prod_nm ELSE cal.prod_nm END) = dm.prod_nm                JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)  LEFT JOIN ntl_prd_qmtbls.stm_eccr_area AS s    ON a.acss_call_ctr_cd = s.acsscallcentercd    AND a.acss_dept_id = s.acssdeptid      left Join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id = u.acss_user_id    left JOIN ntl_prd_allvm.hr_employee_v AS hr  ON u.hr_employee_id = hr.emp_id    LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr2              ON hr.SUPER_ID_LVL2_EMP_ID = hr2.emp_id                     LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr1           ON hr.SUPER_ID_LVL1_EMP_ID = hr1.emp_id   Left Join ntl_prd_allvm.acss_user_v AS u1  on a.repeat_user_id = u1.acss_user_id  WHERE acss_call_dt BETWEEN '2012-09-01' AND ADD_MONTHS('2012-10-01',1)-1 and a.orgtype IN ('CS','WDTS')  and a.reptype IN ('CS','WDTS')  and a.org_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.rpt_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.acss_call_ctr_desc IN('NE Columbia SC',  'NE Huntsville AL',  'NE Hanover MD',  'NE Rochester NY',  'NE Charleston SC',  'NE Charlotte NC',  'NE Wallingford CT',  'NE Wilmington NC',  'NE Bangor ME',  'NE Columbia SC 2')    GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37 ORDER BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37;  --Drop Table ANI_NUM_V; --Drop Table SA_INUM_V; --DROP TABLE Repeat_Reporting_EMH1; --DROP TABLE NTL_PRD_QMTBLS. Repeat_Reporting_EMH21; --DROP TABLE ndcir_clnr_v;	TERADATA	HABERER	00:07:37	00:00:25	17919
10/09/2012	13:05:10	NTL_PRD_ALLVM	00:51:29	38768			select a.acss_call_ctr_desc, hr1.nm_last || ', ' || hr1.nm_first AS  AD_Nm,  hr2.nm_last || ', ' || hr2.nm_first AS Supv_Nm,    u.nm_last||', '||u.nm_first AS First_Rep_nm,  a.initial_dept_desc,  a.acss_user_id, a.mtn, coalesce(ani.ani_num, '0000000000') as ani_num, sa.inum as initial_cll_inum, a.cust_id, a.area_cd, a.region_desc, coalesce(a.acss_call_dt - nc.activity_dt, 'n/a') as call_period_snc_trans, coalesce(nc.activity_type, 'n/a') as activity_type, coalesce(cast(cast(nc.activity_dt as format 'mm/dd/yyyy') as char(10)), 'n/a') as activity_dt, CASE WHEN cal.Device_type_cd LIKE '%4GS%'  THEN cal.device_prod_nm  ELSE cal.prod_nm END AS Device_Nm, dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, a.orgtype, a.acss_call_dt, a.acss_call_ad, a.acss_call_tm, a.call_duration_tm, a.repeat_call_ctr_desc, u1.nm_last||', '||u1.nm_first AS Repeat_Rep_nm,  a.repeat_dept_desc, a.reptype, a.repeat_dt, a.repeat_call_ad, a.repeat_call_tm, a.repeat_call_duration_tm, sa1.inum as rpt_cll_inum, a.tsdiff, a.min_diff, CASE WHEN (a.repeat_call_ad - a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00' THEN  'Y' ELSE 'N' END AS Rpts_2hrs_and_Under, sa.url_speech as intial_cll_url_speech, sa1.url_speech as rpt_call_url_speech   FROM NTL_PRD_QMTBLS.Repeat_Reporting_EMH21 AS a  JOIN sys_calendar.calendar AS z   ON calendar_date= DATE   JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt       Left join ndcir_clnr_v as nc   on a.cust_id = nc.cust_id   and a.cust_line_seq_id = nc.cust_line_seq_id   and a.acss_call_dt >= nc.activity_dt  and  nc.activity_dt between a.acss_call_dt and a.acss_call_dt + 20        LEFT JOIN ANI_NUM_V AS ani   on a.sor_id = ani.sor_id   and a.cust_id = ani.cust_id   and a.cust_line_seq_id = ani.cust_line_seq_id   and a.ivr_call_id = ani.ivr_call_id      LEFT JOIN SA_INUM_V AS sa   ON a.cust_id = sa.cust_id   and a.cust_line_seq_id = sa.cust_line_seq_id   and a.acss_call_dt = sa.call_start_dt   and a.acss_call_id = sa.acss_call_id      LEFT JOIN SA_INUM_V AS sa1   ON a.cust_id = sa1.cust_id   and a.cust_line_seq_id = sa1.cust_line_seq_id   and a.repeat_dt = sa1.call_start_dt   and a.repeat_call_id = sa1.acss_call_id      LEFT JOIN ntl_prd_allvm.device_dp_map_v AS dm                     ON (CASE WHEN cal.Device_type_cd LIKE '%4GS%' THEN cal.device_prod_nm ELSE cal.prod_nm END) = dm.prod_nm                JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)  LEFT JOIN ntl_prd_qmtbls.stm_eccr_area AS s    ON a.acss_call_ctr_cd = s.acsscallcentercd    AND a.acss_dept_id = s.acssdeptid      left Join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id = u.acss_user_id    left JOIN ntl_prd_allvm.hr_employee_v AS hr  ON u.hr_employee_id = hr.emp_id    LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr2              ON hr.SUPER_ID_LVL2_EMP_ID = hr2.emp_id                     LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr1           ON hr.SUPER_ID_LVL1_EMP_ID = hr1.emp_id   Left Join ntl_prd_allvm.acss_user_v AS u1  on a.repeat_user_id = u1.acss_user_id  WHERE acss_call_dt BETWEEN '2012-09-01' AND ADD_MONTHS('2012-10-01',1)-1 and a.orgtype IN ('CS','WDTS')  and a.reptype IN ('CS','WDTS')  and a.org_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.rpt_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.acss_call_ctr_desc IN('NE Columbia SC',  'NE Huntsville AL',  'NE Hanover MD',  'NE Rochester NY',  'NE Charleston SC',  'NE Charlotte NC',  'NE Wallingford CT',  'NE Wilmington NC',  'NE Bangor ME',  'NE Columbia SC 2')    GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37 ORDER BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37;  --Drop Table ANI_NUM_V; --Drop Table SA_INUM_V; --DROP TABLE Repeat_Reporting_EMH1; --DROP TABLE NTL_PRD_QMTBLS. Repeat_Reporting_EMH21; --DROP TABLE ndcir_clnr_v;	TERADATA	HABERER	00:21:30	00:29:59	17918
10/09/2012	12:09:42	NTL_PRD_ALLVM	02:18:37	38843			CREATE VOLATILE TABLE SA_INUM_V AS ( select  a.rpt_mnth ,a.acss_mtn ,a.sa_mtn ,a.cust_id ,a.cust_line_seq_id ,a.call_start_dt   ,a.sa_start_tm ,a.acss_start_tm ,a.acss_user_id ,a.acss_call_id ,a.url_speech ,a.inum ,a.acss_call_type_cd ,a.start_diff ,a.row_num  from (SELECT  (acs.acss_call_dt - (EXTRACT(DAY FROM acs.acss_call_dt) - 1)) rpt_mnth ,acs.mtn as acss_mtn ,sa.mtn as sa_mtn ,acs.cust_id ,acs.cust_line_seq_id ,acs.call_start_dt   ,sa.call_start_tm as sa_start_tm ,acs.call_start_tm as acss_start_tm ,acss_user_id ,acs.acss_call_id ,sa.url_speech ,sa.inum ,acs.acss_call_type_cd ,ABS((sa_start_tm - acss_start_tm) MINUTE(4) TO SECOND) AS start_diff, ROW_NUMBER() OVER (PARTITION BY acs.cust_id, acs.cust_line_seq_id ORDER BY acs.call_start_dt, acs.call_start_tm, acss_call_id ) as row_num  from ntl_prd_allvm.tp_speech_analytics_call_v as sa          join  ntl_prd_allvm.acss_call_v as acs ON acs.call_start_dt=sa.call_start_dt AND acss_user_id=sa.nt_user_id                       left join  ntl_prd_allvm.acss_call_center_v AS  cc                   ON acs.acss_call_ctr_cd = cc.acss_call_ctr_cd                   where rpt_mnth >= '2012-09-01' and start_diff<'2:00.000000'  qualify ROW_NUMBER() OVER (PARTITION BY sa.call_start_dt,sa_start_tm, acss_user_id ORDER BY sa.inum, start_diff) = 1) as a  where row_num = '1' and a.acss_call_type_cd in ('1','7')  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15  ) WITH DATA PRIMARY INDEX (cust_id, cust_line_seq_id, inum, call_start_dt, acss_call_id) ON COMMIT PRESERVE ROWS;   CREATE VOLATILE TABLE ANI_NUM_V AS ( select (ivr.ivr_call_dt - (EXTRACT(DAY FROM ivr.ivr_call_dt) - 1)) rpt_mnth, cal.sor_id, cal.mtn as cal_mtn, ivr.mtn as ivr_mtn, cal.cust_id, cal.cust_line_seq_id, ivr.ivr_call_id, ivr.ani_num   from ntl_prd_allvm.cust_acct_line_dly_hist_v as cal  inner join ntl_prd_allvm.ivr_call_v as ivr        on cal.cust_id = ivr.cust_id      and cal.cust_line_seq_id = ivr.cust_line_seq_id      and ivr.ivr_call_dt BETWEEN cal.eff_dt AND cal.exp_dt       where  rpt_mnth >= '2012-09-01' and cal.sor_id = 'v' and cal.rev_gen_ind = 'Y' and cal.prepaid_ind <> 'Y' and cal.mtn_status_ind in ('a','s')  group by 1,2,3,4,5,6,7,8  ) WITH DATA PRIMARY INDEX (cust_id, cust_line_seq_id, ani_num, sor_id ) ON COMMIT PRESERVE ROWS;   CREATE VOLATILE TABLE ndcir_clnr_v                                         AS(select a.activity_mnth, a.activity_type, a.cust_id,                              a.cust_line_seq_id,                                a.activity_dt   from (SELECT                                                 (p.pymnt_dt - (EXTRACT(DAY FROM p.pymnt_dt) - 1)) activity_mnth, case when  b.item_cd LIKE ANY ('FRU%','CLNR%') then 'clnr' else null end as activity_type, p.cust_id,                              p.cust_line_seq_id,                                min(p.pymnt_dt) as activity_dt                                                                                                                                                                                                                                                                                                                    FROM ntl_prd_allvm.pos_trans_v as p  JOIN ntl_prd_allvm.cust_acct_dly_hist_v AS ca         ON p.cust_id = ca.cust_id       AND p.acct_num = ca.acct_num AND p.pymnt_dt BETWEEN ca.eff_dt AND ca.exp_dt                                        JOIN ntl_prd_allvm.item_v as b                              ON p.item_cd = b.item_cd       AND p.sor_id = b.sor_id           AND p.region_cd = b.region_cd                                   AND b.item_cd LIKE ANY ('FRU%','CLNR%')                                                                         WHERE    activity_mnth >= '2012-09-01'                                              AND p.sold_qty > 0      and (b.IA_ITEM_GROUP_CD like '%DATA%' OR b.IA_ITEM_GROUP_CD like '%PHONE%' OR b.IA_ITEM_GROUP_CD like '%VCP%' )        AND p.cust_id IS NOT NULL AND COALESCE (p.refund_applied_ind, 'E') <> 'R'     --and p.cust_id = '100008270' --and p.cust_line_seq_id = '2'  group by 1,2,3,4) as a   qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id order by a.cust_id, a.cust_line_seq_id, a.activity_dt) = 1  group by 1,2,3,4,5  union all  select activity_mth, activity_type, cust_id, cust_line_seq_id, activity_dt  from ntl_prd_qmvm.ndcir_detail_v  where activity_mth >= '2012-09-01' --and cust_id = '100000050' --and cust_line_seq_id = '1'  qualify row_number() over (partition by cust_id, cust_line_seq_id order by cust_id, cust_line_seq_id, activity_dt) = 1  group by 1,2,3,4,5 )                                                                 WITH DATA                                          PRIMARY INDEX (cust_id, cust_line_seq_id, activity_dt)                                              ON COMMIT PRESERVE ROWS;      CREATE VOLATILE TABLE Repeat_Reporting_EMH1 AS (SELECT      acc.acss_call_ctr_desc,      acc.acss_call_ctr_cd,      ac.sor_id,      ac.acss_call_type_cd,     acc.acss_area_cd AS ctr_area,      acc.acss_call_ctr_type,      ac.cust_id,      ac.cust_line_seq_id,          ac.acct_num,      ac.mtn,      ac.acss_user_id,      ac.acss_call_dt,          ac.acss_call_tm,           (ac.call_disconnect_tm - ac.call_start_tm) HOUR TO SECOND (0) AS call_duration_tm,      COALESCE(sed.departmenttype,'Other') depttype,           COALESCE(sed.departmentgroup, 'Other') as dept_group,          CASE  WHEN acc.acss_call_ctr_time_zn LIKE 'C%' THEN                       ac.acss_call_tm + INTERVAL '1' HOUR                          WHEN acc.acss_call_ctr_time_zn LIKE 'M%' THEN               ac.acss_call_tm + INTERVAL '2' HOUR                          WHEN acc.acss_call_ctr_time_zn LIKE 'P%' THEN                 ac.acss_call_tm +INTERVAL '3' HOUR                            WHEN acc.acss_call_ctr_time_zn LIKE 'H%' THEN                ac.acss_call_tm + INTERVAL '5' HOUR                           ELSE ac.acss_call_tm         END acss_call_ad,      CAST(          ac.acss_call_dt ||          ' '             ||          CAST(acss_call_ad AS CHAR(8)) AS TIMESTAMP(0)      ) acss_dt_tm,      ad.acss_dept_desc,      ad.acss_dept_id,      ac.acss_call_id,          ac.ivr_call_id,      ac.area_cd,      RANK() OVER (PARTITION BY cust_id, cust_line_seq_id          ORDER BY ac.acss_call_dt, acss_call_ad, acss_call_id) rnk  FROM ntl_prd_allvm.acss_call_v AS ac  JOIN sys_calendar.calendar AS z        ON calendar_date= DATE   JOIN ntl_prd_allvm.acss_call_center_v AS acc      ON ac.acss_call_ctr_cd = acc.acss_call_ctr_cd  left JOIN ntl_prd_allvm.acss_user_v AS au      ON ac.acss_user_id = au.acss_user_id  JOIN ntl_prd_allvm.acss_dept_v AS ad      ON ac.acss_dept_id = ad.acss_dept_id  LEFT JOIN ntl_prd_qmtbls.emh_eccr_dep AS sed    ON ad.acss_dept_id = sed.acssdeptid  LEFT JOIN                  (SELECT a.acss_call_dt,a.acss_call_ctr_cd, a.acss_dept_id FROM                  ntl_prd_allvm.acss_call_v  as a                                  JOIN sys_calendar.calendar AS z                        ON calendar_date= DATE                                   WHERE                  a.acss_call_dt BETWEEN '2012-09-30' and '2012-10-06'                  AND a.acss_call_type_cd = '1'                  GROUP BY 1,2,3) r  ON          ac.acss_call_dt = r.acss_call_dt          AND ac.acss_call_ctr_cd = r.acss_call_ctr_cd          AND ac.acss_dept_id = r.acss_dept_id  WHERE ac.acss_call_dt BETWEEN '2012-09-30' and '2012-10-06'  AND COALESCE(sed.departmenttype,'Other') <> 'NA'  AND (      (ac.acss_call_type_cd IN ('1','7')) OR      (          ac.acss_call_type_cd = '3'          AND acc.acss_call_ctr_type = 'O'          AND ad.acss_dept_desc NOT LIKE '%offline%'          AND r.acss_dept_id IS NULL ))  ) WITH DATA PRIMARY INDEX (cust_id, cust_line_seq_id, acss_call_dt, acss_call_id, rnk) ON COMMIT PRESERVE ROWS;   CREATE TABLE NTL_PRD_QMTBLS.Repeat_Reporting_EMH21  AS  (  SELECT      a.sor_id,      a.acss_call_id,          a.ivr_call_id,      a.acss_call_type_cd,      a.ctr_area,      a.acss_call_ctr_type,      m.area_cd,      m.region_desc,      a.cust_id,      a.cust_line_seq_id,      a.mtn,      a.acss_call_dt,          a.acss_call_ad,          a.acss_call_tm,           a.call_duration_tm,      a.rnk,      a.acss_dept_desc as initial_dept_desc,      a.acss_dept_id,      a.acss_user_id,      a.acss_call_ctr_desc,      a.acss_call_ctr_cd,      a.depttype AS orgtype,          a.dept_group as org_dept_group,      b.acss_call_id AS repeat_call_id,      b.acss_dept_desc AS repeat_dept_desc,      b.acss_dept_id AS repeat_dept_id,          b.acss_user_id AS repeat_user_id,          b.acss_call_ctr_desc AS repeat_call_ctr_desc,      b.acss_call_ctr_cd AS repeat_ctr_cd,      b.acss_call_dt AS repeat_dt,          b.acss_call_ad AS repeat_call_ad,         b.acss_call_tm as repeat_call_tm,           b.call_duration_tm as repeat_call_duration_tm,      b.rnk AS repeat_rnk,      b.depttype AS reptype,          b.dept_group as rpt_dept_group,      CASE WHEN b.acss_dt_tm IS NOT NULL THEN        ((b.acss_dt_tm - a.acss_dt_tm) DAY(4) TO MINUTE ) END tsdiff,      CASE WHEN b.acss_dt_tm IS NOT NULL THEN        (EXTRACT(HOUR FROM tsdiff) * 60)        + EXTRACT(MINUTE FROM tsdiff)        + (CAST((CAST ((tsdiff) AS INTERVAL DAY)) AS INTEGER) * 1440) END min_diff  FROM Repeat_Reporting_EMH1 AS a  JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt                 JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)       INNER JOIN Repeat_Reporting_EMH1 AS b          ON  a.cust_id = b.cust_id          AND a.cust_line_seq_id = b.cust_line_seq_id                  AND a.acss_call_dt = b.acss_call_dt                       AND b.rnk = a.rnk + 1          AND b.acss_call_id <> a.acss_call_id                    LEFT JOIN ntl_prd_allvm.acss_call_center_v AS acc      ON b.acss_call_ctr_cd = acc.acss_call_ctr_cd  ) WITH DATA PRIMARY INDEX( sor_id, acss_call_id, ivr_call_id, acss_call_type_cd, ctr_area, acss_call_ctr_type, area_cd, region_desc, cust_id, cust_line_seq_id, mtn, acss_call_dt, acss_call_ad, acss_call_tm, call_duration_tm, rnk, initial_dept_desc, acss_dept_id, acss_user_id, acss_call_ctr_desc, acss_call_ctr_cd, orgtype, org_dept_group, repeat_call_id, repeat_dept_desc, repeat_dept_id, repeat_user_id, repeat_call_ctr_desc, repeat_ctr_cd, repeat_dt, repeat_call_ad, repeat_call_tm, repeat_call_duration_tm, repeat_rnk, reptype, rpt_dept_group, tsdiff, min_diff);  select a.acss_call_ctr_desc, hr1.nm_last || ', ' || hr1.nm_first AS  AD_Nm,  hr2.nm_last || ', ' || hr2.nm_first AS Supv_Nm,    u.nm_last||', '||u.nm_first AS First_Rep_nm,  a.initial_dept_desc,  a.acss_user_id, a.mtn, coalesce(ani.ani_num, '0000000000') as ani_num, sa.inum as initial_cll_inum, a.cust_id, a.area_cd, a.region_desc, coalesce(a.acss_call_dt - nc.activity_dt, 'n/a') as call_period_snc_trans, coalesce(nc.activity_type, 'n/a') as activity_type, coalesce(cast(cast(nc.activity_dt as format 'mm/dd/yyyy') as char(10)), 'n/a') as activity_dt, CASE WHEN cal.Device_type_cd LIKE '%4GS%'  THEN cal.device_prod_nm  ELSE cal.prod_nm END AS Device_Nm, dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, a.orgtype, a.acss_call_dt, a.acss_call_ad, a.acss_call_tm, a.call_duration_tm, a.repeat_call_ctr_desc, u1.nm_last||', '||u1.nm_first AS Repeat_Rep_nm,  a.repeat_dept_desc, a.reptype, a.repeat_dt, a.repeat_call_ad, a.repeat_call_tm, a.repeat_call_duration_tm, sa1.inum as rpt_cll_inum, a.tsdiff, a.min_diff, CASE WHEN (a.repeat_call_ad - a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00' THEN  'Y' ELSE 'N' END AS Rpts_2hrs_and_Under, sa.url_speech as intial_cll_url_speech, sa1.url_speech as rpt_call_url_speech   FROM NTL_PRD_QMTBLS.Repeat_Reporting_EMH21 AS a  JOIN sys_calendar.calendar AS z   ON calendar_date= DATE   JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt       Left join ndcir_clnr_v as nc   on a.cust_id = nc.cust_id   and a.cust_line_seq_id = nc.cust_line_seq_id   and a.acss_call_dt >= nc.activity_dt        LEFT JOIN ANI_NUM_V AS ani   on a.sor_id = ani.sor_id   and a.cust_id = ani.cust_id   and a.cust_line_seq_id = ani.cust_line_seq_id   and a.ivr_call_id = ani.ivr_call_id      LEFT JOIN SA_INUM_V AS sa   ON a.cust_id = sa.cust_id   and a.cust_line_seq_id = sa.cust_line_seq_id   and a.acss_call_dt = sa.call_start_dt   and a.acss_call_id = sa.acss_call_id      LEFT JOIN SA_INUM_V AS sa1   ON a.cust_id = sa1.cust_id   and a.cust_line_seq_id = sa1.cust_line_seq_id   and a.repeat_dt = sa1.call_start_dt   and a.repeat_call_id = sa1.acss_call_id      LEFT JOIN ntl_prd_allvm.device_dp_map_v AS dm                     ON (CASE WHEN cal.Device_type_cd LIKE '%4GS%' THEN cal.device_prod_nm ELSE cal.prod_nm END) = dm.prod_nm                JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)  LEFT JOIN ntl_prd_qmtbls.stm_eccr_area AS s    ON a.acss_call_ctr_cd = s.acsscallcentercd    AND a.acss_dept_id = s.acssdeptid      left Join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id = u.acss_user_id    left JOIN ntl_prd_allvm.hr_employee_v AS hr  ON u.hr_employee_id = hr.emp_id    LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr2              ON hr.SUPER_ID_LVL2_EMP_ID = hr2.emp_id                     LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr1           ON hr.SUPER_ID_LVL1_EMP_ID = hr1.emp_id   Left Join ntl_prd_allvm.acss_user_v AS u1  on a.repeat_user_id = u1.acss_user_id  WHERE acss_call_dt BETWEEN '2012-09-01' AND ADD_MONTHS('2012-10-01',1)-1 and a.orgtype IN ('CS','WDTS')  and a.reptype IN ('CS','WDTS')  and a.org_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.rpt_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.acss_call_ctr_desc IN('NE Columbia SC',  'NE Huntsville AL',  'NE Hanover MD',  'NE Rochester NY',  'NE Charleston SC',  'NE Charlotte NC',  'NE Wallingford CT',  'NE Wilmington NC',  'NE Bangor ME',  'NE Columbia SC 2')    GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37 ORDER BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37;  --Drop Table ANI_NUM_V; --Drop Table SA_INUM_V; --DROP TABLE Repeat_Reporting_EMH1; --DROP TABLE NTL_PRD_QMTBLS. Repeat_Reporting_EMH21; --DROP TABLE ndcir_clnr_v;	TERADATA	HABERER	01:56:26	00:22:11	17917
10/09/2012	11:48:59	NTL_PRD_ALLVM	00:00:09	14			select *  from ntl_prd_allvm.cust_acct_line_dly_hist_v  where mtn = '7185360697'	TERADATA	HABERER	00:00:09	00:00:00	17916
10/09/2012	11:48:13	NTL_PRD_ALLVM	00:00:02	1			select *  from cust_acct_line_v  where mtn = '7185360697'	TERADATA	HABERER	00:00:02	00:00:00	17915
10/09/2012	11:45:38	NTL_PRD_ALLVM	00:00:14	18			select *  from  ntl_prd_qmvm.ndcir_detail_v  where cust_id = '587151861'	TERADATA	HABERER	00:00:14	00:00:00	17914
10/09/2012	11:42:48	NTL_PRD_ALLVM	00:00:00	0	5628		select *  from  ntl_prd_qmvm.ndcir_detail_v  where mtn = '7185360697'	TERADATA	HABERER	00:00:00	00:00:00	17913
10/09/2012	09:54:15	NTL_PRD_ALLVM	00:00:29	1			select max(activity_dt)  from  ntl_prd_qmvm.ndcir_detail_v	TERADATA	HABERER	00:00:29	00:00:00	17912
10/09/2012	09:50:06	NTL_PRD_ALLVM	00:00:32	0			CREATE VOLATILE TABLE SA_INUM_V AS ( select  a.rpt_mnth ,a.acss_mtn ,a.sa_mtn ,a.cust_id ,a.cust_line_seq_id ,a.call_start_dt   ,a.sa_start_tm ,a.acss_start_tm ,a.acss_user_id ,a.acss_call_id ,a.url_speech ,a.inum ,a.acss_call_type_cd ,a.start_diff ,a.row_num  from (SELECT  (acs.acss_call_dt - (EXTRACT(DAY FROM acs.acss_call_dt) - 1)) rpt_mnth ,acs.mtn as acss_mtn ,sa.mtn as sa_mtn ,acs.cust_id ,acs.cust_line_seq_id ,acs.call_start_dt   ,sa.call_start_tm as sa_start_tm ,acs.call_start_tm as acss_start_tm ,acss_user_id ,acs.acss_call_id ,sa.url_speech ,sa.inum ,acs.acss_call_type_cd ,ABS((sa_start_tm - acss_start_tm) MINUTE(4) TO SECOND) AS start_diff, ROW_NUMBER() OVER (PARTITION BY acs.cust_id, acs.cust_line_seq_id ORDER BY acs.call_start_dt, acs.call_start_tm, acss_call_id ) as row_num  from ntl_prd_allvm.tp_speech_analytics_call_v as sa          join  ntl_prd_allvm.acss_call_v as acs ON acs.call_start_dt=sa.call_start_dt AND acss_user_id=sa.nt_user_id                       left join  ntl_prd_allvm.acss_call_center_v AS  cc                   ON acs.acss_call_ctr_cd = cc.acss_call_ctr_cd                   where rpt_mnth >= '2012-09-01' and start_diff<'2:00.000000'  qualify ROW_NUMBER() OVER (PARTITION BY sa.call_start_dt,sa_start_tm, acss_user_id ORDER BY sa.inum, start_diff) = 1) as a  where row_num = '1' and a.acss_call_type_cd in ('1','7')  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15  ) WITH DATA PRIMARY INDEX (cust_id, cust_line_seq_id, inum, call_start_dt, acss_call_id) ON COMMIT PRESERVE ROWS;   CREATE VOLATILE TABLE ANI_NUM_V AS ( select (ivr.ivr_call_dt - (EXTRACT(DAY FROM ivr.ivr_call_dt) - 1)) rpt_mnth, cal.sor_id, cal.mtn as cal_mtn, ivr.mtn as ivr_mtn, cal.cust_id, cal.cust_line_seq_id, ivr.ivr_call_id, ivr.ani_num   from ntl_prd_allvm.cust_acct_line_dly_hist_v as cal  inner join ntl_prd_allvm.ivr_call_v as ivr        on cal.cust_id = ivr.cust_id      and cal.cust_line_seq_id = ivr.cust_line_seq_id      and ivr.ivr_call_dt BETWEEN cal.eff_dt AND cal.exp_dt       where  rpt_mnth >= '2012-09-01' and cal.sor_id = 'v' and cal.rev_gen_ind = 'Y' and cal.prepaid_ind <> 'Y' and cal.mtn_status_ind in ('a','s')  group by 1,2,3,4,5,6,7,8  ) WITH DATA PRIMARY INDEX (cust_id, cust_line_seq_id, ani_num, sor_id ) ON COMMIT PRESERVE ROWS;   CREATE VOLATILE TABLE ndcir_clnr_v                                         AS(select a.activity_mnth, a.activity_type, a.cust_id,                              a.cust_line_seq_id,                                a.activity_dt   from (SELECT                                                 (p.pymnt_dt - (EXTRACT(DAY FROM p.pymnt_dt) - 1)) activity_mnth, case when  b.item_cd LIKE ANY ('FRU%','CLNR%') then 'clnr' else null end as activity_type, p.cust_id,                              p.cust_line_seq_id,                                min(p.pymnt_dt) as activity_dt                                                                                                                                                                                                                                                                                                                    FROM ntl_prd_allvm.pos_trans_v as p  JOIN ntl_prd_allvm.cust_acct_dly_hist_v AS ca         ON p.cust_id = ca.cust_id       AND p.acct_num = ca.acct_num AND p.pymnt_dt BETWEEN ca.eff_dt AND ca.exp_dt                                        JOIN ntl_prd_allvm.item_v as b                              ON p.item_cd = b.item_cd       AND p.sor_id = b.sor_id           AND p.region_cd = b.region_cd                                   AND b.item_cd LIKE ANY ('FRU%','CLNR%')                                                                         WHERE    activity_mnth >= '2012-09-01'                                              AND p.sold_qty > 0      and (b.IA_ITEM_GROUP_CD like '%DATA%' OR b.IA_ITEM_GROUP_CD like '%PHONE%' OR b.IA_ITEM_GROUP_CD like '%VCP%' )        AND p.cust_id IS NOT NULL AND COALESCE (p.refund_applied_ind, 'E') <> 'R'     --and p.cust_id = '100008270' --and p.cust_line_seq_id = '2'  group by 1,2,3,4) as a   qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id, a.activity_dt order by a.cust_id, a.cust_line_seq_id, a.activity_dt) = 1  group by 1,2,3,4,5  union all  select activity_mth, activity_type, cust_id, cust_line_seq_id, activity_dt  from ntl_prd_qmvm.ndcir_detail_v  where activity_mth >= '2012-09-01' --and cust_id = '100000050' --and cust_line_seq_id = '1'  qualify row_number() over (partition by cust_id, cust_line_seq_id, activity_dt order by cust_id, cust_line_seq_id, activity_dt) = 1  group by 1,2,3,4,5 )                                                                 WITH DATA                                          PRIMARY INDEX (cust_id, cust_line_seq_id, activity_dt)                                              ON COMMIT PRESERVE ROWS;      CREATE VOLATILE TABLE Repeat_Reporting_EMH1 AS (SELECT      acc.acss_call_ctr_desc,      acc.acss_call_ctr_cd,      ac.sor_id,      ac.acss_call_type_cd,     acc.acss_area_cd AS ctr_area,      acc.acss_call_ctr_type,      ac.cust_id,      ac.cust_line_seq_id,          ac.acct_num,      ac.mtn,      ac.acss_user_id,      ac.acss_call_dt,          ac.acss_call_tm,           (ac.call_disconnect_tm - ac.call_start_tm) HOUR TO SECOND (0) AS call_duration_tm,      COALESCE(sed.departmenttype,'Other') depttype,           COALESCE(sed.departmentgroup, 'Other') as dept_group,          CASE  WHEN acc.acss_call_ctr_time_zn LIKE 'C%' THEN                       ac.acss_call_tm + INTERVAL '1' HOUR                          WHEN acc.acss_call_ctr_time_zn LIKE 'M%' THEN               ac.acss_call_tm + INTERVAL '2' HOUR                          WHEN acc.acss_call_ctr_time_zn LIKE 'P%' THEN                 ac.acss_call_tm +INTERVAL '3' HOUR                            WHEN acc.acss_call_ctr_time_zn LIKE 'H%' THEN                ac.acss_call_tm + INTERVAL '5' HOUR                           ELSE ac.acss_call_tm         END acss_call_ad,      CAST(          ac.acss_call_dt ||          ' '             ||          CAST(acss_call_ad AS CHAR(8)) AS TIMESTAMP(0)      ) acss_dt_tm,      ad.acss_dept_desc,      ad.acss_dept_id,      ac.acss_call_id,          ac.ivr_call_id,      ac.area_cd,      RANK() OVER (PARTITION BY cust_id, cust_line_seq_id          ORDER BY ac.acss_call_dt, acss_call_ad, acss_call_id) rnk  FROM ntl_prd_allvm.acss_call_v AS ac  JOIN sys_calendar.calendar AS z        ON calendar_date= DATE   JOIN ntl_prd_allvm.acss_call_center_v AS acc      ON ac.acss_call_ctr_cd = acc.acss_call_ctr_cd  left JOIN ntl_prd_allvm.acss_user_v AS au      ON ac.acss_user_id = au.acss_user_id  JOIN ntl_prd_allvm.acss_dept_v AS ad      ON ac.acss_dept_id = ad.acss_dept_id  LEFT JOIN ntl_prd_qmtbls.emh_eccr_dep AS sed    ON ad.acss_dept_id = sed.acssdeptid  LEFT JOIN                  (SELECT a.acss_call_dt,a.acss_call_ctr_cd, a.acss_dept_id FROM                  ntl_prd_allvm.acss_call_v  as a                                  JOIN sys_calendar.calendar AS z                        ON calendar_date= DATE                                   WHERE                  a.acss_call_dt BETWEEN '2012-09-30' and '2012-10-06'                  AND a.acss_call_type_cd = '1'                  GROUP BY 1,2,3) r  ON          ac.acss_call_dt = r.acss_call_dt          AND ac.acss_call_ctr_cd = r.acss_call_ctr_cd          AND ac.acss_dept_id = r.acss_dept_id  WHERE ac.acss_call_dt BETWEEN '2012-09-30' and '2012-10-06'  AND COALESCE(sed.departmenttype,'Other') <> 'NA'  AND (      (ac.acss_call_type_cd IN ('1','7')) OR      (          ac.acss_call_type_cd = '3'          AND acc.acss_call_ctr_type = 'O'          AND ad.acss_dept_desc NOT LIKE '%offline%'          AND r.acss_dept_id IS NULL ))  ) WITH DATA PRIMARY INDEX (cust_id, cust_line_seq_id, acss_call_dt, acss_call_id, rnk) ON COMMIT PRESERVE ROWS;   CREATE TABLE NTL_PRD_QMTBLS.Repeat_Reporting_EMH21  AS  (  SELECT      a.sor_id,      a.acss_call_id,          a.ivr_call_id,      a.acss_call_type_cd,      a.ctr_area,      a.acss_call_ctr_type,      m.area_cd,      m.region_desc,      a.cust_id,      a.cust_line_seq_id,      a.mtn,      a.acss_call_dt,          a.acss_call_ad,          a.acss_call_tm,           a.call_duration_tm,      a.rnk,      a.acss_dept_desc as initial_dept_desc,      a.acss_dept_id,      a.acss_user_id,      a.acss_call_ctr_desc,      a.acss_call_ctr_cd,      a.depttype AS orgtype,          a.dept_group as org_dept_group,      b.acss_call_id AS repeat_call_id,      b.acss_dept_desc AS repeat_dept_desc,      b.acss_dept_id AS repeat_dept_id,          b.acss_user_id AS repeat_user_id,          b.acss_call_ctr_desc AS repeat_call_ctr_desc,      b.acss_call_ctr_cd AS repeat_ctr_cd,      b.acss_call_dt AS repeat_dt,          b.acss_call_ad AS repeat_call_ad,         b.acss_call_tm as repeat_call_tm,           b.call_duration_tm as repeat_call_duration_tm,      b.rnk AS repeat_rnk,      b.depttype AS reptype,          b.dept_group as rpt_dept_group,      CASE WHEN b.acss_dt_tm IS NOT NULL THEN        ((b.acss_dt_tm - a.acss_dt_tm) DAY(4) TO MINUTE ) END tsdiff,      CASE WHEN b.acss_dt_tm IS NOT NULL THEN        (EXTRACT(HOUR FROM tsdiff) * 60)        + EXTRACT(MINUTE FROM tsdiff)        + (CAST((CAST ((tsdiff) AS INTERVAL DAY)) AS INTEGER) * 1440) END min_diff  FROM Repeat_Reporting_EMH1 AS a  JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt                 JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)       INNER JOIN Repeat_Reporting_EMH1 AS b          ON  a.cust_id = b.cust_id          AND a.cust_line_seq_id = b.cust_line_seq_id                  AND a.acss_call_dt = b.acss_call_dt                       AND b.rnk = a.rnk + 1          AND b.acss_call_id <> a.acss_call_id                    LEFT JOIN ntl_prd_allvm.acss_call_center_v AS acc      ON b.acss_call_ctr_cd = acc.acss_call_ctr_cd  ) WITH DATA PRIMARY INDEX( sor_id, acss_call_id, ivr_call_id, acss_call_type_cd, ctr_area, acss_call_ctr_type, area_cd, region_desc, cust_id, cust_line_seq_id, mtn, acss_call_dt, acss_call_ad, acss_call_tm, call_duration_tm, rnk, initial_dept_desc, acss_dept_id, acss_user_id, acss_call_ctr_desc, acss_call_ctr_cd, orgtype, org_dept_group, repeat_call_id, repeat_dept_desc, repeat_dept_id, repeat_user_id, repeat_call_ctr_desc, repeat_ctr_cd, repeat_dt, repeat_call_ad, repeat_call_tm, repeat_call_duration_tm, repeat_rnk, reptype, rpt_dept_group, tsdiff, min_diff);  select a.acss_call_ctr_desc, hr1.nm_last || ', ' || hr1.nm_first AS  AD_Nm,  hr2.nm_last || ', ' || hr2.nm_first AS Supv_Nm,    u.nm_last||', '||u.nm_first AS First_Rep_nm,  a.initial_dept_desc,  a.acss_user_id, a.mtn, coalesce(ani.ani_num, '0000000000') as ani_num, sa.inum as initial_cll_inum, a.cust_id, a.area_cd, a.region_desc, coalesce(a.acss_call_dt - nc.activity_dt, 'n/a') as call_period_snc_trans, coalesce(nc.activity_type, 'n/a') as activity_type, coalesce(cast(cast(nc.activity_dt as format 'mm/dd/yyyy') as char(10)), 'n/a') as activity_dt, CASE WHEN cal.Device_type_cd LIKE '%4GS%'  THEN cal.device_prod_nm  ELSE cal.prod_nm END AS Device_Nm, dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, a.orgtype, a.acss_call_dt, a.acss_call_ad, a.acss_call_tm, a.call_duration_tm, a.repeat_call_ctr_desc, u1.nm_last||', '||u1.nm_first AS Repeat_Rep_nm,  a.repeat_dept_desc, a.reptype, a.repeat_dt, a.repeat_call_ad, a.repeat_call_tm, a.repeat_call_duration_tm, sa1.inum as rpt_cll_inum, a.tsdiff, a.min_diff, CASE WHEN (a.repeat_call_ad - a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00' THEN  'Y' ELSE 'N' END AS Rpts_2hrs_and_Under, sa.url_speech as intial_cll_url_speech, sa1.url_speech as rpt_call_url_speech   FROM NTL_PRD_QMTBLS.Repeat_Reporting_EMH21 AS a  JOIN sys_calendar.calendar AS z   ON calendar_date= DATE   JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt       Left join ndcir_clnr_v as nc   on a.cust_id = nc.cust_id   and a.cust_line_seq_id = nc.cust_line_seq_id   and a.acss_call_dt >= nc.activity_dt        LEFT JOIN ANI_NUM_V AS ani   on a.sor_id = ani.sor_id   and a.cust_id = ani.cust_id   and a.cust_line_seq_id = ani.cust_line_seq_id   and a.ivr_call_id = ani.ivr_call_id      LEFT JOIN SA_INUM_V AS sa   ON a.cust_id = sa.cust_id   and a.cust_line_seq_id = sa.cust_line_seq_id   and a.acss_call_dt = sa.call_start_dt   and a.acss_call_id = sa.acss_call_id      LEFT JOIN SA_INUM_V AS sa1   ON a.cust_id = sa1.cust_id   and a.cust_line_seq_id = sa1.cust_line_seq_id   and a.repeat_dt = sa1.call_start_dt   and a.repeat_call_id = sa1.acss_call_id      LEFT JOIN ntl_prd_allvm.device_dp_map_v AS dm                     ON (CASE WHEN cal.Device_type_cd LIKE '%4GS%' THEN cal.device_prod_nm ELSE cal.prod_nm END) = dm.prod_nm                JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)  LEFT JOIN ntl_prd_qmtbls.stm_eccr_area AS s    ON a.acss_call_ctr_cd = s.acsscallcentercd    AND a.acss_dept_id = s.acssdeptid      left Join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id = u.acss_user_id    left JOIN ntl_prd_allvm.hr_employee_v AS hr  ON u.hr_employee_id = hr.emp_id    LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr2              ON hr.SUPER_ID_LVL2_EMP_ID = hr2.emp_id                     LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr1           ON hr.SUPER_ID_LVL1_EMP_ID = hr1.emp_id   Left Join ntl_prd_allvm.acss_user_v AS u1  on a.repeat_user_id = u1.acss_user_id  WHERE acss_call_dt BETWEEN '2012-09-01' AND ADD_MONTHS('2012-10-01',1)-1 and a.orgtype IN ('CS','WDTS')  and a.reptype IN ('CS','WDTS')  and a.org_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.rpt_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.acss_call_ctr_desc IN('NE Columbia SC',  'NE Huntsville AL',  'NE Hanover MD',  'NE Rochester NY',  'NE Charleston SC',  'NE Charlotte NC',  'NE Wallingford CT',  'NE Wilmington NC',  'NE Bangor ME',  'NE Columbia SC 2')    GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37 ORDER BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37;  --Drop Table ANI_NUM_V; --Drop Table SA_INUM_V; --DROP TABLE Repeat_Reporting_EMH1; --DROP TABLE NTL_PRD_QMTBLS. Repeat_Reporting_EMH21; --DROP TABLE ndcir_clnr_v;	TERADATA	HABERER	00:00:32	00:00:00	17911
10/09/2012	08:42:30	NTL_PRD_ALLVM	00:00:09	133439	3523		select                      rpt_mth,           area_desc,           region_Desc,           rev_gen_ind,            PREPAID_IND,            telemetry,            coalesce (market, 'NA') market,           coalesce (line_type, 'NA') line_type,           coalesce (profile_type, 'NA') profile_type,          coalesce (d.data_tier, 'Feature') data_tier,           coalesce (d.os, 'NA') OS,           coalesce (d.mfg_nm, 'NA') MFG_NM,           coalesce (c.prod_nm, 'NA') prod_nm,           coalesce (d.device_generation, 'NA') dev_gen,           sum(custs) custs,           sum(calls) calls                      from cir c                      left join device_dp_map_v d           on c.prod_nm = d.prod_nm                      group by 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14;           --)with data primary index (rpt_mth, prod_nm, area_desc);           collect stats on ntl_prd_qmtbls.kam_cir_current index (region_desc, prod_nm, area_desc);	TERADATA	HABERER	00:00:08	00:00:01	17910
10/09/2012	08:42:01	NTL_PRD_ALLVM	00:00:00	0	3807		insert into ntl_prd_qmtbls.emh_cir_current           --delete from ntl_prd_qmtbls.kam_cir_current where rpt_mth ='2012-06-01'           --drop table ntl_prd_qmtbls.kam_cir_current;           --create table ntl_prd_qmtbls.kam_cir_current as(           select                      rpt_mth,           area_desc,           region_Desc,           rev_gen_ind,            PREPAID_IND,            telemetry,            coalesce (market, 'NA') market,           coalesce (line_type, 'NA') line_type,           coalesce (profile_type, 'NA') profile_type,          coalesce (d.data_tier, 'Feature') data_tier,           coalesce (d.os, 'NA') OS,           coalesce (d.mfg_nm, 'NA') MFG_NM,           coalesce (c.prod_nm, 'NA') prod_nm,           coalesce (d.device_generation, 'NA') dev_gen,           sum(custs) custs,           sum(calls) calls                      from cir c                      left join device_dp_map_v d           on c.prod_nm = d.prod_nm                      group by 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14;           --)with data primary index (rpt_mth, prod_nm, area_desc);           collect stats on ntl_prd_qmtbls.kam_cir_current index (region_desc, prod_nm, area_desc);	TERADATA	HABERER	00:00:00	00:00:00	17909
10/09/2012	08:29:41	NTL_PRD_ALLVM	00:02:45	0	3523		--drop table cir;           create volatile table cir as(                      select            '2012-06-01' rpt_mth,           m.area_desc,           m.region_desc,           cal.rev_gen_ind,           cal.PREPAID_IND,                      case when cal.LINE_TYPE_CD = 'T' then 'TELEM' else 'NONTELEM' end Telemetry,           case when m.MANAGED_IND ='C' then 'CONSOLIDATED' when m.managed_ind ='D' then 'DIVESTED' else 'OTHER' end MARKET,           case when ecpd.ecpd_liability_type_cd = 'C' then 'CORP' when ecpd.ecpd_liability_type_cd = 'E' then 'EMPL'else 'CONS'end line_type,          case when (ep.ecpd_profile_id is not null and ep.ecpd_profile_type_cd is not null) then ep.ecpd_profile_type_cd           when (ep.ecpd_profile_id is not null and ep.ecpd_profile_type_cd is null) then 'CLEU_OTHER'else 'CONS' end profile_type,                      coalesce(sdt.eqp_prod_nm, cal.prod_nm) prod_nm,                      count(distinct cal.cust_id || cal.cust_line_seq_id) custs,                      count(distinct case when               ((acall.acss_call_type_cd IN ('1','7')) OR                   (                       acall.acss_call_type_cd = '3'                       AND cc.acss_call_ctr_type = 'O'                       AND ad.acss_dept_desc NOT LIKE '%offline%'                       AND r.acss_dept_id is null                   )               ) then acall.acss_call_id else null end) calls                      from ntl_prd_allvm.cust_acct_line_dly_hist_v cal                      join ntl_prd_allvm.cust_acct_dly_hist_v ca            on cal.cust_id = ca.cust_id            and cal.acct_num = ca.acct_num            and cal.sor_id = ca.sor_id                        left join ntl_prd_allvm.cust_ecpd_v ecpd            on ca.sor_id = ecpd.sor_id            and ca.cust_id = ecpd.cust_id            and add_months('2012-06-01',1)-1 between ecpd.ecpd_eff_dt and coalesce(ecpd.ecpd_term_dt,date)                       left join ntl_prd_allvm.ecpd_profile_v ep            on ecpd.ecpd_profile_id = ep.ecpd_profile_id            and ecpd.ecpd_liability_type_cd = ep.ecpd_liability_type_cd            and add_months ('2012-06-01', 1)-1 between ep.act_dt and coalesce(ep.inact_dt, date)                         left join ntl_prd_allvm.SIM_DEVICE_TRANS_V sdt            on cal.esn_num = sdt.sim_device_id            and cast(cast(add_months('2012-06-01',1)-1 as date format 'yyyy-mm-dd') || ' 23:59:59.999999' as timestamp)            between sdt.device_start_ts and sdt.device_stop_ts            and cal.device_type_cd = '4GS'                      join ntl_prd_allvm.market_v m            on cal.sor_id = m.sor_id            and cal.mkt_cd = m.mkt_cd                                    left join ntl_prd_allvm.acss_call_v acall            on cal.cust_id = acall.cust_id            and cal.cust_line_seq_id = acall.cust_line_seq_id            and acall.acss_call_dt between '2012-06-01' and add_months('2012-06-01',1)-1            and acall.acss_call_type_cd in ('1','7','3')                      left join ntl_prd_allvm.acss_call_center_v cc            on acall.acss_call_ctr_cd = cc.acss_call_ctr_cd                      left join ntl_prd_allvm.acss_dept_v ad            on acall.acss_dept_id = ad.acss_dept_id                      left join              (               select acss_call_dt,acss_call_ctr_cd, acss_dept_id from                           ntl_prd_allvm.acss_call_v where                           acss_call_dt between '2012-06-01' and add_months('2012-06-01',1)-1                           and acss_call_type_cd = '1'                           group by 1,2,3) r           on             acall.acss_call_dt = r.acss_call_dt           and acall.acss_call_ctr_cd = r.acss_call_ctr_cd           and acall.acss_dept_id = r.acss_dept_id                     where               add_months('2012-06-01',1)-1 between cal.eff_dt and cal.exp_dt             and add_months('2012-06-01',1)-1 between ca.eff_dt and ca.exp_dt             AND CAL.MTN_STATUS_IND in ('A','S')             and cal.sor_id = 'V'             and m.sub_region_cd not in ('ui','ug')                      group by 1,2,3,4, 5, 6, 7, 8, 9, 10                      )with data primary index (rpt_mth, prod_nm, area_desc) on commit preserve rows;                      insert into ntl_prd_qmtbls.kam_cir_current           --delete from ntl_prd_qmtbls.kam_cir_current where rpt_mth ='2012-06-01'           --drop table ntl_prd_qmtbls.kam_cir_current;           --create table ntl_prd_qmtbls.kam_cir_current as(           select                      rpt_mth,           area_desc,           region_Desc,           rev_gen_ind,            PREPAID_IND,            telemetry,            coalesce (market, 'NA') market,           coalesce (line_type, 'NA') line_type,           coalesce (profile_type, 'NA') profile_type,          coalesce (d.data_tier, 'Feature') data_tier,           coalesce (d.os, 'NA') OS,           coalesce (d.mfg_nm, 'NA') MFG_NM,           coalesce (c.prod_nm, 'NA') prod_nm,           coalesce (d.device_generation, 'NA') dev_gen,           sum(custs) custs,           sum(calls) calls                      from cir c                      left join device_dp_map_v d           on c.prod_nm = d.prod_nm                      group by 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14;           --)with data primary index (rpt_mth, prod_nm, area_desc);           collect stats on ntl_prd_qmtbls.kam_cir_current index (region_desc, prod_nm, area_desc);	TERADATA	HABERER	00:02:45	00:00:00	17908
10/08/2012	09:11:05	NTL_PRD_ALLVM	00:06:42	9974			CREATE VOLATILE TABLE SA_INUM_V AS (  select  a.INUM_Week  ,a.rpt_mnth  ,a.acss_mtn  ,a.sa_mtn  ,a.cust_id  ,a.cust_line_seq_id  ,a.call_start_dt    ,a.sa_start_tm  ,a.acss_start_tm  ,a.acss_user_id  ,a.acss_call_id  ,a.url_speech  ,a.inum  ,a.acss_call_type_cd  ,a.start_diff  ,a.row_num    from (SELECT   ((DATE-(day_of_week+6))(FORMAT 'MM-DD'))||' to '||((DATE-(day_of_week))(FORMAT 'MM-DD')) INUM_Week,  (acs.acss_call_dt - (EXTRACT(DAY FROM acs.acss_call_dt) - 1)) rpt_mnth  ,acs.mtn as acss_mtn  ,sa.mtn as sa_mtn  ,acs.cust_id  ,acs.cust_line_seq_id  ,acs.call_start_dt    ,sa.call_start_tm as sa_start_tm  ,acs.call_start_tm as acss_start_tm  ,acss_user_id  ,acs.acss_call_id  ,sa.url_speech  ,sa.inum  ,acs.acss_call_type_cd  ,ABS((sa_start_tm - acss_start_tm) MINUTE(4) TO SECOND) AS start_diff,  ROW_NUMBER() OVER (PARTITION BY acs.cust_id, acs.cust_line_seq_id ORDER BY acs.call_start_dt, acs.call_start_tm, acss_call_id ) as row_num    from ntl_prd_allvm.tp_speech_analytics_call_v as sa            join  ntl_prd_allvm.acss_call_v as acs  ON acs.call_start_dt=sa.call_start_dt  AND acss_user_id=sa.nt_user_id                         left join  ntl_prd_allvm.acss_call_center_v AS  cc                    ON acs.acss_call_ctr_cd = cc.acss_call_ctr_cd      JOIN sys_calendar.calendar AS z        ON calendar_date= DATE                      where  --rpt_mnth = '2012-07-01'  acs.acss_call_dt  BETWEEN (DATE-(day_of_week+6)) AND (DATE-(day_of_week)) and start_diff<'2:00.000000'    qualify ROW_NUMBER() OVER (PARTITION BY sa.call_start_dt,sa_start_tm, acss_user_id ORDER BY sa.inum, start_diff) = 1) as a    where row_num = '1'  and a.acss_call_type_cd in ('1','7')    group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16   )  WITH DATA PRIMARY INDEX (cust_id, cust_line_seq_id, inum, call_start_dt, acss_call_id) ON COMMIT PRESERVE ROWS;      CREATE VOLATILE TABLE ANI_NUM_V AS (  select   ((DATE-(day_of_week+6))(FORMAT 'MM-DD'))||' to '||((DATE-(day_of_week))(FORMAT 'MM-DD')) ANI_Week, (ivr.ivr_call_dt - (EXTRACT(DAY FROM ivr.ivr_call_dt) - 1)) rpt_mnth,  cal.sor_id,  cal.mtn as cal_mtn,  ivr.mtn as ivr_mtn,  cal.cust_id,  cal.cust_line_seq_id,  ivr.ivr_call_id,  ivr.ani_num      from ntl_prd_allvm.cust_acct_line_dly_hist_v as cal    inner join ntl_prd_allvm.ivr_call_v as ivr         on cal.cust_id = ivr.cust_id       and cal.cust_line_seq_id = ivr.cust_line_seq_id       and ivr.ivr_call_dt BETWEEN cal.eff_dt AND cal.exp_dt     JOIN sys_calendar.calendar AS z        ON calendar_date= DATE        where   --rpt_mnth = '2012-07-01'  ivr.ivr_call_dt BETWEEN (DATE-(day_of_week+6)) AND (DATE-(day_of_week)) and cal.sor_id = 'v'  and cal.rev_gen_ind = 'Y'  and cal.prepaid_ind <> 'Y'  and cal.mtn_status_ind in ('a','s')    group by 1,2,3,4,5,6,7,8,9   )  WITH DATA PRIMARY INDEX (cust_id, cust_line_seq_id, ani_num, sor_id ) ON COMMIT PRESERVE ROWS;      select  ((DATE-(day_of_week+6))(FORMAT 'MM-DD'))||' to '||((DATE-(day_of_week))(FORMAT 'MM-DD')) NDCIR_Week,   a.activity_mth,   a.activity_type,   a.area_desc as cust_area_desc,   a.region_desc as cust_region_desc,   a.sls_dist_chnl_churn_ctgry,  a.sls_outlet_id,   o.sls_outlet_nm as outlet,    a.sls_area_desc as sales_area,   a.sls_region_desc as sales_region,  case when a.fulfillment_ind='F' then 'direct'  when a.fulfillment_ind='L' then 'local'  else 'unknown' end as dfill,  cal.mtn,  coalesce(ani.ani_num, '0000000000') as ani_num,  sa.inum,  a.cust_id,  a.cust_line_seq_id,  a.prod_nm_prev,  a.prod_nm,  dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier,  a.activity_dt,  cal.mtn,  CASE WHEN cc.acss_call_ctr_desc IN ('NE Columbia SC 2', 'NE Columbia SC') THEN 'NE Columbia'              ELSE cc.acss_call_ctr_desc END AS Center,       u.nm_last||', '||u.nm_first AS rep_nm,          u.acss_user_id,         ad.acss_dept_desc,                  a.acss_call_dt,     a.acss_call_id,     a.acss_call_tm,         CASE     WHEN cc.acss_call_ctr_time_zn LIKE 'C%' THEN                          a.acss_call_tm + INTERVAL '1' HOUR            WHEN cc.acss_call_ctr_time_zn LIKE 'M%' THEN                  a.acss_call_tm + INTERVAL '2' HOUR           WHEN cc.acss_call_ctr_time_zn LIKE 'P%' THEN                    a.acss_call_tm +INTERVAL '3' HOUR             WHEN cc.acss_call_ctr_time_zn LIKE 'H%' THEN                   a.acss_call_tm + INTERVAL '6' HOUR            ELSE a.acss_call_tm                       END acss_call_EST_tm,          a.call_duration,       sa.url_speech           from ntl_prd_qmtbls.mrs_ndcir_detail as a    JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal  ON a.cust_id = cal.cust_id  AND a.cust_line_seq_id = cal.cust_line_seq_id  AND a.activity_dt BETWEEN cal.eff_dt AND cal.exp_dt      LEFT JOIN ANI_NUM_V AS ani    on a.sor_id = ani.sor_id    and a.cust_id = ani.cust_id    and a.cust_line_seq_id = ani.cust_line_seq_id    and a.ivr_call_id = ani.ivr_call_id      LEFT JOIN SA_INUM_V AS sa    ON a.cust_id = sa.cust_id    and a.cust_line_seq_id = sa.cust_line_seq_id    and a.acss_call_dt = sa.call_start_dt    and a.acss_call_id = sa.acss_call_id     left join ntl_prd_allvm.outlet_v as o   on a.sls_outlet_id = o.sls_outlet_id    INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc           ON a.acss_call_ctr_cd = cc.acss_call_ctr_cd                                    INNER JOIN ntl_prd_allvm.acss_dept_v AS ad      ON a.acss_dept_id = ad.acss_dept_id        Left JOIN ntl_prd_allvm.acss_user_v AS u     ON a.acss_user_id =  u.acss_user_id        LEFT JOIN ntl_prd_allvm.device_dp_map_v AS dm                     ON a.prod_nm = dm.prod_nm   JOIN sys_calendar.calendar AS z        ON calendar_date= DATE         WHERE  a.activity_dt BETWEEN (DATE-(day_of_week+6)) AND (DATE-(day_of_week))  and a.sls_area_desc = 'Northeast' and a.sls_region_desc = 'New York Metro' AND a.sls_dist_chnl_churn_ctgry <> 'NonComm' AND a.acss_call_ctr_type||a.acss_call_type_cd IN ('v1', 'v7', 'o1', 'o3', 'o7')  AND a.acss_call_dt BETWEEN a.activity_dt AND  ADD_MONTHS(a.activity_dt,0)+ 2        GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32;    --drop table SA_INUM_V;  --drop table ANI_NUM_V;	TERADATA	HABERER	00:06:16	00:00:26	17907
10/08/2012	07:27:23	NTL_PRD_ALLVM	00:01:49	12836			CREATE VOLATILE TABLE Repeat_Reporting_EMH1 AS (SELECT      acc.acss_call_ctr_desc,      acc.acss_call_ctr_cd,      ac.sor_id,      ac.acss_call_type_cd,     acc.acss_area_cd AS ctr_area,      acc.acss_call_ctr_type,      ac.cust_id,      ac.cust_line_seq_id,          ac.acct_num,      ac.mtn,      ac.acss_user_id,      ac.acss_call_dt,          ac.acss_call_tm,           (ac.call_disconnect_tm - ac.call_start_tm) HOUR TO SECOND (0) AS call_duration_tm,      COALESCE(sed.departmenttype,'Other') depttype,           COALESCE(sed.departmentgroup, 'Other') as dept_group,          CASE  WHEN acc.acss_call_ctr_time_zn LIKE 'C%' THEN                       ac.acss_call_tm + INTERVAL '1' HOUR                          WHEN acc.acss_call_ctr_time_zn LIKE 'M%' THEN               ac.acss_call_tm + INTERVAL '2' HOUR                          WHEN acc.acss_call_ctr_time_zn LIKE 'P%' THEN                 ac.acss_call_tm +INTERVAL '3' HOUR                            WHEN acc.acss_call_ctr_time_zn LIKE 'H%' THEN                ac.acss_call_tm + INTERVAL '5' HOUR                           ELSE ac.acss_call_tm         END acss_call_ad,      CAST(          ac.acss_call_dt ||          ' '             ||          CAST(acss_call_ad AS CHAR(8)) AS TIMESTAMP(0)      ) acss_dt_tm,      ad.acss_dept_desc,      ad.acss_dept_id,      ac.acss_call_id,      ac.area_cd,      RANK() OVER (PARTITION BY cust_id, cust_line_seq_id          ORDER BY ac.acss_call_dt, acss_call_ad, acss_call_id) rnk  FROM ntl_prd_allvm.acss_call_v AS ac  JOIN sys_calendar.calendar AS z        ON calendar_date= DATE   JOIN ntl_prd_allvm.acss_call_center_v AS acc      ON ac.acss_call_ctr_cd = acc.acss_call_ctr_cd  JOIN ntl_prd_allvm.acss_user_v AS au      ON ac.acss_user_id = au.acss_user_id  JOIN ntl_prd_allvm.acss_dept_v AS ad      ON ac.acss_dept_id = ad.acss_dept_id  LEFT JOIN ntl_prd_qmtbls.emh_eccr_dep AS sed    ON ad.acss_dept_id = sed.acssdeptid  LEFT JOIN                  (SELECT a.acss_call_dt,a.acss_call_ctr_cd, a.acss_dept_id FROM                  ntl_prd_allvm.acss_call_v  as a                                  JOIN sys_calendar.calendar AS z                                                                        ON calendar_date= DATE                                   WHERE                  a.acss_call_dt BETWEEN (DATE-(4)) AND (DATE-(2))                   AND a.acss_call_type_cd = '1'                  GROUP BY 1,2,3) r  ON          ac.acss_call_dt = r.acss_call_dt          AND ac.acss_call_ctr_cd = r.acss_call_ctr_cd          AND ac.acss_dept_id = r.acss_dept_id  WHERE ac.acss_call_dt BETWEEN (DATE-(4)) AND (DATE-(2))   AND COALESCE(sed.departmenttype,'Other') <> 'NA'  AND (      (ac.acss_call_type_cd IN ('1','7')) OR      (          ac.acss_call_type_cd = '3'          AND acc.acss_call_ctr_type = 'O'          AND ad.acss_dept_desc NOT LIKE '%offline%'          AND r.acss_dept_id IS NULL ))  ) WITH DATA PRIMARY INDEX (cust_id, cust_line_seq_id, acss_call_dt, acss_call_id, rnk) ON COMMIT PRESERVE ROWS;   CREATE TABLE NTL_PRD_QMTBLS.Repeat_Reporting_EMH21  AS  (  SELECT      a.sor_id,      a.acss_call_id,      a.acss_call_type_cd,      a.ctr_area,      a.acss_call_ctr_type,      m.area_cd,      m.region_desc,      a.cust_id,      a.cust_line_seq_id,      a.mtn,      a.acss_call_dt,          a.acss_call_ad,          a.acss_call_tm,           a.call_duration_tm,      a.rnk,      a.acss_dept_desc as initial_dept_desc,      a.acss_dept_id,      a.acss_user_id,      a.acss_call_ctr_desc,      a.acss_call_ctr_cd,      a.depttype AS orgtype,          a.dept_group as org_dept_group,      b.acss_call_id AS repeat_call_id,      b.acss_dept_desc AS repeat_dept_desc,      b.acss_dept_id AS repeat_dept_id,          b.acss_user_id AS repeat_user_id,          b.acss_call_ctr_desc AS repeat_call_ctr_desc,      b.acss_call_ctr_cd AS repeat_ctr_cd,      b.acss_call_dt AS repeat_dt,          b.acss_call_ad AS repeat_call_ad,         b.acss_call_tm as repeat_call_tm,           b.call_duration_tm as repeat_call_duration_tm,      b.rnk AS repeat_rnk,      b.depttype AS reptype,          b.dept_group as rpt_dept_group,      CASE WHEN b.acss_dt_tm IS NOT NULL THEN        ((b.acss_dt_tm - a.acss_dt_tm) DAY(4) TO MINUTE ) END tsdiff,      CASE WHEN b.acss_dt_tm IS NOT NULL THEN        (EXTRACT(HOUR FROM tsdiff) * 60)        + EXTRACT(MINUTE FROM tsdiff)        + (CAST((CAST ((tsdiff) AS INTERVAL DAY)) AS INTEGER) * 1440) END min_diff  FROM Repeat_Reporting_EMH1 AS a  JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt                 JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)       INNER JOIN Repeat_Reporting_EMH1 AS b          ON  a.cust_id = b.cust_id          AND a.cust_line_seq_id = b.cust_line_seq_id                  AND a.acss_call_dt = b.acss_call_dt                       AND b.rnk = a.rnk + 1          AND b.acss_call_id <> a.acss_call_id                  --AND ( b.acss_call_ad -  a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00'              LEFT JOIN ntl_prd_allvm.acss_call_center_v AS acc      ON b.acss_call_ctr_cd = acc.acss_call_ctr_cd  ) WITH DATA PRIMARY INDEX( sor_id, acss_call_id, acss_call_type_cd, ctr_area, acss_call_ctr_type, area_cd, region_desc, cust_id, cust_line_seq_id, mtn, acss_call_dt, acss_call_ad, acss_call_tm, call_duration_tm, rnk, initial_dept_desc, acss_dept_id, acss_user_id, acss_call_ctr_desc, acss_call_ctr_cd, orgtype, org_dept_group, repeat_call_id, repeat_dept_desc, repeat_dept_id, repeat_user_id, repeat_call_ctr_desc, repeat_ctr_cd, repeat_dt, repeat_call_ad, repeat_call_tm, repeat_call_duration_tm, repeat_rnk, reptype, rpt_dept_group, tsdiff, min_diff);  select a.acss_call_ctr_desc, hr1.nm_last || ', ' || hr1.nm_first AS  AD_Nm,  hr2.nm_last || ', ' || hr2.nm_first AS Supv_Nm,    u.nm_last||', '||u.nm_first AS First_Rep_nm,  a.initial_dept_desc,  a.acss_user_id, a.mtn, a.cust_id, a.area_cd, a.region_desc, CASE WHEN cal.Device_type_cd LIKE '%4GS%'  THEN cal.device_prod_nm  ELSE cal.prod_nm END AS Device_Nm, dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, a.orgtype, a.acss_call_dt, a.acss_call_ad, a.acss_call_tm, a.call_duration_tm, a.repeat_call_ctr_desc, u1.nm_last||', '||u1.nm_first AS Repeat_Rep_nm,  a.repeat_dept_desc, a.reptype, a.repeat_dt, a.repeat_call_ad, a.repeat_call_tm, a.repeat_call_duration_tm, a.tsdiff, a.min_diff, CASE WHEN (a.repeat_call_ad - a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00' THEN  'Y' ELSE 'N' END AS Rpts_2hrs_and_Under   FROM NTL_PRD_QMTBLS.Repeat_Reporting_EMH21 AS a  JOIN sys_calendar.calendar AS z   ON calendar_date= DATE   JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt       LEFT JOIN device_dp_map_v AS dm                     ON (CASE WHEN cal.Device_type_cd LIKE '%4GS%' THEN cal.device_prod_nm ELSE cal.prod_nm END) = dm.prod_nm                JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)  LEFT JOIN ntl_prd_qmtbls.stm_eccr_area AS s    ON a.acss_call_ctr_cd = s.acsscallcentercd    AND a.acss_dept_id = s.acssdeptid      Join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id = u.acss_user_id    JOIN ntl_prd_allvm.hr_employee_v AS hr  ON u.hr_employee_id = hr.emp_id    LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr2              ON hr.SUPER_ID_LVL2_EMP_ID = hr2.emp_id                     LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr1           ON hr.SUPER_ID_LVL1_EMP_ID = hr1.emp_id   Join ntl_prd_allvm.acss_user_v AS u1  on a.repeat_user_id = u1.acss_user_id  WHERE acss_call_dt BETWEEN '2012-10-01' AND ADD_MONTHS('2012-10-01',1)-1 and a.orgtype IN ('CS','WDTS')  and a.reptype IN ('CS','WDTS')  and a.org_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.rpt_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.acss_call_ctr_desc IN('NE Columbia SC',  'NE Huntsville AL',  'NE Hanover MD',  'NE Rochester NY',  'NE Charleston SC',  'NE Charlotte NC',  'NE Wallingford CT',  'NE Wilmington NC',  'NE Bangor ME',  'NE Columbia SC 2')    GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29 ORDER BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29;  DROP TABLE Repeat_Reporting_EMH1; DROP TABLE NTL_PRD_QMTBLS. Repeat_Reporting_EMH21;	TERADATA	HABERER	00:01:22	00:00:27	17906
10/05/2012	13:34:46	NTL_PRD_ALLVM	00:15:35	6195			CREATE VOLATILE TABLE Repeat_Reporting_EMH1 AS (SELECT      acc.acss_call_ctr_desc,      acc.acss_call_ctr_cd,      ac.sor_id,      ac.acss_call_type_cd,     acc.acss_area_cd AS ctr_area,      acc.acss_call_ctr_type,      ac.cust_id,      ac.cust_line_seq_id,          ac.acct_num,      ac.mtn,      ac.acss_user_id,      ac.acss_call_dt,          ac.acss_call_tm,           (ac.call_disconnect_tm - ac.call_start_tm) HOUR TO SECOND (0) AS call_duration_tm,      COALESCE(sed.departmenttype,'Other') depttype,           COALESCE(sed.departmentgroup, 'Other') as dept_group,          CASE  WHEN acc.acss_call_ctr_time_zn LIKE 'C%' THEN                       ac.acss_call_tm + INTERVAL '1' HOUR                          WHEN acc.acss_call_ctr_time_zn LIKE 'M%' THEN               ac.acss_call_tm + INTERVAL '2' HOUR                          WHEN acc.acss_call_ctr_time_zn LIKE 'P%' THEN                 ac.acss_call_tm +INTERVAL '3' HOUR                            WHEN acc.acss_call_ctr_time_zn LIKE 'H%' THEN                ac.acss_call_tm + INTERVAL '5' HOUR                           ELSE ac.acss_call_tm         END acss_call_ad,      CAST(          ac.acss_call_dt ||          ' '             ||          CAST(acss_call_ad AS CHAR(8)) AS TIMESTAMP(0)      ) acss_dt_tm,      ad.acss_dept_desc,      ad.acss_dept_id,      ac.acss_call_id,      ac.area_cd,      RANK() OVER (PARTITION BY cust_id, cust_line_seq_id          ORDER BY ac.acss_call_dt, acss_call_ad, acss_call_id) rnk  FROM ntl_prd_allvm.acss_call_v AS ac  JOIN sys_calendar.calendar AS z        ON calendar_date= DATE   JOIN ntl_prd_allvm.acss_call_center_v AS acc      ON ac.acss_call_ctr_cd = acc.acss_call_ctr_cd  JOIN ntl_prd_allvm.acss_user_v AS au      ON ac.acss_user_id = au.acss_user_id  JOIN ntl_prd_allvm.acss_dept_v AS ad      ON ac.acss_dept_id = ad.acss_dept_id  LEFT JOIN ntl_prd_qmtbls.emh_eccr_dep AS sed    ON ad.acss_dept_id = sed.acssdeptid  LEFT JOIN                  (SELECT a.acss_call_dt,a.acss_call_ctr_cd, a.acss_dept_id FROM                  ntl_prd_allvm.acss_call_v  as a                                  JOIN sys_calendar.calendar AS z                                                                        ON calendar_date= DATE                                   WHERE                  a.acss_call_dt BETWEEN (DATE-(2)) AND (DATE-(2))                   AND a.acss_call_type_cd = '1'                  GROUP BY 1,2,3) r  ON          ac.acss_call_dt = r.acss_call_dt          AND ac.acss_call_ctr_cd = r.acss_call_ctr_cd          AND ac.acss_dept_id = r.acss_dept_id  WHERE ac.acss_call_dt BETWEEN (DATE-(2)) AND (DATE-(2))   AND COALESCE(sed.departmenttype,'Other') <> 'NA'  AND (      (ac.acss_call_type_cd IN ('1','7')) OR      (          ac.acss_call_type_cd = '3'          AND acc.acss_call_ctr_type = 'O'          AND ad.acss_dept_desc NOT LIKE '%offline%'          AND r.acss_dept_id IS NULL ))  ) WITH DATA PRIMARY INDEX (cust_id, cust_line_seq_id, acss_call_dt, acss_call_id, rnk) ON COMMIT PRESERVE ROWS;   CREATE TABLE NTL_PRD_QMTBLS.Repeat_Reporting_EMH21  AS  (  SELECT      a.sor_id,      a.acss_call_id,      a.acss_call_type_cd,      a.ctr_area,      a.acss_call_ctr_type,      m.area_cd,      m.region_desc,      a.cust_id,      a.cust_line_seq_id,      a.mtn,      a.acss_call_dt,          a.acss_call_ad,          a.acss_call_tm,           a.call_duration_tm,      a.rnk,      a.acss_dept_desc as initial_dept_desc,      a.acss_dept_id,      a.acss_user_id,      a.acss_call_ctr_desc,      a.acss_call_ctr_cd,      a.depttype AS orgtype,          a.dept_group as org_dept_group,      b.acss_call_id AS repeat_call_id,      b.acss_dept_desc AS repeat_dept_desc,      b.acss_dept_id AS repeat_dept_id,          b.acss_user_id AS repeat_user_id,          b.acss_call_ctr_desc AS repeat_call_ctr_desc,      b.acss_call_ctr_cd AS repeat_ctr_cd,      b.acss_call_dt AS repeat_dt,          b.acss_call_ad AS repeat_call_ad,         b.acss_call_tm as repeat_call_tm,           b.call_duration_tm as repeat_call_duration_tm,      b.rnk AS repeat_rnk,      b.depttype AS reptype,          b.dept_group as rpt_dept_group,      CASE WHEN b.acss_dt_tm IS NOT NULL THEN        ((b.acss_dt_tm - a.acss_dt_tm) DAY(4) TO MINUTE ) END tsdiff,      CASE WHEN b.acss_dt_tm IS NOT NULL THEN        (EXTRACT(HOUR FROM tsdiff) * 60)        + EXTRACT(MINUTE FROM tsdiff)        + (CAST((CAST ((tsdiff) AS INTERVAL DAY)) AS INTEGER) * 1440) END min_diff  FROM Repeat_Reporting_EMH1 AS a  JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt                 JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)       INNER JOIN Repeat_Reporting_EMH1 AS b          ON  a.cust_id = b.cust_id          AND a.cust_line_seq_id = b.cust_line_seq_id                  AND a.acss_call_dt = b.acss_call_dt                       AND b.rnk = a.rnk + 1          AND b.acss_call_id <> a.acss_call_id                  --AND ( b.acss_call_ad -  a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00'              LEFT JOIN ntl_prd_allvm.acss_call_center_v AS acc      ON b.acss_call_ctr_cd = acc.acss_call_ctr_cd  ) WITH DATA PRIMARY INDEX( sor_id, acss_call_id, acss_call_type_cd, ctr_area, acss_call_ctr_type, area_cd, region_desc, cust_id, cust_line_seq_id, mtn, acss_call_dt, acss_call_ad, acss_call_tm, call_duration_tm, rnk, initial_dept_desc, acss_dept_id, acss_user_id, acss_call_ctr_desc, acss_call_ctr_cd, orgtype, org_dept_group, repeat_call_id, repeat_dept_desc, repeat_dept_id, repeat_user_id, repeat_call_ctr_desc, repeat_ctr_cd, repeat_dt, repeat_call_ad, repeat_call_tm, repeat_call_duration_tm, repeat_rnk, reptype, rpt_dept_group, tsdiff, min_diff);  select a.acss_call_ctr_desc, hr1.nm_last || ', ' || hr1.nm_first AS  AD_Nm,  hr2.nm_last || ', ' || hr2.nm_first AS Supv_Nm,    u.nm_last||', '||u.nm_first AS First_Rep_nm,  a.initial_dept_desc,  a.acss_user_id, a.mtn, a.cust_id, a.area_cd, a.region_desc, CASE WHEN cal.Device_type_cd LIKE '%4GS%'  THEN cal.device_prod_nm  ELSE cal.prod_nm END AS Device_Nm, dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, a.orgtype, a.acss_call_dt, a.acss_call_ad, a.acss_call_tm, a.call_duration_tm, a.repeat_call_ctr_desc, u1.nm_last||', '||u1.nm_first AS Repeat_Rep_nm,  a.repeat_dept_desc, a.reptype, a.repeat_dt, a.repeat_call_ad, a.repeat_call_tm, a.repeat_call_duration_tm, a.tsdiff, a.min_diff, CASE WHEN (a.repeat_call_ad - a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00' THEN  'Y' ELSE 'N' END AS Rpts_2hrs_and_Under   FROM NTL_PRD_QMTBLS.Repeat_Reporting_EMH21 AS a  JOIN sys_calendar.calendar AS z   ON calendar_date= DATE   JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt       LEFT JOIN  ntl_prd_allvm.device_dp_map_v AS dm                     ON (CASE WHEN cal.Device_type_cd LIKE '%4GS%' THEN cal.device_prod_nm ELSE cal.prod_nm END) = dm.prod_nm                JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)  LEFT JOIN ntl_prd_qmtbls.stm_eccr_area AS s    ON a.acss_call_ctr_cd = s.acsscallcentercd    AND a.acss_dept_id = s.acssdeptid      Join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id = u.acss_user_id    JOIN ntl_prd_allvm.hr_employee_v AS hr  ON u.hr_employee_id = hr.emp_id    LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr2              ON hr.SUPER_ID_LVL2_EMP_ID = hr2.emp_id                     LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr1           ON hr.SUPER_ID_LVL1_EMP_ID = hr1.emp_id   Join ntl_prd_allvm.acss_user_v AS u1  on a.repeat_user_id = u1.acss_user_id  WHERE acss_call_dt BETWEEN '2012-10-01' AND ADD_MONTHS('2012-10-01',1)-1 and a.orgtype IN ('CS','WDTS')  and a.reptype IN ('CS','WDTS')  and a.org_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.rpt_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.acss_call_ctr_desc IN('NE Columbia SC',  'NE Huntsville AL',  'NE Hanover MD',  'NE Rochester NY',  'NE Charleston SC',  'NE Charlotte NC',  'NE Wallingford CT',  'NE Wilmington NC',  'NE Bangor ME',  'NE Columbia SC 2')    GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29 ORDER BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29;  DROP TABLE Repeat_Reporting_EMH1; DROP TABLE NTL_PRD_QMTBLS. Repeat_Reporting_EMH21;	TERADATA	HABERER	00:15:27	00:00:08	17905
10/05/2012	11:57:53	NTL_PRD_ALLVM	00:03:15	214636			CREATE VOLATILE TABLE clnr_trans_EH_RT                    AS(SELECT                                                 ms.area_desc as sls_area_desc   ,ms.region_desc as sls_region_desc ,o.sls_dist_chnl_type_cd ,p.sls_outlet_id ,coalesce(case when o.sls_dist_chnl_type_cd = 'NC' and o.sls_outlet_nm like '%CUST%' then au.center  when o.sls_dist_chnl_type_cd = 'NC' and o.sls_outlet_nm like '%VND %'  Then au.center  else o.sls_outlet_nm end, 'Unknown') as Outlet ,p.store_num ,p.pos_src_id            ,p.cust_area_cd       ,p.netace_user_id ,p.acss_user_id   ,coalesce(p.acss_user_id, p.netace_user_id) as user_id          ,p.invc_num                             ,p.invc_line_num ,mc.area_desc as cust_area_desc ,mc.region_desc as cust_region_desc                     ,p.cust_id                                 ,p.cust_line_seq_id                  ,p.mtn ,p.prod_nm                               ,p.pymnt_dt ,ml.zip5_cd ,ml.state_cd ,z.tm_zone ,p.invc_dt ,p.invc_tm  ,case when z.tm_zone = 'Central'  then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((1) As interval hour) when z.tm_zone = 'Mountain' and ml.state_cd <> 'AZ' then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((2) As interval hour) when z.tm_zone = 'Pacific' then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((3) As interval hour) when z.tm_zone = 'Hawaii' then  case when p.pymnt_dt between dst.begindate and dst.enddate then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((5) As interval hour) else      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((6) As interval hour) end when ml.state_cd='AZ' then  case when p.pymnt_dt between dst.begindate and dst.enddate then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((2) As interval hour) else      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((3) As interval hour) end Else cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second) end as OrderDateTime_ETAdjusted                             ,p.sold_qty                                                                                                                                                                                                                                                                                                                     FROM ntl_prd_secvm.pos_trans_v as p  JOIN ntl_prd_allvm.cust_acct_dly_hist_v AS ca         ON p.cust_id = ca.cust_id       AND p.acct_num = ca.acct_num AND p.pymnt_dt BETWEEN ca.eff_dt AND ca.exp_dt                                        JOIN ntl_prd_allvm.item_v as b                              ON p.item_cd = b.item_cd       AND p.sor_id = b.sor_id           AND p.region_cd = b.region_cd              AND b.item_cd LIKE ANY ('FRU%','CLNR%')                                            Left JOIN ntl_prd_allvm.outlet_v as o            ON p.sls_outlet_id = o.sls_outlet_id  AND p.sor_id = o.sor_id                                                  Left  join ntl_prd_allvm.master_location_v as ml on o.master_loc_cd = ml.master_loc_cd                                                  left join ntl_prd_allvm.zip_v z on ml.zip5_cd = z.zip5_cd                                                                  left outer join ntl_prd_qmtbls.mrs_dst as dst on p.pymnt_dt = dst.begindate  Left JOIN ntl_prd_allvm.market_v as ms  ON o.sls_outlet_mkt_cd = ms.mkt_cd                  Left JOIN ntl_prd_allvm.market_v as mc  ON ca.sor_id = mc.sor_id AND ca.mkt_cd = mc.mkt_cd   left join (select  au.nm_first || ' ' || au.nm_last as name ,au.acss_user_id ,au.hr_employee_id ,au.eff_dt ,au.exp_dt ,case when acc.acss_call_ctr_desc in ('NE Columbia SC 2', 'NE Columbia SC') then 'NE Columbia'  else acc.acss_call_ctr_desc end as center ,case when acc.acss_call_ctr_desc='HQ AFNI Tucson_NW VZW.COM' then 'VZW.COM' when acc.acss_call_ctr_desc='HQ AFNI Tucson_NW WDTS' then 'VZW.COM' when acc.acss_call_ctr_desc='NE Columbia SC 2' then 'SC' when acc.acss_call_ctr_desc='S AFNI Opelika - VZW.COM' then 'VZW.COM' when acc.acss_call_ctr_desc='S Little Rock AR 2' then 'AR' else substr(acc.acss_call_ctr_desc,character_length(trim(acc.acss_call_ctr_desc))-1,2) end as state ,coalesce(case  when acc.acss_area_cd='NM' then 'Northeast'  when acc.acss_area_cd='MW' then 'Midwest' when acc.acss_area_cd='SO' then 'South' when acc.acss_area_cd='WE' then 'West' else acc.acss_area_cd end,substr(acc.acss_call_ctr_desc,1,2)) as area_cd          from ntl_prd_allvm.ACSS_USER_DLY_HIST_V as  au                  join ntl_prd_allvm.acss_call_center_v acc on au.acss_call_ctr_cd=acc.acss_call_ctr_cd         group by 1,2,3,4,5,6,7,8) as au                  on p.acss_user_id = au.acss_user_id and p.pymnt_dt between au.eff_dt and au.exp_dt                                                               WHERE                                              p.pymnt_dt between '2012-08-01' and '2012-08-31'  AND p.sold_qty > 0      and (b.IA_ITEM_GROUP_CD like '%DATA%' OR b.IA_ITEM_GROUP_CD like '%PHONE%' OR b.IA_ITEM_GROUP_CD like '%VCP%' )        AND p.cust_id IS NOT NULL AND COALESCE (p.refund_applied_ind, 'E') <> 'R'      qualify row_number() over (partition by p.cust_id, p.cust_line_seq_id, p.pymnt_dt order by p.cust_id, p.cust_line_seq_id, p.pymnt_dt) = 1                                                   )                                                                 WITH DATA                                          PRIMARY INDEX (sls_dist_chnl_type_cd, sls_outlet_id, cust_area_desc, cust_region_desc, cust_area_cd, invc_num, invc_line_num, cust_id, cust_line_seq_id, mtn, pymnt_dt)                                              ON COMMIT PRESERVE ROWS;                                                                    CREATE VOLATILE TABLE clnr_calls_EH_RT                                         AS(SELECT c.sls_area_desc   ,c.sls_region_desc                                                 ,c.sls_outlet_id ,c.cust_area_desc ,c.cust_region_desc   ,c.pymnt_dt ,c.invc_dt ,c.invc_tm ,c.OrderDateTime_ETAdjusted         ,c.acss_user_id as sls_acss_user_id ,c.user_id as sls_user_id  ,a.sor_id ,c.prod_nm ,a.mtn ,a.cust_id ,a.cust_line_seq_id ,CASE WHEN cc.acss_call_ctr_desc IN ('NE Columbia SC 2', 'NE Columbia SC') THEN 'NE Columbia'             ELSE cc.acss_call_ctr_desc END AS Center             ,a.acss_user_id        ,ad.acss_dept_desc              ,a.acss_call_dt   ,a.acss_call_id   ,a.acss_call_tm ,case                  when cc.acss_call_ctr_time_zn = 'CST' then cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) + interval '1' hour                  when cc.acss_call_ctr_time_zn = 'CDT' then cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) + interval '1' hour                  when cc.acss_call_ctr_time_zn = 'MST' then cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) + interval '2' hour                  when cc.acss_call_ctr_time_zn = 'MDT' then cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) + interval '2' hour                  when cc.acss_call_ctr_time_zn = 'PST' then cast(a.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) + interval '3' hour                  when cc.acss_call_ctr_time_zn = 'PDT' then cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) + interval '3' hour                  else cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6))   End As CallDateTime_ETAdjusted                                                                                                                         FROM ntl_prd_allvm.acss_call_v as a  left outer join ntl_prd_qmtbls.mrs_dst as dst   on a.acss_call_dt = dst.begindate                                            INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc          ON a.acss_call_ctr_cd = cc.acss_call_ctr_cd                                  INNER JOIN ntl_prd_allvm.acss_dept_v AS ad     ON a.acss_dept_id = ad.acss_dept_id   LEFT OUTER JOIN              (SELECT acss_call_dt,                          acss_call_ctr_cd,                     acss_dept_id                                            FROM ntl_prd_allvm.acss_call_v                 WHERE acss_call_dt BETWEEN '2012-08-01'                                                                                              AND ADD_MONTHS('2012-08-01', 1) + 32                   AND acss_call_type_cd = '1'                                                   GROUP BY 1,2,3                                                    ) AS R      ON  a.acss_call_dt = r.acss_call_dt                 AND a.acss_call_ctr_cd = r.acss_call_ctr_cd                 AND a.acss_dept_id = r.acss_dept_id   inner join  clnr_trans_EH_RT as c   on a.cust_id = c.cust_id                          and a.cust_line_seq_id = c.cust_line_seq_id   and a.acss_call_dt between c.pymnt_dt and c.pymnt_dt + 32                                                                    WHERE  a.sor_id = 'v'        AND a.cust_line_seq_id IS NOT NULL          AND a.acss_call_dt BETWEEN  '2012-08-01' AND ADD_MONTHS('2012-08-01', 1) + 32  AND ((a.acss_call_type_cd IN ('1','7')) OR            (a.acss_call_type_cd = '3'               AND cc.acss_call_ctr_type = 'O'             AND ad.acss_dept_desc NOT LIKE '%offline%'    AND R.acss_dept_id IS NULL ))   group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21, 22, 23                                                 )                                                WITH DATA                                          PRIMARY INDEX (cust_id, cust_line_seq_id, acss_call_id, acss_call_dt, acss_call_tm)                                    ON COMMIT PRESERVE ROWS;   CREATE VOLATILE TABLE clnr_calls_EH_RT2                                        AS( Select sor_id ,mtn ,cust_id ,cust_line_seq_id ,Center             ,acss_user_id  ,sls_user_id       ,acss_dept_desc  ,acss_call_id   ,pymnt_dt ,invc_tm      , OrderDateTime_ETAdjusted       ,acss_call_dt   ,acss_call_tm , CallDateTime_ETAdjusted  ,CASE WHEN acss_call_id IS NULL THEN 'NO CALL FOUND' WHEN (CallDateTime_ETAdjusted  <= OrderDateTime_ETAdjusted) THEN 'CALL BEFORE CLNR' ELSE 'CALL AFTER CLNR' END AS when_call ,   (CallDateTime_ETAdjusted - OrderDateTime_ETAdjusted) DAY(4) TO SECOND As call_period    from clnr_calls_EH_RT  where sls_user_id <> acss_user_id and when_call <> 'CALL BEFORE CLNR'   group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16 )                                                WITH DATA                                          PRIMARY INDEX (mtn, cust_id, cust_line_seq_id, acss_call_id, acss_call_dt, pymnt_dt)                                    ON COMMIT PRESERVE ROWS;    --This was created to see multiple CLNR data CREATE VOLATILE TABLE clnr_count_EH_RT                                        AS( Select cust_id  ,cust_line_seq_id ,case when lines >='2' then 'Multiple Clnrs' When lines < '2' then 'Single Clnr'  else null end as clnr_line_count ,Lines  from (select cust_id ,cust_line_seq_id ,count(*) as lines  from clnr_trans_EH_RT   group by 1,2) as a  group by 1,2,3,4  )                                                WITH DATA                                          PRIMARY INDEX (cust_id, cust_line_seq_id)                                    ON COMMIT PRESERVE ROWS;   select  TRIM(EXTRACT(MONTH FROM a.OrderDateTime_ETAdjusted))||'-'||TRIM(EXTRACT(YEAR FROM a.OrderDateTime_ETAdjusted)) CLNR_MTH ,coalesce(a.cust_area_desc, 'Unknown') as cust_area_desc ,coalesce(a.cust_region_desc, 'Unknown') as cust_region_desc  ,a.sls_dist_chnl_type_cd ,a.sls_outlet_id ,a.Outlet ,a.prod_nm ,c.clnr_line_count ,count(distinct(a.cust_id||a.cust_line_seq_id||invc_num)) Clnr_Qty , Count(distinct(CASE WHEN Extract(Day from b.call_period) <'3' THEN b.acss_call_id Else Null END)) AS calls3                          , Count(distinct(CASE WHEN  Extract(Day from b.call_period) <'32' THEN b.acss_call_id Else Null END)) AS calls31                        from clnr_trans_EH_RT as a  left outer join clnr_calls_EH_RT2 as b on a.cust_id = b.cust_id and a.cust_line_seq_id = b.cust_line_seq_id AND b.CallDateTime_ETAdjusted BETWEEN a.OrderDateTime_ETAdjusted AND a.OrderDateTime_ETAdjusted + interval '31' Day   left outer join clnr_count_EH_RT as c  on a.cust_id = c.cust_id and a.cust_line_seq_id = c.cust_line_seq_id  group by 1,2,3,4,5,6,7,8;  --drop table clnr_trans_EH_RT; --drop table clnr_calls_EH_RT; --drop table clnr_calls_EH_RT2; --drop table clnr_count_EH_RT;	TERADATA	HABERER	00:01:42	00:01:33	17904
10/05/2012	11:53:44	NTL_PRD_ALLVM	00:00:00	0			drop table clnr_count_EH_RT;	TERADATA	HABERER	00:00:00	00:00:00	17903
10/05/2012	11:53:21	NTL_PRD_ALLVM	00:00:01	0			drop table clnr_calls_EH_RT2;	TERADATA	HABERER	00:00:01	00:00:00	17902
10/05/2012	11:52:32	NTL_PRD_ALLVM	00:00:00	0			drop table clnr_calls_EH_RT	TERADATA	HABERER	00:00:00	00:00:00	17901
10/05/2012	11:51:51	NTL_PRD_ALLVM	00:00:00	0			drop table clnr_trans_EH_RT	TERADATA	HABERER	00:00:00	00:00:00	17900
10/05/2012	11:50:34	NTL_PRD_ALLVM	00:00:01	0	3803		CREATE VOLATILE TABLE clnr_trans_EH_RT                    AS(SELECT                                                 ms.area_desc as sls_area_desc   ,ms.region_desc as sls_region_desc ,o.sls_dist_chnl_type_cd ,p.sls_outlet_id ,coalesce(case when o.sls_dist_chnl_type_cd = 'NC' and o.sls_outlet_nm like '%CUST%' then au.center  when o.sls_dist_chnl_type_cd = 'NC' and o.sls_outlet_nm like '%VND %'  Then au.center  else o.sls_outlet_nm end, 'Unknown') as Outlet ,p.store_num ,p.pos_src_id            ,p.cust_area_cd       ,p.netace_user_id ,p.acss_user_id   ,coalesce(p.acss_user_id, p.netace_user_id) as user_id          ,p.invc_num                             ,p.invc_line_num ,mc.area_desc as cust_area_desc ,mc.region_desc as cust_region_desc                     ,p.cust_id                                 ,p.cust_line_seq_id                  ,p.mtn ,p.prod_nm                               ,p.pymnt_dt ,ml.zip5_cd ,ml.state_cd ,z.tm_zone ,p.invc_dt ,p.invc_tm  ,case when z.tm_zone = 'Central'  then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((1) As interval hour) when z.tm_zone = 'Mountain' and ml.state_cd <> 'AZ' then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((2) As interval hour) when z.tm_zone = 'Pacific' then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((3) As interval hour) when z.tm_zone = 'Hawaii' then  case when p.pymnt_dt between dst.begindate and dst.enddate then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((5) As interval hour) else      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((6) As interval hour) end when ml.state_cd='AZ' then  case when p.pymnt_dt between dst.begindate and dst.enddate then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((2) As interval hour) else      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((3) As interval hour) end Else cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second) end as OrderDateTime_ETAdjusted                             ,p.sold_qty                                                                                                                                                                                                                                                                                                                     FROM ntl_prd_secvm.pos_trans_v as p  JOIN ntl_prd_allvm.cust_acct_dly_hist_v AS ca         ON p.cust_id = ca.cust_id       AND p.acct_num = ca.acct_num AND p.pymnt_dt BETWEEN ca.eff_dt AND ca.exp_dt                                        JOIN ntl_prd_allvm.item_v as b                              ON p.item_cd = b.item_cd       AND p.sor_id = b.sor_id           AND p.region_cd = b.region_cd              AND b.item_cd LIKE ANY ('FRU%','CLNR%')                                            Left JOIN ntl_prd_allvm.outlet_v as o            ON p.sls_outlet_id = o.sls_outlet_id  AND p.sor_id = o.sor_id                                                  Left  join ntl_prd_allvm.master_location_v as ml on o.master_loc_cd = ml.master_loc_cd                                                  left join ntl_prd_allvm.zip_v z on ml.zip5_cd = z.zip5_cd                                                                  left outer join ntl_prd_qmtbls.mrs_dst as dst on p.pymnt_dt = dst.begindate  Left JOIN ntl_prd_allvm.market_v as ms  ON o.sls_outlet_mkt_cd = ms.mkt_cd                  Left JOIN ntl_prd_allvm.market_v as mc  ON ca.sor_id = mc.sor_id AND ca.mkt_cd = mc.mkt_cd   left join (select  au.nm_first || ' ' || au.nm_last as name ,au.acss_user_id ,au.hr_employee_id ,au.eff_dt ,au.exp_dt ,case when acc.acss_call_ctr_desc in ('NE Columbia SC 2', 'NE Columbia SC') then 'NE Columbia'  else acc.acss_call_ctr_desc end as center ,case when acc.acss_call_ctr_desc='HQ AFNI Tucson_NW VZW.COM' then 'VZW.COM' when acc.acss_call_ctr_desc='HQ AFNI Tucson_NW WDTS' then 'VZW.COM' when acc.acss_call_ctr_desc='NE Columbia SC 2' then 'SC' when acc.acss_call_ctr_desc='S AFNI Opelika - VZW.COM' then 'VZW.COM' when acc.acss_call_ctr_desc='S Little Rock AR 2' then 'AR' else substr(acc.acss_call_ctr_desc,character_length(trim(acc.acss_call_ctr_desc))-1,2) end as state ,coalesce(case  when acc.acss_area_cd='NM' then 'Northeast'  when acc.acss_area_cd='MW' then 'Midwest' when acc.acss_area_cd='SO' then 'South' when acc.acss_area_cd='WE' then 'West' else acc.acss_area_cd end,substr(acc.acss_call_ctr_desc,1,2)) as area_cd          from ntl_prd_allvm.ACSS_USER_DLY_HIST_V as  au                  join ntl_prd_allvm.acss_call_center_v acc on au.acss_call_ctr_cd=acc.acss_call_ctr_cd         group by 1,2,3,4,5,6,7,8) as au                  on p.acss_user_id = au.acss_user_id and p.pymnt_dt between au.eff_dt and au.exp_dt                                                               WHERE                                              p.pymnt_dt between '2012-08-01' and '2012-08-31'  AND p.sold_qty > 0      and (b.IA_ITEM_GROUP_CD like '%DATA%' OR b.IA_ITEM_GROUP_CD like '%PHONE%' OR b.IA_ITEM_GROUP_CD like '%VCP%' )        AND p.cust_id IS NOT NULL AND COALESCE (p.refund_applied_ind, 'E') <> 'R'      qualify row_number() over (partition by p.cust_id, p.cust_line_seq_id, p.pymnt_dt order by p.cust_id, p.cust_line_seq_id, p.pymnt_dt) = 1                                                   )                                                                 WITH DATA                                          PRIMARY INDEX (sls_dist_chnl_type_cd, sls_outlet_id, cust_area_desc, cust_region_desc, cust_area_cd, invc_num, invc_line_num, cust_id, cust_line_seq_id, mtn, pymnt_dt)                                              ON COMMIT PRESERVE ROWS;                                                                    CREATE VOLATILE TABLE clnr_calls_EH_RT                                         AS(SELECT c.sls_area_desc   ,c.sls_region_desc                                                 ,c.sls_outlet_id ,c.cust_area_desc ,c.cust_region_desc   ,c.pymnt_dt ,c.invc_dt ,c.invc_tm ,c.OrderDateTime_ETAdjusted         ,c.acss_user_id as sls_acss_user_id ,c.user_id as sls_user_id  ,a.sor_id ,c.prod_nm ,a.mtn ,a.cust_id ,a.cust_line_seq_id ,CASE WHEN cc.acss_call_ctr_desc IN ('NE Columbia SC 2', 'NE Columbia SC') THEN 'NE Columbia'             ELSE cc.acss_call_ctr_desc END AS Center             ,a.acss_user_id        ,ad.acss_dept_desc              ,a.acss_call_dt   ,a.acss_call_id   ,a.acss_call_tm ,case                  when cc.acss_call_ctr_time_zn = 'CST' then cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) + interval '1' hour                  when cc.acss_call_ctr_time_zn = 'CDT' then cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) + interval '1' hour                  when cc.acss_call_ctr_time_zn = 'MST' then cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) + interval '2' hour                  when cc.acss_call_ctr_time_zn = 'MDT' then cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) + interval '2' hour                  when cc.acss_call_ctr_time_zn = 'PST' then cast(a.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) + interval '3' hour                  when cc.acss_call_ctr_time_zn = 'PDT' then cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) + interval '3' hour                  else cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6))   End As CallDateTime_ETAdjusted                                                                                                                         FROM ntl_prd_allvm.acss_call_v as a  left outer join ntl_prd_qmtbls.mrs_dst as dst   on a.acss_call_dt = dst.begindate                                            INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc          ON a.acss_call_ctr_cd = cc.acss_call_ctr_cd                                  INNER JOIN ntl_prd_allvm.acss_dept_v AS ad     ON a.acss_dept_id = ad.acss_dept_id   LEFT OUTER JOIN              (SELECT acss_call_dt,                          acss_call_ctr_cd,                     acss_dept_id                                            FROM ntl_prd_allvm.acss_call_v                 WHERE acss_call_dt BETWEEN '2012-08-01'                                                                                              AND ADD_MONTHS('2012-08-01', 1) + 32                   AND acss_call_type_cd = '1'                                                   GROUP BY 1,2,3                                                    ) AS R      ON  a.acss_call_dt = r.acss_call_dt                 AND a.acss_call_ctr_cd = r.acss_call_ctr_cd                 AND a.acss_dept_id = r.acss_dept_id   inner join  clnr_trans_EH_RT as c   on a.cust_id = c.cust_id                          and a.cust_line_seq_id = c.cust_line_seq_id   and a.acss_call_dt between c.pymnt_dt and c.pymnt_dt + 32                                                                    WHERE  a.sor_id = 'v'        AND a.cust_line_seq_id IS NOT NULL          AND a.acss_call_dt BETWEEN  '2012-08-01' AND ADD_MONTHS('2012-08-01', 1) + 32  AND ((a.acss_call_type_cd IN ('1','7')) OR            (a.acss_call_type_cd = '3'               AND cc.acss_call_ctr_type = 'O'             AND ad.acss_dept_desc NOT LIKE '%offline%'    AND R.acss_dept_id IS NULL ))   group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21, 22, 23                                                 )                                                WITH DATA                                          PRIMARY INDEX (cust_id, cust_line_seq_id, acss_call_id, acss_call_dt, acss_call_tm)                                    ON COMMIT PRESERVE ROWS;   CREATE VOLATILE TABLE clnr_calls_EH_RT2                                        AS( Select sor_id ,mtn ,cust_id ,cust_line_seq_id ,Center             ,acss_user_id  ,sls_user_id       ,acss_dept_desc  ,acss_call_id   ,pymnt_dt ,invc_tm      , OrderDateTime_ETAdjusted       ,acss_call_dt   ,acss_call_tm , CallDateTime_ETAdjusted  ,CASE WHEN acss_call_id IS NULL THEN 'NO CALL FOUND' WHEN (CallDateTime_ETAdjusted  <= OrderDateTime_ETAdjusted) THEN 'CALL BEFORE CLNR' ELSE 'CALL AFTER CLNR' END AS when_call ,   (CallDateTime_ETAdjusted - OrderDateTime_ETAdjusted) DAY(4) TO SECOND As call_period    from clnr_calls_EH_RT  where sls_user_id <> acss_user_id and when_call <> 'CALL BEFORE CLNR'   group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16 )                                                WITH DATA                                          PRIMARY INDEX (mtn, cust_id, cust_line_seq_id, acss_call_id, acss_call_dt, pymnt_dt)                                    ON COMMIT PRESERVE ROWS;    --This was created to see multiple CLNR data CREATE VOLATILE TABLE clnr_count_EH_RT                                        AS( Select cust_id  ,cust_line_seq_id ,case when lines >='2' then 'Multiple Clnrs' When lines < '2' then 'Single Clnr'  else null end as clnr_line_count ,Lines  from (select cust_id ,cust_line_seq_id ,count(*) as lines  from clnr_trans_EH_RT   group by 1,2) as a  group by 1,2,3,4  )                                                WITH DATA                                          PRIMARY INDEX (cust_id, cust_line_seq_id)                                    ON COMMIT PRESERVE ROWS;   select  TRIM(EXTRACT(MONTH FROM a.OrderDateTime_ETAdjusted))||'-'||TRIM(EXTRACT(YEAR FROM a.OrderDateTime_ETAdjusted)) CLNR_MTH ,coalesce(a.cust_area_desc, 'Unknown') as cust_area_desc ,coalesce(a.cust_region_desc, 'Unknown') as cust_region_desc  ,a.sls_dist_chnl_type_cd ,a.sls_outlet_id ,a.Outlet ,a.prod_nm ,c.clnr_line_count ,count(distinct(a.cust_id||a.cust_line_seq_id||invc_num)) Clnr_Qty , Count(distinct(CASE WHEN Extract(Day from b.call_period) <'3' THEN b.acss_call_id Else Null END)) AS calls3                          , Count(distinct(CASE WHEN  Extract(Day from b.call_period) <'32' THEN b.acss_call_id Else Null END)) AS calls31                        from clnr_trans_EH_RT as a  left outer join clnr_calls_EH_RT2 as b on a.cust_id = b.cust_id and a.cust_line_seq_id = b.cust_line_seq_id AND b.CallDateTime_ETAdjusted BETWEEN a.OrderDateTime_ETAdjusted AND a.OrderDateTime_ETAdjusted + interval '31' Day   left outer join clnr_count_EH_RT as c  on a.cust_id = c.cust_id and a.cust_line_seq_id = c.cust_line_seq_id  group by 1,2,3,4,5,6,7,8;	TERADATA	HABERER	00:00:01	00:00:00	17899
10/05/2012	10:21:40	NTL_PRD_ALLVM	00:04:10	214617			CREATE VOLATILE TABLE clnr_trans_EH_RT                    AS(SELECT                                                 ms.area_desc as sls_area_desc   ,ms.region_desc as sls_region_desc ,o.sls_dist_chnl_type_cd ,p.sls_outlet_id ,coalesce(case when o.sls_dist_chnl_type_cd = 'NC' and o.sls_outlet_nm like '%CUST%' then au.center  when o.sls_dist_chnl_type_cd = 'NC' and o.sls_outlet_nm like '%VND %'  Then au.center  else o.sls_outlet_nm end, 'Unknown') as Outlet ,p.store_num ,p.pos_src_id            ,p.cust_area_cd       ,p.netace_user_id ,p.acss_user_id   ,coalesce(p.acss_user_id, p.netace_user_id) as user_id          ,p.invc_num                             ,p.invc_line_num ,mc.area_desc as cust_area_desc ,mc.region_desc as cust_region_desc                     ,p.cust_id                                 ,p.cust_line_seq_id                  ,p.mtn ,p.prod_nm                               ,p.pymnt_dt ,ml.zip5_cd ,ml.state_cd ,z.tm_zone ,p.invc_dt ,p.invc_tm  ,case when z.tm_zone = 'Central'  then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((1) As interval hour) when z.tm_zone = 'Mountain' and ml.state_cd <> 'AZ' then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((2) As interval hour) when z.tm_zone = 'Pacific' then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((3) As interval hour) when z.tm_zone = 'Hawaii' then  case when p.pymnt_dt between dst.begindate and dst.enddate then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((5) As interval hour) else      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((6) As interval hour) end when ml.state_cd='AZ' then  case when p.pymnt_dt between dst.begindate and dst.enddate then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((2) As interval hour) else      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((3) As interval hour) end Else cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second) end as OrderDateTime_ETAdjusted                             ,p.sold_qty                                                                                                                                                                                                                                                                                                                     FROM ntl_prd_secvm.pos_trans_v as p  JOIN ntl_prd_allvm.cust_acct_dly_hist_v AS ca         ON p.cust_id = ca.cust_id       AND p.acct_num = ca.acct_num AND p.pymnt_dt BETWEEN ca.eff_dt AND ca.exp_dt                                        JOIN ntl_prd_allvm.item_v as b                              ON p.item_cd = b.item_cd       AND p.sor_id = b.sor_id           AND p.region_cd = b.region_cd              AND b.item_cd LIKE ANY ('FRU%','CLNR%')                                            Left JOIN ntl_prd_allvm.outlet_v as o            ON p.sls_outlet_id = o.sls_outlet_id  AND p.sor_id = o.sor_id                                                  Left  join ntl_prd_allvm.master_location_v as ml on o.master_loc_cd = ml.master_loc_cd                                                  left join ntl_prd_allvm.zip_v z on ml.zip5_cd = z.zip5_cd                                                                  left outer join ntl_prd_qmtbls.mrs_dst as dst on p.pymnt_dt = dst.begindate  Left JOIN ntl_prd_allvm.market_v as ms  ON o.sls_outlet_mkt_cd = ms.mkt_cd                  Left JOIN ntl_prd_allvm.market_v as mc  ON ca.sor_id = mc.sor_id AND ca.mkt_cd = mc.mkt_cd   left join (select  au.nm_first || ' ' || au.nm_last as name ,au.acss_user_id ,au.hr_employee_id ,au.eff_dt ,au.exp_dt ,case when acc.acss_call_ctr_desc in ('NE Columbia SC 2', 'NE Columbia SC') then 'NE Columbia'  else acc.acss_call_ctr_desc end as center ,case when acc.acss_call_ctr_desc='HQ AFNI Tucson_NW VZW.COM' then 'VZW.COM' when acc.acss_call_ctr_desc='HQ AFNI Tucson_NW WDTS' then 'VZW.COM' when acc.acss_call_ctr_desc='NE Columbia SC 2' then 'SC' when acc.acss_call_ctr_desc='S AFNI Opelika - VZW.COM' then 'VZW.COM' when acc.acss_call_ctr_desc='S Little Rock AR 2' then 'AR' else substr(acc.acss_call_ctr_desc,character_length(trim(acc.acss_call_ctr_desc))-1,2) end as state ,coalesce(case  when acc.acss_area_cd='NM' then 'Northeast'  when acc.acss_area_cd='MW' then 'Midwest' when acc.acss_area_cd='SO' then 'South' when acc.acss_area_cd='WE' then 'West' else acc.acss_area_cd end,substr(acc.acss_call_ctr_desc,1,2)) as area_cd          from ntl_prd_allvm.ACSS_USER_DLY_HIST_V as  au                  join ntl_prd_allvm.acss_call_center_v acc on au.acss_call_ctr_cd=acc.acss_call_ctr_cd         group by 1,2,3,4,5,6,7,8) as au                  on p.acss_user_id = au.acss_user_id and p.pymnt_dt between au.eff_dt and au.exp_dt                                                               WHERE                                              p.pymnt_dt between '2012-08-01' and '2012-08-31' AND p.sold_qty > 0      and (b.IA_ITEM_GROUP_CD like '%DATA%' OR b.IA_ITEM_GROUP_CD like '%PHONE%' OR b.IA_ITEM_GROUP_CD like '%VCP%' )        AND p.cust_id IS NOT NULL AND COALESCE (p.refund_applied_ind, 'E') <> 'R'      qualify row_number() over (partition by p.cust_id, p.cust_line_seq_id, p.pymnt_dt order by p.cust_id, p.cust_line_seq_id, p.pymnt_dt) = 1                                                   )                                                                 WITH DATA                                          PRIMARY INDEX (sls_dist_chnl_type_cd, sls_outlet_id, cust_area_desc, cust_region_desc, cust_area_cd, invc_num, invc_line_num, cust_id, cust_line_seq_id, mtn, pymnt_dt)                                              ON COMMIT PRESERVE ROWS;                                                                    CREATE VOLATILE TABLE clnr_calls_EH_RT                                         AS(SELECT c.sls_area_desc   ,c.sls_region_desc                                                 ,c.sls_outlet_id ,c.cust_area_desc ,c.cust_region_desc   ,c.pymnt_dt ,c.invc_dt ,c.invc_tm ,c.OrderDateTime_ETAdjusted         ,c.acss_user_id as sls_acss_user_id ,c.user_id as sls_user_id  ,a.sor_id ,c.prod_nm ,a.mtn ,a.cust_id ,a.cust_line_seq_id ,CASE WHEN cc.acss_call_ctr_desc IN ('NE Columbia SC 2', 'NE Columbia SC') THEN 'NE Columbia'             ELSE cc.acss_call_ctr_desc END AS Center             ,a.acss_user_id        ,ad.acss_dept_desc              ,a.acss_call_dt   ,a.acss_call_id   ,a.acss_call_tm ,case   when cc.acss_call_ctr_time_zn = 'CST' then cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) + interval '1' hour   when cc.acss_call_ctr_time_zn = 'CDT' then cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) + interval '1' hour   when cc.acss_call_ctr_time_zn = 'MST' then cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) + interval '2' hour   when cc.acss_call_ctr_time_zn = 'MDT' then cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) + interval '2' hour   when cc.acss_call_ctr_time_zn = 'PST' then cast(a.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) + interval '3' hour   when cc.acss_call_ctr_time_zn = 'PDT' then cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) + interval '3' hour   else cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6))   End As CallDateTime_ETAdjusted                                                                                                                         FROM ntl_prd_allvm.acss_call_v as a  left outer join ntl_prd_qmtbls.mrs_dst as dst   on a.acss_call_dt = dst.begindate                                            INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc          ON a.acss_call_ctr_cd = cc.acss_call_ctr_cd                                  INNER JOIN ntl_prd_allvm.acss_dept_v AS ad     ON a.acss_dept_id = ad.acss_dept_id   LEFT OUTER JOIN              (SELECT acss_call_dt,                          acss_call_ctr_cd,                     acss_dept_id                                            FROM ntl_prd_allvm.acss_call_v                 WHERE acss_call_dt BETWEEN '2012-08-01'                                                                                              AND ADD_MONTHS('2012-08-01', 1) + 32                   AND acss_call_type_cd = '1'                                                   GROUP BY 1,2,3                                                    ) AS R      ON  a.acss_call_dt = r.acss_call_dt                 AND a.acss_call_ctr_cd = r.acss_call_ctr_cd                 AND a.acss_dept_id = r.acss_dept_id   inner join  clnr_trans_EH_RT as c   on a.cust_id = c.cust_id                          and a.cust_line_seq_id = c.cust_line_seq_id   and a.acss_call_dt between c.pymnt_dt and c.pymnt_dt + 32                                                                    WHERE  a.sor_id = 'v'        AND a.cust_line_seq_id IS NOT NULL          AND a.acss_call_dt BETWEEN  '2012-08-01' AND ADD_MONTHS('2012-08-01', 1) + 32  AND ((a.acss_call_type_cd IN ('1','7')) OR            (a.acss_call_type_cd = '3'               AND cc.acss_call_ctr_type = 'O'             AND ad.acss_dept_desc NOT LIKE '%offline%'    AND R.acss_dept_id IS NULL ))   group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21, 22, 23                                                 )                                                WITH DATA                                          PRIMARY INDEX (cust_id, cust_line_seq_id, acss_call_id, acss_call_dt, acss_call_tm)                                    ON COMMIT PRESERVE ROWS;   CREATE VOLATILE TABLE clnr_calls_EH_RT2                                        AS( Select sor_id ,mtn ,cust_id ,cust_line_seq_id ,Center             ,acss_user_id  ,sls_user_id       ,acss_dept_desc  ,acss_call_id   ,pymnt_dt ,invc_tm      , OrderDateTime_ETAdjusted       ,acss_call_dt   ,acss_call_tm , CallDateTime_ETAdjusted  ,CASE WHEN acss_call_id IS NULL THEN 'NO CALL FOUND' WHEN (CallDateTime_ETAdjusted  <= OrderDateTime_ETAdjusted) THEN 'CALL BEFORE CLNR' ELSE 'CALL AFTER CLNR' END AS when_call ,   (CallDateTime_ETAdjusted - OrderDateTime_ETAdjusted) DAY(4) TO SECOND As call_period    from clnr_calls_EH_RT  where sls_user_id <> acss_user_id and when_call <> 'CALL BEFORE CLNR'   group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16 )                                                WITH DATA                                          PRIMARY INDEX (mtn, cust_id, cust_line_seq_id, acss_call_id, acss_call_dt, pymnt_dt)                                    ON COMMIT PRESERVE ROWS;    --This was created to see multiple CLNR data CREATE VOLATILE TABLE clnr_count_EH_RT                                        AS( Select cust_id  ,cust_line_seq_id ,case when lines >='2' then 'Multiple Clnrs' When lines < '2' then 'Single Clnr'  else null end as clnr_line_count ,Lines  from (select cust_id ,cust_line_seq_id ,count(*) as lines  from clnr_trans_EH_RT   group by 1,2) as a  group by 1,2,3,4  )                                                WITH DATA                                          PRIMARY INDEX (cust_id, cust_line_seq_id)                                    ON COMMIT PRESERVE ROWS;   select  TRIM(EXTRACT(MONTH FROM a.OrderDateTime_ETAdjusted))||'-'||TRIM(EXTRACT(YEAR FROM a.OrderDateTime_ETAdjusted)) CLNR_MTH ,coalesce(a.cust_area_desc, 'Unknown') as cust_area_desc ,coalesce(a.cust_region_desc, 'Unknown') as cust_region_desc   ,a.sls_dist_chnl_type_cd ,a.sls_outlet_id ,a.Outlet ,a.prod_nm ,c.clnr_line_count ,count(distinct(a.cust_id||a.cust_line_seq_id||invc_num)) Clnr_Qty , Count(distinct(CASE WHEN Extract(Day from b.call_period) <'3' THEN b.acss_call_id Else Null END)) AS calls3                          , Count(distinct(CASE WHEN  Extract(Day from b.call_period) <'32' THEN b.acss_call_id Else Null END)) AS calls31                        from clnr_trans_EH_RT as a  left outer join clnr_calls_EH_RT2 as b on a.cust_id = b.cust_id and a.cust_line_seq_id = b.cust_line_seq_id AND b.acss_call_dt BETWEEN a.pymnt_dt AND a.pymnt_dt +31   left outer join clnr_count_EH_RT as c  on a.cust_id = c.cust_id and a.cust_line_seq_id = c.cust_line_seq_id  group by 1,2,3,4,5,6,7,8;   --drop table clnr_trans_EH_RT; --drop table clnr_calls_EH_RT;  --drop table clnr_calls_EH_RT2; --drop table clnr_count_EH_RT;	TERADATA	HABERER	00:01:16	00:02:54	17898
10/05/2012	10:12:43	NTL_PRD_ALLVM	00:00:01	0			drop table clnr_trans_EH_RT	TERADATA	HABERER	00:00:01	00:00:00	17897
10/05/2012	10:11:18	NTL_PRD_ALLVM	00:00:01	1			select count(*)  from clnr_trans_eh_rt	TERADATA	HABERER	00:00:01	00:00:00	17896
10/05/2012	10:11:10	NTL_PRD_ALLVM	00:00:42	0			CREATE VOLATILE TABLE clnr_trans_EH_RT                    AS(SELECT                                                 ms.area_desc as sls_area_desc   ,ms.region_desc as sls_region_desc ,o.sls_dist_chnl_type_cd ,p.sls_outlet_id ,coalesce(case when o.sls_dist_chnl_type_cd = 'NC' and o.sls_outlet_nm like '%CUST%' then au.center  when o.sls_dist_chnl_type_cd = 'NC' and o.sls_outlet_nm like '%VND %'  Then au.center  else o.sls_outlet_nm end, 'Unknown') as Outlet ,p.store_num ,p.pos_src_id            ,p.cust_area_cd       ,p.netace_user_id ,p.acss_user_id   ,coalesce(p.acss_user_id, p.netace_user_id) as user_id          ,p.invc_num                             ,p.invc_line_num ,mc.area_desc as cust_area_desc ,mc.region_desc as cust_region_desc                     ,p.cust_id                                 ,p.cust_line_seq_id                  ,p.mtn ,p.prod_nm                               ,p.pymnt_dt ,ml.zip5_cd ,ml.state_cd ,z.tm_zone ,p.invc_dt ,p.invc_tm    ,case when z.tm_zone = 'Central'  then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((1) As interval hour) when z.tm_zone = 'Mountain' and ml.state_cd <> 'AZ' then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((2) As interval hour) when z.tm_zone = 'Pacific' then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((3) As interval hour) when z.tm_zone = 'Hawaii' then  case when p.pymnt_dt between dst.begindate and dst.enddate then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((5) As interval hour) else      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((6) As interval hour) end when ml.state_cd='AZ' then  case when p.pymnt_dt between dst.begindate and dst.enddate then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((2) As interval hour) else      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((3) As interval hour) end Else cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second) end as OrderDateTime_ETAdjusted                             ,p.sold_qty                                                                                                                                                                                                                                                                                                                           FROM ntl_prd_secvm.pos_trans_v as p  JOIN ntl_prd_allvm.cust_acct_dly_hist_v AS ca         ON p.cust_id = ca.cust_id       AND p.acct_num = ca.acct_num AND p.pymnt_dt BETWEEN ca.eff_dt AND ca.exp_dt                                        JOIN ntl_prd_allvm.item_v as b                              ON p.item_cd = b.item_cd       AND p.sor_id = b.sor_id           AND p.region_cd = b.region_cd              AND b.item_cd LIKE ANY ('FRU%','CLNR%')                                            Left JOIN ntl_prd_allvm.outlet_v as o            ON p.sls_outlet_id = o.sls_outlet_id  AND p.sor_id = o.sor_id                                                  Left  join ntl_prd_allvm.master_location_v as ml on o.master_loc_cd = ml.master_loc_cd                                                  left join ntl_prd_allvm.zip_v z on ml.zip5_cd = z.zip5_cd                                                                  left outer join ntl_prd_qmtbls.mrs_dst as dst on p.pymnt_dt = dst.begindate  Left JOIN ntl_prd_allvm.market_v as ms  ON o.sls_outlet_mkt_cd = ms.mkt_cd                  Left JOIN ntl_prd_allvm.market_v as mc  ON ca.sor_id = mc.sor_id AND ca.mkt_cd = mc.mkt_cd   left join (select  au.nm_first || ' ' || au.nm_last as name ,au.acss_user_id ,au.hr_employee_id ,au.eff_dt ,au.exp_dt ,case when acc.acss_call_ctr_desc in ('NE Columbia SC 2', 'NE Columbia SC') then 'NE Columbia'  else acc.acss_call_ctr_desc end as center ,case when acc.acss_call_ctr_desc='HQ AFNI Tucson_NW VZW.COM' then 'VZW.COM' when acc.acss_call_ctr_desc='HQ AFNI Tucson_NW WDTS' then 'VZW.COM' when acc.acss_call_ctr_desc='NE Columbia SC 2' then 'SC' when acc.acss_call_ctr_desc='S AFNI Opelika - VZW.COM' then 'VZW.COM' when acc.acss_call_ctr_desc='S Little Rock AR 2' then 'AR' else substr(acc.acss_call_ctr_desc,character_length(trim(acc.acss_call_ctr_desc))-1,2) end as state ,coalesce(case  when acc.acss_area_cd='NM' then 'Northeast'  when acc.acss_area_cd='MW' then 'Midwest' when acc.acss_area_cd='SO' then 'South' when acc.acss_area_cd='WE' then 'West' else acc.acss_area_cd end,substr(acc.acss_call_ctr_desc,1,2)) as area_cd          from ntl_prd_allvm.ACSS_USER_DLY_HIST_V as  au                  join ntl_prd_allvm.acss_call_center_v acc on au.acss_call_ctr_cd=acc.acss_call_ctr_cd         group by 1,2,3,4,5,6,7,8) as au                  on p.acss_user_id = au.acss_user_id and p.pymnt_dt between au.eff_dt and au.exp_dt                                                               WHERE                                              p.pymnt_dt between '2012-08-01' and '2012-08-31' AND p.sold_qty > 0      and (b.IA_ITEM_GROUP_CD like '%DATA%' OR b.IA_ITEM_GROUP_CD like '%PHONE%' OR b.IA_ITEM_GROUP_CD like '%VCP%' )        AND p.cust_id IS NOT NULL AND COALESCE (p.refund_applied_ind, 'E') <> 'R'      qualify row_number() over (partition by p.cust_id, p.cust_line_seq_id, p.pymnt_dt order by p.cust_id, p.cust_line_seq_id, p.pymnt_dt) = 1                                                   )                                                                 WITH DATA                                          PRIMARY INDEX (sls_dist_chnl_type_cd, sls_outlet_id, cust_area_desc, cust_region_desc, cust_area_cd, invc_num, invc_line_num, cust_id, cust_line_seq_id, mtn, pymnt_dt)                                              ON COMMIT PRESERVE ROWS;	TERADATA	HABERER	00:00:42	00:00:00	17895
10/05/2012	10:09:23	NTL_PRD_ALLVM	00:00:00	0	3807		drop table clnr_trans_EH_RT	TERADATA	HABERER	00:00:00	00:00:00	17894
10/05/2012	10:09:04	NTL_PRD_ALLVM	00:00:01	0			drop table clnr_trans_EH_RT	TERADATA	HABERER	00:00:01	00:00:00	17893
10/05/2012	10:06:06	NTL_PRD_ALLVM	00:00:00	1			select count(*)  from clnr_trans_eh_rt	TERADATA	HABERER	00:00:00	00:00:00	17892
10/05/2012	10:05:39	NTL_PRD_ALLVM	00:00:35	0			CREATE VOLATILE TABLE clnr_trans_EH_RT                    AS(SELECT                                                 ms.area_desc as sls_area_desc   ,ms.region_desc as sls_region_desc ,o.sls_dist_chnl_type_cd ,p.sls_outlet_id ,coalesce(case when o.sls_dist_chnl_type_cd = 'NC' and o.sls_outlet_nm like '%CUST%' then au.center  when o.sls_dist_chnl_type_cd = 'NC' and o.sls_outlet_nm like '%VND %'  Then au.center  else o.sls_outlet_nm end, 'Unknown') as Outlet ,p.store_num ,p.pos_src_id            ,p.cust_area_cd       ,p.netace_user_id ,p.acss_user_id   ,coalesce(p.acss_user_id, p.netace_user_id) as user_id          ,p.invc_num                             ,p.invc_line_num ,mc.area_desc as cust_area_desc ,mc.region_desc as cust_region_desc                     ,p.cust_id                                 ,p.cust_line_seq_id                  ,p.mtn ,p.prod_nm                               ,p.pymnt_dt ,ml.zip5_cd ,ml.state_cd ,z.tm_zone ,p.invc_dt ,p.invc_tm    ,case when z.tm_zone = 'Central'  then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((1) As interval hour) when z.tm_zone = 'Mountain' and ml.state_cd <> 'AZ' then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((2) As interval hour) when z.tm_zone = 'Pacific' then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((3) As interval hour) when z.tm_zone = 'Hawaii' then  case when p.pymnt_dt between dst.begindate and dst.enddate then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((5) As interval hour) else      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((6) As interval hour) end when ml.state_cd='AZ' then  case when p.pymnt_dt between dst.begindate and dst.enddate then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((2) As interval hour) else      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((3) As interval hour) end Else cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second) end as OrderDateTime_ETAdjusted                             ,p.sold_qty                                                                                                                                                                                                                                                                                                                           FROM ntl_prd_allvm.pos_trans_v as p  JOIN ntl_prd_allvm.cust_acct_dly_hist_v AS ca         ON p.cust_id = ca.cust_id       AND p.acct_num = ca.acct_num AND p.pymnt_dt BETWEEN ca.eff_dt AND ca.exp_dt                                        JOIN ntl_prd_allvm.item_v as b                              ON p.item_cd = b.item_cd       AND p.sor_id = b.sor_id           AND p.region_cd = b.region_cd              AND b.item_cd LIKE ANY ('FRU%','CLNR%')                                            Left JOIN ntl_prd_allvm.outlet_v as o            ON p.sls_outlet_id = o.sls_outlet_id  AND p.sor_id = o.sor_id                                                  Left  join ntl_prd_allvm.master_location_v as ml on o.master_loc_cd = ml.master_loc_cd                                                  left join ntl_prd_allvm.zip_v z on ml.zip5_cd = z.zip5_cd                                                                  left outer join ntl_prd_qmtbls.mrs_dst as dst on p.pymnt_dt = dst.begindate  Left JOIN ntl_prd_allvm.market_v as ms  ON o.sls_outlet_mkt_cd = ms.mkt_cd                  Left JOIN ntl_prd_allvm.market_v as mc  ON ca.sor_id = mc.sor_id AND ca.mkt_cd = mc.mkt_cd   left join (select  au.nm_first || ' ' || au.nm_last as name ,au.acss_user_id ,au.hr_employee_id ,au.eff_dt ,au.exp_dt ,case when acc.acss_call_ctr_desc in ('NE Columbia SC 2', 'NE Columbia SC') then 'NE Columbia'  else acc.acss_call_ctr_desc end as center ,case when acc.acss_call_ctr_desc='HQ AFNI Tucson_NW VZW.COM' then 'VZW.COM' when acc.acss_call_ctr_desc='HQ AFNI Tucson_NW WDTS' then 'VZW.COM' when acc.acss_call_ctr_desc='NE Columbia SC 2' then 'SC' when acc.acss_call_ctr_desc='S AFNI Opelika - VZW.COM' then 'VZW.COM' when acc.acss_call_ctr_desc='S Little Rock AR 2' then 'AR' else substr(acc.acss_call_ctr_desc,character_length(trim(acc.acss_call_ctr_desc))-1,2) end as state ,coalesce(case  when acc.acss_area_cd='NM' then 'Northeast'  when acc.acss_area_cd='MW' then 'Midwest' when acc.acss_area_cd='SO' then 'South' when acc.acss_area_cd='WE' then 'West' else acc.acss_area_cd end,substr(acc.acss_call_ctr_desc,1,2)) as area_cd          from ntl_prd_allvm.ACSS_USER_DLY_HIST_V as  au                  join ntl_prd_allvm.acss_call_center_v acc on au.acss_call_ctr_cd=acc.acss_call_ctr_cd         group by 1,2,3,4,5,6,7,8) as au                  on p.acss_user_id = au.acss_user_id and p.pymnt_dt between au.eff_dt and au.exp_dt                                                               WHERE                                              p.pymnt_dt between '2012-08-01' and '2012-08-31' AND p.sold_qty > 0      and (b.IA_ITEM_GROUP_CD like '%DATA%' OR b.IA_ITEM_GROUP_CD like '%PHONE%' OR b.IA_ITEM_GROUP_CD like '%VCP%' )        AND p.cust_id IS NOT NULL AND COALESCE (p.refund_applied_ind, 'E') <> 'R'      qualify row_number() over (partition by p.cust_id, p.cust_line_seq_id, p.pymnt_dt order by p.cust_id, p.cust_line_seq_id, p.pymnt_dt) = 1                                                   )                                                                 WITH DATA                                          PRIMARY INDEX (sls_dist_chnl_type_cd, sls_outlet_id, cust_area_desc, cust_region_desc, cust_area_cd, invc_num, invc_line_num, cust_id, cust_line_seq_id, mtn, pymnt_dt)                                              ON COMMIT PRESERVE ROWS;	TERADATA	HABERER	00:00:35	00:00:00	17891
10/05/2012	10:02:01	NTL_PRD_ALLVM	00:00:02	1			select count(*)  from clnr_trans_vt	TERADATA	HABERER	00:00:02	00:00:00	17890
10/05/2012	10:01:11	NTL_PRD_ALLVM	00:00:50	0			CREATE VOLATILE TABLE clnr_trans_vt                                         AS(SELECT                                                 TRIM(EXTRACT(MONTH FROM p.pymnt_dt))||'-'||TRIM(EXTRACT(YEAR FROM p.pymnt_dt)) CLNR_MTH ,p.sor_id ,ms.area_desc as sls_area_desc   ,ms.region_desc as sls_region_desc ,o.sls_dist_chnl_type_cd ,p.sls_outlet_id ,coalesce(case when o.sls_dist_chnl_type_cd = 'NC' and o.sls_outlet_nm like '%CUST%' then au.center  when o.sls_dist_chnl_type_cd = 'NC' and o.sls_outlet_nm like '%VND %'  Then au.center  else o.sls_outlet_nm end, 'Unknown') as Outlet ,p.store_num ,p.pos_src_id            ,p.cust_area_cd       ,p.netace_user_id ,p.acss_user_id        ,p.invc_num                             ,p.invc_line_num ,mc.area_desc as cust_area_desc ,mc.region_desc as cust_region_desc                     ,p.cust_id                                 ,p.cust_line_seq_id                  ,p.mtn ,p.prod_nm                               ,p.pymnt_dt ,p.invc_dt ,p.invc_tm ,ml.zip5_cd ,ml.state_cd ,z.tm_zone ,case when z.tm_zone = 'Central'  then p.invc_tm + 3600 when z.tm_zone = 'Mountain' and ml.state_cd <> 'AZ' then p.invc_tm + 7200 when z.tm_zone = 'Pacific' then p.invc_tm + 10800 when z.tm_zone = 'Hawaii' then  case when p.pymnt_dt between dst.begindate and dst.enddate then p.invc_tm + 18000 else p.invc_tm + 21600 end when ml.state_cd='AZ' then  case when p.pymnt_dt between dst.begindate and dst.enddate then p.invc_tm + 7200 else p.invc_tm + 10800 end else p.invc_tm end as tm_ESTAdjusted                             ,p.sold_qty                                                                                                                                                                                                                                                                                                                      FROM ntl_prd_secvm.pos_trans_v as p  JOIN  ntl_prd_allvm.cust_acct_dly_hist_v AS ca         ON p.cust_id = ca.cust_id       AND p.acct_num = ca.acct_num AND p.pymnt_dt BETWEEN ca.eff_dt AND ca.exp_dt                                        JOIN  ntl_prd_allvm.item_v as b                              ON p.item_cd = b.item_cd       AND p.sor_id = b.sor_id           AND p.region_cd = b.region_cd                                   AND b.item_cd LIKE ANY ('FRU%','CLNR%')                                       Left JOIN ntl_prd_allvm.outlet_v as o            ON p.sls_outlet_id = o.sls_outlet_id  AND p.sor_id = o.sor_id                                           Left  join ntl_prd_allvm.master_location_v as ml on o.master_loc_cd = ml.master_loc_cd                                                  left join ntl_prd_allvm.zip_v z on ml.zip5_cd = z.zip5_cd                                                                  left outer join ntl_prd_qmtbls.mrs_dst as dst on p.pymnt_dt = dst.begindate                                                                                         Left JOIN ntl_prd_allvm.market_v as ms  ON o.sls_outlet_mkt_cd = ms.mkt_cd                  Left JOIN ntl_prd_allvm.market_v as mc  ON ca.sor_id = mc.sor_id AND ca.mkt_cd = mc.mkt_cd   left join (select  au.nm_first || ' ' || au.nm_last as name ,au.acss_user_id ,au.hr_employee_id ,au.eff_dt ,au.exp_dt ,case when acc.acss_call_ctr_desc in ('NE Columbia SC 2', 'NE Columbia SC') then 'NE Columbia'  else acc.acss_call_ctr_desc end as center ,case when acc.acss_call_ctr_desc='HQ AFNI Tucson_NW VZW.COM' then 'VZW.COM' when acc.acss_call_ctr_desc='HQ AFNI Tucson_NW WDTS' then 'VZW.COM' when acc.acss_call_ctr_desc='NE Columbia SC 2' then 'SC' when acc.acss_call_ctr_desc='S AFNI Opelika - VZW.COM' then 'VZW.COM' when acc.acss_call_ctr_desc='S Little Rock AR 2' then 'AR' else substr(acc.acss_call_ctr_desc,character_length(trim(acc.acss_call_ctr_desc))-1,2) end as state ,coalesce(case  when acc.acss_area_cd='NM' then 'Northeast'  when acc.acss_area_cd='MW' then 'Midwest' when acc.acss_area_cd='SO' then 'South' when acc.acss_area_cd='WE' then 'West' else acc.acss_area_cd end,substr(acc.acss_call_ctr_desc,1,2)) as area_cd          from ntl_prd_allvm.ACSS_USER_DLY_HIST_V as  au                  join ntl_prd_allvm.acss_call_center_v acc on au.acss_call_ctr_cd=acc.acss_call_ctr_cd         group by 1,2,3,4,5,6,7,8) as au                  on p.acss_user_id = au.acss_user_id and p.pymnt_dt between au.eff_dt and au.exp_dt                                                               WHERE                                                  p.pymnt_dt between '2012-08-01' and '2012-08-31' AND p.sold_qty > 0      and (b.IA_ITEM_GROUP_CD like '%DATA%' OR b.IA_ITEM_GROUP_CD like '%PHONE%' OR b.IA_ITEM_GROUP_CD like '%VCP%' )        AND p.cust_id IS NOT NULL AND COALESCE (p.refund_applied_ind, 'E') <> 'R'      qualify row_number() over (partition by p.cust_id, p.cust_line_seq_id, p.pymnt_dt order by p.cust_id, p.cust_line_seq_id, p.pymnt_dt) = 1  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28                                                       )                                                                 WITH DATA                                          PRIMARY INDEX (sor_id, clnr_mth, sls_dist_chnl_type_cd, sls_outlet_id, cust_area_desc, cust_region_desc, cust_area_cd, invc_num, invc_line_num, cust_id, cust_line_seq_id, mtn, pymnt_dt)                                              ON COMMIT PRESERVE ROWS;	TERADATA	HABERER	00:00:50	00:00:00	17889
10/05/2012	09:58:42	NTL_PRD_ALLVM	00:00:00	0			drop table clnr_trans_vt	TERADATA	HABERER	00:00:00	00:00:00	17888
10/05/2012	09:58:18	NTL_PRD_ALLVM	00:00:00	1			Select count(*)  from clnr_trans_vt	TERADATA	HABERER	00:00:00	00:00:00	17887
10/05/2012	09:57:50	NTL_PRD_ALLVM	00:00:25	0			CREATE VOLATILE TABLE clnr_trans_vt                                         AS(SELECT                                                 TRIM(EXTRACT(MONTH FROM p.pymnt_dt))||'-'||TRIM(EXTRACT(YEAR FROM p.pymnt_dt)) CLNR_MTH ,p.sor_id ,ms.area_desc as sls_area_desc   ,ms.region_desc as sls_region_desc ,o.sls_dist_chnl_type_cd ,p.sls_outlet_id ,coalesce(case when o.sls_dist_chnl_type_cd = 'NC' and o.sls_outlet_nm like '%CUST%' then au.center  when o.sls_dist_chnl_type_cd = 'NC' and o.sls_outlet_nm like '%VND %'  Then au.center  else o.sls_outlet_nm end, 'Unknown') as Outlet ,p.store_num ,p.pos_src_id            ,p.cust_area_cd       ,p.netace_user_id ,p.acss_user_id        ,p.invc_num                             ,p.invc_line_num ,mc.area_desc as cust_area_desc ,mc.region_desc as cust_region_desc                     ,p.cust_id                                 ,p.cust_line_seq_id                  ,p.mtn ,p.prod_nm                               ,p.pymnt_dt ,p.invc_dt ,p.invc_tm ,ml.zip5_cd ,ml.state_cd ,z.tm_zone ,case when z.tm_zone = 'Central'  then p.invc_tm + 3600 when z.tm_zone = 'Mountain' and ml.state_cd <> 'AZ' then p.invc_tm + 7200 when z.tm_zone = 'Pacific' then p.invc_tm + 10800 when z.tm_zone = 'Hawaii' then  case when p.pymnt_dt between dst.begindate and dst.enddate then p.invc_tm + 18000 else p.invc_tm + 21600 end when ml.state_cd='AZ' then  case when p.pymnt_dt between dst.begindate and dst.enddate then p.invc_tm + 7200 else p.invc_tm + 10800 end else p.invc_tm end as tm_ESTAdjusted                             ,p.sold_qty                                                                                                                                                                                                                                                                                                                      FROM ntl_prd_secvm.pos_trans_v as p  JOIN  ntl_prd_allvm.cust_acct_dly_hist_v AS ca         ON p.cust_id = ca.cust_id       AND p.acct_num = ca.acct_num AND p.pymnt_dt BETWEEN ca.eff_dt AND ca.exp_dt                                        JOIN  ntl_prd_allvm.item_v as b                              ON p.item_cd = b.item_cd       AND p.sor_id = b.sor_id           AND p.region_cd = b.region_cd                                   AND b.item_cd LIKE ANY ('FRU%','CLNR%')                                       Left JOIN ntl_prd_allvm.outlet_v as o            ON p.sls_outlet_id = o.sls_outlet_id  AND p.sor_id = o.sor_id                                           Left  join ntl_prd_allvm.master_location_v as ml on o.master_loc_cd = ml.master_loc_cd                                                  left join ntl_prd_allvm.zip_v z on ml.zip5_cd = z.zip5_cd                                                                  left outer join ntl_prd_qmtbls.mrs_dst as dst on p.pymnt_dt = dst.begindate                                                                                         Left JOIN ntl_prd_allvm.market_v as ms  ON o.sls_outlet_mkt_cd = ms.mkt_cd                  Left JOIN ntl_prd_allvm.market_v as mc  ON ca.sor_id = mc.sor_id AND ca.mkt_cd = mc.mkt_cd   left join (select  au.nm_first || ' ' || au.nm_last as name ,au.acss_user_id ,au.hr_employee_id ,au.eff_dt ,au.exp_dt ,case when acc.acss_call_ctr_desc in ('NE Columbia SC 2', 'NE Columbia SC') then 'NE Columbia'  else acc.acss_call_ctr_desc end as center ,case when acc.acss_call_ctr_desc='HQ AFNI Tucson_NW VZW.COM' then 'VZW.COM' when acc.acss_call_ctr_desc='HQ AFNI Tucson_NW WDTS' then 'VZW.COM' when acc.acss_call_ctr_desc='NE Columbia SC 2' then 'SC' when acc.acss_call_ctr_desc='S AFNI Opelika - VZW.COM' then 'VZW.COM' when acc.acss_call_ctr_desc='S Little Rock AR 2' then 'AR' else substr(acc.acss_call_ctr_desc,character_length(trim(acc.acss_call_ctr_desc))-1,2) end as state ,coalesce(case  when acc.acss_area_cd='NM' then 'Northeast'  when acc.acss_area_cd='MW' then 'Midwest' when acc.acss_area_cd='SO' then 'South' when acc.acss_area_cd='WE' then 'West' else acc.acss_area_cd end,substr(acc.acss_call_ctr_desc,1,2)) as area_cd          from ntl_prd_allvm.ACSS_USER_DLY_HIST_V as  au                  join ntl_prd_allvm.acss_call_center_v acc on au.acss_call_ctr_cd=acc.acss_call_ctr_cd         group by 1,2,3,4,5,6,7,8) as au                  on p.acss_user_id = au.acss_user_id and p.pymnt_dt between au.eff_dt and au.exp_dt                                                               WHERE                                                  p.pymnt_dt between '2012-07-01' and '2012-07-31' AND p.sold_qty > 0      and (b.IA_ITEM_GROUP_CD like '%DATA%' OR b.IA_ITEM_GROUP_CD like '%PHONE%' OR b.IA_ITEM_GROUP_CD like '%VCP%' )        AND p.cust_id IS NOT NULL AND COALESCE (p.refund_applied_ind, 'E') <> 'R'      qualify row_number() over (partition by p.cust_id, p.cust_line_seq_id, p.pymnt_dt order by p.cust_id, p.cust_line_seq_id, p.pymnt_dt) = 1  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28                                                       )                                                                 WITH DATA                                          PRIMARY INDEX (sor_id, clnr_mth, sls_dist_chnl_type_cd, sls_outlet_id, cust_area_desc, cust_region_desc, cust_area_cd, invc_num, invc_line_num, cust_id, cust_line_seq_id, mtn, pymnt_dt)                                              ON COMMIT PRESERVE ROWS;	TERADATA	HABERER	00:00:25	00:00:00	17886
10/05/2012	09:56:59	NTL_PRD_ALLVM	00:00:00	0	3807		CREATE VOLATILE TABLE clnr_trans_vt                                         AS(SELECT                                                 TRIM(EXTRACT(MONTH FROM p.pymnt_dt))||'-'||TRIM(EXTRACT(YEAR FROM p.pymnt_dt)) CLNR_MTH ,p.sor_id ,ms.area_desc as sls_area_desc   ,ms.region_desc as sls_region_desc ,o.sls_dist_chnl_type_cd ,p.sls_outlet_id ,coalesce(case when o.sls_dist_chnl_type_cd = 'NC' and o.sls_outlet_nm like '%CUST%' then au.center  when o.sls_dist_chnl_type_cd = 'NC' and o.sls_outlet_nm like '%VND %'  Then au.center  else o.sls_outlet_nm end, 'Unknown') as Outlet ,p.store_num ,p.pos_src_id            ,p.cust_area_cd       ,p.netace_user_id ,p.acss_user_id        ,p.invc_num                             ,p.invc_line_num ,mc.area_desc as cust_area_desc ,mc.region_desc as cust_region_desc                     ,p.cust_id                                 ,p.cust_line_seq_id                  ,p.mtn ,p.prod_nm                               ,p.pymnt_dt ,p.invc_dt ,p.invc_tm ,ml.zip5_cd ,ml.state_cd ,z.tm_zone ,case when z.tm_zone = 'Central'  then p.invc_tm + 3600 when z.tm_zone = 'Mountain' and ml.state_cd <> 'AZ' then p.invc_tm + 7200 when z.tm_zone = 'Pacific' then p.invc_tm + 10800 when z.tm_zone = 'Hawaii' then  case when p.pymnt_dt between dst.begindate and dst.enddate then p.invc_tm + 18000 else p.invc_tm + 21600 end when ml.state_cd='AZ' then  case when p.pymnt_dt between dst.begindate and dst.enddate then p.invc_tm + 7200 else p.invc_tm + 10800 end else p.invc_tm end as tm_ESTAdjusted                             ,p.sold_qty                                                                                                                                                                                                                                                                                                                      FROM ntl_prd_secvm.pos_trans_v as p  JOIN  ntl_prd_allvm.cust_acct_dly_hist_v AS ca         ON p.cust_id = ca.cust_id       AND p.acct_num = ca.acct_num AND p.pymnt_dt BETWEEN ca.eff_dt AND ca.exp_dt                                        JOIN  ntl_prd_secvm.item_v as b                              ON p.item_cd = b.item_cd       AND p.sor_id = b.sor_id           AND p.region_cd = b.region_cd                                   AND b.item_cd LIKE ANY ('FRU%','CLNR%')                                       Left JOIN ntl_prd_allvm.outlet_v as o            ON p.sls_outlet_id = o.sls_outlet_id  AND p.sor_id = o.sor_id                                           Left  join ntl_prd_allvm.master_location_v as ml on o.master_loc_cd = ml.master_loc_cd                                                  left join ntl_prd_allvm.zip_v z on ml.zip5_cd = z.zip5_cd                                                                  left outer join ntl_prd_qmtbls.mrs_dst as dst on p.pymnt_dt = dst.begindate                                                                                         Left JOIN ntl_prd_allvm.market_v as ms  ON o.sls_outlet_mkt_cd = ms.mkt_cd                  Left JOIN ntl_prd_allvm.market_v as mc  ON ca.sor_id = mc.sor_id AND ca.mkt_cd = mc.mkt_cd   left join (select  au.nm_first || ' ' || au.nm_last as name ,au.acss_user_id ,au.hr_employee_id ,au.eff_dt ,au.exp_dt ,case when acc.acss_call_ctr_desc in ('NE Columbia SC 2', 'NE Columbia SC') then 'NE Columbia'  else acc.acss_call_ctr_desc end as center ,case when acc.acss_call_ctr_desc='HQ AFNI Tucson_NW VZW.COM' then 'VZW.COM' when acc.acss_call_ctr_desc='HQ AFNI Tucson_NW WDTS' then 'VZW.COM' when acc.acss_call_ctr_desc='NE Columbia SC 2' then 'SC' when acc.acss_call_ctr_desc='S AFNI Opelika - VZW.COM' then 'VZW.COM' when acc.acss_call_ctr_desc='S Little Rock AR 2' then 'AR' else substr(acc.acss_call_ctr_desc,character_length(trim(acc.acss_call_ctr_desc))-1,2) end as state ,coalesce(case  when acc.acss_area_cd='NM' then 'Northeast'  when acc.acss_area_cd='MW' then 'Midwest' when acc.acss_area_cd='SO' then 'South' when acc.acss_area_cd='WE' then 'West' else acc.acss_area_cd end,substr(acc.acss_call_ctr_desc,1,2)) as area_cd          from ntl_prd_allvm.ACSS_USER_DLY_HIST_V as  au                  join ntl_prd_allvm.acss_call_center_v acc on au.acss_call_ctr_cd=acc.acss_call_ctr_cd         group by 1,2,3,4,5,6,7,8) as au                  on p.acss_user_id = au.acss_user_id and p.pymnt_dt between au.eff_dt and au.exp_dt                                                               WHERE                                                  p.pymnt_dt between '2012-07-01' and '2012-07-31' AND p.sold_qty > 0      and (b.IA_ITEM_GROUP_CD like '%DATA%' OR b.IA_ITEM_GROUP_CD like '%PHONE%' OR b.IA_ITEM_GROUP_CD like '%VCP%' )        AND p.cust_id IS NOT NULL AND COALESCE (p.refund_applied_ind, 'E') <> 'R'      qualify row_number() over (partition by p.cust_id, p.cust_line_seq_id, p.pymnt_dt order by p.cust_id, p.cust_line_seq_id, p.pymnt_dt) = 1  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28                                                       )                                                                 WITH DATA                                          PRIMARY INDEX (sor_id, clnr_mth, sls_dist_chnl_type_cd, sls_outlet_id, cust_area_desc, cust_region_desc, cust_area_cd, invc_num, invc_line_num, cust_id, cust_line_seq_id, mtn, pymnt_dt)                                              ON COMMIT PRESERVE ROWS;	TERADATA	HABERER	00:00:00	00:00:00	17885
10/05/2012	09:56:18	NTL_PRD_ALLVM	00:00:00	0	3807		CREATE VOLATILE TABLE clnr_trans_vt                                         AS(SELECT                                                 TRIM(EXTRACT(MONTH FROM p.pymnt_dt))||'-'||TRIM(EXTRACT(YEAR FROM p.pymnt_dt)) CLNR_MTH ,p.sor_id ,ms.area_desc as sls_area_desc   ,ms.region_desc as sls_region_desc ,o.sls_dist_chnl_type_cd ,p.sls_outlet_id ,coalesce(case when o.sls_dist_chnl_type_cd = 'NC' and o.sls_outlet_nm like '%CUST%' then au.center  when o.sls_dist_chnl_type_cd = 'NC' and o.sls_outlet_nm like '%VND %'  Then au.center  else o.sls_outlet_nm end, 'Unknown') as Outlet ,p.store_num ,p.pos_src_id            ,p.cust_area_cd       ,p.netace_user_id ,p.acss_user_id        ,p.invc_num                             ,p.invc_line_num ,mc.area_desc as cust_area_desc ,mc.region_desc as cust_region_desc                     ,p.cust_id                                 ,p.cust_line_seq_id                  ,p.mtn ,p.prod_nm                               ,p.pymnt_dt ,p.invc_dt ,p.invc_tm ,ml.zip5_cd ,ml.state_cd ,z.tm_zone ,case when z.tm_zone = 'Central'  then p.invc_tm + 3600 when z.tm_zone = 'Mountain' and ml.state_cd <> 'AZ' then p.invc_tm + 7200 when z.tm_zone = 'Pacific' then p.invc_tm + 10800 when z.tm_zone = 'Hawaii' then  case when p.pymnt_dt between dst.begindate and dst.enddate then p.invc_tm + 18000 else p.invc_tm + 21600 end when ml.state_cd='AZ' then  case when p.pymnt_dt between dst.begindate and dst.enddate then p.invc_tm + 7200 else p.invc_tm + 10800 end else p.invc_tm end as tm_ESTAdjusted                             ,p.sold_qty                                                                                                                                                                                                                                                                                                                      FROM ntl_prd_secvm.pos_trans_v as p  JOIN ntl_prd_secvm.cust_acct_dly_hist_v AS ca         ON p.cust_id = ca.cust_id       AND p.acct_num = ca.acct_num AND p.pymnt_dt BETWEEN ca.eff_dt AND ca.exp_dt                                        JOIN ntl_prd_allvm.item_v as b                              ON p.item_cd = b.item_cd       AND p.sor_id = b.sor_id           AND p.region_cd = b.region_cd                                   AND b.item_cd LIKE ANY ('FRU%','CLNR%')                                       Left JOIN ntl_prd_allvm.outlet_v as o            ON p.sls_outlet_id = o.sls_outlet_id  AND p.sor_id = o.sor_id                                           Left  join ntl_prd_allvm.master_location_v as ml on o.master_loc_cd = ml.master_loc_cd                                                  left join ntl_prd_allvm.zip_v z on ml.zip5_cd = z.zip5_cd                                                                  left outer join ntl_prd_qmtbls.mrs_dst as dst on p.pymnt_dt = dst.begindate                                                                                         Left JOIN ntl_prd_allvm.market_v as ms  ON o.sls_outlet_mkt_cd = ms.mkt_cd                  Left JOIN ntl_prd_allvm.market_v as mc  ON ca.sor_id = mc.sor_id AND ca.mkt_cd = mc.mkt_cd   left join (select  au.nm_first || ' ' || au.nm_last as name ,au.acss_user_id ,au.hr_employee_id ,au.eff_dt ,au.exp_dt ,case when acc.acss_call_ctr_desc in ('NE Columbia SC 2', 'NE Columbia SC') then 'NE Columbia'  else acc.acss_call_ctr_desc end as center ,case when acc.acss_call_ctr_desc='HQ AFNI Tucson_NW VZW.COM' then 'VZW.COM' when acc.acss_call_ctr_desc='HQ AFNI Tucson_NW WDTS' then 'VZW.COM' when acc.acss_call_ctr_desc='NE Columbia SC 2' then 'SC' when acc.acss_call_ctr_desc='S AFNI Opelika - VZW.COM' then 'VZW.COM' when acc.acss_call_ctr_desc='S Little Rock AR 2' then 'AR' else substr(acc.acss_call_ctr_desc,character_length(trim(acc.acss_call_ctr_desc))-1,2) end as state ,coalesce(case  when acc.acss_area_cd='NM' then 'Northeast'  when acc.acss_area_cd='MW' then 'Midwest' when acc.acss_area_cd='SO' then 'South' when acc.acss_area_cd='WE' then 'West' else acc.acss_area_cd end,substr(acc.acss_call_ctr_desc,1,2)) as area_cd          from ntl_prd_allvm.ACSS_USER_DLY_HIST_V as  au                  join ntl_prd_allvm.acss_call_center_v acc on au.acss_call_ctr_cd=acc.acss_call_ctr_cd         group by 1,2,3,4,5,6,7,8) as au                  on p.acss_user_id = au.acss_user_id and p.pymnt_dt between au.eff_dt and au.exp_dt                                                               WHERE                                                  p.pymnt_dt between '2012-07-01' and '2012-07-31' AND p.sold_qty > 0      and (b.IA_ITEM_GROUP_CD like '%DATA%' OR b.IA_ITEM_GROUP_CD like '%PHONE%' OR b.IA_ITEM_GROUP_CD like '%VCP%' )        AND p.cust_id IS NOT NULL AND COALESCE (p.refund_applied_ind, 'E') <> 'R'      qualify row_number() over (partition by p.cust_id, p.cust_line_seq_id, p.pymnt_dt order by p.cust_id, p.cust_line_seq_id, p.pymnt_dt) = 1  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28                                                       )                                                                 WITH DATA                                          PRIMARY INDEX (sor_id, clnr_mth, sls_dist_chnl_type_cd, sls_outlet_id, cust_area_desc, cust_region_desc, cust_area_cd, invc_num, invc_line_num, cust_id, cust_line_seq_id, mtn, pymnt_dt)                                              ON COMMIT PRESERVE ROWS;	TERADATA	HABERER	00:00:00	00:00:00	17884
10/05/2012	08:52:34	NTL_PRD_ALLVM	00:01:52	2415			select Distinct cal.mtn, cal.area_cd   from ntl_prd_allvm.cust_acct_line_dly_hist_v as cal  where '2012-09-28' BETWEEN cal.eff_dt AND cal.exp_dt   and mtn in ('2012070514', '2012323099', '2012480610', '2012484392', '2012815267', '2013062072', '2013414753', '2013418627', '2013645879', '2013907700', '2013966246', '2014003247', '2014012179', '2014031919', '2014526914', '2014583189', '2015433201', '2016150316', '2016153831', '2016155752', '2016184537', '2016798947', '2 ...	TERADATA	HABERER	00:01:42	00:00:10	17883
10/05/2012	08:50:19	NTL_PRD_ALLVM	00:00:56	3676			select cal.mtn, cal.area_cd   from ntl_prd_allvm.cust_acct_line_dly_hist_v as cal  where '2012-09-27' BETWEEN cal.eff_dt AND cal.exp_dt   and mtn in ('2012070514', '2012323099', '2012480610', '2012484392', '2012815267', '2013062072', '2013414753', '2013418627', '2013645879', '2013907700', '2013966246', '2014003247', '2014012179', '2014031919', '2014526914', '2014583189', '2015433201', '2016150316', '2016153831', '2016155752', '2016184537', '2016798947', '2016943117 ...	TERADATA	HABERER	00:00:52	00:00:04	17882
10/05/2012	08:49:01	NTL_PRD_ALLVM	00:02:11	0			select cal.mtn, cal.area_cd   from ntl_prd_allvm.cust_acct_line_dly_hist_v as cal  where '2012-09-01' BETWEEN cal.eff_dt AND cal.exp_dt   and mtn in ('2012070514', '2012323099', '2012480610', '2012484392', '2012815267', '2013062072', '2013414753', '2013418627', '2013645879', '2013907700', '2013966246', '2014003247', '2014012179', '2014031919', '2014526914', '2014583189', '2015433201', '2016150316', '2016153831', '2016155752', '2016184537', '2016798947', '2016943117 ...	TERADATA	HABERER	00:02:11	00:00:00	17881
10/05/2012	08:46:34	NTL_PRD_ALLVM	00:00:01	0	3807		select mtn, area_cd   from ntl_prd_allvm.cust_acct_line_dly_hist_v  where '2012-09-01' BETWEEN cal.eff_dt AND cal.exp_dt   and mtn in ('2012070514', '2012323099', '2012480610', '2012484392', '2012815267', '2013062072', '2013414753', '2013418627', '2013645879', '2013907700', '2013966246', '2014003247', '2014012179', '2014031919', '2014526914', '2014583189', '2015433201', '2016150316', '2016153831', '2016155752', '2016184537', '2016798947', '2016943117', '2016966150 ...	TERADATA	HABERER	00:00:01	00:00:00	17880
10/05/2012	08:42:05	NTL_PRD_ALLVM	00:00:14	3720			select mtn, area_cd   from cust_acct_line_v  where mtn in ('2012070514', '2012323099', '2012480610', '2012484392', '2012815267', '2013062072', '2013414753', '2013418627', '2013645879', '2013907700', '2013966246', '2014003247', '2014012179', '2014031919', '2014526914', '2014583189', '2015433201', '2016150316', '2016153831', '2016155752', '2016184537', '2016798947', '2016943117', '2016966150', '2017095199', '2017246565', '2017417516', '2017834002', '2018039388', ...	TERADATA	HABERER	00:00:11	00:00:03	17879
10/05/2012	08:37:00	NTL_PRD_ALLVM	00:00:18	100			select top 100 *  from cust_acct_line_v	TERADATA	HABERER	00:00:17	00:00:01	17878
10/04/2012	13:56:30	NTL_PRD_ALLVM	00:05:15	6454			CREATE VOLATILE TABLE Repeat_Reporting_EMH1 AS (SELECT      acc.acss_call_ctr_desc,      acc.acss_call_ctr_cd,      ac.sor_id,      ac.acss_call_type_cd,     acc.acss_area_cd AS ctr_area,      acc.acss_call_ctr_type,      ac.cust_id,      ac.cust_line_seq_id,          ac.acct_num,      ac.mtn,      ac.acss_user_id,      ac.acss_call_dt,          ac.acss_call_tm,           (ac.call_disconnect_tm - ac.call_start_tm) HOUR TO SECOND (0) AS call_duration_tm,      COALESCE(sed.departmenttype,'Other') depttype,           COALESCE(sed.departmentgroup, 'Other') as dept_group,          CASE  WHEN acc.acss_call_ctr_time_zn LIKE 'C%' THEN                       ac.acss_call_tm + INTERVAL '1' HOUR                          WHEN acc.acss_call_ctr_time_zn LIKE 'M%' THEN               ac.acss_call_tm + INTERVAL '2' HOUR                          WHEN acc.acss_call_ctr_time_zn LIKE 'P%' THEN                 ac.acss_call_tm +INTERVAL '3' HOUR                            WHEN acc.acss_call_ctr_time_zn LIKE 'H%' THEN                ac.acss_call_tm + INTERVAL '5' HOUR                           ELSE ac.acss_call_tm         END acss_call_ad,      CAST(          ac.acss_call_dt ||          ' '             ||          CAST(acss_call_ad AS CHAR(8)) AS TIMESTAMP(0)      ) acss_dt_tm,      ad.acss_dept_desc,      ad.acss_dept_id,      ac.acss_call_id,      ac.area_cd,      RANK() OVER (PARTITION BY cust_id, cust_line_seq_id          ORDER BY ac.acss_call_dt, acss_call_ad, acss_call_id) rnk  FROM ntl_prd_allvm.acss_call_v AS ac  JOIN sys_calendar.calendar AS z        ON calendar_date= DATE   JOIN ntl_prd_allvm.acss_call_center_v AS acc      ON ac.acss_call_ctr_cd = acc.acss_call_ctr_cd  JOIN ntl_prd_allvm.acss_user_v AS au      ON ac.acss_user_id = au.acss_user_id  JOIN ntl_prd_allvm.acss_dept_v AS ad      ON ac.acss_dept_id = ad.acss_dept_id  LEFT JOIN ntl_prd_qmtbls.emh_eccr_dep AS sed    ON ad.acss_dept_id = sed.acssdeptid  LEFT JOIN                  (SELECT a.acss_call_dt,a.acss_call_ctr_cd, a.acss_dept_id FROM                  ntl_prd_allvm.acss_call_v  as a                                  JOIN sys_calendar.calendar AS z                                                                        ON calendar_date= DATE                                   WHERE                  a.acss_call_dt BETWEEN (DATE-(2)) AND (DATE-(2))                   AND a.acss_call_type_cd = '1'                  GROUP BY 1,2,3) r  ON          ac.acss_call_dt = r.acss_call_dt          AND ac.acss_call_ctr_cd = r.acss_call_ctr_cd          AND ac.acss_dept_id = r.acss_dept_id  WHERE ac.acss_call_dt BETWEEN (DATE-(2)) AND (DATE-(2))   AND COALESCE(sed.departmenttype,'Other') <> 'NA'  AND (      (ac.acss_call_type_cd IN ('1','7')) OR      (          ac.acss_call_type_cd = '3'          AND acc.acss_call_ctr_type = 'O'          AND ad.acss_dept_desc NOT LIKE '%offline%'          AND r.acss_dept_id IS NULL ))  ) WITH DATA PRIMARY INDEX (cust_id, cust_line_seq_id, acss_call_dt, acss_call_id, rnk) ON COMMIT PRESERVE ROWS;   CREATE TABLE NTL_PRD_QMTBLS.Repeat_Reporting_EMH21  AS  (  SELECT      a.sor_id,      a.acss_call_id,      a.acss_call_type_cd,      a.ctr_area,      a.acss_call_ctr_type,      m.area_cd,      m.region_desc,      a.cust_id,      a.cust_line_seq_id,      a.mtn,      a.acss_call_dt,          a.acss_call_ad,          a.acss_call_tm,           a.call_duration_tm,      a.rnk,      a.acss_dept_desc as initial_dept_desc,      a.acss_dept_id,      a.acss_user_id,      a.acss_call_ctr_desc,      a.acss_call_ctr_cd,      a.depttype AS orgtype,          a.dept_group as org_dept_group,      b.acss_call_id AS repeat_call_id,      b.acss_dept_desc AS repeat_dept_desc,      b.acss_dept_id AS repeat_dept_id,          b.acss_user_id AS repeat_user_id,          b.acss_call_ctr_desc AS repeat_call_ctr_desc,      b.acss_call_ctr_cd AS repeat_ctr_cd,      b.acss_call_dt AS repeat_dt,          b.acss_call_ad AS repeat_call_ad,         b.acss_call_tm as repeat_call_tm,           b.call_duration_tm as repeat_call_duration_tm,      b.rnk AS repeat_rnk,      b.depttype AS reptype,          b.dept_group as rpt_dept_group,      CASE WHEN b.acss_dt_tm IS NOT NULL THEN        ((b.acss_dt_tm - a.acss_dt_tm) DAY(4) TO MINUTE ) END tsdiff,      CASE WHEN b.acss_dt_tm IS NOT NULL THEN        (EXTRACT(HOUR FROM tsdiff) * 60)        + EXTRACT(MINUTE FROM tsdiff)        + (CAST((CAST ((tsdiff) AS INTERVAL DAY)) AS INTEGER) * 1440) END min_diff  FROM Repeat_Reporting_EMH1 AS a  JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt                 JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)       INNER JOIN Repeat_Reporting_EMH1 AS b          ON  a.cust_id = b.cust_id          AND a.cust_line_seq_id = b.cust_line_seq_id                  AND a.acss_call_dt = b.acss_call_dt                       AND b.rnk = a.rnk + 1          AND b.acss_call_id <> a.acss_call_id                  --AND ( b.acss_call_ad -  a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00'              LEFT JOIN ntl_prd_allvm.acss_call_center_v AS acc      ON b.acss_call_ctr_cd = acc.acss_call_ctr_cd  ) WITH DATA PRIMARY INDEX( sor_id, acss_call_id, acss_call_type_cd, ctr_area, acss_call_ctr_type, area_cd, region_desc, cust_id, cust_line_seq_id, mtn, acss_call_dt, acss_call_ad, acss_call_tm, call_duration_tm, rnk, initial_dept_desc, acss_dept_id, acss_user_id, acss_call_ctr_desc, acss_call_ctr_cd, orgtype, org_dept_group, repeat_call_id, repeat_dept_desc, repeat_dept_id, repeat_user_id, repeat_call_ctr_desc, repeat_ctr_cd, repeat_dt, repeat_call_ad, repeat_call_tm, repeat_call_duration_tm, repeat_rnk, reptype, rpt_dept_group, tsdiff, min_diff);  select a.acss_call_ctr_desc, hr1.nm_last || ', ' || hr1.nm_first AS  AD_Nm,  hr2.nm_last || ', ' || hr2.nm_first AS Supv_Nm,    u.nm_last||', '||u.nm_first AS First_Rep_nm,  a.initial_dept_desc,  a.acss_user_id, a.mtn, a.cust_id, a.area_cd, a.region_desc, CASE WHEN cal.Device_type_cd LIKE '%4GS%'  THEN cal.device_prod_nm  ELSE cal.prod_nm END AS Device_Nm, dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, a.orgtype, a.acss_call_dt, a.acss_call_ad, a.acss_call_tm, a.call_duration_tm, a.repeat_call_ctr_desc, u1.nm_last||', '||u1.nm_first AS Repeat_Rep_nm,  a.repeat_dept_desc, a.reptype, a.repeat_dt, a.repeat_call_ad, a.repeat_call_tm, a.repeat_call_duration_tm, a.tsdiff, a.min_diff, CASE WHEN (a.repeat_call_ad - a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00' THEN  'Y' ELSE 'N' END AS Rpts_2hrs_and_Under   FROM NTL_PRD_QMTBLS.Repeat_Reporting_EMH21 AS a  JOIN sys_calendar.calendar AS z   ON calendar_date= DATE   JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt       LEFT JOIN  ntl_prd_allvm.device_dp_map_v AS dm                     ON (CASE WHEN cal.Device_type_cd LIKE '%4GS%' THEN cal.device_prod_nm ELSE cal.prod_nm END) = dm.prod_nm                JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)  LEFT JOIN ntl_prd_qmtbls.stm_eccr_area AS s    ON a.acss_call_ctr_cd = s.acsscallcentercd    AND a.acss_dept_id = s.acssdeptid      Join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id = u.acss_user_id    JOIN ntl_prd_allvm.hr_employee_v AS hr  ON u.hr_employee_id = hr.emp_id    LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr2              ON hr.SUPER_ID_LVL2_EMP_ID = hr2.emp_id                     LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr1           ON hr.SUPER_ID_LVL1_EMP_ID = hr1.emp_id   Join ntl_prd_allvm.acss_user_v AS u1  on a.repeat_user_id = u1.acss_user_id  WHERE acss_call_dt BETWEEN '2012-10-01' AND ADD_MONTHS('2012-10-01',1)-1 and a.orgtype IN ('CS','WDTS')  and a.reptype IN ('CS','WDTS')  and a.org_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.rpt_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.acss_call_ctr_desc IN('NE Columbia SC',  'NE Huntsville AL',  'NE Hanover MD',  'NE Rochester NY',  'NE Charleston SC',  'NE Charlotte NC',  'NE Wallingford CT',  'NE Wilmington NC',  'NE Bangor ME',  'NE Columbia SC 2')    GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29 ORDER BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29;  DROP TABLE Repeat_Reporting_EMH1; DROP TABLE NTL_PRD_QMTBLS. Repeat_Reporting_EMH21;	TERADATA	HABERER	00:04:33	00:00:42	17877
10/04/2012	13:46:32	NTL_PRD_ALLVM	00:03:11	68991			CREATE VOLATILE TABLE clnr_trans_EH_RT                    AS(SELECT                                                 ms.area_desc as sls_area_desc   ,ms.region_desc as sls_region_desc ,o.sls_dist_chnl_type_cd ,p.sls_outlet_id ,coalesce(case when o.sls_dist_chnl_type_cd = 'NC' and o.sls_outlet_nm like '%CUST%' then au.center  when o.sls_dist_chnl_type_cd = 'NC' and o.sls_outlet_nm like '%VND %'  Then au.center  else o.sls_outlet_nm end, 'Unknown') as Outlet ,p.store_num ,p.pos_src_id            ,p.cust_area_cd       ,p.netace_user_id ,p.acss_user_id   ,coalesce(p.acss_user_id, p.netace_user_id) as user_id          ,p.invc_num                             ,p.invc_line_num ,mc.area_desc as cust_area_desc ,mc.region_desc as cust_region_desc                     ,p.cust_id                                 ,p.cust_line_seq_id                  ,p.mtn ,p.prod_nm                               ,p.pymnt_dt ,ml.zip5_cd ,ml.state_cd ,z.tm_zone ,p.invc_dt ,p.invc_tm    ,case when z.tm_zone = 'Central'  then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((1) As interval hour) when z.tm_zone = 'Mountain' and ml.state_cd <> 'AZ' then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((2) As interval hour) when z.tm_zone = 'Pacific' then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((3) As interval hour) when z.tm_zone = 'Hawaii' then  case when p.pymnt_dt between dst.begindate and dst.enddate then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((5) As interval hour) else      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((6) As interval hour) end when ml.state_cd='AZ' then  case when p.pymnt_dt between dst.begindate and dst.enddate then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((2) As interval hour) else      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((3) As interval hour) end Else cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second) end as OrderDateTime_ETAdjusted                             ,p.sold_qty                                                                                                                                                                                                                                                                                                                           FROM ntl_prd_allvm.pos_trans_v as p  JOIN ntl_prd_allvm.cust_acct_dly_hist_v AS ca         ON p.cust_id = ca.cust_id       AND p.acct_num = ca.acct_num AND p.pymnt_dt BETWEEN ca.eff_dt AND ca.exp_dt                                        JOIN ntl_prd_allvm.item_v as b                              ON p.item_cd = b.item_cd       AND p.sor_id = b.sor_id           AND p.region_cd = b.region_cd              AND b.item_cd LIKE ANY ('FRU%','CLNR%')                                            Left JOIN ntl_prd_allvm.outlet_v as o            ON p.sls_outlet_id = o.sls_outlet_id  AND p.sor_id = o.sor_id                                                  Left  join ntl_prd_allvm.master_location_v as ml on o.master_loc_cd = ml.master_loc_cd                                                  left join ntl_prd_allvm.zip_v z on ml.zip5_cd = z.zip5_cd                                                                  left outer join ntl_prd_qmtbls.mrs_dst as dst on p.pymnt_dt = dst.begindate  Left JOIN ntl_prd_allvm.market_v as ms  ON o.sls_outlet_mkt_cd = ms.mkt_cd                  Left JOIN ntl_prd_allvm.market_v as mc  ON ca.sor_id = mc.sor_id AND ca.mkt_cd = mc.mkt_cd   left join (select  au.nm_first || ' ' || au.nm_last as name ,au.acss_user_id ,au.hr_employee_id ,au.eff_dt ,au.exp_dt ,case when acc.acss_call_ctr_desc in ('NE Columbia SC 2', 'NE Columbia SC') then 'NE Columbia'  else acc.acss_call_ctr_desc end as center ,case when acc.acss_call_ctr_desc='HQ AFNI Tucson_NW VZW.COM' then 'VZW.COM' when acc.acss_call_ctr_desc='HQ AFNI Tucson_NW WDTS' then 'VZW.COM' when acc.acss_call_ctr_desc='NE Columbia SC 2' then 'SC' when acc.acss_call_ctr_desc='S AFNI Opelika - VZW.COM' then 'VZW.COM' when acc.acss_call_ctr_desc='S Little Rock AR 2' then 'AR' else substr(acc.acss_call_ctr_desc,character_length(trim(acc.acss_call_ctr_desc))-1,2) end as state ,coalesce(case  when acc.acss_area_cd='NM' then 'Northeast'  when acc.acss_area_cd='MW' then 'Midwest' when acc.acss_area_cd='SO' then 'South' when acc.acss_area_cd='WE' then 'West' else acc.acss_area_cd end,substr(acc.acss_call_ctr_desc,1,2)) as area_cd          from ntl_prd_allvm.ACSS_USER_DLY_HIST_V as  au                  join ntl_prd_allvm.acss_call_center_v acc on au.acss_call_ctr_cd=acc.acss_call_ctr_cd         group by 1,2,3,4,5,6,7,8) as au                  on p.acss_user_id = au.acss_user_id and p.pymnt_dt between au.eff_dt and au.exp_dt                                                               WHERE                                              p.pymnt_dt between '2012-07-01' and '2012-07-31' AND p.sold_qty > 0      and (b.IA_ITEM_GROUP_CD like '%DATA%' OR b.IA_ITEM_GROUP_CD like '%PHONE%' OR b.IA_ITEM_GROUP_CD like '%VCP%' )        AND p.cust_id IS NOT NULL AND COALESCE (p.refund_applied_ind, 'E') <> 'R'      qualify row_number() over (partition by p.cust_id, p.cust_line_seq_id, p.pymnt_dt order by p.cust_id, p.cust_line_seq_id, p.pymnt_dt) = 1                                                   )                                                                 WITH DATA                                          PRIMARY INDEX (sls_dist_chnl_type_cd, sls_outlet_id, cust_area_desc, cust_region_desc, cust_area_cd, invc_num, invc_line_num, cust_id, cust_line_seq_id, mtn, pymnt_dt)                                              ON COMMIT PRESERVE ROWS;                                                                    CREATE VOLATILE TABLE clnr_calls_EH_RT                                         AS(SELECT c.sls_area_desc   ,c.sls_region_desc                                                 ,c.sls_outlet_id ,c.cust_area_desc ,c.cust_region_desc   ,c.pymnt_dt ,c.invc_dt ,c.invc_tm ,c.OrderDateTime_ETAdjusted         ,c.acss_user_id as sls_acss_user_id ,c.user_id as sls_user_id  ,a.sor_id ,c.prod_nm ,a.mtn ,a.cust_id ,a.cust_line_seq_id ,CASE WHEN cc.acss_call_ctr_desc IN ('NE Columbia SC 2', 'NE Columbia SC') THEN 'NE Columbia'             ELSE cc.acss_call_ctr_desc END AS Center             ,a.acss_user_id        ,ad.acss_dept_desc              ,a.acss_call_dt   ,a.acss_call_id   ,a.acss_call_tm ,case when cc.acss_call_ctr_time_zn = 'EST' then cast(a.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) - interval '3' hour   when cc.acss_call_ctr_time_zn = 'EDT' then cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) - interval '3' hour   when cc.acss_call_ctr_time_zn = 'CST' then cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) - interval '2' hour   when cc.acss_call_ctr_time_zn = 'CDT' then cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) - interval '2' hour   when cc.acss_call_ctr_time_zn = 'MST' then cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) - interval '1' hour   when cc.acss_call_ctr_time_zn = 'MDT' then cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) - interval '1' hour   else cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6))   End As CallDateTime_ETAdjusted                                                                                                                         FROM ntl_prd_allvm.acss_call_v as a  left outer join ntl_prd_qmtbls.mrs_dst as dst   on a.acss_call_dt = dst.begindate                                            INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc          ON a.acss_call_ctr_cd = cc.acss_call_ctr_cd                                  INNER JOIN ntl_prd_allvm.acss_dept_v AS ad     ON a.acss_dept_id = ad.acss_dept_id   LEFT OUTER JOIN              (SELECT acss_call_dt,                          acss_call_ctr_cd,                     acss_dept_id                                            FROM ntl_prd_allvm.acss_call_v                 WHERE acss_call_dt BETWEEN '2012-07-01'                                                                                              AND ADD_MONTHS('2012-07-01', 1) + 32                   AND acss_call_type_cd = '1'                                                   GROUP BY 1,2,3                                                    ) AS R      ON  a.acss_call_dt = r.acss_call_dt                 AND a.acss_call_ctr_cd = r.acss_call_ctr_cd                 AND a.acss_dept_id = r.acss_dept_id   inner join clnr_trans_EH_RT as c   on a.cust_id = c.cust_id                           and a.cust_line_seq_id = c.cust_line_seq_id    and a.acss_call_dt between c.pymnt_dt and c.pymnt_dt + 32                                                                    WHERE  a.sor_id = 'v'        AND a.cust_line_seq_id IS NOT NULL          AND a.acss_call_dt BETWEEN  '2012-07-01' AND ADD_MONTHS('2012-07-01', 1) + 32   AND ((a.acss_call_type_cd IN ('1','7')) OR            (a.acss_call_type_cd = '3'               AND cc.acss_call_ctr_type = 'O'             AND ad.acss_dept_desc NOT LIKE '%offline%'    AND R.acss_dept_id IS NULL ))   group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21, 22, 23                                                 )                                                WITH DATA                                          PRIMARY INDEX (cust_id, cust_line_seq_id, acss_call_id, acss_call_dt, acss_call_tm)                                    ON COMMIT PRESERVE ROWS;   CREATE VOLATILE TABLE clnr_calls_EH_RT2                                        AS( Select sor_id ,mtn ,cust_id ,cust_line_seq_id ,Center             ,acss_user_id  ,sls_user_id       ,acss_dept_desc  ,acss_call_id   ,pymnt_dt ,invc_tm      , OrderDateTime_ETAdjusted       ,acss_call_dt   ,acss_call_tm , CallDateTime_ETAdjusted  ,CASE WHEN acss_call_id IS NULL THEN 'NO CALL FOUND' WHEN (CallDateTime_ETAdjusted  <= OrderDateTime_ETAdjusted) THEN 'CALL BEFORE CLNR' ELSE 'CALL AFTER CLNR' END AS when_call ,   (CallDateTime_ETAdjusted - OrderDateTime_ETAdjusted) DAY(4) TO SECOND As call_period    from clnr_calls_EH_RT  where sls_user_id <> acss_user_id and when_call <> 'CALL BEFORE CLNR'   group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16 )                                                WITH DATA                                          PRIMARY INDEX (mtn, cust_id, cust_line_seq_id, acss_call_id, acss_call_dt, pymnt_dt)                                    ON COMMIT PRESERVE ROWS;    --This was created to see multiple CLNR data CREATE VOLATILE TABLE clnr_count_EH_RT                                        AS( Select cust_id  ,cust_line_seq_id ,case when lines >='2' then 'Multiple Clnrs' When lines < '2' then 'Single Clnr'  else null end as clnr_line_count ,Lines  from (select cust_id ,cust_line_seq_id ,count(*) as lines  from clnr_trans_EH_RT   group by 1,2) as a  group by 1,2,3,4  )                                                WITH DATA                                          PRIMARY INDEX (cust_id, cust_line_seq_id)                                    ON COMMIT PRESERVE ROWS;   select  TRIM(EXTRACT(MONTH FROM a.OrderDateTime_ETAdjusted))||'-'||TRIM(EXTRACT(YEAR FROM a.OrderDateTime_ETAdjusted)) CLNR_MTH ,coalesce(a.cust_area_desc, 'Unknown') as cust_area_desc ,coalesce(a.cust_region_desc, 'Unknown') as cust_region_desc   ,a.sls_dist_chnl_type_cd ,a.sls_outlet_id ,a.Outlet ,a.prod_nm ,c.clnr_line_count ,count(distinct(a.cust_id||a.cust_line_seq_id||invc_num)) Clnr_Qty , Count(distinct(CASE WHEN Extract(Day from b.call_period) <'3' THEN b.acss_call_id Else Null END)) AS calls3                          , Count(distinct(CASE WHEN  Extract(Day from b.call_period) <'32' THEN b.acss_call_id Else Null END)) AS calls31                        from clnr_trans_EH_RT as a  left outer join clnr_calls_EH_RT2 as b on a.cust_id = b.cust_id and a.cust_line_seq_id = b.cust_line_seq_id AND b.acss_call_dt BETWEEN a.pymnt_dt AND a.pymnt_dt +31   left outer join clnr_count_EH_RT as c  on a.cust_id = c.cust_id and a.cust_line_seq_id = c.cust_line_seq_id  group by 1,2,3,4,5,6,7,8;   drop table clnr_trans_EH_RT; drop table clnr_calls_EH_RT;  drop table clnr_calls_EH_RT2; drop table clnr_count_EH_RT;	TERADATA	HABERER	00:01:13	00:01:58	17876
10/04/2012	13:41:35	NTL_PRD_ALLVM	00:00:03	0			drop table clnr_trans_EH_RT; drop table clnr_calls_EH_RT;  drop table clnr_calls_EH_RT2; drop table clnr_count_EH_RT;	TERADATA	HABERER	00:00:03	00:00:00	17875
10/04/2012	13:32:16	NTL_PRD_ALLVM	00:03:01	69002			CREATE VOLATILE TABLE clnr_trans_EH_RT                    AS(SELECT                                                 ms.area_desc as sls_area_desc   ,ms.region_desc as sls_region_desc ,o.sls_dist_chnl_type_cd ,p.sls_outlet_id ,coalesce(case when o.sls_dist_chnl_type_cd = 'NC' and o.sls_outlet_nm like '%CUST%' then au.center  when o.sls_dist_chnl_type_cd = 'NC' and o.sls_outlet_nm like '%VND %'  Then au.center  else o.sls_outlet_nm end, 'Unknown') as Outlet ,p.store_num ,p.pos_src_id            ,p.cust_area_cd       ,p.netace_user_id ,p.acss_user_id   ,coalesce(p.acss_user_id, p.netace_user_id) as user_id          ,p.invc_num                             ,p.invc_line_num ,mc.area_desc as cust_area_desc ,mc.region_desc as cust_region_desc                     ,p.cust_id                                 ,p.cust_line_seq_id                  ,p.mtn ,p.prod_nm                               ,p.pymnt_dt ,ml.zip5_cd ,ml.state_cd ,z.tm_zone ,p.invc_dt ,p.invc_tm    ,case when z.tm_zone = 'Central'  then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((1) As interval hour) when z.tm_zone = 'Mountain' and ml.state_cd <> 'AZ' then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((2) As interval hour) when z.tm_zone = 'Pacific' then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((3) As interval hour) when z.tm_zone = 'Hawaii' then  case when p.pymnt_dt between dst.begindate and dst.enddate then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((5) As interval hour) else      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((6) As interval hour) end when ml.state_cd='AZ' then  case when p.pymnt_dt between dst.begindate and dst.enddate then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((2) As interval hour) else      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((3) As interval hour) end Else cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second) end as OrderDateTime_ETAdjusted                             ,p.sold_qty                                                                                                                                                                                                                                                                                                                           FROM ntl_prd_allvm.pos_trans_v as p  JOIN ntl_prd_allvm.cust_acct_dly_hist_v AS ca         ON p.cust_id = ca.cust_id       AND p.acct_num = ca.acct_num AND p.pymnt_dt BETWEEN ca.eff_dt AND ca.exp_dt                                        JOIN ntl_prd_allvm.item_v as b                              ON p.item_cd = b.item_cd       AND p.sor_id = b.sor_id           AND p.region_cd = b.region_cd              AND b.item_cd LIKE ANY ('FRU%','CLNR%')                                            Left JOIN ntl_prd_allvm.outlet_v as o            ON p.sls_outlet_id = o.sls_outlet_id  AND p.sor_id = o.sor_id                                                  Left  join ntl_prd_allvm.master_location_v as ml on o.master_loc_cd = ml.master_loc_cd                                                  left join ntl_prd_allvm.zip_v z on ml.zip5_cd = z.zip5_cd                                                                  left outer join ntl_prd_qmtbls.mrs_dst as dst on p.pymnt_dt = dst.begindate  Left JOIN ntl_prd_allvm.market_v as ms  ON o.sls_outlet_mkt_cd = ms.mkt_cd                  Left JOIN ntl_prd_allvm.market_v as mc  ON ca.sor_id = mc.sor_id AND ca.mkt_cd = mc.mkt_cd   left join (select  au.nm_first || ' ' || au.nm_last as name ,au.acss_user_id ,au.hr_employee_id ,au.eff_dt ,au.exp_dt ,case when acc.acss_call_ctr_desc in ('NE Columbia SC 2', 'NE Columbia SC') then 'NE Columbia'  else acc.acss_call_ctr_desc end as center ,case when acc.acss_call_ctr_desc='HQ AFNI Tucson_NW VZW.COM' then 'VZW.COM' when acc.acss_call_ctr_desc='HQ AFNI Tucson_NW WDTS' then 'VZW.COM' when acc.acss_call_ctr_desc='NE Columbia SC 2' then 'SC' when acc.acss_call_ctr_desc='S AFNI Opelika - VZW.COM' then 'VZW.COM' when acc.acss_call_ctr_desc='S Little Rock AR 2' then 'AR' else substr(acc.acss_call_ctr_desc,character_length(trim(acc.acss_call_ctr_desc))-1,2) end as state ,coalesce(case  when acc.acss_area_cd='NM' then 'Northeast'  when acc.acss_area_cd='MW' then 'Midwest' when acc.acss_area_cd='SO' then 'South' when acc.acss_area_cd='WE' then 'West' else acc.acss_area_cd end,substr(acc.acss_call_ctr_desc,1,2)) as area_cd          from ntl_prd_allvm.ACSS_USER_DLY_HIST_V as  au                  join ntl_prd_allvm.acss_call_center_v acc on au.acss_call_ctr_cd=acc.acss_call_ctr_cd         group by 1,2,3,4,5,6,7,8) as au                  on p.acss_user_id = au.acss_user_id and p.pymnt_dt between au.eff_dt and au.exp_dt                                                               WHERE                                              p.pymnt_dt between '2012-07-01' and '2012-07-31' AND p.sold_qty > 0      and (b.IA_ITEM_GROUP_CD like '%DATA%' OR b.IA_ITEM_GROUP_CD like '%PHONE%' OR b.IA_ITEM_GROUP_CD like '%VCP%' )        AND p.cust_id IS NOT NULL AND COALESCE (p.refund_applied_ind, 'E') <> 'R'      qualify row_number() over (partition by p.cust_id, p.cust_line_seq_id, p.pymnt_dt order by p.cust_id, p.cust_line_seq_id, p.pymnt_dt) = 1                                                   )                                                                 WITH DATA                                          PRIMARY INDEX (sls_dist_chnl_type_cd, sls_outlet_id, cust_area_desc, cust_region_desc, cust_area_cd, invc_num, invc_line_num, cust_id, cust_line_seq_id, mtn, pymnt_dt)                                              ON COMMIT PRESERVE ROWS;                                                                    CREATE VOLATILE TABLE clnr_calls_EH_RT                                         AS(SELECT c.sls_area_desc   ,c.sls_region_desc                                                 ,c.sls_outlet_id ,c.cust_area_desc ,c.cust_region_desc   ,c.pymnt_dt ,c.invc_dt ,c.invc_tm ,c.OrderDateTime_ETAdjusted         ,c.acss_user_id as sls_acss_user_id ,c.user_id as sls_user_id  ,a.sor_id ,c.prod_nm ,a.mtn ,a.cust_id ,a.cust_line_seq_id ,CASE WHEN cc.acss_call_ctr_desc IN ('NE Columbia SC 2', 'NE Columbia SC') THEN 'NE Columbia'             ELSE cc.acss_call_ctr_desc END AS Center             ,a.acss_user_id        ,ad.acss_dept_desc              ,a.acss_call_dt   ,a.acss_call_id   ,a.acss_call_tm ,case   when cc.acss_call_ctr_time_zn = 'CST' then cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) + interval '1' hour   when cc.acss_call_ctr_time_zn = 'CDT' then cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) + interval '1' hour   when cc.acss_call_ctr_time_zn = 'MST' then cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) + interval '2' hour   when cc.acss_call_ctr_time_zn = 'MDT' then cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) + interval '2' hour   when cc.acss_call_ctr_time_zn = 'PST' then cast(a.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) + interval '3' hour   when cc.acss_call_ctr_time_zn = 'PDT' then cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) + interval '3' hour   else cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6))   End As CallDateTime_ETAdjusted                                                                                                                         FROM ntl_prd_allvm.acss_call_v as a  left outer join ntl_prd_qmtbls.mrs_dst as dst   on a.acss_call_dt = dst.begindate                                            INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc          ON a.acss_call_ctr_cd = cc.acss_call_ctr_cd                                  INNER JOIN ntl_prd_allvm.acss_dept_v AS ad     ON a.acss_dept_id = ad.acss_dept_id   LEFT OUTER JOIN              (SELECT acss_call_dt,                          acss_call_ctr_cd,                     acss_dept_id                                            FROM ntl_prd_allvm.acss_call_v                 WHERE acss_call_dt BETWEEN '2012-07-01'                                                                                              AND ADD_MONTHS('2012-07-01', 1) + 32                   AND acss_call_type_cd = '1'                                                   GROUP BY 1,2,3                                                    ) AS R      ON  a.acss_call_dt = r.acss_call_dt                 AND a.acss_call_ctr_cd = r.acss_call_ctr_cd                 AND a.acss_dept_id = r.acss_dept_id   inner join  clnr_trans_EH_RT as c   on a.cust_id = c.cust_id                           and a.cust_line_seq_id = c.cust_line_seq_id  --  and a.acss_call_dt between c.pymnt_dt and c.pymnt_dt + 32                                                                    WHERE  a.sor_id = 'v'        AND a.cust_line_seq_id IS NOT NULL          AND a.acss_call_dt BETWEEN  '2012-07-01' AND ADD_MONTHS('2012-07-01', 1) + 32   AND ((a.acss_call_type_cd IN ('1','7')) OR            (a.acss_call_type_cd = '3'               AND cc.acss_call_ctr_type = 'O'             AND ad.acss_dept_desc NOT LIKE '%offline%'    AND R.acss_dept_id IS NULL ))   group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21, 22, 23                                                 )                                                WITH DATA                                          PRIMARY INDEX (cust_id, cust_line_seq_id, acss_call_id, acss_call_dt, acss_call_tm)                                    ON COMMIT PRESERVE ROWS;   CREATE VOLATILE TABLE clnr_calls_EH_RT2                                        AS( Select sor_id ,mtn ,cust_id ,cust_line_seq_id ,Center             ,acss_user_id  ,sls_user_id       ,acss_dept_desc  ,acss_call_id   ,pymnt_dt ,invc_tm      , OrderDateTime_ETAdjusted       ,acss_call_dt   ,acss_call_tm , CallDateTime_ETAdjusted  ,CASE WHEN acss_call_id IS NULL THEN 'NO CALL FOUND' WHEN (CallDateTime_ETAdjusted  <= OrderDateTime_ETAdjusted) THEN 'CALL BEFORE CLNR' ELSE 'CALL AFTER CLNR' END AS when_call ,   (CallDateTime_ETAdjusted - OrderDateTime_ETAdjusted) DAY(4) TO SECOND As call_period    from clnr_calls_EH_RT  where sls_user_id <> acss_user_id and when_call <> 'CALL BEFORE CLNR'   group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16 )                                                WITH DATA                                          PRIMARY INDEX (mtn, cust_id, cust_line_seq_id, acss_call_id, acss_call_dt, pymnt_dt)                                    ON COMMIT PRESERVE ROWS;    --This was created to see multiple CLNR data CREATE VOLATILE TABLE clnr_count_EH_RT                                        AS( Select cust_id  ,cust_line_seq_id ,case when lines >='2' then 'Multiple Clnrs' When lines < '2' then 'Single Clnr'  else null end as clnr_line_count ,Lines  from (select cust_id ,cust_line_seq_id ,count(*) as lines  from clnr_trans_EH_RT   group by 1,2) as a  group by 1,2,3,4  )                                                WITH DATA                                          PRIMARY INDEX (cust_id, cust_line_seq_id)                                    ON COMMIT PRESERVE ROWS;   select  TRIM(EXTRACT(MONTH FROM a.OrderDateTime_ETAdjusted))||'-'||TRIM(EXTRACT(YEAR FROM a.OrderDateTime_ETAdjusted)) CLNR_MTH ,coalesce(a.cust_area_desc, 'Unknown') as cust_area_desc ,coalesce(a.cust_region_desc, 'Unknown') as cust_region_desc   ,a.sls_dist_chnl_type_cd ,a.sls_outlet_id ,a.Outlet ,a.prod_nm ,c.clnr_line_count ,count(distinct(a.cust_id||a.cust_line_seq_id||invc_num)) Clnr_Qty , Count(distinct(CASE WHEN Extract(Day from b.call_period) <'3' THEN b.acss_call_id Else Null END)) AS calls3                          , Count(distinct(CASE WHEN  Extract(Day from b.call_period) <'32' THEN b.acss_call_id Else Null END)) AS calls31                        from clnr_trans_EH_RT as a  left outer join clnr_calls_EH_RT2 as b on a.cust_id = b.cust_id and a.cust_line_seq_id = b.cust_line_seq_id AND b.acss_call_dt BETWEEN a.pymnt_dt AND a.pymnt_dt +31   left outer join clnr_count_EH_RT as c  on a.cust_id = c.cust_id and a.cust_line_seq_id = c.cust_line_seq_id  group by 1,2,3,4,5,6,7,8;   --drop table clnr_trans_EH_RT; --drop table clnr_calls_EH_RT;  --drop table clnr_calls_EH_RT2; --drop table clnr_count_EH_RT;	TERADATA	HABERER	00:02:37	00:00:24	17874
10/04/2012	13:28:13	NTL_PRD_ALLVM	00:00:02	0			drop table clnr_trans_EH_RT; drop table clnr_calls_EH_RT;  drop table clnr_calls_EH_RT2; drop table clnr_count_EH_RT;	TERADATA	HABERER	00:00:02	00:00:00	17873
10/04/2012	11:50:05	NTL_PRD_ALLVM	00:01:44	64447			CREATE VOLATILE TABLE clnr_trans_EH_RT                    AS(SELECT                                                 ms.area_desc as sls_area_desc   ,ms.region_desc as sls_region_desc ,o.sls_dist_chnl_type_cd ,p.sls_outlet_id ,coalesce(case when o.sls_dist_chnl_type_cd = 'NC' and o.sls_outlet_nm like '%CUST%' then au.center  when o.sls_dist_chnl_type_cd = 'NC' and o.sls_outlet_nm like '%VND %'  Then au.center  else o.sls_outlet_nm end, 'Unknown') as Outlet ,p.store_num ,p.pos_src_id            ,p.cust_area_cd       ,p.netace_user_id ,p.acss_user_id   ,coalesce(p.acss_user_id, p.netace_user_id) as user_id          ,p.invc_num                             ,p.invc_line_num ,mc.area_desc as cust_area_desc ,mc.region_desc as cust_region_desc                     ,p.cust_id                                 ,p.cust_line_seq_id                  ,p.mtn ,p.prod_nm                               ,p.pymnt_dt ,ml.zip5_cd ,ml.state_cd ,z.tm_zone ,p.invc_dt ,p.invc_tm    ,case when z.tm_zone = 'Central'  then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((1) As interval hour) when z.tm_zone = 'Mountain' and ml.state_cd <> 'AZ' then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((2) As interval hour) when z.tm_zone = 'Pacific' then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((3) As interval hour) when z.tm_zone = 'Hawaii' then  case when p.pymnt_dt between dst.begindate and dst.enddate then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((5) As interval hour) else      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((6) As interval hour) end when ml.state_cd='AZ' then  case when p.pymnt_dt between dst.begindate and dst.enddate then      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((2) As interval hour) else      cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second)    + cast((3) As interval hour) end Else cast(p.pymnt_dt AS timestamp(6))   + cast(p.invc_tm / 10000 AS interval hour)   + cast((p.invc_tm / 100) mod 100 AS interval minute)   + cast((p.invc_tm mod 100) AS interval second) end as OrderDateTime_ETAdjusted                             ,p.sold_qty                                                                                                                                                                                                                                                                                                                           FROM ntl_prd_allvm.pos_trans_v as p  JOIN ntl_prd_allvm.cust_acct_dly_hist_v AS ca         ON p.cust_id = ca.cust_id       AND p.acct_num = ca.acct_num AND p.pymnt_dt BETWEEN ca.eff_dt AND ca.exp_dt                                        JOIN ntl_prd_allvm.item_v as b                              ON p.item_cd = b.item_cd       AND p.sor_id = b.sor_id           AND p.region_cd = b.region_cd              AND b.item_cd LIKE ANY ('FRU%','CLNR%')                                            Left JOIN ntl_prd_allvm.outlet_v as o            ON p.sls_outlet_id = o.sls_outlet_id  AND p.sor_id = o.sor_id                                                  Left  join ntl_prd_allvm.master_location_v as ml on o.master_loc_cd = ml.master_loc_cd                                                  left join ntl_prd_allvm.zip_v z on ml.zip5_cd = z.zip5_cd                                                                  left outer join ntl_prd_qmtbls.mrs_dst as dst on p.pymnt_dt = dst.begindate  Left JOIN ntl_prd_allvm.market_v as ms  ON o.sls_outlet_mkt_cd = ms.mkt_cd                  Left JOIN ntl_prd_allvm.market_v as mc  ON ca.sor_id = mc.sor_id AND ca.mkt_cd = mc.mkt_cd   left join (select  au.nm_first || ' ' || au.nm_last as name ,au.acss_user_id ,au.hr_employee_id ,au.eff_dt ,au.exp_dt ,case when acc.acss_call_ctr_desc in ('NE Columbia SC 2', 'NE Columbia SC') then 'NE Columbia'  else acc.acss_call_ctr_desc end as center ,case when acc.acss_call_ctr_desc='HQ AFNI Tucson_NW VZW.COM' then 'VZW.COM' when acc.acss_call_ctr_desc='HQ AFNI Tucson_NW WDTS' then 'VZW.COM' when acc.acss_call_ctr_desc='NE Columbia SC 2' then 'SC' when acc.acss_call_ctr_desc='S AFNI Opelika - VZW.COM' then 'VZW.COM' when acc.acss_call_ctr_desc='S Little Rock AR 2' then 'AR' else substr(acc.acss_call_ctr_desc,character_length(trim(acc.acss_call_ctr_desc))-1,2) end as state ,coalesce(case  when acc.acss_area_cd='NM' then 'Northeast'  when acc.acss_area_cd='MW' then 'Midwest' when acc.acss_area_cd='SO' then 'South' when acc.acss_area_cd='WE' then 'West' else acc.acss_area_cd end,substr(acc.acss_call_ctr_desc,1,2)) as area_cd          from ntl_prd_allvm.ACSS_USER_DLY_HIST_V as  au                  join ntl_prd_allvm.acss_call_center_v acc on au.acss_call_ctr_cd=acc.acss_call_ctr_cd         group by 1,2,3,4,5,6,7,8) as au                  on p.acss_user_id = au.acss_user_id and p.pymnt_dt between au.eff_dt and au.exp_dt                                                               WHERE                                              p.pymnt_dt between '2012-08-01' and '2012-08-31' AND p.sold_qty > 0      and (b.IA_ITEM_GROUP_CD like '%DATA%' OR b.IA_ITEM_GROUP_CD like '%PHONE%' OR b.IA_ITEM_GROUP_CD like '%VCP%' )        AND p.cust_id IS NOT NULL AND COALESCE (p.refund_applied_ind, 'E') <> 'R'      qualify row_number() over (partition by p.cust_id, p.cust_line_seq_id, p.pymnt_dt order by p.cust_id, p.cust_line_seq_id, p.pymnt_dt) = 1                                                   )                                                                 WITH DATA                                          PRIMARY INDEX (sls_dist_chnl_type_cd, sls_outlet_id, cust_area_desc, cust_region_desc, cust_area_cd, invc_num, invc_line_num, cust_id, cust_line_seq_id, mtn, pymnt_dt)                                              ON COMMIT PRESERVE ROWS;                                                                    CREATE VOLATILE TABLE clnr_calls_EH_RT                                         AS(SELECT c.sls_area_desc   ,c.sls_region_desc                                                 ,c.sls_outlet_id ,c.cust_area_desc ,c.cust_region_desc   ,c.pymnt_dt ,c.invc_dt ,c.invc_tm ,c.OrderDateTime_ETAdjusted         ,c.acss_user_id as sls_acss_user_id ,c.user_id as sls_user_id  ,a.sor_id ,c.prod_nm ,a.mtn ,a.cust_id ,a.cust_line_seq_id ,CASE WHEN cc.acss_call_ctr_desc IN ('NE Columbia SC 2', 'NE Columbia SC') THEN 'NE Columbia'             ELSE cc.acss_call_ctr_desc END AS Center             ,a.acss_user_id        ,ad.acss_dept_desc              ,a.acss_call_dt   ,a.acss_call_id   ,a.acss_call_tm ,case   when cc.acss_call_ctr_time_zn = 'CST' then cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) + interval '1' hour   when cc.acss_call_ctr_time_zn = 'CDT' then cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) + interval '1' hour   when cc.acss_call_ctr_time_zn = 'MST' then cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) + interval '2' hour   when cc.acss_call_ctr_time_zn = 'MDT' then cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) + interval '2' hour   when cc.acss_call_ctr_time_zn = 'PST' then cast(a.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) + interval '3' hour   when cc.acss_call_ctr_time_zn = 'PDT' then cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6)) + interval '3' hour   else cast(A.ACSS_CALL_DT as TimeStamp(6))+ ((a.acss_call_tm - time '00:00:00') hour to second(6))   End As CallDateTime_ETAdjusted                                                                                                                         FROM ntl_prd_allvm.acss_call_v as a  left outer join ntl_prd_qmtbls.mrs_dst as dst   on a.acss_call_dt = dst.begindate                                            INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc          ON a.acss_call_ctr_cd = cc.acss_call_ctr_cd                                  INNER JOIN ntl_prd_allvm.acss_dept_v AS ad     ON a.acss_dept_id = ad.acss_dept_id   LEFT OUTER JOIN              (SELECT acss_call_dt,                          acss_call_ctr_cd,                     acss_dept_id                                            FROM ntl_prd_allvm.acss_call_v                 WHERE acss_call_dt BETWEEN '2012-08-01'                                                                                              AND ADD_MONTHS('2012-08-01', 1) + 32                   AND acss_call_type_cd = '1'                                                   GROUP BY 1,2,3                                                    ) AS R      ON  a.acss_call_dt = r.acss_call_dt                 AND a.acss_call_ctr_cd = r.acss_call_ctr_cd                 AND a.acss_dept_id = r.acss_dept_id   inner join  clnr_trans_EH_RT as c   on a.cust_id = c.cust_id                           and a.cust_line_seq_id = c.cust_line_seq_id  --  and a.acss_call_dt between c.pymnt_dt and c.pymnt_dt + 32                                                                    WHERE  a.sor_id = 'v'        AND a.cust_line_seq_id IS NOT NULL          AND a.acss_call_dt BETWEEN  '2012-08-01' AND ADD_MONTHS('2012-08-01', 1) + 32   AND ((a.acss_call_type_cd IN ('1','7')) OR            (a.acss_call_type_cd = '3'               AND cc.acss_call_ctr_type = 'O'             AND ad.acss_dept_desc NOT LIKE '%offline%'    AND R.acss_dept_id IS NULL ))   group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21, 22, 23                                                 )                                                WITH DATA                                          PRIMARY INDEX (cust_id, cust_line_seq_id, acss_call_id, acss_call_dt, acss_call_tm)                                    ON COMMIT PRESERVE ROWS;   CREATE VOLATILE TABLE clnr_calls_EH_RT2                                        AS( Select sor_id ,mtn ,cust_id ,cust_line_seq_id ,Center             ,acss_user_id  ,sls_user_id       ,acss_dept_desc  ,acss_call_id   ,pymnt_dt ,invc_tm      , OrderDateTime_ETAdjusted       ,acss_call_dt   ,acss_call_tm , CallDateTime_ETAdjusted  ,CASE WHEN acss_call_id IS NULL THEN 'NO CALL FOUND' WHEN (CallDateTime_ETAdjusted  <= OrderDateTime_ETAdjusted) THEN 'CALL BEFORE CLNR' ELSE 'CALL AFTER CLNR' END AS when_call ,   (CallDateTime_ETAdjusted - OrderDateTime_ETAdjusted) DAY(4) TO SECOND As call_period    from clnr_calls_EH_RT  where sls_user_id <> acss_user_id and when_call <> 'CALL BEFORE CLNR'   group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16 )                                                WITH DATA                                          PRIMARY INDEX (mtn, cust_id, cust_line_seq_id, acss_call_id, acss_call_dt, pymnt_dt)                                    ON COMMIT PRESERVE ROWS;    --This was created to see multiple CLNR data CREATE VOLATILE TABLE clnr_count_EH_RT                                        AS( Select cust_id  ,cust_line_seq_id ,case when lines >='2' then 'Multiple Clnrs' When lines < '2' then 'Single Clnr'  else null end as clnr_line_count ,Lines  from (select cust_id ,cust_line_seq_id ,count(*) as lines  from clnr_trans_EH_RT   group by 1,2) as a  group by 1,2,3,4  )                                                WITH DATA                                          PRIMARY INDEX (cust_id, cust_line_seq_id)                                    ON COMMIT PRESERVE ROWS;   select  TRIM(EXTRACT(MONTH FROM a.OrderDateTime_ETAdjusted))||'-'||TRIM(EXTRACT(YEAR FROM a.OrderDateTime_ETAdjusted)) CLNR_MTH ,coalesce(a.cust_area_desc, 'Unknown') as cust_area_desc ,coalesce(a.cust_region_desc, 'Unknown') as cust_region_desc   ,a.sls_dist_chnl_type_cd ,a.sls_outlet_id ,a.Outlet ,a.prod_nm ,c.clnr_line_count ,count(distinct(a.cust_id||a.cust_line_seq_id||invc_num)) Clnr_Qty , Count(distinct(CASE WHEN Extract(Day from b.call_period) <'3' THEN b.acss_call_id Else Null END)) AS calls3                          , Count(distinct(CASE WHEN  Extract(Day from b.call_period) <'32' THEN b.acss_call_id Else Null END)) AS calls31                        from clnr_trans_EH_RT as a  left outer join clnr_calls_EH_RT2 as b on a.cust_id = b.cust_id and a.cust_line_seq_id = b.cust_line_seq_id AND b.acss_call_dt BETWEEN a.pymnt_dt AND a.pymnt_dt +31   left outer join clnr_count_EH_RT as c  on a.cust_id = c.cust_id and a.cust_line_seq_id = c.cust_line_seq_id  group by 1,2,3,4,5,6,7,8;   --drop table clnr_trans_EH_RT; --drop table clnr_calls_EH_RT;  --drop table clnr_calls_EH_RT2; --drop table clnr_count_EH_RT;	TERADATA	HABERER	00:01:32	00:00:12	17872
10/03/2012	10:57:39	NTL_PRD_ALLVM	00:23:19	17383			CREATE VOLATILE TABLE SA_INUM_V AS (  select  a.INUM_Week  ,a.rpt_mnth  ,a.acss_mtn  ,a.sa_mtn  ,a.cust_id  ,a.cust_line_seq_id  ,a.call_start_dt    ,a.sa_start_tm  ,a.acss_start_tm  ,a.acss_user_id  ,a.acss_call_id  ,a.url_speech  ,a.inum  ,a.acss_call_type_cd  ,a.start_diff  ,a.row_num    from (SELECT   ((DATE-(day_of_week+6))(FORMAT 'MM-DD'))||' to '||((DATE-(day_of_week))(FORMAT 'MM-DD')) INUM_Week,  (acs.acss_call_dt - (EXTRACT(DAY FROM acs.acss_call_dt) - 1)) rpt_mnth  ,acs.mtn as acss_mtn  ,sa.mtn as sa_mtn  ,acs.cust_id  ,acs.cust_line_seq_id  ,acs.call_start_dt    ,sa.call_start_tm as sa_start_tm  ,acs.call_start_tm as acss_start_tm  ,acss_user_id  ,acs.acss_call_id  ,sa.url_speech  ,sa.inum  ,acs.acss_call_type_cd  ,ABS((sa_start_tm - acss_start_tm) MINUTE(4) TO SECOND) AS start_diff,  ROW_NUMBER() OVER (PARTITION BY acs.cust_id, acs.cust_line_seq_id ORDER BY acs.call_start_dt, acs.call_start_tm, acss_call_id ) as row_num    from ntl_prd_allvm.tp_speech_analytics_call_v as sa            join  ntl_prd_allvm.acss_call_v as acs  ON acs.call_start_dt=sa.call_start_dt  AND acss_user_id=sa.nt_user_id                         left join  ntl_prd_allvm.acss_call_center_v AS  cc                    ON acs.acss_call_ctr_cd = cc.acss_call_ctr_cd      JOIN sys_calendar.calendar AS z        ON calendar_date= DATE                      where  --rpt_mnth = '2012-07-01'  acs.acss_call_dt  BETWEEN (DATE-(day_of_week+6)) AND (DATE-(day_of_week)) and start_diff<'2:00.000000'    qualify ROW_NUMBER() OVER (PARTITION BY sa.call_start_dt,sa_start_tm, acss_user_id ORDER BY sa.inum, start_diff) = 1) as a    where row_num = '1'  and a.acss_call_type_cd in ('1','7')    group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16   )  WITH DATA PRIMARY INDEX (cust_id, cust_line_seq_id, inum, call_start_dt, acss_call_id) ON COMMIT PRESERVE ROWS;      CREATE VOLATILE TABLE ANI_NUM_V AS (  select   ((DATE-(day_of_week+6))(FORMAT 'MM-DD'))||' to '||((DATE-(day_of_week))(FORMAT 'MM-DD')) ANI_Week, (ivr.ivr_call_dt - (EXTRACT(DAY FROM ivr.ivr_call_dt) - 1)) rpt_mnth,  cal.sor_id,  cal.mtn as cal_mtn,  ivr.mtn as ivr_mtn,  cal.cust_id,  cal.cust_line_seq_id,  ivr.ivr_call_id,  ivr.ani_num      from ntl_prd_allvm.cust_acct_line_dly_hist_v as cal    inner join ntl_prd_allvm.ivr_call_v as ivr         on cal.cust_id = ivr.cust_id       and cal.cust_line_seq_id = ivr.cust_line_seq_id       and ivr.ivr_call_dt BETWEEN cal.eff_dt AND cal.exp_dt     JOIN sys_calendar.calendar AS z        ON calendar_date= DATE        where   --rpt_mnth = '2012-07-01'  ivr.ivr_call_dt BETWEEN (DATE-(day_of_week+6)) AND (DATE-(day_of_week)) and cal.sor_id = 'v'  and cal.rev_gen_ind = 'Y'  and cal.prepaid_ind <> 'Y'  and cal.mtn_status_ind in ('a','s')    group by 1,2,3,4,5,6,7,8,9   )  WITH DATA PRIMARY INDEX (cust_id, cust_line_seq_id, ani_num, sor_id ) ON COMMIT PRESERVE ROWS;      select  ((DATE-(day_of_week+6))(FORMAT 'MM-DD'))||' to '||((DATE-(day_of_week))(FORMAT 'MM-DD')) NDCIR_Week,   a.activity_mth,   a.activity_type,   a.area_desc as cust_area_desc,   a.region_desc as cust_region_desc,   a.sls_dist_chnl_churn_ctgry,  a.sls_outlet_id,   o.sls_outlet_nm as outlet,    a.sls_area_desc as sales_area,   a.sls_region_desc as sales_region,  case when a.fulfillment_ind='F' then 'direct'  when a.fulfillment_ind='L' then 'local'  else 'unknown' end as dfill,  cal.mtn,  coalesce(ani.ani_num, '0000000000') as ani_num,  sa.inum,  a.cust_id,  a.cust_line_seq_id,  a.prod_nm_prev,  a.prod_nm,  dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier,  a.activity_dt,  cal.mtn,  CASE WHEN cc.acss_call_ctr_desc IN ('NE Columbia SC 2', 'NE Columbia SC') THEN 'NE Columbia'              ELSE cc.acss_call_ctr_desc END AS Center,       u.nm_last||', '||u.nm_first AS rep_nm,          u.acss_user_id,         ad.acss_dept_desc,                  a.acss_call_dt,     a.acss_call_id,     a.acss_call_tm,         CASE     WHEN cc.acss_call_ctr_time_zn LIKE 'C%' THEN                          a.acss_call_tm + INTERVAL '1' HOUR            WHEN cc.acss_call_ctr_time_zn LIKE 'M%' THEN                  a.acss_call_tm + INTERVAL '2' HOUR           WHEN cc.acss_call_ctr_time_zn LIKE 'P%' THEN                    a.acss_call_tm +INTERVAL '3' HOUR             WHEN cc.acss_call_ctr_time_zn LIKE 'H%' THEN                   a.acss_call_tm + INTERVAL '6' HOUR            ELSE a.acss_call_tm                       END acss_call_EST_tm,          a.call_duration,       sa.url_speech           from ntl_prd_qmtbls.mrs_ndcir_detail as a    JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal  ON a.cust_id = cal.cust_id  AND a.cust_line_seq_id = cal.cust_line_seq_id  AND a.activity_dt BETWEEN cal.eff_dt AND cal.exp_dt      LEFT JOIN ANI_NUM_V AS ani    on a.sor_id = ani.sor_id    and a.cust_id = ani.cust_id    and a.cust_line_seq_id = ani.cust_line_seq_id    and a.ivr_call_id = ani.ivr_call_id      LEFT JOIN SA_INUM_V AS sa    ON a.cust_id = sa.cust_id    and a.cust_line_seq_id = sa.cust_line_seq_id    and a.acss_call_dt = sa.call_start_dt    and a.acss_call_id = sa.acss_call_id     left join ntl_prd_allvm.outlet_v as o   on a.sls_outlet_id = o.sls_outlet_id    INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc           ON a.acss_call_ctr_cd = cc.acss_call_ctr_cd                                    INNER JOIN ntl_prd_allvm.acss_dept_v AS ad      ON a.acss_dept_id = ad.acss_dept_id        Left JOIN ntl_prd_allvm.acss_user_v AS u     ON a.acss_user_id =  u.acss_user_id        LEFT JOIN ntl_prd_allvm.device_dp_map_v AS dm                     ON a.prod_nm = dm.prod_nm   JOIN sys_calendar.calendar AS z        ON calendar_date= DATE         WHERE  a.activity_dt BETWEEN (DATE-(day_of_week+6)) AND (DATE-(day_of_week))  and a.sls_area_desc = 'Northeast' and a.sls_region_desc = 'New York Metro' AND a.sls_dist_chnl_churn_ctgry <> 'NonComm' AND a.acss_call_ctr_type||a.acss_call_type_cd IN ('v1', 'v7', 'o1', 'o3', 'o7')  AND a.acss_call_dt BETWEEN a.activity_dt AND  ADD_MONTHS(a.activity_dt,0)+ 2        GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32;    --drop table SA_INUM_V;  --drop table ANI_NUM_V;	TERADATA	HABERER	00:06:32	00:16:47	17871
10/03/2012	10:57:34	NTL_PRD_ALLVM	00:20:36	6791			CREATE VOLATILE TABLE Repeat_Reporting_EMH1 AS (SELECT      acc.acss_call_ctr_desc,      acc.acss_call_ctr_cd,      ac.sor_id,      ac.acss_call_type_cd,     acc.acss_area_cd AS ctr_area,      acc.acss_call_ctr_type,      ac.cust_id,      ac.cust_line_seq_id,          ac.acct_num,      ac.mtn,      ac.acss_user_id,      ac.acss_call_dt,          ac.acss_call_tm,           (ac.call_disconnect_tm - ac.call_start_tm) HOUR TO SECOND (0) AS call_duration_tm,      COALESCE(sed.departmenttype,'Other') depttype,           COALESCE(sed.departmentgroup, 'Other') as dept_group,          CASE  WHEN acc.acss_call_ctr_time_zn LIKE 'C%' THEN                       ac.acss_call_tm + INTERVAL '1' HOUR                          WHEN acc.acss_call_ctr_time_zn LIKE 'M%' THEN               ac.acss_call_tm + INTERVAL '2' HOUR                          WHEN acc.acss_call_ctr_time_zn LIKE 'P%' THEN                 ac.acss_call_tm +INTERVAL '3' HOUR                            WHEN acc.acss_call_ctr_time_zn LIKE 'H%' THEN                ac.acss_call_tm + INTERVAL '5' HOUR                           ELSE ac.acss_call_tm         END acss_call_ad,      CAST(          ac.acss_call_dt ||          ' '             ||          CAST(acss_call_ad AS CHAR(8)) AS TIMESTAMP(0)      ) acss_dt_tm,      ad.acss_dept_desc,      ad.acss_dept_id,      ac.acss_call_id,      ac.area_cd,      RANK() OVER (PARTITION BY cust_id, cust_line_seq_id          ORDER BY ac.acss_call_dt, acss_call_ad, acss_call_id) rnk  FROM ntl_prd_allvm.acss_call_v AS ac  JOIN sys_calendar.calendar AS z        ON calendar_date= DATE   JOIN ntl_prd_allvm.acss_call_center_v AS acc      ON ac.acss_call_ctr_cd = acc.acss_call_ctr_cd  JOIN ntl_prd_allvm.acss_user_v AS au      ON ac.acss_user_id = au.acss_user_id  JOIN ntl_prd_allvm.acss_dept_v AS ad      ON ac.acss_dept_id = ad.acss_dept_id  LEFT JOIN ntl_prd_qmtbls.emh_eccr_dep AS sed    ON ad.acss_dept_id = sed.acssdeptid  LEFT JOIN                  (SELECT a.acss_call_dt,a.acss_call_ctr_cd, a.acss_dept_id FROM                  ntl_prd_allvm.acss_call_v  as a                                  JOIN sys_calendar.calendar AS z                                                                        ON calendar_date= DATE                                   WHERE                  a.acss_call_dt BETWEEN (DATE-(2)) AND (DATE-(2))                   AND a.acss_call_type_cd = '1'                  GROUP BY 1,2,3) r  ON          ac.acss_call_dt = r.acss_call_dt          AND ac.acss_call_ctr_cd = r.acss_call_ctr_cd          AND ac.acss_dept_id = r.acss_dept_id  WHERE ac.acss_call_dt BETWEEN (DATE-(2)) AND (DATE-(2))   AND COALESCE(sed.departmenttype,'Other') <> 'NA'  AND (      (ac.acss_call_type_cd IN ('1','7')) OR      (          ac.acss_call_type_cd = '3'          AND acc.acss_call_ctr_type = 'O'          AND ad.acss_dept_desc NOT LIKE '%offline%'          AND r.acss_dept_id IS NULL ))  ) WITH DATA PRIMARY INDEX (cust_id, cust_line_seq_id, acss_call_dt, acss_call_id, rnk) ON COMMIT PRESERVE ROWS;   CREATE TABLE NTL_PRD_QMTBLS.Repeat_Reporting_EMH21  AS  (  SELECT      a.sor_id,      a.acss_call_id,      a.acss_call_type_cd,      a.ctr_area,      a.acss_call_ctr_type,      m.area_cd,      m.region_desc,      a.cust_id,      a.cust_line_seq_id,      a.mtn,      a.acss_call_dt,          a.acss_call_ad,          a.acss_call_tm,           a.call_duration_tm,      a.rnk,      a.acss_dept_desc as initial_dept_desc,      a.acss_dept_id,      a.acss_user_id,      a.acss_call_ctr_desc,      a.acss_call_ctr_cd,      a.depttype AS orgtype,          a.dept_group as org_dept_group,      b.acss_call_id AS repeat_call_id,      b.acss_dept_desc AS repeat_dept_desc,      b.acss_dept_id AS repeat_dept_id,          b.acss_user_id AS repeat_user_id,          b.acss_call_ctr_desc AS repeat_call_ctr_desc,      b.acss_call_ctr_cd AS repeat_ctr_cd,      b.acss_call_dt AS repeat_dt,          b.acss_call_ad AS repeat_call_ad,         b.acss_call_tm as repeat_call_tm,           b.call_duration_tm as repeat_call_duration_tm,      b.rnk AS repeat_rnk,      b.depttype AS reptype,          b.dept_group as rpt_dept_group,      CASE WHEN b.acss_dt_tm IS NOT NULL THEN        ((b.acss_dt_tm - a.acss_dt_tm) DAY(4) TO MINUTE ) END tsdiff,      CASE WHEN b.acss_dt_tm IS NOT NULL THEN        (EXTRACT(HOUR FROM tsdiff) * 60)        + EXTRACT(MINUTE FROM tsdiff)        + (CAST((CAST ((tsdiff) AS INTERVAL DAY)) AS INTEGER) * 1440) END min_diff  FROM Repeat_Reporting_EMH1 AS a  JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt                 JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)       INNER JOIN Repeat_Reporting_EMH1 AS b          ON  a.cust_id = b.cust_id          AND a.cust_line_seq_id = b.cust_line_seq_id                  AND a.acss_call_dt = b.acss_call_dt                       AND b.rnk = a.rnk + 1          AND b.acss_call_id <> a.acss_call_id                  --AND ( b.acss_call_ad -  a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00'              LEFT JOIN ntl_prd_allvm.acss_call_center_v AS acc      ON b.acss_call_ctr_cd = acc.acss_call_ctr_cd  ) WITH DATA PRIMARY INDEX( sor_id, acss_call_id, acss_call_type_cd, ctr_area, acss_call_ctr_type, area_cd, region_desc, cust_id, cust_line_seq_id, mtn, acss_call_dt, acss_call_ad, acss_call_tm, call_duration_tm, rnk, initial_dept_desc, acss_dept_id, acss_user_id, acss_call_ctr_desc, acss_call_ctr_cd, orgtype, org_dept_group, repeat_call_id, repeat_dept_desc, repeat_dept_id, repeat_user_id, repeat_call_ctr_desc, repeat_ctr_cd, repeat_dt, repeat_call_ad, repeat_call_tm, repeat_call_duration_tm, repeat_rnk, reptype, rpt_dept_group, tsdiff, min_diff);  select a.acss_call_ctr_desc, hr1.nm_last || ', ' || hr1.nm_first AS  AD_Nm,  hr2.nm_last || ', ' || hr2.nm_first AS Supv_Nm,    u.nm_last||', '||u.nm_first AS First_Rep_nm,  a.initial_dept_desc,  a.acss_user_id, a.mtn, a.cust_id, a.area_cd, a.region_desc, CASE WHEN cal.Device_type_cd LIKE '%4GS%'  THEN cal.device_prod_nm  ELSE cal.prod_nm END AS Device_Nm, dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, a.orgtype, a.acss_call_dt, a.acss_call_ad, a.acss_call_tm, a.call_duration_tm, a.repeat_call_ctr_desc, u1.nm_last||', '||u1.nm_first AS Repeat_Rep_nm,  a.repeat_dept_desc, a.reptype, a.repeat_dt, a.repeat_call_ad, a.repeat_call_tm, a.repeat_call_duration_tm, a.tsdiff, a.min_diff, CASE WHEN (a.repeat_call_ad - a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00' THEN  'Y' ELSE 'N' END AS Rpts_2hrs_and_Under   FROM NTL_PRD_QMTBLS.Repeat_Reporting_EMH21 AS a  JOIN sys_calendar.calendar AS z   ON calendar_date= DATE   JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt       LEFT JOIN  ntl_prd_allvm.device_dp_map_v AS dm                     ON (CASE WHEN cal.Device_type_cd LIKE '%4GS%' THEN cal.device_prod_nm ELSE cal.prod_nm END) = dm.prod_nm                JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)  LEFT JOIN ntl_prd_qmtbls.stm_eccr_area AS s    ON a.acss_call_ctr_cd = s.acsscallcentercd    AND a.acss_dept_id = s.acssdeptid      Join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id = u.acss_user_id    JOIN ntl_prd_allvm.hr_employee_v AS hr  ON u.hr_employee_id = hr.emp_id    LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr2              ON hr.SUPER_ID_LVL2_EMP_ID = hr2.emp_id                     LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr1           ON hr.SUPER_ID_LVL1_EMP_ID = hr1.emp_id   Join ntl_prd_allvm.acss_user_v AS u1  on a.repeat_user_id = u1.acss_user_id  WHERE acss_call_dt BETWEEN '2012-10-01' AND ADD_MONTHS('2012-10-01',1)-1 and a.orgtype IN ('CS','WDTS')  and a.reptype IN ('CS','WDTS')  and a.org_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.rpt_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.acss_call_ctr_desc IN('NE Columbia SC',  'NE Huntsville AL',  'NE Hanover MD',  'NE Rochester NY',  'NE Charleston SC',  'NE Charlotte NC',  'NE Wallingford CT',  'NE Wilmington NC',  'NE Bangor ME',  'NE Columbia SC 2')    GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29 ORDER BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29;  DROP TABLE Repeat_Reporting_EMH1; DROP TABLE NTL_PRD_QMTBLS. Repeat_Reporting_EMH21;	TERADATA	HABERER	00:03:29	00:17:07	17870
10/03/2012	10:33:59	NTL_PRD_ALLVM	00:00:01	0	10053		CREATE VOLATILE TABLE SA_INUM_V AS (  select  a.INUM_Week  ,a.rpt_mnth  ,a.acss_mtn  ,a.sa_mtn  ,a.cust_id  ,a.cust_line_seq_id  ,a.call_start_dt    ,a.sa_start_tm  ,a.acss_start_tm  ,a.acss_user_id  ,a.acss_call_id  ,a.url_speech  ,a.inum  ,a.acss_call_type_cd  ,a.start_diff  ,a.row_num    from (SELECT   ((DATE-(day_of_week+6))(FORMAT 'MM-DD'))||' to '||((DATE-(day_of_week))(FORMAT 'MM-DD')) INUM_Week,  (acs.acss_call_dt - (EXTRACT(DAY FROM acs.acss_call_dt) - 1)) rpt_mnth  ,acs.mtn as acss_mtn  ,sa.mtn as sa_mtn  ,acs.cust_id  ,acs.cust_line_seq_id  ,acs.call_start_dt    ,sa.call_start_tm as sa_start_tm  ,acs.call_start_tm as acss_start_tm  ,acss_user_id  ,acs.acss_call_id  ,sa.url_speech  ,sa.inum  ,acs.acss_call_type_cd  ,ABS((sa_start_tm - acss_start_tm) MINUTE(4) TO SECOND) AS start_diff,  ROW_NUMBER() OVER (PARTITION BY acs.cust_id, acs.cust_line_seq_id ORDER BY acs.call_start_dt, acs.call_start_tm, acss_call_id ) as row_num    from ntl_prd_allvm.tp_speech_analytics_call_v as sa            join  ntl_prd_allvm.acss_call_v as acs  ON acs.call_start_dt=sa.call_start_dt  AND acss_user_id=sa.nt_user_id                         left join  ntl_prd_allvm.acss_call_center_v AS  cc                    ON acs.acss_call_ctr_cd = cc.acss_call_ctr_cd      JOIN sys_calendar.calendar AS z        ON calendar_date= DATE                      where  --rpt_mnth = '2012-07-01'  acs.acss_call_dt  BETWEEN (DATE-(day_of_week+6)) AND (DATE-(day_of_week)) and start_diff<'2:00.000000'    qualify ROW_NUMBER() OVER (PARTITION BY sa.call_start_dt,sa_start_tm, acss_user_id ORDER BY sa.inum, start_diff) = 1) as a    where row_num = '1'  and a.acss_call_type_cd in ('1','7')    group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16   )  WITH DATA PRIMARY INDEX (cust_id, cust_line_seq_id, inum, call_start_dt, acss_call_id) ON COMMIT PRESERVE ROWS;      CREATE VOLATILE TABLE ANI_NUM_V AS (  select   ((DATE-(day_of_week+6))(FORMAT 'MM-DD'))||' to '||((DATE-(day_of_week))(FORMAT 'MM-DD')) ANI_Week, (ivr.ivr_call_dt - (EXTRACT(DAY FROM ivr.ivr_call_dt) - 1)) rpt_mnth,  cal.sor_id,  cal.mtn as cal_mtn,  ivr.mtn as ivr_mtn,  cal.cust_id,  cal.cust_line_seq_id,  ivr.ivr_call_id,  ivr.ani_num      from ntl_prd_allvm.cust_acct_line_dly_hist_v as cal    inner join ntl_prd_allvm.ivr_call_v as ivr         on cal.cust_id = ivr.cust_id       and cal.cust_line_seq_id = ivr.cust_line_seq_id       and ivr.ivr_call_dt BETWEEN cal.eff_dt AND cal.exp_dt     JOIN sys_calendar.calendar AS z        ON calendar_date= DATE        where   --rpt_mnth = '2012-07-01'  ivr.ivr_call_dt BETWEEN (DATE-(day_of_week+6)) AND (DATE-(day_of_week)) and cal.sor_id = 'v'  and cal.rev_gen_ind = 'Y'  and cal.prepaid_ind <> 'Y'  and cal.mtn_status_ind in ('a','s')    group by 1,2,3,4,5,6,7,8,9   )  WITH DATA PRIMARY INDEX (cust_id, cust_line_seq_id, ani_num, sor_id ) ON COMMIT PRESERVE ROWS;      select  ((DATE-(day_of_week+6))(FORMAT 'MM-DD'))||' to '||((DATE-(day_of_week))(FORMAT 'MM-DD')) NDCIR_Week,   a.activity_mth,   a.activity_type,   a.area_desc as cust_area_desc,   a.region_desc as cust_region_desc,   a.sls_dist_chnl_churn_ctgry,  a.sls_outlet_id,   o.sls_outlet_nm as outlet,    a.sls_area_desc as sales_area,   a.sls_region_desc as sales_region,  case when a.fulfillment_ind='F' then 'direct'  when a.fulfillment_ind='L' then 'local'  else 'unknown' end as dfill,  cal.mtn,  coalesce(ani.ani_num, '0000000000') as ani_num,  sa.inum,  a.cust_id,  a.cust_line_seq_id,  a.prod_nm_prev,  a.prod_nm,  dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier,  a.activity_dt,  cal.mtn,  CASE WHEN cc.acss_call_ctr_desc IN ('NE Columbia SC 2', 'NE Columbia SC') THEN 'NE Columbia'              ELSE cc.acss_call_ctr_desc END AS Center,       u.nm_last||', '||u.nm_first AS rep_nm,          u.acss_user_id,         ad.acss_dept_desc,                  a.acss_call_dt,     a.acss_call_id,     a.acss_call_tm,         CASE     WHEN cc.acss_call_ctr_time_zn LIKE 'C%' THEN                          a.acss_call_tm + INTERVAL '1' HOUR            WHEN cc.acss_call_ctr_time_zn LIKE 'M%' THEN                  a.acss_call_tm + INTERVAL '2' HOUR           WHEN cc.acss_call_ctr_time_zn LIKE 'P%' THEN                    a.acss_call_tm +INTERVAL '3' HOUR             WHEN cc.acss_call_ctr_time_zn LIKE 'H%' THEN                   a.acss_call_tm + INTERVAL '6' HOUR            ELSE a.acss_call_tm                       END acss_call_EST_tm,          a.call_duration,       sa.url_speech           from ntl_prd_qmtbls.mrs_ndcir_detail as a    JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal  ON a.cust_id = cal.cust_id  AND a.cust_line_seq_id = cal.cust_line_seq_id  AND a.activity_dt BETWEEN cal.eff_dt AND cal.exp_dt      LEFT JOIN ANI_NUM_V AS ani    on a.sor_id = ani.sor_id    and a.cust_id = ani.cust_id    and a.cust_line_seq_id = ani.cust_line_seq_id    and a.ivr_call_id = ani.ivr_call_id      LEFT JOIN SA_INUM_V AS sa    ON a.cust_id = sa.cust_id    and a.cust_line_seq_id = sa.cust_line_seq_id    and a.acss_call_dt = sa.call_start_dt    and a.acss_call_id = sa.acss_call_id     left join ntl_prd_allvm.outlet_v as o   on a.sls_outlet_id = o.sls_outlet_id    INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc           ON a.acss_call_ctr_cd = cc.acss_call_ctr_cd                                    INNER JOIN ntl_prd_allvm.acss_dept_v AS ad      ON a.acss_dept_id = ad.acss_dept_id        Left JOIN ntl_prd_allvm.acss_user_v AS u     ON a.acss_user_id =  u.acss_user_id        LEFT JOIN ntl_prd_allvm.device_dp_map_v AS dm                     ON a.prod_nm = dm.prod_nm   JOIN sys_calendar.calendar AS z        ON calendar_date= DATE         WHERE  a.activity_dt BETWEEN (DATE-(day_of_week+6)) AND (DATE-(day_of_week))  and a.sls_area_desc = 'Northeast' and a.sls_region_desc = 'New York Metro' AND a.sls_dist_chnl_churn_ctgry <> 'NonComm' AND a.acss_call_ctr_type||a.acss_call_type_cd IN ('v1', 'v7', 'o1', 'o3', 'o7')  AND a.acss_call_dt BETWEEN a.activity_dt AND  ADD_MONTHS(a.activity_dt,0)+ 2        GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32;    --drop table SA_INUM_V;  --drop table ANI_NUM_V;	TERADATA	HABERER	00:00:01	00:00:00	17869
10/03/2012	10:32:50	NTL_PRD_ALLVM	00:00:11	0			drop table Reporting_Month; drop table nccir_base11; drop table nccir_base1a; drop table nccir_base11b; drop table nccir_acts_v; drop table upcir_base11; drop table upcir_base22; drop table upcir_base33; drop table upcir_base22a; drop table upcir_base22aa; drop table upcir_base22b; drop table upcir_base22bb; drop table upcir_up_v; drop table ndcir_up_nc_emh_v;	TERADATA	HABERER	00:00:11	00:00:00	17868
10/03/2012	10:04:34	NTL_PRD_ALLVM	00:01:25	586			select  a.activity_mth,  a.activity_dt,  a.activity_type,   --Customer Info a.cust_area,  a.cust_region, cal.mtn, coalesce(ani.ani_num, '0000000000') as ani_num,  a.cust_id,  a.cust_line_seq_id,    a.fulfillment_ind,   --Equipment info  ndcir.device_nm as unmsk_device_nm,  a.prod_nm as msk_device_nm,  a.data_tier_fin,  a.device_generation,  a.prod_nm_prev,  a.data_tier_fin_prev,  a.device_generation_prev,    --NonComm Upgrade Rep a.sales_area,  a.sales_region,  a.sls_dist_chnl_churn_ctgry,  a.outlet as Upgrd_Channel,  a.emp_nm as upgrd_emp_nm,  a.job_desc as upgrd_job_desc,  a.hr_employee_id as upgrd_hr_employee_id,  a.nt_user_id as upgrd_nt_user_id,  acall.acss_call_dt upgrd_call_dt,  acall.acss_call_tm as upgrd_call_tm,  acall.acss_call_id as upgrd_call_id,   CASE   WHEN cc1.acss_call_ctr_time_zn LIKE 'C%' THEN              acall.acss_call_tm + INTERVAL '1' HOUR          WHEN cc1.acss_call_ctr_time_zn LIKE 'M%' THEN              acall.acss_call_tm + INTERVAL '2' HOUR         WHEN cc1.acss_call_ctr_time_zn LIKE 'P%' THEN              acall.acss_call_tm +INTERVAL '3' HOUR          WHEN cc1.acss_call_ctr_time_zn LIKE 'H%' THEN              acall.acss_call_tm + INTERVAL '5' HOUR          ELSE acall.acss_call_tm       END upgrd_call_est_tm,  (acall.call_disconnect_tm - acall.call_start_tm) HOUR TO SECOND (0) AS upgrd_duration_tm,  sa.inum as upgrd_cll_inum,   ---Calls following the initial call  cc.acss_call_ctr_desc,  a.acss_call_ctr_cd,  u.nm_last||', '||u.nm_first AS rep_nm,  a.acss_user_id,  ad.acss_dept_desc,  a.acss_call_dt,  a.acss_call_tm, a.acss_call_id,  a.call_duration, sa1.inum as initial_cll_inum,  a.call_period      from ntl_prd_qmvm.ndcir_detail_v as a    inner join  ntl_prd_allvm.acss_call_v AS acall  on a.sor_id = acall.sor_id  and a.cust_id = acall.cust_id  and a.cust_line_seq_id = acall.cust_line_seq_id  and a.nt_user_id = acall.acss_user_id  and a.activity_dt = acall.acss_call_dt  and a.acss_call_id <> acall.acss_call_id  and acall.acss_call_type_cd IN ('1','3','7')    left join (Select activity_dt, cust_id, cust_line_seq_id, device_nm    from ndcir_up_nc_emh_v    where  activity_mth = '2012-09-01'  and activity_type = 'UP'  and sls_dist_chnl_churn_ctgry = 'NonComm'      qualify row_number() over (partition by cust_id, cust_line_seq_id order by cust_id, cust_line_seq_id, activity_dt) = 1    group by 1,2,3,4  ) as ndcir  on a.cust_id = ndcir.cust_id  and a.cust_line_seq_id = ndcir.cust_line_seq_id  and a.activity_dt = ndcir.activity_dt    join  ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal  on a.cust_id = cal.cust_id  and  a.cust_line_seq_id = cal.cust_line_seq_id  and  a.activity_dt between cal.eff_dt and cal.exp_dt     INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc1     ON acall.acss_call_ctr_cd = cc1.acss_call_ctr_cd   JOIN ntl_prd_allvm.acss_user_v AS u     ON a.acss_user_id =  u.acss_user_id      INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc     ON a.acss_call_ctr_cd = cc.acss_call_ctr_cd     INNER JOIN ntl_prd_allvm.acss_dept_v AS ad     ON a.acss_dept_id = ad.acss_dept_id        left join ani_num_v as ani   on acall.sor_id = ani.sor_id   and acall.cust_id = ani.cust_id   and acall.cust_line_seq_id = ani.cust_line_seq_id   and acall.ivr_call_id = ani.ivr_call_id       left join sa_inum_v as sa    on acall.cust_id = sa.cust_id   and acall.cust_line_seq_id = sa.cust_line_seq_id   and acall.acss_call_dt = sa.call_start_dt   and acall.acss_call_id = sa.acss_call_id       left join sa_inum_v as sa1    on a.cust_id = sa1.cust_id   and a.cust_line_seq_id = sa1.cust_line_seq_id   and a.acss_call_dt = sa1.call_start_dt   and a.acss_call_id = sa1.acss_call_id    where a.activity_dt between '2012-09-15' and '2012-09-28'  and a.activity_type = 'UP'  and a.sales_area = 'Northeast'  and a.sls_dist_chnl_churn_ctgry = 'NonComm'  and a.outlet in ('NE Wallingford CT',  'NE Wilmington NC',  'NE Huntsville AL',  'NE Rochester NY'  'NE Charleston SC',  'NE Columbia SC 2',  'NE Columbia SC',  'NE Charlotte NC',  'NE Hanover MD',  'NE Bangor ME')  and a.acss_call_ctr_type||a.acss_call_type_cd IN ('v1', 'v7', 'o1', 'o3', 'o7')   and a.acss_call_dt BETWEEN a.activity_dt AND  ADD_MONTHS(a.activity_dt,0)+ 2;     --drop table Reporting_Month; --drop table nccir_base11; --drop table nccir_base1a; --drop table nccir_base11b; --drop table nccir_acts_v; --drop table upcir_base11; --drop table upcir_base22; --drop table upcir_base33; --drop table upcir_base22a; --drop table upcir_base22aa; --drop table upcir_base22b; --drop table upcir_base22bb; --drop table upcir_up_v; --drop table ndcir_up_nc_emh_v;	TERADATA	HABERER	00:01:24	00:00:01	17867
10/03/2012	09:59:13	NTL_PRD_ALLVM	00:00:32	596			select  a.activity_mth,  a.activity_dt,  a.activity_type,   --Customer Info a.cust_area,  a.cust_region, cal.mtn, coalesce(ani.ani_num, '0000000000') as ani_num,  a.cust_id,  a.cust_line_seq_id,    a.fulfillment_ind,   --Equipment info  ndcir.device_nm as unmsk_device_nm,  a.prod_nm as msk_device_nm,  a.data_tier_fin,  a.device_generation,  a.prod_nm_prev,  a.data_tier_fin_prev,  a.device_generation_prev,    --NonComm Upgrade Rep a.sales_area,  a.sales_region,  a.sls_dist_chnl_churn_ctgry,  a.outlet as Upgrd_Channel,  a.emp_nm as upgrd_emp_nm,  a.job_desc as upgrd_job_desc,  a.hr_employee_id as upgrd_hr_employee_id,  a.nt_user_id as upgrd_nt_user_id,  acall.acss_call_dt upgrd_call_dt,  acall.acss_call_tm as upgrd_call_tm,  acall.acss_call_id as upgrd_call_id,   CASE   WHEN cc1.acss_call_ctr_time_zn LIKE 'C%' THEN              acall.acss_call_tm + INTERVAL '1' HOUR          WHEN cc1.acss_call_ctr_time_zn LIKE 'M%' THEN              acall.acss_call_tm + INTERVAL '2' HOUR         WHEN cc1.acss_call_ctr_time_zn LIKE 'P%' THEN              acall.acss_call_tm +INTERVAL '3' HOUR          WHEN cc1.acss_call_ctr_time_zn LIKE 'H%' THEN              acall.acss_call_tm + INTERVAL '5' HOUR          ELSE acall.acss_call_tm       END upgrd_call_est_tm,  (acall.call_disconnect_tm - acall.call_start_tm) HOUR TO SECOND (0) AS upgrd_duration_tm,  sa.inum as upgrd_cll_inum,   ---Calls following the initial call  cc.acss_call_ctr_desc,  a.acss_call_ctr_cd,  u.nm_last||', '||u.nm_first AS rep_nm,  a.acss_user_id,  ad.acss_dept_desc,  a.acss_call_dt,  a.acss_call_tm, a.acss_call_id,  a.call_duration, sa1.inum as initial_cll_inum,  a.call_period      from ntl_prd_qmvm.ndcir_detail_v as a    inner join  ntl_prd_allvm.acss_call_v AS acall  on a.sor_id = acall.sor_id  and a.cust_id = acall.cust_id  and a.cust_line_seq_id = acall.cust_line_seq_id  and a.nt_user_id = acall.acss_user_id  and a.activity_dt = acall.acss_call_dt  --and a.acss_call_id <> acall.acss_call_id  and acall.acss_call_type_cd IN ('1','3','7')    left join (Select activity_dt, cust_id, cust_line_seq_id, device_nm    from ndcir_up_nc_emh_v    where  activity_mth = '2012-09-01'  and activity_type = 'UP'  and sls_dist_chnl_churn_ctgry = 'NonComm'      qualify row_number() over (partition by cust_id, cust_line_seq_id order by cust_id, cust_line_seq_id, activity_dt) = 1    group by 1,2,3,4  ) as ndcir  on a.cust_id = ndcir.cust_id  and a.cust_line_seq_id = ndcir.cust_line_seq_id  and a.activity_dt = ndcir.activity_dt    join  ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal  on a.cust_id = cal.cust_id  and  a.cust_line_seq_id = cal.cust_line_seq_id  and  a.activity_dt between cal.eff_dt and cal.exp_dt     INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc1     ON acall.acss_call_ctr_cd = cc1.acss_call_ctr_cd   JOIN ntl_prd_allvm.acss_user_v AS u     ON a.acss_user_id =  u.acss_user_id      INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc     ON a.acss_call_ctr_cd = cc.acss_call_ctr_cd     INNER JOIN ntl_prd_allvm.acss_dept_v AS ad     ON a.acss_dept_id = ad.acss_dept_id        left join ani_num_v as ani   on acall.sor_id = ani.sor_id   and acall.cust_id = ani.cust_id   and acall.cust_line_seq_id = ani.cust_line_seq_id   and acall.ivr_call_id = ani.ivr_call_id       left join sa_inum_v as sa    on acall.cust_id = sa.cust_id   and acall.cust_line_seq_id = sa.cust_line_seq_id   and acall.acss_call_dt = sa.call_start_dt   and acall.acss_call_id = sa.acss_call_id       left join sa_inum_v as sa1    on a.cust_id = sa1.cust_id   and a.cust_line_seq_id = sa1.cust_line_seq_id   and a.acss_call_dt = sa1.call_start_dt   and a.acss_call_id = sa1.acss_call_id    where a.activity_dt between '2012-09-15' and '2012-09-28'  and a.activity_type = 'UP'  and a.sales_area = 'Northeast'  and a.sls_dist_chnl_churn_ctgry = 'NonComm'  and a.outlet in ('NE Wallingford CT',  'NE Wilmington NC',  'NE Huntsville AL',  'NE Rochester NY'  'NE Charleston SC',  'NE Columbia SC 2',  'NE Columbia SC',  'NE Charlotte NC',  'NE Hanover MD',  'NE Bangor ME')  and a.acss_call_ctr_type||a.acss_call_type_cd IN ('v1', 'v7', 'o1', 'o3', 'o7')   and a.acss_call_dt BETWEEN a.activity_dt AND  ADD_MONTHS(a.activity_dt,0)+ 2;     --drop table Reporting_Month; --drop table nccir_base11; --drop table nccir_base1a; --drop table nccir_base11b; --drop table nccir_acts_v; --drop table upcir_base11; --drop table upcir_base22; --drop table upcir_base33; --drop table upcir_base22a; --drop table upcir_base22aa; --drop table upcir_base22b; --drop table upcir_base22bb; --drop table upcir_up_v; --drop table ndcir_up_nc_emh_v;	TERADATA	HABERER	00:00:31	00:00:01	17866
10/03/2012	09:57:34	NTL_PRD_ALLVM	01:25:44	37896			CREATE VOLATILE TABLE SA_INUM_V AS ( select  a.rpt_mnth ,a.acss_mtn ,a.sa_mtn ,a.cust_id ,a.cust_line_seq_id ,a.call_start_dt   ,a.sa_start_tm ,a.acss_start_tm ,a.acss_user_id ,a.acss_call_id ,a.url_speech ,a.inum ,a.acss_call_type_cd ,a.start_diff ,a.row_num  from (SELECT  (acs.acss_call_dt - (EXTRACT(DAY FROM acs.acss_call_dt) - 1)) rpt_mnth ,acs.mtn as acss_mtn ,sa.mtn as sa_mtn ,acs.cust_id ,acs.cust_line_seq_id ,acs.call_start_dt   ,sa.call_start_tm as sa_start_tm  ...	TERADATA	HABERER	01:25:41	00:00:03	17865
10/03/2012	08:04:08	NTL_PRD_ALLVM	00:00:03	7			select mtn, count(*)  from acss_call_v  where acss_call_dt between '2012-09-01' and '2012-09-30' and acss_call_type_cd in ('1','7') and mtn in ('2152058876',  '9155497626', '7607058888', '9175835546', '9784570437', '4015006275', '8452147441')  group by 1 order by 2 desc	TERADATA	HABERER	00:00:02	00:00:01	17864
10/03/2012	07:35:16	NTL_PRD_ALLVM	00:00:02	7			select mtn, count(*)  from acss_call_v  where acss_call_dt between '2012-09-01' and '2012-09-30' and acss_call_type_cd in ('1','7') and mtn in ('2152058876',  '9155497626', '7607058888', '9175835546', '9784570437', '4015006275', '8452147441')  group by 1	TERADATA	HABERER	00:00:02	00:00:00	17863
10/03/2012	07:34:59	NTL_PRD_ALLVM	00:00:00	0	3504		select acss_call_dt, mtn, count(*)  from acss_call_v  where acss_call_dt between '2012-09-01' and '2012-09-30' and acss_call_type_cd in ('1','7') and mtn in ('2152058876',  '9155497626', '7607058888', '9175835546', '9784570437', '4015006275', '8452147441')	TERADATA	HABERER	00:00:00	00:00:00	17862
10/03/2012	07:34:32	NTL_PRD_ALLVM	00:00:03	100			select top 100 * from acss_call_v	TERADATA	HABERER	00:00:03	00:00:00	17861
10/03/2012	07:34:04	NTL_PRD_ALLVM	00:00:00	0	5628		select acss_call_dt, mtn, count(*)   from acss_call_v  where acss_call_dt between '2012-09-01' and '2012-09-30' and acss_call_type_id in ('1','7') and mtn in ('2152058876',  '9155497626', '7607058888', '9175835546', '9784570437', '4015006275', '8452147441')	TERADATA	HABERER	00:00:00	00:00:00	17860
10/02/2012	14:45:42	NTL_PRD_ALLVM	00:00:01	1			select count (*)   from ndcir_up_nc_emh_v	TERADATA	HABERER	00:00:01	00:00:00	17859
10/02/2012	14:45:21	NTL_PRD_ALLVM	00:00:02	1			select min(activity_dt)   from ndcir_up_nc_emh_v	TERADATA	HABERER	00:00:01	00:00:01	17858
10/02/2012	12:54:13	NTL_PRD_ALLVM	00:00:04	50665			select  a.activity_dt ,a.cust_id ,a.cust_line_seq_id ,case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill ,a.fulfillment_ind ,count(distinct a.cust_id||a.cust_line_seq_id) as acts    from ntl_prd_qmtbls.mrs_ndcir_detail as a   where  a.activity_dt between '2012-09-15' and '2012-09-28' and a.sls_area_desc = 'Northeast' and a.sls_region_desc = 'New York Metro' and a.sls_dist_chnl_churn_ctgry = 'Stores'  qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id order by a.cust_id, a.cust_line_seq_id, a.activity_dt) = 1  group by 1,2,3,4,5	TERADATA	HABERER	00:00:03	00:00:01	17857
10/02/2012	12:53:12	NTL_PRD_ALLVM	00:17:06	51318			select  a.activity_mth,  a.activity_dt,  a.activity_type,  a.sls_area_desc as sales_area,  a.sls_region_desc as sales_region,  a.sls_dist_chnl_churn_ctgry,  a.sls_outlet_id,  o.sls_outlet_nm as outlet,   coalesce(case when heh.nm_mdlin is null then   heh.nm_last||', '||heh.nm_first   else heh.nm_last||', '||heh.nm_first||' '||trim(heh.nm_mdlin)||'.' end, 'Unknown') as sls_rep_nm, heh.job_desc, coalesce(case when heh02.nm_mdlin is null then   heh02.nm_last||', '||heh02.nm_first   else heh02.nm_last||', '||heh02.nm_first||' '||trim(heh02.nm_mdlin)||'.' end, 'Unknown') as sls_rep_direct_mgr,  heh02.email_addr as rep_direct_mgr_email,  heh02.job_desc as direct_mgr_job_desc,  coalesce(case when heh01.nm_mdlin is null then   heh01.nm_last||', '||heh01.nm_first   else heh01.nm_last||', '||heh01.nm_first||' '||trim(heh01.nm_mdlin)||'.' end, 'Unknown') as sls_district_mgr_nm,  heh01.email_addr as district_mgr_email,  heh01.job_desc as district_mgr_job_desc,  o.district_cd as Zone_District_cd,  a.area_desc as cust_area_desc,  a.region_desc as cust_region_desc,  cal.nm_first||'   '||cal.nm_last AS cust_name,  a.lang_pref_ind,  coalesce(email.email_addr, 'n/a') as cust_email_addr,   cal.mtn,   a.cust_id,  a.cust_line_seq_id,  a.device_nm_prev,  a.device_nm,  dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, case when a.fulfillement_ind='F' then 'direct' when a.fulfillement_ind='L' then 'local' else 'unknown' end as dfill, case when a.ecpd_liability_type_cd='C' then 'Business' else 'Consumer' end as Consumer_Business, case when dnsh.dns_type_cd is not null then 'Yes' When dnsh.dns_type_cd is null then 'No' end as on_dns_list, case when acs.currentstatus = 'Completed' and acs.mtn is not null then 'Yes'  else 'No' end as After_Cll_Survey  from ndcir_up_nc_emh_v as a  join  ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal ON a.cust_id = cal.cust_id AND a.cust_line_seq_id = cal.cust_line_seq_id AND a.activity_dt  BETWEEN cal.eff_dt AND cal.exp_dt  left join ntl_prd_allvm.cust_acct_line_dns_dly_hist_v as dnsh on a.sor_id = dnsh.sor_id and a.cust_id = dnsh.cust_id and a.cust_line_seq_id = dnsh.cust_line_seq_id and dnsh.dns_type_cd = 'SR' and a.activity_dt + 1 between dnsh.eff_dt and dnsh.exp_dt  left join (select sor_id, cust_id, acct_num, email_addr, email_status_ind,  email_selection_ind, entry_point, opt_in_dt,entry_dt, verify_ind  from ntl_prd_allvm.cust_acct_email_v  where email_selection_ind = 'X' ) as email on cal.sor_id = email.sor_id and cal.cust_id = email.cust_id and cal.acct_num = email.acct_num  left join ntl_prd_qmtbls.after_call_survey_emh_v as acs on cal.mtn = acs.mtn and cal.cust_id = acs.customerid  left join ntl_prd_allvm.hr_employee_hist_v as heh on a.hr_employee_id = heh.emp_id and a.activity_dt between heh.eff_dt and heh.exp_dt  left join ntl_prd_allvm.hr_employee_hist_v AS heh02              on heh.super_id_lvl2_emp_id = heh02.emp_id and a.activity_dt between heh02.eff_dt and heh02.exp_dt                   left join ntl_prd_allvm.hr_employee_hist_v AS heh01          on heh.super_id_lvl1_emp_id  = heh01.emp_id  and a.activity_dt between heh01.eff_dt and heh01.exp_dt    left join  ntl_prd_allvm.dns_type_v as dnsd on dnsh.dns_type_cd = dnsd.dns_type_cd  left join ntl_prd_allvm.outlet_v as o  on a.sls_outlet_id = o.sls_outlet_id   left join  ntl_prd_allvm.device_dp_map_v AS dm                   ON a.device_nm = dm.prod_nm   where  a.activity_mth = '2012-09-01' and a.sls_area_desc = 'Northeast' and a.sls_region_desc = 'New York Metro' and a.sls_dist_chnl_churn_ctgry = 'Stores' --and dfill = 'Local' --and cust_email_addr <> 'n/a' --and heh.job_cd in ('65045', 'V51103')     --and dm.device_tier not in ('Tablet', 'PC Card', 'Other') --and on_dns_list <> 'Yes' --and After_Cll_Survey <> 'Yes'  qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id order by a.cust_id, a.cust_line_seq_id, a.activity_dt) = 1  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33 order by a.sls_area_desc, a.sls_region_desc, a.activity_dt asc;	TERADATA	HABERER	00:17:04	00:00:02	17856
10/02/2012	12:34:44	NTL_PRD_ALLVM	00:00:00	0	3706		select  a.activity_mth,  a.activity_dt,  a.activity_type,  a.sls_area_desc as sales_area,  a.sls_region_desc as sales_region,  a.sls_dist_chnl_churn_ctgry,  a.sls_outlet_id,  o.sls_outlet_nm as outlet,   coalesce(case when heh.nm_mdlin is null then   heh.nm_last||', '||heh.nm_first   else heh.nm_last||', '||heh.nm_first||' '||trim(heh.nm_mdlin)||'.' end, 'Unknown') as sls_rep_nm, heh.job_desc, coalesce(case when heh02.nm_mdlin is null then   heh02.nm_last||', '||heh02.nm_first   else heh02.nm_last||', '||heh02.nm_first||' '||trim(heh02.nm_mdlin)||'.' end, 'Unknown') as sls_rep_direct_mgr,  heh02.email_addr as rep_direct_mgr_email,  heh02.job_desc as direct_mgr_job_desc,  coalesce(case when heh01.nm_mdlin is null then   heh01.nm_last||', '||heh01.nm_first   else heh01.nm_last||', '||heh01.nm_first||' '||trim(heh01.nm_mdlin)||'.' end, 'Unknown') as sls_district_mgr_nm,  heh01.email_addr as district_mgr_email,  heh01.job_desc as district_mgr_job_desc,  o.district_cd as Zone_District_cd,  a.area_desc as cust_area_desc,  a.region_desc as cust_region_desc,  cal.nm_first||'   '||cal.nm_last AS cust_name,  a.lang_pref_ind,  coalesce(email.email_addr, 'n/a') as cust_email_addr,   cal.mtn,   a.cust_id,  a.cust_line_seq_id,  a.device_nm_prev,  a.device_nm,  dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, case when a.fulfillement_ind='F' then 'direct' when a.fulfillement_ind='L' then 'local' else 'unknown' end as dfill, case when a.ecpd_liability_type_cd='C' then 'Business' else 'Consumer' end as Consumer_Business, case when dnsh.dns_type_cd is not null then 'Yes' When dnsh.dns_type_cd is null then 'No' end as on_dns_list, case when acs.currentstatus = 'Completed' and acs.mtn is not null then 'Yes'  else 'No' end as After_Cll_Survey  from ndcir_up_nc_emh_v as a  join  ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal ON a.cust_id = cal.cust_id AND a.cust_line_seq_id = cal.cust_line_seq_id AND a.activity_dt  BETWEEN cal.eff_dt AND cal.exp_dt  left join ntl_prd_allvm.cust_acct_line_dns_dly_hist_v as dnsh on a.sor_id = dnsh.sor_id and a.cust_id = dnsh.cust_id and a.cust_line_seq_id = dnsh.cust_line_seq_id and dnsh.dns_type_cd = 'SR' and a.activity_dt + 1 between dnsh.eff_dt and dnsh.exp_dt  left join (select sor_id, cust_id, acct_num, email_addr, email_status_ind,  email_selection_ind, entry_point, opt_in_dt,entry_dt, verify_ind  from ntl_prd_allvm.cust_acct_email_v  where email_selection_ind = 'X' ) as email on cal.sor_id = email.sor_id and cal.cust_id = email.cust_id and cal.acct_num = email.acct_num  left join ntl_prd_qmtbls.after_call_survey_emh_v as acs on cal.mtn = acs.mtn and cal.cust_id = acs.customerid  left join ntl_prd_allvm.hr_employee_hist_v as heh on a.hr_employee_id = heh.emp_id and a.activity_dt between heh.eff_dt and heh.exp_dt  left join ntl_prd_allvm.hr_employee_hist_v AS heh02              on heh.super_id_lvl2_emp_id = heh02.emp_id and a.activity_dt between heh02.eff_dt and heh02.exp_dt                   left join ntl_prd_allvm.hr_employee_hist_v AS heh01          on heh.super_id_lvl1_emp_id  = heh01.emp_id  and a.activity_dt between heh01.eff_dt and heh01.exp_dt    left join  ntl_prd_allvm.dns_type_v as dnsd on dnsh.dns_type_cd = dnsd.dns_type_cd  left join ntl_prd_allvm.outlet_v as o  on a.sls_outlet_id = o.sls_outlet_id   left join  ntl_prd_allvm.device_dp_map_v AS dm                   ON a.device_nm = dm.prod_nm   on a.cust_id = ndcir.cust_id and a.cust_line_seq_id = ndcir.cust_line_seq_id and a.activity_dt = ndcir.activity_dt  where  a.activity_mth = '2012-09-01' and a.sls_area_desc = 'Northeast' and a.sls_region_desc = 'New York Metro' and a.sls_dist_chnl_churn_ctgry = 'Stores' --and dfill = 'Local' --and cust_email_addr <> 'n/a' --and heh.job_cd in ('65045', 'V51103')     --and dm.device_tier not in ('Tablet', 'PC Card', 'Other') --and on_dns_list <> 'Yes' --and After_Cll_Survey <> 'Yes'  qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id order by a.cust_id, a.cust_line_seq_id, a.activity_dt) = 1  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33 order by a.sls_area_desc, a.sls_region_desc, a.activity_dt asc;	TERADATA	HABERER	00:00:00	00:00:00	17855
10/02/2012	12:33:30	NTL_PRD_ALLVM	00:00:01	1			select min(activity_dt)   from ndcir_up_nc_emh_v	TERADATA	HABERER	00:00:01	00:00:00	17854
10/02/2012	12:32:20	NTL_PRD_ALLVM	00:00:03	100			select top 100 *  from ndcir_up_nc_emh_v	TERADATA	HABERER	00:00:03	00:00:00	17853
10/02/2012	12:30:59	NTL_PRD_ALLVM	00:00:14	596			select a.activity_mth, a.activity_dt, a.activity_type, a.cust_area, a.cust_region, cal.mtn, a.cust_id, a.cust_line_seq_id,  a.fulfillment_ind,  ndcir.device_nm as unmsk_device_nm, a.prod_nm as msk_device_nm, a.data_tier_fin, a.device_generation, a.prod_nm_prev, a.data_tier_fin_prev, a.device_generation_prev,  a.sales_area, a.sales_region, a.sls_dist_chnl_churn_ctgry, a.outlet as Upgrd_Channel, a.emp_nm as upgrd_emp_nm, a.job_desc as upgrd_job_desc, a.hr_employee_id as upgrd_hr_employee_id, a.nt_user_id as upgrd_nt_user_id, acall.acss_call_dt upgrd_call_dt, acall.acss_call_tm as upgrd_call_tm,   CASE   WHEN cc1.acss_call_ctr_time_zn LIKE 'C%' THEN              acall.acss_call_tm + INTERVAL '1' HOUR          WHEN cc1.acss_call_ctr_time_zn LIKE 'M%' THEN              acall.acss_call_tm + INTERVAL '2' HOUR         WHEN cc1.acss_call_ctr_time_zn LIKE 'P%' THEN              acall.acss_call_tm +INTERVAL '3' HOUR          WHEN cc1.acss_call_ctr_time_zn LIKE 'H%' THEN              acall.acss_call_tm + INTERVAL '5' HOUR          ELSE acall.acss_call_tm       END upgrd_call_est_tm, (acall.call_disconnect_tm - acall.call_start_tm) HOUR TO SECOND (0) AS upgrd_duration_tm,   ---Calls following the initial call cc.acss_call_ctr_desc, a.acss_call_ctr_cd, u.nm_last||', '||u.nm_first AS rep_nm,  a.acss_user_id, ad.acss_dept_desc,  a.acss_call_dt, a.acss_call_tm, a.call_duration, a.call_period   from ntl_prd_qmvm.ndcir_detail_v as a  inner join  ntl_prd_allvm.acss_call_v AS acall  on a.sor_id = acall.sor_id and a.cust_id = acall.cust_id  and a.cust_line_seq_id = acall.cust_line_seq_id  and a.nt_user_id = acall.acss_user_id  and a.activity_dt = acall.acss_call_dt  --and a.acss_call_id <> acall.acss_call_id and acall.acss_call_type_cd IN ('1','3','7')   left join (Select activity_dt, cust_id, cust_line_seq_id, device_nm  from ndcir_up_nc_emh_v  where  activity_mth = '2012-09-01' and activity_type = 'UP' and sls_dist_chnl_churn_ctgry = 'NonComm'   qualify row_number() over (partition by cust_id, cust_line_seq_id order by cust_id, cust_line_seq_id, activity_dt) = 1  group by 1,2,3,4 ) as ndcir on a.cust_id = ndcir.cust_id and a.cust_line_seq_id = ndcir.cust_line_seq_id and a.activity_dt = ndcir.activity_dt  join  ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal on a.cust_id = cal.cust_id and  a.cust_line_seq_id = cal.cust_line_seq_id and  a.activity_dt between cal.eff_dt and cal.exp_dt    INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc1     ON acall.acss_call_ctr_cd = cc1.acss_call_ctr_cd  JOIN ntl_prd_allvm.acss_user_v AS u     ON a.acss_user_id =  u.acss_user_id      INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc     ON a.acss_call_ctr_cd = cc.acss_call_ctr_cd     INNER JOIN ntl_prd_allvm.acss_dept_v AS ad     ON a.acss_dept_id = ad.acss_dept_id  where a.activity_dt between '2012-09-15' and '2012-09-28' and a.activity_type = 'UP' and a.sales_area = 'Northeast' and a.sls_dist_chnl_churn_ctgry = 'NonComm' and a.outlet in ('NE Wallingford CT', 'NE Wilmington NC', 'NE Huntsville AL', 'NE Rochester NY' 'NE Charleston SC', 'NE Columbia SC 2', 'NE Columbia SC', 'NE Charlotte NC', 'NE Hanover MD', 'NE Bangor ME') and a.acss_call_ctr_type||a.acss_call_type_cd IN ('v1', 'v7', 'o1', 'o3', 'o7')  and a.acss_call_dt BETWEEN a.activity_dt AND  ADD_MONTHS(a.activity_dt,0)+ 2;	TERADATA	HABERER	00:00:14	00:00:00	17852
10/02/2012	12:29:48	NTL_PRD_ALLVM	00:00:00	0	3706		select  a.activity_mth,  a.activity_dt,  a.activity_type,  a.sls_area_desc as sales_area,  a.sls_region_desc as sales_region,  a.sls_dist_chnl_churn_ctgry,  a.sls_outlet_id,  o.sls_outlet_nm as outlet,   coalesce(case when heh.nm_mdlin is null then   heh.nm_last||', '||heh.nm_first   else heh.nm_last||', '||heh.nm_first||' '||trim(heh.nm_mdlin)||'.' end, 'Unknown') as sls_rep_nm, heh.job_desc, coalesce(case when heh02.nm_mdlin is null then   heh02.nm_last||', '||heh02.nm_first   else heh02.nm_last||', '||heh02.nm_first||' '||trim(heh02.nm_mdlin)||'.' end, 'Unknown') as sls_rep_direct_mgr,  heh02.email_addr as rep_direct_mgr_email,  heh02.job_desc as direct_mgr_job_desc,  coalesce(case when heh01.nm_mdlin is null then   heh01.nm_last||', '||heh01.nm_first   else heh01.nm_last||', '||heh01.nm_first||' '||trim(heh01.nm_mdlin)||'.' end, 'Unknown') as sls_district_mgr_nm,  heh01.email_addr as district_mgr_email,  heh01.job_desc as district_mgr_job_desc,  o.district_cd as Zone_District_cd,  a.area_desc as cust_area_desc,  a.region_desc as cust_region_desc,  cal.nm_first||'   '||cal.nm_last AS cust_name,  a.lang_pref_ind,  coalesce(email.email_addr, 'n/a') as cust_email_addr,   cal.mtn,   a.cust_id,  a.cust_line_seq_id,  a.device_nm_prev,  a.device_nm,  dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, case when a.fulfillement_ind='F' then 'direct' when a.fulfillement_ind='L' then 'local' else 'unknown' end as dfill, case when a.ecpd_liability_type_cd='C' then 'Business' else 'Consumer' end as Consumer_Business, case when dnsh.dns_type_cd is not null then 'Yes' When dnsh.dns_type_cd is null then 'No' end as on_dns_list, case when acs.currentstatus = 'Completed' and acs.mtn is not null then 'Yes'  else 'No' end as After_Cll_Survey  from ndcir_up_nc_emh_v as a  join  ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal ON a.cust_id = cal.cust_id AND a.cust_line_seq_id = cal.cust_line_seq_id AND a.activity_dt  BETWEEN cal.eff_dt AND cal.exp_dt  left join ntl_prd_allvm.cust_acct_line_dns_dly_hist_v as dnsh on a.sor_id = dnsh.sor_id and a.cust_id = dnsh.cust_id and a.cust_line_seq_id = dnsh.cust_line_seq_id and dnsh.dns_type_cd = 'SR' and a.activity_dt + 1 between dnsh.eff_dt and dnsh.exp_dt  left join (select sor_id, cust_id, acct_num, email_addr, email_status_ind,  email_selection_ind, entry_point, opt_in_dt,entry_dt, verify_ind  from ntl_prd_allvm.cust_acct_email_v  where email_selection_ind = 'X' ) as email on cal.sor_id = email.sor_id and cal.cust_id = email.cust_id and cal.acct_num = email.acct_num  left join ntl_prd_qmtbls.after_call_survey_emh_v as acs on cal.mtn = acs.mtn and cal.cust_id = acs.customerid  left join ntl_prd_allvm.hr_employee_hist_v as heh on a.hr_employee_id = heh.emp_id and a.activity_dt between heh.eff_dt and heh.exp_dt  left join ntl_prd_allvm.hr_employee_hist_v AS heh02              on heh.super_id_lvl2_emp_id = heh02.emp_id and a.activity_dt between heh02.eff_dt and heh02.exp_dt                   left join ntl_prd_allvm.hr_employee_hist_v AS heh01          on heh.super_id_lvl1_emp_id  = heh01.emp_id  and a.activity_dt between heh01.eff_dt and heh01.exp_dt    left join  ntl_prd_allvm.dns_type_v as dnsd on dnsh.dns_type_cd = dnsd.dns_type_cd  left join ntl_prd_allvm.outlet_v as o  on a.sls_outlet_id = o.sls_outlet_id   left join  ntl_prd_allvm.device_dp_map_v AS dm                   ON a.device_nm = dm.prod_nm   on a.cust_id = ndcir.cust_id and a.cust_line_seq_id = ndcir.cust_line_seq_id and a.activity_dt = ndcir.activity_dt  where  a.activity_mth = '2012-09-01' and a.sls_area_desc = 'Northeast' and a.sls_region_desc = 'New York Metro' and a.sls_dist_chnl_churn_ctgry = 'Stores' --and dfill = 'Local' --and cust_email_addr <> 'n/a' --and heh.job_cd in ('65045', 'V51103')     --and dm.device_tier not in ('Tablet', 'PC Card', 'Other') --and on_dns_list <> 'Yes' --and After_Cll_Survey <> 'Yes'  qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id order by a.cust_id, a.cust_line_seq_id, a.activity_dt) = 1  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33 order by a.sls_area_desc, a.sls_region_desc, a.activity_dt asc;	TERADATA	HABERER	00:00:00	00:00:00	17851
10/02/2012	12:04:14	NTL_PRD_ALLVM	02:16:04	0	3706		create volatile table Reporting_Month as (  select *  from ntl_prd_qmtbls.month_date_emh_v   where date_range = '2012-09-01'  ) with data primary index(month_range, date_range)  index(date_range) order by values(date_range) on commit preserve rows;   --Table one NC create volatile table nccir_base11 as (  select    'NC' as activity_type   ,(dla.activity_dt - (extract(day from dla.activity_dt)-1)) as activity_mth   ,dla.activity_dt   ,mh.area_desc   ,mh.region_desc   ,dla. ...	TERADATA	HABERER	02:16:04	00:00:00	17850
10/02/2012	11:41:40	NTL_PRD_ALLVM	00:26:05	3133			CREATE VOLATILE TABLE Repeat_Reporting_EMH1 AS (SELECT      acc.acss_call_ctr_desc,      acc.acss_call_ctr_cd,      ac.sor_id,      ac.acss_call_type_cd,     acc.acss_area_cd AS ctr_area,      acc.acss_call_ctr_type,      ac.cust_id,      ac.cust_line_seq_id,          ac.acct_num,      ac.mtn,      ac.acss_user_id,      ac.acss_call_dt,          ac.acss_call_tm,           (ac.call_disconnect_tm - ac.call_start_tm) HOUR TO SECOND (0) AS call_duration_tm,      COALESCE(sed.departmenttype,'Other') depttype,           COALESCE(sed.departmentgroup, 'Other') as dept_group,          CASE  WHEN acc.acss_call_ctr_time_zn LIKE 'C%' THEN                       ac.acss_call_tm + INTERVAL '1' HOUR                          WHEN acc.acss_call_ctr_time_zn LIKE 'M%' THEN               ac.acss_call_tm + INTERVAL '2' HOUR                          WHEN acc.acss_call_ctr_time_zn LIKE 'P%' THEN                 ac.acss_call_tm +INTERVAL '3' HOUR                            WHEN acc.acss_call_ctr_time_zn LIKE 'H%' THEN                ac.acss_call_tm + INTERVAL '5' HOUR                           ELSE ac.acss_call_tm         END acss_call_ad,      CAST(          ac.acss_call_dt ||          ' '             ||          CAST(acss_call_ad AS CHAR(8)) AS TIMESTAMP(0)      ) acss_dt_tm,      ad.acss_dept_desc,      ad.acss_dept_id,      ac.acss_call_id,      ac.area_cd,      RANK() OVER (PARTITION BY cust_id, cust_line_seq_id          ORDER BY ac.acss_call_dt, acss_call_ad, acss_call_id) rnk  FROM ntl_prd_allvm.acss_call_v AS ac  JOIN sys_calendar.calendar AS z        ON calendar_date= DATE   JOIN ntl_prd_allvm.acss_call_center_v AS acc      ON ac.acss_call_ctr_cd = acc.acss_call_ctr_cd  JOIN ntl_prd_allvm.acss_user_v AS au      ON ac.acss_user_id = au.acss_user_id  JOIN ntl_prd_allvm.acss_dept_v AS ad      ON ac.acss_dept_id = ad.acss_dept_id  LEFT JOIN ntl_prd_qmtbls.emh_eccr_dep AS sed    ON ad.acss_dept_id = sed.acssdeptid  LEFT JOIN                  (SELECT a.acss_call_dt,a.acss_call_ctr_cd, a.acss_dept_id FROM                  ntl_prd_allvm.acss_call_v  as a                                  JOIN sys_calendar.calendar AS z                                                                        ON calendar_date= DATE                                   WHERE                  a.acss_call_dt BETWEEN (DATE-(2)) AND (DATE-(2))                   AND a.acss_call_type_cd = '1'                  GROUP BY 1,2,3) r  ON          ac.acss_call_dt = r.acss_call_dt          AND ac.acss_call_ctr_cd = r.acss_call_ctr_cd          AND ac.acss_dept_id = r.acss_dept_id  WHERE ac.acss_call_dt BETWEEN (DATE-(2)) AND (DATE-(2))   AND COALESCE(sed.departmenttype,'Other') <> 'NA'  AND (      (ac.acss_call_type_cd IN ('1','7')) OR      (          ac.acss_call_type_cd = '3'          AND acc.acss_call_ctr_type = 'O'          AND ad.acss_dept_desc NOT LIKE '%offline%'          AND r.acss_dept_id IS NULL ))  ) WITH DATA PRIMARY INDEX (cust_id, cust_line_seq_id, acss_call_dt, acss_call_id, rnk) ON COMMIT PRESERVE ROWS;   CREATE TABLE NTL_PRD_QMTBLS.Repeat_Reporting_EMH21  AS  (  SELECT      a.sor_id,      a.acss_call_id,      a.acss_call_type_cd,      a.ctr_area,      a.acss_call_ctr_type,      m.area_cd,      m.region_desc,      a.cust_id,      a.cust_line_seq_id,      a.mtn,      a.acss_call_dt,          a.acss_call_ad,          a.acss_call_tm,           a.call_duration_tm,      a.rnk,      a.acss_dept_desc as initial_dept_desc,      a.acss_dept_id,      a.acss_user_id,      a.acss_call_ctr_desc,      a.acss_call_ctr_cd,      a.depttype AS orgtype,          a.dept_group as org_dept_group,      b.acss_call_id AS repeat_call_id,      b.acss_dept_desc AS repeat_dept_desc,      b.acss_dept_id AS repeat_dept_id,          b.acss_user_id AS repeat_user_id,          b.acss_call_ctr_desc AS repeat_call_ctr_desc,      b.acss_call_ctr_cd AS repeat_ctr_cd,      b.acss_call_dt AS repeat_dt,          b.acss_call_ad AS repeat_call_ad,         b.acss_call_tm as repeat_call_tm,           b.call_duration_tm as repeat_call_duration_tm,      b.rnk AS repeat_rnk,      b.depttype AS reptype,          b.dept_group as rpt_dept_group,      CASE WHEN b.acss_dt_tm IS NOT NULL THEN        ((b.acss_dt_tm - a.acss_dt_tm) DAY(4) TO MINUTE ) END tsdiff,      CASE WHEN b.acss_dt_tm IS NOT NULL THEN        (EXTRACT(HOUR FROM tsdiff) * 60)        + EXTRACT(MINUTE FROM tsdiff)        + (CAST((CAST ((tsdiff) AS INTERVAL DAY)) AS INTEGER) * 1440) END min_diff  FROM Repeat_Reporting_EMH1 AS a  JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt                 JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)       INNER JOIN Repeat_Reporting_EMH1 AS b          ON  a.cust_id = b.cust_id          AND a.cust_line_seq_id = b.cust_line_seq_id                  AND a.acss_call_dt = b.acss_call_dt                       AND b.rnk = a.rnk + 1          AND b.acss_call_id <> a.acss_call_id                  --AND ( b.acss_call_ad -  a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00'              LEFT JOIN ntl_prd_allvm.acss_call_center_v AS acc      ON b.acss_call_ctr_cd = acc.acss_call_ctr_cd  ) WITH DATA PRIMARY INDEX( sor_id, acss_call_id, acss_call_type_cd, ctr_area, acss_call_ctr_type, area_cd, region_desc, cust_id, cust_line_seq_id, mtn, acss_call_dt, acss_call_ad, acss_call_tm, call_duration_tm, rnk, initial_dept_desc, acss_dept_id, acss_user_id, acss_call_ctr_desc, acss_call_ctr_cd, orgtype, org_dept_group, repeat_call_id, repeat_dept_desc, repeat_dept_id, repeat_user_id, repeat_call_ctr_desc, repeat_ctr_cd, repeat_dt, repeat_call_ad, repeat_call_tm, repeat_call_duration_tm, repeat_rnk, reptype, rpt_dept_group, tsdiff, min_diff);  select a.acss_call_ctr_desc, hr1.nm_last || ', ' || hr1.nm_first AS  AD_Nm,  hr2.nm_last || ', ' || hr2.nm_first AS Supv_Nm,    u.nm_last||', '||u.nm_first AS First_Rep_nm,  a.initial_dept_desc,  a.acss_user_id, a.mtn, a.cust_id, a.area_cd, a.region_desc, CASE WHEN cal.Device_type_cd LIKE '%4GS%'  THEN cal.device_prod_nm  ELSE cal.prod_nm END AS Device_Nm, dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, a.orgtype, a.acss_call_dt, a.acss_call_ad, a.acss_call_tm, a.call_duration_tm, a.repeat_call_ctr_desc, u1.nm_last||', '||u1.nm_first AS Repeat_Rep_nm,  a.repeat_dept_desc, a.reptype, a.repeat_dt, a.repeat_call_ad, a.repeat_call_tm, a.repeat_call_duration_tm, a.tsdiff, a.min_diff, CASE WHEN (a.repeat_call_ad - a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00' THEN  'Y' ELSE 'N' END AS Rpts_2hrs_and_Under   FROM NTL_PRD_QMTBLS.Repeat_Reporting_EMH21 AS a  JOIN sys_calendar.calendar AS z   ON calendar_date= DATE   JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt       LEFT JOIN  ntl_prd_allvm.device_dp_map_v AS dm                     ON (CASE WHEN cal.Device_type_cd LIKE '%4GS%' THEN cal.device_prod_nm ELSE cal.prod_nm END) = dm.prod_nm                JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)  LEFT JOIN ntl_prd_qmtbls.stm_eccr_area AS s    ON a.acss_call_ctr_cd = s.acsscallcentercd    AND a.acss_dept_id = s.acssdeptid      Join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id = u.acss_user_id    JOIN ntl_prd_allvm.hr_employee_v AS hr  ON u.hr_employee_id = hr.emp_id    LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr2              ON hr.SUPER_ID_LVL2_EMP_ID = hr2.emp_id                     LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr1           ON hr.SUPER_ID_LVL1_EMP_ID = hr1.emp_id   Join ntl_prd_allvm.acss_user_v AS u1  on a.repeat_user_id = u1.acss_user_id  WHERE acss_call_dt BETWEEN '2012-09-01' AND ADD_MONTHS('2012-09-01',1)-1 and a.orgtype IN ('CS','WDTS')  and a.reptype IN ('CS','WDTS')  and a.org_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.rpt_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.acss_call_ctr_desc IN('NE Columbia SC',  'NE Huntsville AL',  'NE Hanover MD',  'NE Rochester NY',  'NE Charleston SC',  'NE Charlotte NC',  'NE Wallingford CT',  'NE Wilmington NC',  'NE Bangor ME',  'NE Columbia SC 2')    GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29 ORDER BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29;  DROP TABLE Repeat_Reporting_EMH1; DROP TABLE NTL_PRD_QMTBLS. Repeat_Reporting_EMH21;	TERADATA	HABERER	00:25:59	00:00:06	17849
10/02/2012	09:59:21	NTL_PRD_ALLVM	00:37:21	25175			--Step 1 - Find all of the accounts (cust_id level) that have been accessed by Retail during a calendar month.      CREATE VOLATILE TABLE retail_pos_trans AS ( SELECT m.area_desc AREA, m.region_desc REGION , p.store_num, o.district_cd, o.sls_outlet_nm STORE_NAME, o.sls_outlet_id, p.cust_id, p.trans_dt, MIN(p.trans_tm) TRANS_TIME      FROM pos_screen_usage_v p      INNER JOIN netace_outlet_xref_v x ON p.store_num = x.store_num AND p.sor_id = x.sor_id      INNER JOIN outlet_v o ON o.sls_outlet_id = x.sls_outlet_id AND o.sor_id = x.sor_id      INNER JOIN market_v m ON o.sls_outlet_mkt_cd = m.mkt_cd WHERE p.trans_dt BETWEEN '2012-09-15' AND '2012-09-30'     AND o.sls_dist_chnl_type_cd = 'M'     and m.area_desc = 'Northeast'     GROUP BY 1,2,3,4,5,6,7,8)     WITH DATA PRIMARY INDEX (area, region, district_cd, store_num, sls_outlet_id, cust_id, trans_dt, trans_time)      ON COMMIT PRESERVE ROWS;     --Step 2 - Find the net ace user id that was associated with the initial account lookup per day      CREATE VOLATILE TABLE retail_pos_trans2 AS ( SELECT m.area, m.region , m.district_cd, m.store_num, m.store_name, m.sls_outlet_id, m.cust_id, m.trans_dt, m.trans_time, p.netace_user_id, nu.netace_user_nm      FROM retail_pos_trans m      INNER JOIN pos_screen_usage_v p ON  m.store_num = p.store_num AND m.cust_id = p.cust_id AND m.trans_dt = p.trans_dt AND m.trans_time = p.trans_tm      LEFT OUTER JOIN netace_user_id_v nu ON p.netace_user_id = nu.netace_user_id)      WITH DATA PRIMARY INDEX (area, region, district_cd, store_num, sls_outlet_id, cust_id, trans_dt, trans_time, netace_user_id)      ON COMMIT PRESERVE ROWS;     --Step 3 - The store transaction time is translated to Pacific time based on the time zone associated with the Retail store. Time zone is found through store location zip code.     CREATE VOLATILE TABLE retail_pos_trans3 AS ( SELECT m.area, m.region , m.district_cd, m.store_num, m.store_name, m.sls_outlet_id, m.cust_id, m.trans_dt, m.netace_user_id, m.netace_user_nm,     CASE WHEN o.time_zone = 'Central' THEN m.trans_time - INTERVAL '2' HOUR                    WHEN o.time_zone = 'Mountain' THEN m.trans_time - INTERVAL '1' HOUR             WHEN o.time_zone = 'Eastern' THEN m.trans_time - INTERVAL '3' HOUR                     WHEN o.time_zone = 'Hawaii' THEN m.trans_time + INTERVAL '3' HOUR              ELSE m.trans_time END TRANS_TIME_PST            FROM retail_pos_trans2 m             INNER JOIN netace_outlet_xref_v x ON m.store_num = x.store_num             INNER JOIN (SELECT o.sor_id, o.sls_outlet_mkt_cd, o.district_cd, o.sls_outlet_id, o.sls_outlet_nm, CASE WHEN o.state_cd = 'AZ' THEN 'Arizona'     WHEN o.state_cd = 'HI' THEN 'Hawaii'     ELSE z.tm_zone END TIME_ZONE FROM outlet_v o LEFT JOIN zip_v z ON o.zip5_cd = z.zip5_cd WHERE sls_dist_chnl_type_cd = 'M'     AND store_open_dt IS NOT NULL     AND store_close_dt IS NULL) o ON o.sls_outlet_id = x.sls_outlet_id)      WITH DATA PRIMARY INDEX (area, region, district_cd, store_num, sls_outlet_id, cust_id, trans_dt, netace_user_id, trans_time_pst)      ON COMMIT PRESERVE ROWS;     --Step 4 - Type 1 & 7 calls are identified that took place within the time period of the retail transaction date and 2 days after the retail transaction date --The time of the call is adjusted to Pacific time zone      CREATE VOLATILE TABLE retail_pos_trans_calls AS ( SELECT a.area, a.region, a.district_cd, a.store_num, a.store_name, a.sls_outlet_id, a.cust_id, b.mtn, a.trans_dt, a.trans_time_pst, a.netace_user_id,      a.netace_user_nm, b.acss_call_ctr_cd, b.acss_user_id, b.acss_call_tm,      CASE WHEN c.acss_call_ctr_time_zn = 'CDT' THEN b.acss_call_tm - INTERVAL '2' HOUR          WHEN c.acss_call_ctr_time_zn = 'MDT' THEN b.acss_call_tm - INTERVAL '1' HOUR       WHEN c.acss_call_ctr_time_zn IN ('EDT','TY') THEN b.acss_call_tm - INTERVAL '3' HOUR        WHEN c.acss_call_ctr_time_zn = 'HST' THEN b.acss_call_tm + INTERVAL '3' HOUR       ELSE b.acss_call_tm END ACSS_CALL_TM_PST,      (b.call_disconnect_tm - b.call_start_tm) HOUR TO SECOND (0) AS call_duration_tm, b.acss_call_dt, b.acss_call_type_cd, b.acss_call_id, b.acss_dept_id      FROM retail_pos_trans3 a      LEFT OUTER JOIN acss_call_v b ON a.cust_id = b.cust_id AND b.acss_call_dt BETWEEN a.trans_dt AND a.trans_dt+2 AND b.acss_call_type_cd IN ('1','7')      AND b.acss_dept_id IN ('225','155','156','199','311','72','117','158','78','299','10','207','142','313','321','322','309','229','310',  '221','51','277','3','55','150','83','151','132','82','166','148','318','317','136','264','170','203','290','209','179')     LEFT OUTER JOIN acss_call_center_v c ON b.acss_call_ctr_cd = c.acss_call_ctr_cd)      WITH DATA PRIMARY INDEX (area, region, district_cd, store_num, sls_outlet_id, cust_id, trans_dt, trans_time_pst, netace_user_id, acss_user_id, acss_call_tm, acss_call_tm_pst, acss_call_dt, acss_call_id)      ON COMMIT PRESERVE ROWS;     --Step 5 - The Pacific time of the call to CS is compared to the Pacific time of the retail transaction to determine which came first      CREATE VOLATILE TABLE retail_pos_trans_calls2 AS ( SELECT a.area, a.region, a.district_cd, a.store_num, a.sls_outlet_id, a.store_name, a.cust_id, a.mtn, a.trans_dt, a.trans_time_pst, a.netace_user_id, a.netace_user_nm,      a.acss_call_ctr_cd, a.acss_user_id, a.acss_call_tm_pst, a.acss_call_tm, a.call_duration_tm, a.acss_call_dt, a.acss_call_type_cd, a.acss_call_id, a.acss_dept_id,      CASE WHEN a.acss_call_tm_pst IS NULL THEN 'NO CALL FOUND'     WHEN (a.acss_call_dt <= a.trans_dt AND a.acss_call_tm_pst < a.trans_time_pst) THEN 'BEFORE RETAIL'     ELSE 'AFTER RETAIL' END AS WHEN_CALL     FROM retail_pos_trans_calls a)     WITH DATA PRIMARY INDEX (area, region, district_cd, store_num, sls_outlet_id, cust_id, trans_dt, trans_time_pst, netace_user_id, acss_user_id, acss_call_tm_pst, acss_call_tm, acss_call_dt, acss_call_id, when_call)      ON COMMIT PRESERVE ROWS;     --Step 6 - OC&C transaction at MTN level and Account level are compiled on the customers who called into CS.     CREATE VOLATILE TABLE retail_pos_trans_calls_occ AS ( SELECT mot.trans_seq_id, mot.cust_id, mot.occ_cd, occ.occ_desc, mot.trans_dt, mot.occ_reas_cd, orv.occ_reas_desc, mot.user_id,      COALESCE(mot.approver_id, mot.user_id) APPROVER, mot.occ_amt      FROM mtn_occ_trans_v  AS mot      INNER JOIN retail_pos_trans_calls rpt ON mot.cust_id = rpt.cust_id AND mot.trans_dt = rpt.acss_call_dt AND mot.user_id = rpt.acss_user_id      LEFT OUTER JOIN cust_acct_v AS cav ON mot.sor_id = cav.sor_id AND mot.mkt_cd = cav.mkt_cd AND mot.cust_id = cav.cust_id AND mot.acct_num = cav.acct_num      INNER JOIN occ_v AS occ ON mot.occ_cd = occ.occ_cd      INNER JOIN occ_reason_v orv ON mot.occ_reas_cd = orv.occ_reas_cd      INNER JOIN acss_user_v AS au ON COALESCE(mot.approver_id, mot.user_id) = au.acss_user_id      WHERE mot.trans_dt  BETWEEN '2012-09-15' AND '2012-09-30'       AND mot.occ_status_cd = 'A'     AND mot.user_generated = 'Y'     AND mot.occ_reas_cd <> 'SB'     UNION     SELECT cao.trans_seq_id, cao.cust_id, cao.occ_cd, occ.occ_desc, cao.trans_dt, cao.occ_reas_cd, orv.occ_reas_desc, cao.user_id, COALESCE(cao.approver_id, cao.user_id) APPROVER, cao.occ_amt      FROM cust_acct_occ_trans_v AS cao      INNER JOIN retail_pos_trans_calls rpt ON cao.cust_id = rpt.cust_id AND cao.trans_dt = rpt.acss_call_dt AND cao.user_id = rpt.acss_user_id      LEFT OUTER JOIN cust_acct_v AS cav ON cao.sor_id = cav.sor_id AND cao.mkt_cd = cav.mkt_cd AND cao.cust_id = cav.cust_id AND cao.acct_num = cav.acct_num      INNER JOIN occ_v AS occ ON cao.occ_cd = occ.occ_cd      INNER JOIN occ_reason_v orv ON cao.occ_reas_cd = orv.occ_reas_cd      INNER JOIN acss_user_v AS au ON COALESCE(cao.approver_id, cao.user_id) = au.acss_user_id      WHERE cao.trans_dt BETWEEN '2012-09-15' AND '2012-09-30'     AND cao.occ_status_cd = 'A'     AND cao.user_generated = 'Y'     AND cao.occ_reas_cd <> 'SB')     WITH DATA PRIMARY INDEX (trans_seq_id)     ON COMMIT PRESERVE ROWS;     --Step 7 - Final query output used to produce 3-Day Retail Store Customer Call In Rate reporting      SELECT a.area, a.region, a.district_cd, a.store_num, a.store_name, a.sls_outlet_id, a.netace_user_nm, a.when_call,      COUNT(DISTINCT a.cust_id||a.trans_dt) ACCOUNTS,      COUNT(DISTINCT a.acss_call_id) CALLS,     COALESCE(SUM(b.occ_amt),0) OCC     FROM retail_pos_trans_calls2 a     LEFT OUTER JOIN retail_pos_trans_calls_occ b ON a.cust_id = b.cust_id AND a.trans_dt = b.trans_dt AND a.acss_user_id = b.user_id GROUP BY 1,2,3,4,5,6,7,8;     --Step 8 - Export call detail from retail_pos_trans_calls2 table      SELECT      acall.area,      acall.region,      acall.district_cd,      acall.store_num,      acall.sls_outlet_id,      acall.store_name,      acall.trans_dt,      acall.trans_time_pst,      acall.netace_user_nm,      acall.netace_user_id,      acall.mtn,     acall.cust_id,      CASE WHEN cc.acss_call_ctr_desc IN ('NE Columbia SC 2', 'NE Columbia SC') THEN 'NE Columbia'     ELSE cc.acss_call_ctr_desc END AS Center,     u.nm_last||', '||u.nm_first AS rep_nm,     acall.acss_user_id,      acall.acss_call_dt,      acall.acss_call_id,     acall.acss_call_tm,     acall.acss_call_tm_pst,       acall.call_duration_tm,      CASE WHEN (acall.acss_call_tm_pst - acall.trans_time_pst) HOUR TO MINUTE BETWEEN '0:01' AND '00:04' THEN  'Y' ELSE 'N' END AS one_to_four_min,      CASE WHEN (acall.acss_call_tm_pst - acall.trans_time_pst) HOUR TO MINUTE BETWEEN '0:05' AND '00:10' THEN  'Y' ELSE 'N' END AS five_to_ten_min,     CASE WHEN (acall.acss_call_tm_pst - acall.trans_time_pst) HOUR TO MINUTE BETWEEN '0:01' AND '00:10' THEN  'Y' ELSE 'N' END AS one_to_ten_min,     CASE WHEN acall.trans_dt = acall.acss_call_dt Then 'Yes' else 'No' end as Same_Day,     acall.WHEN_CALL     FROM retail_pos_trans_calls2 AS acall      JOIN ntl_prd_allvm.acss_user_v AS u      ON acall.acss_user_id =  u.acss_user_id            JOIN ntl_prd_allvm.hr_employee_v AS hr --This table is only used when we are not including Vendor Centers. If you want all calls remove the hr_employee_v table.     ON u.hr_employee_id = hr.emp_id     AND hr.job_desc IN ('Rep-Customer Service',      'Sr Rep-Customer Service',      'Coord-Customer Service',     'Coord-Tech Support I',     'Coord-Tech Support II')                   INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc       ON acall.acss_call_ctr_cd = cc.acss_call_ctr_cd            WHERE acall.when_call = 'AFTER RETAIL'     AND Same_Day = 'Yes'     and one_to_ten_min ='Y'            GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25     ORDER BY 1,2;     --DROP TABLE retail_pos_trans;     --DROP TABLE retail_pos_trans2;     --DROP TABLE retail_pos_trans3;     --DROP TABLE retail_pos_trans_calls;     --DROP TABLE retail_pos_trans_calls2;     --DROP TABLE retail_pos_trans_calls_occ;	TERADATA	HABERER	00:22:42	00:14:39	17848
10/02/2012	09:46:16	NTL_PRD_ALLVM	00:00:00	0	3807		drop table upcir_base33;	TERADATA	HABERER	00:00:00	00:00:00	17847
10/02/2012	09:46:11	NTL_PRD_ALLVM	00:00:00	0	3807		drop table upcir_base22; drop table upcir_base33; drop table upcir_base22a; drop table upcir_base22aa; drop table upcir_base22b; drop table upcir_base22bb; drop table upcir_up_v; drop table ndcir_up_nc_emh_v;	TERADATA	HABERER	00:00:00	00:00:00	17846
10/02/2012	09:43:20	NTL_PRD_ALLVM	00:00:09	0	3807		drop table Reporting_Month; drop table nccir_base11; drop table nccir_base1a; drop table nccir_base11b; drop table nccir_acts_v; drop table upcir_base11; drop table upcir_base22; drop table upcir_base33; drop table upcir_base22a; drop table upcir_base22aa; drop table upcir_base22b; drop table upcir_base22bb; drop table upcir_up_v; drop table ndcir_up_nc_emh_v;	TERADATA	HABERER	00:00:09	00:00:00	17845
10/02/2012	09:41:30	NTL_PRD_ALLVM	00:20:46	0			create volatile table Reporting_Month as (  select *  from ntl_prd_qmtbls.month_date_emh_v   where date_range = '2012-09-01'  ) with data primary index(month_range, date_range)  index(date_range) order by values(date_range) on commit preserve rows;   --Table one NC create volatile table nccir_base11 as (  select    'NC' as activity_type   ,(dla.activity_dt - (extract(day from dla.activity_dt)-1)) as activity_mth   ,dla.activity_dt   ,mh.area_desc   ,mh.region_desc   ,dla. ...	TERADATA	HABERER	00:20:46	00:00:00	17844
10/02/2012	09:18:50	NTL_PRD_ALLVM	00:00:17	0			drop table Reporting_Month; drop table nccir_base11; drop table nccir_base1a; drop table nccir_base11b; drop table nccir_acts_v; drop table upcir_base11; drop table upcir_base22; drop table upcir_base33; drop table upcir_base22a; drop table upcir_base22aa; drop table upcir_base22b; drop table upcir_base22bb; drop table upcir_up_v; drop table ndcir_up_nc_emh_v;	TERADATA	HABERER	00:00:17	00:00:00	17843
10/02/2012	09:17:05	NTL_PRD_ALLVM	00:01:13	571			select a.activity_mth, a.activity_dt, a.activity_type, a.cust_area, a.cust_region, cal.mtn, a.cust_id, a.cust_line_seq_id,  a.fulfillment_ind, CASE WHEN cal.Device_type_cd LIKE '%4GS%'  THEN cal.device_prod_nm  ELSE cal.prod_nm END AS Device_Nm,  ndcir.device_nm as unmsk_device_nm, a.prod_nm as msk_device_nm, a.data_tier_fin, a.device_generation, a.prod_nm_prev, a.data_tier_fin_prev, a.device_generation_prev,  a.sales_area, a.sales_region, a.sls_dist_chnl_churn_ctgry, a.outlet as Upgrd_Channel, a.emp_nm as upgrd_emp_nm, a.job_desc as upgrd_job_desc, a.hr_employee_id as upgrd_hr_employee_id, a.nt_user_id as upgrd_nt_user_id, acall.acss_call_dt upgrd_call_dt, acall.acss_call_tm as upgrd_call_tm,   CASE   WHEN cc1.acss_call_ctr_time_zn LIKE 'C%' THEN              acall.acss_call_tm + INTERVAL '1' HOUR          WHEN cc1.acss_call_ctr_time_zn LIKE 'M%' THEN              acall.acss_call_tm + INTERVAL '2' HOUR         WHEN cc1.acss_call_ctr_time_zn LIKE 'P%' THEN              acall.acss_call_tm +INTERVAL '3' HOUR          WHEN cc1.acss_call_ctr_time_zn LIKE 'H%' THEN              acall.acss_call_tm + INTERVAL '5' HOUR          ELSE acall.acss_call_tm       END upgrd_call_est_tm, (acall.call_disconnect_tm - acall.call_start_tm) HOUR TO SECOND (0) AS upgrd_duration_tm,   ---Calls following the initial call cc.acss_call_ctr_desc, a.acss_call_ctr_cd, u.nm_last||', '||u.nm_first AS rep_nm,  a.acss_user_id, ad.acss_dept_desc,  a.acss_call_dt, a.acss_call_tm, a.call_duration, a.call_period   from ntl_prd_qmvm.ndcir_detail_v as a  inner join  ntl_prd_allvm.acss_call_v AS acall  on a.sor_id = acall.sor_id and a.cust_id = acall.cust_id  and a.cust_line_seq_id = acall.cust_line_seq_id  and a.nt_user_id = acall.acss_user_id  and a.activity_dt = acall.acss_call_dt  --and a.acss_call_id <> acall.acss_call_id and acall.acss_call_type_cd IN ('1','3','7')   left join (Select activity_dt, cust_id, cust_line_seq_id, device_nm  from ndcir_up_nc_emh_v  where  activity_mth = '2012-09-01' and activity_type = 'UP' and sls_dist_chnl_churn_ctgry = 'NonComm'   qualify row_number() over (partition by cust_id, cust_line_seq_id order by cust_id, cust_line_seq_id, activity_dt) = 1  group by 1,2,3,4 ) as ndcir on a.cust_id = ndcir.cust_id and a.cust_line_seq_id = ndcir.cust_line_seq_id and a.activity_dt = ndcir.activity_dt  join  ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal on a.cust_id = cal.cust_id and  a.cust_line_seq_id = cal.cust_line_seq_id and  a.activity_dt between cal.eff_dt and cal.exp_dt    INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc1     ON acall.acss_call_ctr_cd = cc1.acss_call_ctr_cd  JOIN ntl_prd_allvm.acss_user_v AS u     ON a.acss_user_id =  u.acss_user_id      INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc     ON a.acss_call_ctr_cd = cc.acss_call_ctr_cd     INNER JOIN ntl_prd_allvm.acss_dept_v AS ad     ON a.acss_dept_id = ad.acss_dept_id  where a.activity_dt between '2012-09-15' and '2012-09-27' and a.activity_type = 'UP' and a.sales_area = 'Northeast' and a.sls_dist_chnl_churn_ctgry = 'NonComm' and a.outlet in ('NE Wallingford CT', 'NE Wilmington NC', 'NE Huntsville AL', 'NE Rochester NY' 'NE Charleston SC', 'NE Columbia SC 2', 'NE Columbia SC', 'NE Charlotte NC', 'NE Hanover MD', 'NE Bangor ME') and a.acss_call_ctr_type||a.acss_call_type_cd IN ('v1', 'v7', 'o1', 'o3', 'o7')  and a.acss_call_dt BETWEEN a.activity_dt AND  ADD_MONTHS(a.activity_dt,0)+ 2;   --drop table Reporting_Month; --drop table nccir_base11; --drop table nccir_base1a; --drop table nccir_base11b; --drop table nccir_acts_v; --drop table upcir_base11; --drop table upcir_base22; --drop table upcir_base33; --drop table upcir_base22a;	TERADATA	HABERER	00:01:12	00:00:01	17842
10/02/2012	09:01:03	NTL_PRD_ALLVM	00:15:21	0	3706		create volatile table Reporting_Month as (  select *  from ntl_prd_qmtbls.month_date_emh_v   where date_range = '2012-09-01'  ) with data primary index(month_range, date_range)  index(date_range) order by values(date_range) on commit preserve rows;   --Table one NC create volatile table nccir_base11 as (  select    'NC' as activity_type   ,(dla.activity_dt - (extract(day from dla.activity_dt)-1)) as activity_mth   ,dla.activity_dt   ,mh.area_desc   ,mh.region_desc   ,dla. ...	TERADATA	HABERER	00:15:21	00:00:00	17841
10/02/2012	08:54:23	NTL_PRD_ALLVM	00:00:03	0			SELECT top 100 * FROM ntl_prd_qmtbls.mrs_ndcir_detail  where activity_dt = '2012-09-21' and prod_nm like '%IPHONE 4S%'	TERADATA	HABERER	00:00:03	00:00:00	17840
10/02/2012	08:48:18	NTL_PRD_ALLVM	00:00:08	100			SELECT top 100 * FROM ntl_prd_qmtbls.mrs_ndcir_detail  where activity_dt = '2012-09-21'	TERADATA	HABERER	00:00:07	00:00:01	17839
10/02/2012	08:45:11	NTL_PRD_ALLVM	00:00:10	0			drop table Reporting_Month; drop table nccir_base11; drop table nccir_base1a; drop table nccir_base11b; drop table nccir_acts_v; drop table upcir_base11; drop table upcir_base22; drop table upcir_base33; drop table upcir_base22a; drop table upcir_base22aa; drop table upcir_base22b; drop table upcir_base22bb; drop table upcir_up_v; drop table ndcir_up_nc_emh_v;	TERADATA	HABERER	00:00:10	00:00:00	17838
10/02/2012	08:38:13	NTL_PRD_ALLVM	00:00:09	100			SELECT top 100 * FROM ntl_prd_qmtbls.mrs_ndcir_detail  where activity_dt = '2012-09-21'	TERADATA	HABERER	00:00:09	00:00:00	17837
10/02/2012	08:36:27	NTL_PRD_ALLVM	00:00:02	0			SELECT top 100 * FROM ntl_prd_qmtbls.mrs_ndcir_detail  where prod_nm like '%iphone%' and activity_dt = '2012-09-21'	TERADATA	HABERER	00:00:02	00:00:00	17836
10/02/2012	08:35:52	NTL_PRD_ALLVM	00:00:00	0	3707		SELECT * FROM ntl_prd_qmtbls.mrs_ndcir_detail  where prod_nm is like '%iphone%' and activity_dt = '2012-09-21'	TERADATA	HABERER	00:00:00	00:00:00	17835
10/02/2012	08:32:51	NTL_PRD_ALLVM	00:00:35	571			select a.activity_mth, a.activity_dt, a.activity_type, a.cust_area, a.cust_region, cal.mtn, a.cust_id, a.cust_line_seq_id,  a.fulfillment_ind, CASE WHEN cal.Device_type_cd LIKE '%4GS%'  THEN cal.device_prod_nm  ELSE cal.prod_nm END AS Device_Nm, cal.prod_nm, cal.device_type_cd, cal.device_prod_nm, a.prod_nm, a.data_tier_fin, a.device_generation, a.prod_nm_prev, a.data_tier_fin_prev, a.device_generation_prev,  a.sales_area, a.sales_region, a.sls_dist_chnl_churn_ctgry, a.outlet as Upgrd_Channel, a.emp_nm as upgrd_emp_nm, a.job_desc as upgrd_job_desc, a.hr_employee_id as upgrd_hr_employee_id, a.nt_user_id as upgrd_nt_user_id, acall.acss_call_dt upgrd_call_dt, acall.acss_call_tm as upgrd_call_tm,   CASE   WHEN cc1.acss_call_ctr_time_zn LIKE 'C%' THEN              acall.acss_call_tm + INTERVAL '1' HOUR          WHEN cc1.acss_call_ctr_time_zn LIKE 'M%' THEN              acall.acss_call_tm + INTERVAL '2' HOUR         WHEN cc1.acss_call_ctr_time_zn LIKE 'P%' THEN              acall.acss_call_tm +INTERVAL '3' HOUR          WHEN cc1.acss_call_ctr_time_zn LIKE 'H%' THEN              acall.acss_call_tm + INTERVAL '5' HOUR          ELSE acall.acss_call_tm       END upgrd_call_est_tm, (acall.call_disconnect_tm - acall.call_start_tm) HOUR TO SECOND (0) AS upgrd_duration_tm,   ---Calls following the initial call cc.acss_call_ctr_desc, a.acss_call_ctr_cd, u.nm_last||', '||u.nm_first AS rep_nm,  a.acss_user_id, ad.acss_dept_desc,  a.acss_call_dt, a.acss_call_tm, a.call_duration, a.call_period   from ntl_prd_qmvm.ndcir_detail_v as a  inner join  ntl_prd_allvm.acss_call_v AS acall  on a.sor_id = acall.sor_id and a.cust_id = acall.cust_id  and a.cust_line_seq_id = acall.cust_line_seq_id  and a.nt_user_id = acall.acss_user_id  and a.activity_dt = acall.acss_call_dt  --and a.acss_call_id <> acall.acss_call_id and acall.acss_call_type_cd IN ('1','3','7')   join  ntl_prd_secvm.cust_acct_line_dly_hist_v  AS cal on a.cust_id = cal.cust_id and  a.cust_line_seq_id = cal.cust_line_seq_id and  a.activity_dt between cal.eff_dt and cal.exp_dt    INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc1     ON acall.acss_call_ctr_cd = cc1.acss_call_ctr_cd  JOIN ntl_prd_allvm.acss_user_v AS u     ON a.acss_user_id =  u.acss_user_id      INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc     ON a.acss_call_ctr_cd = cc.acss_call_ctr_cd     INNER JOIN ntl_prd_allvm.acss_dept_v AS ad     ON a.acss_dept_id = ad.acss_dept_id  where a.activity_dt between '2012-09-15' and '2012-09-27' and a.activity_type = 'UP' and a.sales_area = 'Northeast' and a.sls_dist_chnl_churn_ctgry = 'NonComm' and a.outlet in ('NE Wallingford CT', 'NE Wilmington NC', 'NE Huntsville AL', 'NE Rochester NY' 'NE Charleston SC', 'NE Columbia SC 2', 'NE Columbia SC', 'NE Charlotte NC', 'NE Hanover MD', 'NE Bangor ME') and a.acss_call_ctr_type||a.acss_call_type_cd IN ('v1', 'v7', 'o1', 'o3', 'o7')  and a.acss_call_dt BETWEEN a.activity_dt AND  ADD_MONTHS(a.activity_dt,0)+ 2	TERADATA	HABERER	00:00:34	00:00:01	17834
10/02/2012	07:43:24	NTL_PRD_ALLVM	00:01:19	41300			select  a.activity_mth,  a.activity_dt,  a.activity_type,  a.sls_area_desc as sales_area,  a.sls_region_desc as sales_region,  a.sls_dist_chnl_churn_ctgry,  a.sls_outlet_id,  o.sls_outlet_nm as outlet,   coalesce(case when heh.nm_mdlin is null then   heh.nm_last||', '||heh.nm_first   else heh.nm_last||', '||heh.nm_first||' '||trim(heh.nm_mdlin)||'.' end, 'Unknown') as sls_rep_nm, heh.job_desc, coalesce(case when heh02.nm_mdlin is null then   heh02.nm_last||', '||heh02.nm_first   else heh02.nm_last||', '||heh02.nm_first||' '||trim(heh02.nm_mdlin)||'.' end, 'Unknown') as sls_rep_direct_mgr,  heh02.email_addr as rep_direct_mgr_email,  heh02.job_desc as direct_mgr_job_desc,  coalesce(case when heh01.nm_mdlin is null then   heh01.nm_last||', '||heh01.nm_first   else heh01.nm_last||', '||heh01.nm_first||' '||trim(heh01.nm_mdlin)||'.' end, 'Unknown') as sls_district_mgr_nm,  heh01.email_addr as district_mgr_email,  heh01.job_desc as district_mgr_job_desc,  o.district_cd as Zone_District_cd,  a.area_desc as cust_area_desc,  a.region_desc as cust_region_desc,  cal.nm_first||'   '||cal.nm_last AS cust_name,  a.lang_pref_ind,  coalesce(email.email_addr, 'n/a') as cust_email_addr,   cal.mtn,   a.cust_id,  a.cust_line_seq_id,  a.device_nm_prev,  a.device_nm,  dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, case when a.fulfillement_ind='F' then 'direct' when a.fulfillement_ind='L' then 'local' else 'unknown' end as dfill, case when a.ecpd_liability_type_cd='C' then 'Business' else 'Consumer' end as Consumer_Business, case when dnsh.dns_type_cd is not null then 'Yes' When dnsh.dns_type_cd is null then 'No' end as on_dns_list, case when acs.currentstatus = 'Completed' and acs.mtn is not null then 'Yes'  else 'No' end as After_Cll_Survey, cal.mtn_status_ind, cal.line_term_dt, case when ndcir.cust_id is not null and ndcir.activity_dt is not null then 'Yes' else 'No' end as test1  from ndcir_up_nc_emh_v as a  join  ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal ON a.cust_id = cal.cust_id AND a.cust_line_seq_id = cal.cust_line_seq_id AND a.activity_dt  BETWEEN cal.eff_dt AND cal.exp_dt  left join ntl_prd_allvm.cust_acct_line_dns_dly_hist_v as dnsh on a.sor_id = dnsh.sor_id and a.cust_id = dnsh.cust_id and a.cust_line_seq_id = dnsh.cust_line_seq_id and dnsh.dns_type_cd = 'SR' and a.activity_dt + 1 between dnsh.eff_dt and dnsh.exp_dt  left join (select sor_id, cust_id, acct_num, email_addr, email_status_ind,  email_selection_ind, entry_point, opt_in_dt,entry_dt, verify_ind  from ntl_prd_allvm.cust_acct_email_v  where email_selection_ind = 'X' ) as email on cal.sor_id = email.sor_id and cal.cust_id = email.cust_id and cal.acct_num = email.acct_num  left join ntl_prd_qmtbls.after_call_survey_emh_v as acs on cal.mtn = acs.mtn and cal.cust_id = acs.customerid  left join ntl_prd_allvm.hr_employee_hist_v as heh on a.hr_employee_id = heh.emp_id and a.activity_dt between heh.eff_dt and heh.exp_dt  left join ntl_prd_allvm.hr_employee_hist_v AS heh02              on heh.super_id_lvl2_emp_id = heh02.emp_id and a.activity_dt between heh02.eff_dt and heh02.exp_dt                   left join ntl_prd_allvm.hr_employee_hist_v AS heh01          on heh.super_id_lvl1_emp_id  = heh01.emp_id  and a.activity_dt between heh01.eff_dt and heh01.exp_dt    left join  ntl_prd_allvm.dns_type_v as dnsd on dnsh.dns_type_cd = dnsd.dns_type_cd  left join ntl_prd_allvm.outlet_v as o  on a.sls_outlet_id = o.sls_outlet_id   left join  ntl_prd_allvm.device_dp_map_v AS dm                   ON a.device_nm = dm.prod_nm    left join (select  a.activity_dt ,a.cust_id ,a.cust_line_seq_id ,case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill ,a.fulfillment_ind ,count(distinct a.cust_id||a.cust_line_seq_id) as acts    from ntl_prd_qmtbls.mrs_ndcir_detail as a   where  a.activity_dt between '2012-09-21' and '2012-09-28' and a.sls_area_desc = 'Northeast' and a.sls_region_desc = 'New York Metro' and a.sls_dist_chnl_churn_ctgry = 'Stores'  qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id order by a.cust_id, a.cust_line_seq_id, a.activity_dt) = 1  group by 1,2,3,4,5) as ndcir  on a.cust_id = ndcir.cust_id and a.cust_line_seq_id = ndcir.cust_line_seq_id and a.activity_dt = ndcir.activity_dt  where  a.activity_mth = '2012-09-01' and a.sls_area_desc = 'Northeast' and a.sls_region_desc = 'New York Metro' and a.sls_dist_chnl_churn_ctgry = 'Stores' --and dfill = 'Local' --and cust_email_addr <> 'n/a' --and heh.job_cd in ('65045', 'V51103')     --and dm.device_tier not in ('Tablet', 'PC Card', 'Other') --and on_dns_list <> 'Yes' --and After_Cll_Survey <> 'Yes'  qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id order by a.cust_id, a.cust_line_seq_id, a.activity_dt) = 1  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36 order by a.sls_area_desc, a.sls_region_desc, a.activity_dt asc;  --drop table Reporting_Month; --drop table nccir_base11; --drop table nccir_base1a; --drop table nccir_base11b; --drop table nccir_acts_v; --drop table upcir_base11; --drop table upcir_base22; --drop table upcir_base33; --drop table upcir_base22a; --drop table upcir_base22aa; --drop table upcir_base22b; --drop table upcir_base22bb; --drop table upcir_up_v; --drop table ndcir_up_nc_emh_v;	TERADATA	HABERER	00:00:29	00:00:50	17833
10/02/2012	07:41:50	NTL_PRD_ALLVM	00:00:00	0	3504		select  a.activity_mth,  a.activity_dt,  a.activity_type,  a.sls_area_desc as sales_area,  a.sls_region_desc as sales_region,  a.sls_dist_chnl_churn_ctgry,  a.sls_outlet_id,  o.sls_outlet_nm as outlet,   coalesce(case when heh.nm_mdlin is null then   heh.nm_last||', '||heh.nm_first   else heh.nm_last||', '||heh.nm_first||' '||trim(heh.nm_mdlin)||'.' end, 'Unknown') as sls_rep_nm, heh.job_desc, coalesce(case when heh02.nm_mdlin is null then   heh02.nm_last||', '||heh02.nm_first   else heh02.nm_last||', '||heh02.nm_first||' '||trim(heh02.nm_mdlin)||'.' end, 'Unknown') as sls_rep_direct_mgr,  heh02.email_addr as rep_direct_mgr_email,  heh02.job_desc as direct_mgr_job_desc,  coalesce(case when heh01.nm_mdlin is null then   heh01.nm_last||', '||heh01.nm_first   else heh01.nm_last||', '||heh01.nm_first||' '||trim(heh01.nm_mdlin)||'.' end, 'Unknown') as sls_district_mgr_nm,  heh01.email_addr as district_mgr_email,  heh01.job_desc as district_mgr_job_desc,  o.district_cd as Zone_District_cd,  a.area_desc as cust_area_desc,  a.region_desc as cust_region_desc,  cal.nm_first||'   '||cal.nm_last AS cust_name,  a.lang_pref_ind,  coalesce(email.email_addr, 'n/a') as cust_email_addr,   cal.mtn,   a.cust_id,  a.cust_line_seq_id,  a.device_nm_prev,  a.device_nm,  dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, case when a.fulfillement_ind='F' then 'direct' when a.fulfillement_ind='L' then 'local' else 'unknown' end as dfill, case when a.ecpd_liability_type_cd='C' then 'Business' else 'Consumer' end as Consumer_Business, case when dnsh.dns_type_cd is not null then 'Yes' When dnsh.dns_type_cd is null then 'No' end as on_dns_list, case when acs.currentstatus = 'Completed' and acs.mtn is not null then 'Yes'  else 'No' end as After_Cll_Survey, cal.mtn_status_ind, cal.line_term_dt, case when ndcir.cust_id is not null and ndcir.activity_dt is not null then 'Yes' else 'No' end as test1  from ndcir_up_nc_emh_v as a  join  ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal ON a.cust_id = cal.cust_id AND a.cust_line_seq_id = cal.cust_line_seq_id AND a.activity_dt  BETWEEN cal.eff_dt AND cal.exp_dt  left join ntl_prd_allvm.cust_acct_line_dns_dly_hist_v as dnsh on a.sor_id = dnsh.sor_id and a.cust_id = dnsh.cust_id and a.cust_line_seq_id = dnsh.cust_line_seq_id and dnsh.dns_type_cd = 'SR' and a.activity_dt + 1 between dnsh.eff_dt and dnsh.exp_dt  left join (select sor_id, cust_id, acct_num, email_addr, email_status_ind,  email_selection_ind, entry_point, opt_in_dt,entry_dt, verify_ind  from ntl_prd_allvm.cust_acct_email_v  where email_selection_ind = 'X' ) as email on cal.sor_id = email.sor_id and cal.cust_id = email.cust_id and cal.acct_num = email.acct_num  left join ntl_prd_qmtbls.after_call_survey_emh_v as acs on cal.mtn = acs.mtn and cal.cust_id = acs.customerid  left join ntl_prd_allvm.hr_employee_hist_v as heh on a.hr_employee_id = heh.emp_id and a.activity_dt between heh.eff_dt and heh.exp_dt  left join ntl_prd_allvm.hr_employee_hist_v AS heh02              on heh.super_id_lvl2_emp_id = heh02.emp_id and a.activity_dt between heh02.eff_dt and heh02.exp_dt                   left join ntl_prd_allvm.hr_employee_hist_v AS heh01          on heh.super_id_lvl1_emp_id  = heh01.emp_id  and a.activity_dt between heh01.eff_dt and heh01.exp_dt    left join  ntl_prd_allvm.dns_type_v as dnsd on dnsh.dns_type_cd = dnsd.dns_type_cd  left join ntl_prd_allvm.outlet_v as o  on a.sls_outlet_id = o.sls_outlet_id   left join  ntl_prd_allvm.device_dp_map_v AS dm                   ON a.device_nm = dm.prod_nm    left join (select  a.activity_dt ,a.cust_id ,a.cust_line_seq_id ,case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill ,a.fulfillment_ind ,count(distinct a.cust_id||a.cust_line_seq_id) as acts    from ntl_prd_qmtbls.mrs_ndcir_detail as a   where  a.activity_dt between '2012-09-21' and '2012-09-28' and a.sls_area_desc = 'Northeast' and a.sls_region_desc = 'New York Metro' and a.sls_dist_chnl_churn_ctgry = 'Stores'  qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id order by a.cust_id, a.cust_line_seq_id, a.activity_dt) = 1  group by 1,2,3,4,5) as ndcir  on a.cust_id = ndcir.cust_id and a.cust_line_seq_id = ndcir.cust_line_seq_id and a.activity_dt = ndcir.activity_dt  where  a.activity_mth = '2012-09-01' and a.sls_area_desc = 'Northeast' and a.sls_region_desc = 'New York Metro' and a.sls_dist_chnl_churn_ctgry = 'Stores' --and dfill = 'Local' --and cust_email_addr <> 'n/a' --and heh.job_cd in ('65045', 'V51103')     --and dm.device_tier not in ('Tablet', 'PC Card', 'Other') --and on_dns_list <> 'Yes' --and After_Cll_Survey <> 'Yes'  qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id order by a.cust_id, a.cust_line_seq_id, a.activity_dt) = 1  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35 order by a.sls_area_desc, a.sls_region_desc, a.activity_dt asc;  --drop table Reporting_Month; --drop table nccir_base11; --drop table nccir_base1a; --drop table nccir_base11b; --drop table nccir_acts_v; --drop table upcir_base11; --drop table upcir_base22; --drop table upcir_base33; --drop table upcir_base22a; --drop table upcir_base22aa; --drop table upcir_base22b; --drop table upcir_base22bb; --drop table upcir_up_v; --drop table ndcir_up_nc_emh_v;	TERADATA	HABERER	00:00:00	00:00:00	17832
10/02/2012	07:41:19	NTL_PRD_ALLVM	00:00:00	0	3707		select  a.activity_mth,  a.activity_dt,  a.activity_type,  a.sls_area_desc as sales_area,  a.sls_region_desc as sales_region,  a.sls_dist_chnl_churn_ctgry,  a.sls_outlet_id,  o.sls_outlet_nm as outlet,   coalesce(case when heh.nm_mdlin is null then   heh.nm_last||', '||heh.nm_first   else heh.nm_last||', '||heh.nm_first||' '||trim(heh.nm_mdlin)||'.' end, 'Unknown') as sls_rep_nm, heh.job_desc, coalesce(case when heh02.nm_mdlin is null then   heh02.nm_last||', '||heh02.nm_first   else heh02.nm_last||', '||heh02.nm_first||' '||trim(heh02.nm_mdlin)||'.' end, 'Unknown') as sls_rep_direct_mgr,  heh02.email_addr as rep_direct_mgr_email,  heh02.job_desc as direct_mgr_job_desc,  coalesce(case when heh01.nm_mdlin is null then   heh01.nm_last||', '||heh01.nm_first   else heh01.nm_last||', '||heh01.nm_first||' '||trim(heh01.nm_mdlin)||'.' end, 'Unknown') as sls_district_mgr_nm,  heh01.email_addr as district_mgr_email,  heh01.job_desc as district_mgr_job_desc,  o.district_cd as Zone_District_cd,  a.area_desc as cust_area_desc,  a.region_desc as cust_region_desc,  cal.nm_first||'   '||cal.nm_last AS cust_name,  a.lang_pref_ind,  coalesce(email.email_addr, 'n/a') as cust_email_addr,   cal.mtn,   a.cust_id,  a.cust_line_seq_id,  a.device_nm_prev,  a.device_nm,  dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, case when a.fulfillement_ind='F' then 'direct' when a.fulfillement_ind='L' then 'local' else 'unknown' end as dfill, case when a.ecpd_liability_type_cd='C' then 'Business' else 'Consumer' end as Consumer_Business, case when dnsh.dns_type_cd is not null then 'Yes' When dnsh.dns_type_cd is null then 'No' end as on_dns_list, case when acs.currentstatus = 'Completed' and acs.mtn is not null then 'Yes'  else 'No' end as After_Cll_Survey, cal.mtn_status_ind, cal.line_term_dt, case when ndcir.cust_id and ndcir.activity_dt is not null then 'Yes' else 'No' end as test1  from ndcir_up_nc_emh_v as a  join  ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal ON a.cust_id = cal.cust_id AND a.cust_line_seq_id = cal.cust_line_seq_id AND a.activity_dt  BETWEEN cal.eff_dt AND cal.exp_dt  left join ntl_prd_allvm.cust_acct_line_dns_dly_hist_v as dnsh on a.sor_id = dnsh.sor_id and a.cust_id = dnsh.cust_id and a.cust_line_seq_id = dnsh.cust_line_seq_id and dnsh.dns_type_cd = 'SR' and a.activity_dt + 1 between dnsh.eff_dt and dnsh.exp_dt  left join (select sor_id, cust_id, acct_num, email_addr, email_status_ind,  email_selection_ind, entry_point, opt_in_dt,entry_dt, verify_ind  from ntl_prd_allvm.cust_acct_email_v  where email_selection_ind = 'X' ) as email on cal.sor_id = email.sor_id and cal.cust_id = email.cust_id and cal.acct_num = email.acct_num  left join ntl_prd_qmtbls.after_call_survey_emh_v as acs on cal.mtn = acs.mtn and cal.cust_id = acs.customerid  left join ntl_prd_allvm.hr_employee_hist_v as heh on a.hr_employee_id = heh.emp_id and a.activity_dt between heh.eff_dt and heh.exp_dt  left join ntl_prd_allvm.hr_employee_hist_v AS heh02              on heh.super_id_lvl2_emp_id = heh02.emp_id and a.activity_dt between heh02.eff_dt and heh02.exp_dt                   left join ntl_prd_allvm.hr_employee_hist_v AS heh01          on heh.super_id_lvl1_emp_id  = heh01.emp_id  and a.activity_dt between heh01.eff_dt and heh01.exp_dt    left join  ntl_prd_allvm.dns_type_v as dnsd on dnsh.dns_type_cd = dnsd.dns_type_cd  left join ntl_prd_allvm.outlet_v as o  on a.sls_outlet_id = o.sls_outlet_id   left join  ntl_prd_allvm.device_dp_map_v AS dm                   ON a.device_nm = dm.prod_nm    left join (select  a.activity_dt ,a.cust_id ,a.cust_line_seq_id ,case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill ,a.fulfillment_ind ,count(distinct a.cust_id||a.cust_line_seq_id) as acts    from ntl_prd_qmtbls.mrs_ndcir_detail as a   where  a.activity_dt between '2012-09-21' and '2012-09-28' and a.sls_area_desc = 'Northeast' and a.sls_region_desc = 'New York Metro' and a.sls_dist_chnl_churn_ctgry = 'Stores'  qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id order by a.cust_id, a.cust_line_seq_id, a.activity_dt) = 1  group by 1,2,3,4,5) as ndcir  on a.cust_id = ndcir.cust_id and a.cust_line_seq_id = ndcir.cust_line_seq_id and a.activity_dt = ndcir.activity_dt  where  a.activity_mth = '2012-09-01' and a.sls_area_desc = 'Northeast' and a.sls_region_desc = 'New York Metro' and a.sls_dist_chnl_churn_ctgry = 'Stores' --and dfill = 'Local' --and cust_email_addr <> 'n/a' --and heh.job_cd in ('65045', 'V51103')     --and dm.device_tier not in ('Tablet', 'PC Card', 'Other') --and on_dns_list <> 'Yes' --and After_Cll_Survey <> 'Yes'  qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id order by a.cust_id, a.cust_line_seq_id, a.activity_dt) = 1  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35 order by a.sls_area_desc, a.sls_region_desc, a.activity_dt asc;  --drop table Reporting_Month; --drop table nccir_base11; --drop table nccir_base1a; --drop table nccir_base11b; --drop table nccir_acts_v; --drop table upcir_base11; --drop table upcir_base22; --drop table upcir_base33; --drop table upcir_base22a; --drop table upcir_base22aa; --drop table upcir_base22b; --drop table upcir_base22bb; --drop table upcir_up_v; --drop table ndcir_up_nc_emh_v;	TERADATA	HABERER	00:00:00	00:00:00	17831
10/02/2012	07:35:32	NTL_PRD_ALLVM	00:00:03	40144			select  a.activity_dt ,a.cust_id ,a.cust_line_seq_id ,case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill ,a.fulfillment_ind ,count(distinct a.cust_id||a.cust_line_seq_id) as acts    from ntl_prd_qmtbls.mrs_ndcir_detail as a   where  a.activity_dt between '2012-09-21' and '2012-09-28' and a.sls_area_desc = 'Northeast' and a.sls_region_desc = 'New York Metro' and a.sls_dist_chnl_churn_ctgry = 'Stores'  qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id order by a.cust_id, a.cust_line_seq_id, a.activity_dt) = 1  group by 1,2,3,4,5	TERADATA	HABERER	00:00:02	00:00:01	17830
10/02/2012	07:34:42	NTL_PRD_ALLVM	00:09:07	41300			create volatile table Reporting_Month as (  select *  from ntl_prd_qmtbls.month_date_emh_v   where date_range = '2012-09-01'  ) with data primary index(month_range, date_range)  index(date_range) order by values(date_range) on commit preserve rows;   --Table one NC create volatile table nccir_base11 as (  select    'NC' as activity_type   ,(dla.activity_dt - (extract(day from dla.activity_dt)-1)) as activity_mth   ,dla.activity_dt   ,mh.area_desc   ,mh.region_desc   ,dla. ...	TERADATA	HABERER	00:03:32	00:05:35	17829
10/01/2012	15:29:48	NTL_PRD_ALLVM	00:00:21	42703			select  a.activity_dt ,a.cust_id ,a.cust_line_seq_id ,case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill ,a.fulfillment_ind ,count(distinct a.cust_id||a.cust_line_seq_id) as acts    from ntl_prd_qmtbls.mrs_ndcir_detail as a   where  a.activity_dt between '2012-09-21' and '2012-09-30' and a.sls_area_desc = 'Northeast' and a.sls_region_desc = 'New York Metro' and a.sls_dist_chnl_churn_ctgry = 'Stores'  qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id order by a.cust_id, a.cust_line_seq_id, a.activity_dt) = 1  group by 1,2,3,4,5	TERADATA	HABERER	00:00:04	00:00:17	17828
10/01/2012	15:18:46	NTL_PRD_ALLVM	00:00:24	42703			select  a.activity_dt ,a.cust_id ,a.cust_line_seq_id ,case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill ,count(distinct a.cust_id||a.cust_line_seq_id) as acts    from ntl_prd_qmtbls.mrs_ndcir_detail as a   where  a.activity_dt between '2012-09-21' and '2012-09-30' and a.sls_area_desc = 'Northeast' and a.sls_region_desc = 'New York Metro' and a.sls_dist_chnl_churn_ctgry = 'Stores'  qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id order by a.cust_id, a.cust_line_seq_id, a.activity_dt) = 1  group by 1,2,3,4	TERADATA	HABERER	00:00:03	00:00:21	17827
10/01/2012	15:18:13	NTL_PRD_ALLVM	00:00:00	0	3706		select  a.activity_dt ,a.cust_id ,a.cust_line_seq_id ,case when a.fulfillment_ind='F' then 'direct' when a.fulfillment_ind='L' then 'local' else 'unknown' end as dfill ,count(distinct a.cust_id||a.cust_line_seq_id) as acts    from ntl_prd_qmtbls.mrs_ndcir_detail as a   WHERE where  a.activity_dt between '2012-09-21' and '2012-09-30' and a.sls_area_desc = 'Northeast' and a.sls_region_desc = 'New York Metro' and a.sls_dist_chnl_churn_ctgry = 'Stores'  qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id order by a.cust_id, a.cust_line_seq_id, a.activity_dt) = 1  group by 1,2,3,4	TERADATA	HABERER	00:00:00	00:00:00	17826
10/01/2012	15:10:45	NTL_PRD_ALLVM	00:00:00	0	3706		SELECT top 100 *      FROM ntl_prd_qmtbls.mrs_ndcir_sum as a   WHERE where  a.activity_mth = '2012-09-01' and a.sls_area_desc = 'Northeast' and a.sls_region_desc = 'New York Metro' and a.sls_dist_chnl_churn_ctgry = 'Stores'	TERADATA	HABERER	00:00:00	00:00:00	17825
10/01/2012	15:10:29	NTL_PRD_ALLVM	00:00:01	0	10053		SELECT top 100 *      FROM ntl_prd_qmtbls.mrs_ndcir_sum as a   WHERE where  a.activity_mth = '2012-09-01' and a.sls_area_desc = 'Northeast' and a.sls_region_desc = 'New York Metro' and a.sls_dist_chnl_churn_ctgry = 'Stores'	TERADATA	HABERER	00:00:01	00:00:00	17824
10/01/2012	13:54:00	NTL_PRD_ALLVM	00:08:52	47225			select  a.activity_mth,  a.activity_dt,  a.activity_type,  a.sls_area_desc as sales_area,  a.sls_region_desc as sales_region,  a.sls_dist_chnl_churn_ctgry,  a.sls_outlet_id,  o.sls_outlet_nm as outlet,   coalesce(case when heh.nm_mdlin is null then   heh.nm_last||', '||heh.nm_first   else heh.nm_last||', '||heh.nm_first||' '||trim(heh.nm_mdlin)||'.' end, 'Unknown') as sls_rep_nm, heh.job_desc, coalesce(case when heh02.nm_mdlin is null then   heh02.nm_last||', '||heh02.nm_first   else heh02.nm_last||', '||heh02.nm_first||' '||trim(heh02.nm_mdlin)||'.' end, 'Unknown') as sls_rep_direct_mgr,  heh02.email_addr as rep_direct_mgr_email,  heh02.job_desc as direct_mgr_job_desc,  coalesce(case when heh01.nm_mdlin is null then   heh01.nm_last||', '||heh01.nm_first   else heh01.nm_last||', '||heh01.nm_first||' '||trim(heh01.nm_mdlin)||'.' end, 'Unknown') as sls_district_mgr_nm,  heh01.email_addr as district_mgr_email,  heh01.job_desc as district_mgr_job_desc,  o.district_cd as Zone_District_cd,  a.area_desc as cust_area_desc,  a.region_desc as cust_region_desc,  cal.nm_first||'   '||cal.nm_last AS cust_name,  a.lang_pref_ind,  coalesce(email.email_addr, 'n/a') as cust_email_addr,   cal.mtn,   a.cust_id,  a.cust_line_seq_id,  a.device_nm_prev,  a.device_nm,  dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, case when a.fulfillement_ind='F' then 'direct' when a.fulfillement_ind='L' then 'local' else 'unknown' end as dfill, case when a.ecpd_liability_type_cd='C' then 'Business' else 'Consumer' end as Consumer_Business, case when dnsh.dns_type_cd is not null then 'Yes' When dnsh.dns_type_cd is null then 'No' end as on_dns_list, case when acs.currentstatus = 'Completed' and acs.mtn is not null then 'Yes'  else 'No' end as After_Cll_Survey  from ndcir_up_nc_emh_v as a  join  ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal ON a.cust_id = cal.cust_id AND a.cust_line_seq_id = cal.cust_line_seq_id AND a.activity_dt  BETWEEN cal.eff_dt AND cal.exp_dt  left join ntl_prd_allvm.cust_acct_line_dns_dly_hist_v as dnsh on a.sor_id = dnsh.sor_id and a.cust_id = dnsh.cust_id and a.cust_line_seq_id = dnsh.cust_line_seq_id and dnsh.dns_type_cd = 'SR' and a.activity_dt + 1 between dnsh.eff_dt and dnsh.exp_dt  left join (select sor_id, cust_id, acct_num, email_addr, email_status_ind,  email_selection_ind, entry_point, opt_in_dt,entry_dt, verify_ind  from ntl_prd_allvm.cust_acct_email_v  where email_selection_ind = 'X' ) as email on cal.sor_id = email.sor_id and cal.cust_id = email.cust_id and cal.acct_num = email.acct_num  left join ntl_prd_qmtbls.after_call_survey_emh_v as acs on cal.mtn = acs.mtn and cal.cust_id = acs.customerid  left join ntl_prd_allvm.hr_employee_hist_v as heh on a.hr_employee_id = heh.emp_id and a.activity_dt between heh.eff_dt and heh.exp_dt  left join ntl_prd_allvm.hr_employee_hist_v AS heh02              on heh.super_id_lvl2_emp_id = heh02.emp_id and a.activity_dt between heh02.eff_dt and heh02.exp_dt                   left join ntl_prd_allvm.hr_employee_hist_v AS heh01          on heh.super_id_lvl1_emp_id  = heh01.emp_id  and a.activity_dt between heh01.eff_dt and heh01.exp_dt    left join  ntl_prd_allvm.dns_type_v as dnsd on dnsh.dns_type_cd = dnsd.dns_type_cd  left join ntl_prd_allvm.outlet_v as o  on a.sls_outlet_id = o.sls_outlet_id   left join  ntl_prd_allvm.device_dp_map_v AS dm                   ON a.device_nm = dm.prod_nm   where  a.activity_mth = '2012-09-01' and a.sls_area_desc = 'Northeast' and a.sls_region_desc = 'New York Metro' and a.sls_dist_chnl_churn_ctgry = 'Stores' --and dfill = 'Local' --and cust_email_addr <> 'n/a' --and heh.job_cd in ('65045', 'V51103')     --and dm.device_tier not in ('Tablet', 'PC Card', 'Other') --and on_dns_list <> 'Yes' --and After_Cll_Survey <> 'Yes'  qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id order by a.cust_id, a.cust_line_seq_id, a.activity_dt) = 1  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33 order by a.sls_area_desc, a.sls_region_desc, a.activity_dt asc;	TERADATA	HABERER	00:08:04	00:00:48	17823
10/01/2012	13:41:41	NTL_PRD_ALLVM	02:44:07	47225			create volatile table Reporting_Month as (  select *  from ntl_prd_qmtbls.month_date_emh_v   where date_range = '2012-09-01'  ) with data primary index(month_range, date_range)  index(date_range) order by values(date_range) on commit preserve rows;   --Table one NC create volatile table nccir_base11 as (  select    'NC' as activity_type   ,(dla.activity_dt - (extract(day from dla.activity_dt)-1)) as activity_mth   ,dla.activity_dt   ,mh.area_desc   ,mh.region_desc   ,dla. ...	TERADATA	HABERER	02:43:07	00:01:00	17822
10/01/2012	13:35:43	NTL_PRD_ALLVM	00:00:16	571			select a.activity_mth, a.activity_dt, a.activity_type, a.cust_area, a.cust_region, cal.mtn, a.cust_id, a.cust_line_seq_id,  a.fulfillment_ind, CASE WHEN cal.Device_type_cd LIKE '%4GS%'  THEN cal.device_prod_nm  ELSE cal.prod_nm END AS Device_Nm, cal.prod_nm, cal.device_type_cd, cal.device_prod_nm, a.prod_nm, a.data_tier_fin, a.device_generation, a.prod_nm_prev, a.data_tier_fin_prev, a.device_generation_prev,  a.sales_area, a.sales_region, a.sls_dist_chnl_churn_ctgry, a.outlet as Upgrd_Channel, a.emp_nm as upgrd_emp_nm, a.job_desc as upgrd_job_desc, a.hr_employee_id as upgrd_hr_employee_id, a.nt_user_id as upgrd_nt_user_id, acall.acss_call_dt upgrd_call_dt, acall.acss_call_tm as upgrd_call_tm,   CASE   WHEN cc1.acss_call_ctr_time_zn LIKE 'C%' THEN              acall.acss_call_tm + INTERVAL '1' HOUR          WHEN cc1.acss_call_ctr_time_zn LIKE 'M%' THEN              acall.acss_call_tm + INTERVAL '2' HOUR         WHEN cc1.acss_call_ctr_time_zn LIKE 'P%' THEN              acall.acss_call_tm +INTERVAL '3' HOUR          WHEN cc1.acss_call_ctr_time_zn LIKE 'H%' THEN              acall.acss_call_tm + INTERVAL '5' HOUR          ELSE acall.acss_call_tm       END upgrd_call_est_tm, (acall.call_disconnect_tm - acall.call_start_tm) HOUR TO SECOND (0) AS upgrd_duration_tm,   ---Calls following the initial call cc.acss_call_ctr_desc, a.acss_call_ctr_cd, u.nm_last||', '||u.nm_first AS rep_nm,  a.acss_user_id, ad.acss_dept_desc,  a.acss_call_dt, a.acss_call_tm, a.call_duration, a.call_period   from ntl_prd_qmvm.ndcir_detail_v as a  inner join  ntl_prd_allvm.acss_call_v AS acall  on a.sor_id = acall.sor_id and a.cust_id = acall.cust_id  and a.cust_line_seq_id = acall.cust_line_seq_id  and a.nt_user_id = acall.acss_user_id  and a.activity_dt = acall.acss_call_dt  --and a.acss_call_id <> acall.acss_call_id and acall.acss_call_type_cd IN ('1','3','7')   join  ntl_prd_secvm.cust_acct_line_dly_hist_v  AS cal on a.cust_id = cal.cust_id and  a.cust_line_seq_id = cal.cust_line_seq_id and  a.activity_dt between cal.eff_dt and cal.exp_dt    INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc1     ON acall.acss_call_ctr_cd = cc1.acss_call_ctr_cd  JOIN ntl_prd_allvm.acss_user_v AS u     ON a.acss_user_id =  u.acss_user_id      INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc     ON a.acss_call_ctr_cd = cc.acss_call_ctr_cd     INNER JOIN ntl_prd_allvm.acss_dept_v AS ad     ON a.acss_dept_id = ad.acss_dept_id  where a.activity_dt between '2012-09-15' and '2012-09-27' and a.activity_type = 'UP' and a.sales_area = 'Northeast' and a.sls_dist_chnl_churn_ctgry = 'NonComm' and a.outlet in ('NE Wallingford CT', 'NE Wilmington NC', 'NE Huntsville AL', 'NE Rochester NY' 'NE Charleston SC', 'NE Columbia SC 2', 'NE Columbia SC', 'NE Charlotte NC', 'NE Hanover MD', 'NE Bangor ME') and a.acss_call_ctr_type||a.acss_call_type_cd IN ('v1', 'v7', 'o1', 'o3', 'o7')  and a.acss_call_dt BETWEEN a.activity_dt AND  ADD_MONTHS(a.activity_dt,0)+ 2	TERADATA	HABERER	00:00:15	00:00:01	17821
10/01/2012	13:33:02	NTL_PRD_ALLVM	00:00:23	571			select a.activity_mth, a.activity_dt, a.activity_type, a.cust_area, a.cust_region, cal.mtn, a.cust_id, a.cust_line_seq_id,  a.fulfillment_ind, cal.prod_nm, cal.device_type_cd, cal.device_prod_nm, a.prod_nm, a.data_tier_fin, a.device_generation, a.prod_nm_prev, a.data_tier_fin_prev, a.device_generation_prev,  a.sales_area, a.sales_region, a.sls_dist_chnl_churn_ctgry, a.outlet as Upgrd_Channel, a.emp_nm as upgrd_emp_nm, a.job_desc as upgrd_job_desc, a.hr_employee_id as upgrd_hr_employee_id, a.nt_user_id as upgrd_nt_user_id, acall.acss_call_dt upgrd_call_dt, acall.acss_call_tm as upgrd_call_tm,   CASE   WHEN cc1.acss_call_ctr_time_zn LIKE 'C%' THEN              acall.acss_call_tm + INTERVAL '1' HOUR          WHEN cc1.acss_call_ctr_time_zn LIKE 'M%' THEN              acall.acss_call_tm + INTERVAL '2' HOUR         WHEN cc1.acss_call_ctr_time_zn LIKE 'P%' THEN              acall.acss_call_tm +INTERVAL '3' HOUR          WHEN cc1.acss_call_ctr_time_zn LIKE 'H%' THEN              acall.acss_call_tm + INTERVAL '5' HOUR          ELSE acall.acss_call_tm       END upgrd_call_est_tm, (acall.call_disconnect_tm - acall.call_start_tm) HOUR TO SECOND (0) AS upgrd_duration_tm,   ---Calls following the initial call cc.acss_call_ctr_desc, a.acss_call_ctr_cd, u.nm_last||', '||u.nm_first AS rep_nm,  a.acss_user_id, ad.acss_dept_desc,  a.acss_call_dt, a.acss_call_tm, a.call_duration, a.call_period   from ntl_prd_qmvm.ndcir_detail_v as a  inner join  ntl_prd_allvm.acss_call_v AS acall  on a.sor_id = acall.sor_id and a.cust_id = acall.cust_id  and a.cust_line_seq_id = acall.cust_line_seq_id  and a.nt_user_id = acall.acss_user_id  and a.activity_dt = acall.acss_call_dt  --and a.acss_call_id <> acall.acss_call_id and acall.acss_call_type_cd IN ('1','3','7')   join  ntl_prd_secvm.cust_acct_line_dly_hist_v  AS cal on a.cust_id = cal.cust_id and  a.cust_line_seq_id = cal.cust_line_seq_id and  a.activity_dt between cal.eff_dt and cal.exp_dt    INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc1     ON acall.acss_call_ctr_cd = cc1.acss_call_ctr_cd  JOIN ntl_prd_allvm.acss_user_v AS u     ON a.acss_user_id =  u.acss_user_id      INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc     ON a.acss_call_ctr_cd = cc.acss_call_ctr_cd     INNER JOIN ntl_prd_allvm.acss_dept_v AS ad     ON a.acss_dept_id = ad.acss_dept_id  where a.activity_dt between '2012-09-15' and '2012-09-27' and a.activity_type = 'UP' and a.sales_area = 'Northeast' and a.sls_dist_chnl_churn_ctgry = 'NonComm' and a.outlet in ('NE Wallingford CT', 'NE Wilmington NC', 'NE Huntsville AL', 'NE Rochester NY' 'NE Charleston SC', 'NE Columbia SC 2', 'NE Columbia SC', 'NE Charlotte NC', 'NE Hanover MD', 'NE Bangor ME') and a.acss_call_ctr_type||a.acss_call_type_cd IN ('v1', 'v7', 'o1', 'o3', 'o7')  and a.acss_call_dt BETWEEN a.activity_dt AND  ADD_MONTHS(a.activity_dt,0)+ 2	TERADATA	HABERER	00:00:22	00:00:01	17820
10/01/2012	13:29:22	NTL_PRD_ALLVM	00:00:15	571			select a.activity_mth, a.activity_dt, a.activity_type, a.cust_area, a.cust_region, cal.mtn, a.cust_id, a.cust_line_seq_id,  a.fulfillment_ind, a.prod_nm, a.data_tier_fin, a.device_generation, a.prod_nm_prev, a.data_tier_fin_prev, a.device_generation_prev,  a.sales_area, a.sales_region, a.sls_dist_chnl_churn_ctgry, a.outlet as Upgrd_Channel, a.emp_nm as upgrd_emp_nm, a.job_desc as upgrd_job_desc, a.hr_employee_id as upgrd_hr_employee_id, a.nt_user_id as upgrd_nt_user_id, acall.acss_call_dt upgrd_call_dt, acall.acss_call_tm as upgrd_call_tm,   CASE   WHEN cc1.acss_call_ctr_time_zn LIKE 'C%' THEN              acall.acss_call_tm + INTERVAL '1' HOUR          WHEN cc1.acss_call_ctr_time_zn LIKE 'M%' THEN              acall.acss_call_tm + INTERVAL '2' HOUR         WHEN cc1.acss_call_ctr_time_zn LIKE 'P%' THEN              acall.acss_call_tm +INTERVAL '3' HOUR          WHEN cc1.acss_call_ctr_time_zn LIKE 'H%' THEN              acall.acss_call_tm + INTERVAL '5' HOUR          ELSE acall.acss_call_tm       END upgrd_call_est_tm, (acall.call_disconnect_tm - acall.call_start_tm) HOUR TO SECOND (0) AS upgrd_duration_tm,   ---Calls following the initial call cc.acss_call_ctr_desc, a.acss_call_ctr_cd, u.nm_last||', '||u.nm_first AS rep_nm,  a.acss_user_id, ad.acss_dept_desc,  a.acss_call_dt, a.acss_call_tm, a.call_duration, a.call_period   from ntl_prd_qmvm.ndcir_detail_v as a  inner join  ntl_prd_allvm.acss_call_v AS acall  on a.sor_id = acall.sor_id and a.cust_id = acall.cust_id  and a.cust_line_seq_id = acall.cust_line_seq_id  and a.nt_user_id = acall.acss_user_id  and a.activity_dt = acall.acss_call_dt  --and a.acss_call_id <> acall.acss_call_id and acall.acss_call_type_cd IN ('1','3','7')   join  ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal on a.cust_id = cal.cust_id and  a.cust_line_seq_id = cal.cust_line_seq_id and  a.activity_dt between cal.eff_dt and cal.exp_dt    INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc1     ON acall.acss_call_ctr_cd = cc1.acss_call_ctr_cd  JOIN ntl_prd_allvm.acss_user_v AS u     ON a.acss_user_id =  u.acss_user_id      INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc     ON a.acss_call_ctr_cd = cc.acss_call_ctr_cd     INNER JOIN ntl_prd_allvm.acss_dept_v AS ad     ON a.acss_dept_id = ad.acss_dept_id  where a.activity_dt between '2012-09-15' and '2012-09-27' and a.activity_type = 'UP' and a.sales_area = 'Northeast' and a.sls_dist_chnl_churn_ctgry = 'NonComm' and a.outlet in ('NE Wallingford CT', 'NE Wilmington NC', 'NE Huntsville AL', 'NE Rochester NY' 'NE Charleston SC', 'NE Columbia SC 2', 'NE Columbia SC', 'NE Charlotte NC', 'NE Hanover MD', 'NE Bangor ME') and a.acss_call_ctr_type||a.acss_call_type_cd IN ('v1', 'v7', 'o1', 'o3', 'o7')  and a.acss_call_dt BETWEEN a.activity_dt AND  ADD_MONTHS(a.activity_dt,0)+ 2	TERADATA	HABERER	00:00:15	00:00:00	17819
10/01/2012	13:26:29	NTL_PRD_ALLVM	00:00:35	1			select max(activity_dt)  from ntl_prd_qmvm.ndcir_detail_v	TERADATA	HABERER	00:00:35	00:00:00	17818
10/01/2012	13:18:50	NTL_PRD_ALLVM	00:00:38	598			select a.activity_mth, a.activity_dt, a.activity_type, a.cust_area, a.cust_region, cal.mtn, a.cust_id, a.cust_line_seq_id,  a.fulfillment_ind, a.prod_nm, a.data_tier_fin, a.device_generation, a.prod_nm_prev, a.data_tier_fin_prev, a.device_generation_prev,  a.sales_area, a.sales_region, a.sls_dist_chnl_churn_ctgry, a.outlet as Upgrd_Channel, a.emp_nm as upgrd_emp_nm, a.job_desc as upgrd_job_desc, a.hr_employee_id as upgrd_hr_employee_id, a.nt_user_id as upgrd_nt_user_id, acall.acss_call_dt upgrd_call_dt, acall.acss_call_tm as upgrd_call_tm,   CASE   WHEN cc1.acss_call_ctr_time_zn LIKE 'C%' THEN              acall.acss_call_tm + INTERVAL '1' HOUR          WHEN cc1.acss_call_ctr_time_zn LIKE 'M%' THEN              acall.acss_call_tm + INTERVAL '2' HOUR         WHEN cc1.acss_call_ctr_time_zn LIKE 'P%' THEN              acall.acss_call_tm +INTERVAL '3' HOUR          WHEN cc1.acss_call_ctr_time_zn LIKE 'H%' THEN              acall.acss_call_tm + INTERVAL '5' HOUR          ELSE acall.acss_call_tm       END upgrd_call_est_tm, (acall.call_disconnect_tm - acall.call_start_tm) HOUR TO SECOND (0) AS upgrd_duration_tm,   ---Calls following the initial call cc.acss_call_ctr_desc, a.acss_call_ctr_cd, u.nm_last||', '||u.nm_first AS rep_nm,  a.acss_user_id, ad.acss_dept_desc,  a.acss_call_dt, a.acss_call_tm, a.call_duration, a.call_period   from ntl_prd_qmvm.ndcir_detail_v as a  inner join  ntl_prd_allvm.acss_call_v AS acall  on a.sor_id = acall.sor_id and a.cust_id = acall.cust_id  and a.cust_line_seq_id = acall.cust_line_seq_id  and a.nt_user_id = acall.acss_user_id  and a.activity_dt = acall.acss_call_dt  --and a.acss_call_id <> acall.acss_call_id and acall.acss_call_type_cd IN ('1','3','7')   join  ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal on a.cust_id = cal.cust_id and  a.cust_line_seq_id = cal.cust_line_seq_id and  a.activity_dt between cal.eff_dt and cal.exp_dt    INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc1     ON acall.acss_call_ctr_cd = cc1.acss_call_ctr_cd  JOIN ntl_prd_allvm.acss_user_v AS u     ON a.acss_user_id =  u.acss_user_id      INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc     ON a.acss_call_ctr_cd = cc.acss_call_ctr_cd     INNER JOIN ntl_prd_allvm.acss_dept_v AS ad     ON a.acss_dept_id = ad.acss_dept_id  where a.activity_dt between '2012-09-15' and '2012-09-30' and a.activity_type = 'UP' and a.sales_area = 'Northeast' and a.sls_dist_chnl_churn_ctgry = 'NonComm' and a.outlet in ('NE Wallingford CT', 'NE Wilmington NC', 'NE Huntsville AL', 'NE Rochester NY' 'NE Charleston SC', 'NE Columbia SC 2', 'NE Columbia SC', 'NE Charlotte NC', 'NE Hanover MD', 'NE Bangor ME') and a.acss_call_ctr_type||a.acss_call_type_cd IN ('v1', 'v7', 'o1', 'o3', 'o7')  and a.acss_call_dt BETWEEN a.activity_dt AND  ADD_MONTHS(a.activity_dt,0)+ 2	TERADATA	HABERER	00:00:37	00:00:01	17817
10/01/2012	13:09:17	NTL_PRD_ALLVM	00:00:17	100			select top 100 a.activity_mth, a.activity_dt, a.activity_type, a.cust_area, a.cust_region, cal.mtn, a.cust_id, a.cust_line_seq_id,  a.fulfillment_ind, a.prod_nm, a.data_tier_fin, a.device_generation, a.prod_nm_prev, a.data_tier_fin_prev, a.device_generation_prev,  a.sales_area, a.sales_region, a.sls_dist_chnl_churn_ctgry, a.outlet as Upgrd_Channel, a.emp_nm as upgrd_emp_nm, a.job_desc as upgrd_job_desc, a.hr_employee_id as upgrd_hr_employee_id, a.nt_user_id as upgrd_nt_user_id, acall.acss_call_dt upgrd_call_dt, acall.acss_call_tm as upgrd_call_tm,   CASE   WHEN cc1.acss_call_ctr_time_zn LIKE 'C%' THEN              acall.acss_call_tm + INTERVAL '1' HOUR          WHEN cc1.acss_call_ctr_time_zn LIKE 'M%' THEN              acall.acss_call_tm + INTERVAL '2' HOUR         WHEN cc1.acss_call_ctr_time_zn LIKE 'P%' THEN              acall.acss_call_tm +INTERVAL '3' HOUR          WHEN cc1.acss_call_ctr_time_zn LIKE 'H%' THEN              acall.acss_call_tm + INTERVAL '5' HOUR          ELSE acall.acss_call_tm       END upgrd_call_est_tm, (acall.call_disconnect_tm - acall.call_start_tm) HOUR TO SECOND (0) AS upgrd_duration_tm,   ---Calls following the initial call cc.acss_call_ctr_desc, a.acss_call_ctr_cd, u.nm_last||', '||u.nm_first AS Upgrd_rep_nm,  a.acss_user_id, ad.acss_dept_desc,  a.acss_call_dt, a.acss_call_tm, a.call_duration, a.acss_call_id, a.call_period   from ntl_prd_qmvm.ndcir_detail_v as a  inner join  ntl_prd_allvm.acss_call_v AS acall  on a.sor_id = acall.sor_id and a.cust_id = acall.cust_id  and a.cust_line_seq_id = acall.cust_line_seq_id  and a.nt_user_id = acall.acss_user_id  and a.activity_dt = acall.acss_call_dt  --and a.acss_call_id <> acall.acss_call_id and acall.acss_call_type_cd IN ('1','3','7')   join  ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal on a.cust_id = cal.cust_id and  a.cust_line_seq_id = cal.cust_line_seq_id and  a.activity_dt between cal.eff_dt and cal.exp_dt    INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc1     ON acall.acss_call_ctr_cd = cc1.acss_call_ctr_cd  JOIN ntl_prd_allvm.acss_user_v AS u     ON a.acss_user_id =  u.acss_user_id      INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc     ON a.acss_call_ctr_cd = cc.acss_call_ctr_cd     INNER JOIN ntl_prd_allvm.acss_dept_v AS ad     ON a.acss_dept_id = ad.acss_dept_id  where a.activity_dt between '2012-09-21' and '2012-09-30' and a.activity_type = 'UP' and a.sales_area = 'Northeast' and a.sls_dist_chnl_churn_ctgry = 'NonComm' and a.outlet in ('NE Wallingford CT', 'NE Wilmington NC', 'NE Huntsville AL', 'NE Rochester NY' 'NE Charleston SC', 'NE Columbia SC 2', 'NE Columbia SC', 'NE Charlotte NC', 'NE Hanover MD', 'NE Bangor ME') and a.acss_call_ctr_type||a.acss_call_type_cd IN ('v1', 'v7', 'o1', 'o3', 'o7')  AND a.acss_call_dt BETWEEN a.activity_dt AND  ADD_MONTHS(a.activity_dt,0)+ 2	TERADATA	HABERER	00:00:17	00:00:00	17816
10/01/2012	13:08:47	NTL_PRD_ALLVM	00:00:00	0	3810		select top 100 a.activity_mth, a.activity_dt, a.activity_type, a.cust_area, a.cust_region, cal.mtn, a.cust_id, a.cust_line_seq_id,  a.fulfillment_ind, a.prod_nm, a.data_tier_fin, a.device_generation, a.prod_nm_prev, a.data_tier_fin_prev, a.device_generation_prev,  a.sales_area, a.sales_region, a.sls_dist_chnl_churn_ctgry, a.outlet as Upgrd_Channel, a.emp_nm as upgrd_emp_nm, a.job_desc as upgrd_job_desc, a.hr_employee_id as upgrd_hr_employee_id, a.nt_user_id as upgrd_nt_user_id, acall.acss_call_dt upgrd_call_dt, acall.acss_call_tm as upgrd_call_tm,   CASE   WHEN cc1.acss_call_ctr_time_zn LIKE 'C%' THEN              acall.acss_call_tm + INTERVAL '1' HOUR          WHEN cc1.acss_call_ctr_time_zn LIKE 'M%' THEN              acall.acss_call_tm + INTERVAL '2' HOUR         WHEN cc1.acss_call_ctr_time_zn LIKE 'P%' THEN              acall.acss_call_tm +INTERVAL '3' HOUR          WHEN cc1.acss_call_ctr_time_zn LIKE 'H%' THEN              acall.acss_call_tm + INTERVAL '5' HOUR          ELSE acall.acss_call_tm       END upgrd_call_est_tm, (acall.call_disconnect_tm - acall.call_start_tm) HOUR TO SECOND (0) AS upgrd_duration_tm,   ---Calls following the initial call cc.acss_call_ctr_des, a.acss_call_ctr_cd, u.nm_last||', '||u.nm_first AS Upgrd_rep_nm,  a.acss_user_id, ad.acss_dept_desc,  a.acss_call_dt, a.acss_call_tm, a.call_duration, a.acss_call_id, a.call_period   from ntl_prd_qmvm.ndcir_detail_v as a  inner join  ntl_prd_allvm.acss_call_v AS acall  on a.sor_id = acall.sor_id and a.cust_id = acall.cust_id  and a.cust_line_seq_id = acall.cust_line_seq_id  and a.nt_user_id = acall.acss_user_id  and a.activity_dt = acall.acss_call_dt  --and a.acss_call_id <> acall.acss_call_id and acall.acss_call_type_cd IN ('1','3','7')   join  ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal on a.cust_id = cal.cust_id and  a.cust_line_seq_id = cal.cust_line_seq_id and  a.activity_dt between cal.eff_dt and cal.exp_dt    INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc1     ON acall.acss_call_ctr_cd = cc1.acss_call_ctr_cd  JOIN ntl_prd_allvm.acss_user_v AS u     ON a.acss_user_id =  u.acss_user_id      INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc     ON a.acss_call_ctr_cd = cc.acss_call_ctr_cd     INNER JOIN ntl_prd_allvm.acss_dept_v AS ad     ON a.acss_dept_id = ad.acss_dept_id  where a.activity_dt between '2012-09-21' and '2012-09-30' and a.activity_type = 'UP' and a.sales_area = 'Northeast' and a.sls_dist_chnl_churn_ctgry = 'NonComm' and a.outlet in ('NE Wallingford CT', 'NE Wilmington NC', 'NE Huntsville AL', 'NE Rochester NY' 'NE Charleston SC', 'NE Columbia SC 2', 'NE Columbia SC', 'NE Charlotte NC', 'NE Hanover MD', 'NE Bangor ME') and a.acss_call_ctr_type||a.acss_call_type_cd IN ('v1', 'v7', 'o1', 'o3', 'o7')  AND a.acss_call_dt BETWEEN a.activity_dt AND  ADD_MONTHS(a.activity_dt,0)+ 2	TERADATA	HABERER	00:00:00	00:00:00	17815
10/01/2012	13:07:38	NTL_PRD_ALLVM	00:00:01	0	3810		select top 100 a.activity_mth, a.activity_dt, a.activity_type, a.cust_area, a.cust_region, cal.mtn, a.cust_id, a.cust_line_seq_id,  a.fulfillment_ind, a.prod_nm, a.data_tier_fin, a.device_generation, a.prod_nm_prev, a.data_tier_fin_prev, a.device_generation_prev,  a.sales_area, a.sales_region, a.sls_dist_chnl_churn_ctgry, a.outlet as Upgrd_Channel, a.emp_nm as upgrd_emp_nm, a.job_desc as upgrd_job_desc, a.hr_employee_id as upgrd_hr_employee_id, a.nt_user_id as upgrd_nt_user_id, acall.acss_call_dt upgrd_call_dt, acall.acss_call_tm as upgrd_call_tm,   CASE   WHEN cc1.acss_call_ctr_time_zn LIKE 'C%' THEN              acall.acss_call_tm + INTERVAL '1' HOUR          WHEN cc1.acss_call_ctr_time_zn LIKE 'M%' THEN              acall.acss_call_tm + INTERVAL '2' HOUR         WHEN cc1.acss_call_ctr_time_zn LIKE 'P%' THEN              acall.acss_call_tm +INTERVAL '3' HOUR          WHEN cc1.acss_call_ctr_time_zn LIKE 'H%' THEN              acall.acss_call_tm + INTERVAL '5' HOUR          ELSE acall.acss_call_tm       END upgrd_call_est_tm, (acall.call_disconnect_tm - acall.call_start_tm) HOUR TO SECOND (0) AS upgrd_duration_tm,   ---Calls following the initial call cc.acss_call_ctr_des, a.acss_call_ctr_cd, u.nm_last||', '||u.nm_first AS Upgrd_rep_nm,  a.acss_user_id, ad.acss_dept_desc,  a.acss_call_dt, a.acss_call_tm, a.call_duration, a.acss_call_id, a.call_period   from ntl_prd_qmvm.ndcir_detail_v as a  inner join  ntl_prd_allvm.acss_call_v AS acall  on a.sor_id = acall.sor_id and a.cust_id = acall.cust_id  and a.cust_line_seq_id = acall.cust_line_seq_id  and a.nt_user_id = acall.acss_user_id  and a.activity_dt = acall.acss_call_dt  --and a.acss_call_id <> acall.acss_call_id and acall.acss_call_type_cd IN ('1','3','7')   join  ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal on a.cust_id = cal.cust_id and  a.cust_line_seq_id = cal.cust_line_seq_id and  a.activity_dt between cal.eff_dt and cal.exp_dt    INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc1     ON acall.acss_call_ctr_cd = cc1.acss_call_ctr_cd  JOIN ntl_prd_allvm.acss_user_v AS u     ON a.acss_user_id =  u.acss_user_id      INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc     ON a.acss_call_ctr_cd = cc.acss_call_ctr_cd     INNER JOIN ntl_prd_allvm.acss_dept_v AS ad     ON a.acss_dept_id = ad.acss_dept_id  where a.activity_dt between '2012-09-21' and '2012-09-30' and a.activity_type = 'UP' and a.sales_area = 'Northeast' and a.sls_dist_chnl_churn_ctgry = 'NonComm' and a.outlet in ('NE Wallingford CT', 'NE Wilmington NC', 'NE Huntsville AL', 'NE Rochester NY' 'NE Charleston SC', 'NE Columbia SC 2', 'NE Columbia SC', 'NE Charlotte NC', 'NE Hanover MD', 'NE Bangor ME') and a.acss_call_ctr_type||a.acss_call_type_cd IN ('v1', 'v7', 'o1', 'o3', 'o7')  AND a.acss_call_dt BETWEEN a.activity_dt AND  ADD_MONTHS(a.activity_dt,0)+ 2	TERADATA	HABERER	00:00:01	00:00:00	17814
10/01/2012	12:59:10	NTL_PRD_ALLVM	00:00:18	100			select top 100 a.activity_mth, a.activity_dt, a.activity_type, a.cust_area, a.cust_region, a.cust_id, a.cust_line_seq_id,  a.fulfillment_ind, a.prod_nm, a.data_tier_fin, a.device_generation, a.prod_nm_prev, a.data_tier_fin_prev, a.device_generation_prev,  a.sales_area, a.sales_region, a.sls_dist_chnl_churn_ctgry, a.outlet, a.emp_nm, a.job_desc, a.hr_employee_id, a.nt_user_id, acall.acss_call_dt, acall.acss_call_tm, (acall.call_disconnect_tm - acall.call_start_tm) HOUR TO SECOND (0) AS call_duration_tm,   ---Calls following the initial call a.acss_call_ctr_cd, a.acss_user_id, a.acss_call_dt, a.acss_call_tm, a.call_duration, a.acss_call_id, a.call_period   from ntl_prd_qmvm.ndcir_detail_v as a  inner join  ntl_prd_allvm.acss_call_v AS acall  on a.sor_id = acall.sor_id and a.cust_id = acall.cust_id  and a.cust_line_seq_id = acall.cust_line_seq_id  and a.nt_user_id = acall.acss_user_id  and a.activity_dt = acall.acss_call_dt  --and a.acss_call_id <> acall.acss_call_id and acall.acss_call_type_cd IN ('1','3','7')   join  ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal on a.cust_id = cal.cust_id and  a.cust_line_seq_id = cal.cust_line_seq_id and  a.activity_dt between cal.eff_dt and cal.exp_dt   where a.activity_dt between '2012-09-21' and '2012-09-30' and a.activity_type = 'UP' and a.sales_area = 'Northeast' and a.sls_dist_chnl_churn_ctgry = 'NonComm' and a.outlet in ('NE Wallingford CT', 'NE Wilmington NC', 'NE Huntsville AL', 'NE Rochester NY' 'NE Charleston SC', 'NE Columbia SC 2', 'NE Columbia SC', 'NE Charlotte NC', 'NE Hanover MD', 'NE Bangor ME') and a.acss_call_ctr_type||a.acss_call_type_cd IN ('v1', 'v7', 'o1', 'o3', 'o7')  AND a.acss_call_dt BETWEEN a.activity_dt AND  ADD_MONTHS(a.activity_dt,0)+ 2	TERADATA	HABERER	00:00:18	00:00:00	17813
10/01/2012	12:58:37	NTL_PRD_ALLVM	00:00:00	0	3707		select top 100 a.activity_mth, a.activity_dt, a.activity_type, a.cust_area, a.cust_region, a.cust_id, a.cust_line_seq_id,  a.fulfillment_ind, a.prod_nm, a.data_tier_fin, a.device_generation, a.prod_nm_prev, a.data_tier_fin_prev, a.device_generation_prev,  a.sales_area, a.sales_region, a.sls_dist_chnl_churn_ctgry, a.outlet, a.emp_nm, a.job_desc, a.hr_employee_id, a.nt_user_id, acall.acss_call_dt, acall.acss_call_tm, (acall.call_disconnect_tm - acall.call_start_tm) HOUR TO SECOND (0) AS call_duration_tm,   ---Calls following the initial call a.acss_call_ctr_cd, a.acss_user_id, a.acss_call_dt, a.acss_call_tm, a.call_duration, a.acss_call_id, a.call_period   from ntl_prd_qmvm.ndcir_detail_v as a  inner join  ntl_prd_allvm.acss_call_v AS acall  and a.sor_id = acall.sor_id and a.cust_id = acall.cust_id  and a.cust_line_seq_id = acall.cust_line_seq_id  and a.nt_user_id = acall.acss_user_id  and a.activity_dt = acall.acss_call_dt  --and a.acss_call_id <> acall.acss_call_id and acall.acss_call_type_cd IN ('1','3','7')   join  ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal on a.cust_id = cal.cust_id and  a.cust_line_seq_id = cal.cust_line_seq_id and  a.activity_dt between cal.eff_dt and cal.exp_dt   where a.activity_dt between '2012-09-21' and '2012-09-30' and a.activity_type = 'UP' and a.sales_area = 'Northeast' and a.sls_dist_chnl_churn_ctgry = 'NonComm' and a.outlet in ('NE Wallingford CT', 'NE Wilmington NC', 'NE Huntsville AL', 'NE Rochester NY' 'NE Charleston SC', 'NE Columbia SC 2', 'NE Columbia SC', 'NE Charlotte NC', 'NE Hanover MD', 'NE Bangor ME') and a.acss_call_ctr_type||a.acss_call_type_cd IN ('v1', 'v7', 'o1', 'o3', 'o7')  AND a.acss_call_dt BETWEEN a.activity_dt AND  ADD_MONTHS(a.activity_dt,0)+ 2	TERADATA	HABERER	00:00:00	00:00:00	17812
10/01/2012	11:57:58	NTL_PRD_ALLVM	00:00:10	100			select top 100 a.activity_mth, a.activity_type, a.cust_area, a.cust_region, a.cust_id, a.cust_line_seq_id,  a.fulfillment_ind, a.prod_nm, a.data_tier_fin, a.device_generation, a.prod_nm_prev, a.data_tier_fin_prev, a.device_generation_prev,  a.sales_area, a.sales_region, a.sls_dist_chnl_churn_ctgry, a.outlet, a.emp_nm, a.job_desc, a.hr_employee_id, a.nt_user_id,  ---Calls following the initial call a.acss_call_ctr_cd, a.acss_user_id, a.acss_call_dt, a.acss_call_tm, a.call_duration, a.acss_call_id, a.call_period   from ntl_prd_qmvm.ndcir_detail_v as a  where a.activity_dt between '2012-09-21' and '2012-09-30' and a.sales_area = 'Northeast' and a.sls_dist_chnl_churn_ctgry = 'NonComm' AND a.outlet in ('NE Wallingford CT', 'NE Wilmington NC', 'NE Huntsville AL', 'NE Rochester NY' 'NE Charleston SC', 'NE Columbia SC 2', 'NE Columbia SC', 'NE Charlotte NC', 'NE Hanover MD', 'NE Bangor ME') and a.acss_call_ctr_type||a.acss_call_type_cd IN ('v1', 'v7', 'o1', 'o3', 'o7')  AND a.acss_call_dt BETWEEN a.activity_dt AND  ADD_MONTHS(a.activity_dt,0)+ 2	TERADATA	HABERER	00:00:10	00:00:00	17811
10/01/2012	11:57:04	NTL_PRD_ALLVM	00:00:08	100			select top 100 a.activity_mth, a.activity_type, a.cust_area, a.cust_region, a.cust_id, a.cust_line_seq_id,  a.fulfillment_ind, a.prod_nm, a.data_tier_fin, a.device_generation, a.prod_nm_prev, a.data_tier_fin_prev, a.device_generation_prev,  a.sales_area, a.sales_region, a.sls_dist_chnl_churn_ctgry, a.outlet, a.emp_nm, a.job_desc, a.hr_employee_id, a.nt_user_id,  ---Calls following the initial call a.acss_call_ctr_cd, a.acss_user_id, a.acss_call_dt, a.acss_call_tm, a.call_duration, a.acss_call_id, a.call_period   from ntl_prd_qmvm.ndcir_detail_v as a  where a.activity_dt between '2012-09-21' and '2012-09-30' and a.sales_area = 'Northeast' and a.sls_dist_chnl_churn_ctgry = 'NonComm' and a.acss_call_ctr_type||a.acss_call_type_cd IN ('v1', 'v7', 'o1', 'o3', 'o7')  AND a.acss_call_dt BETWEEN a.activity_dt AND  ADD_MONTHS(a.activity_dt,0)+ 2	TERADATA	HABERER	00:00:08	00:00:00	17810
10/01/2012	11:56:22	NTL_PRD_ALLVM	00:00:00	0	3810		select top 100 a.activity_mth, a.activity_type, a.cust_area, a.cust_region, a.cust_id, a.cust_line_seq_id,  a.fulfillment_ind, a.prod_nm, a.data_tier_fin, a.device_generation, a.prod_nm_prev, a.data_tier_fin_prev, a.device_generation_prev,  a.sls_area, a.sls_region, a.sls_dist_chnl_churn_ctgry, a.outlet, a.emp_nm, a.job_desc, a.hr_employee_id, a.nt_user_id,  ---Calls following the initial call a.acss_call_ctr_cd, a.acss_user_id, a.acss_call_dt, a.acss_call_tm, a.call_duration, a.acss_call_id, a.call_period   from ntl_prd_qmvm.ndcir_detail_v as a  where a.activity_dt between '2012-09-21' and '2012-09-30' and a.sls_area = 'Northeast' and a.sls_dist_chnl_churn_ctgry = 'NonComm' and a.acss_call_ctr_type||a.acss_call_type_cd IN ('v1', 'v7', 'o1', 'o3', 'o7')  AND a.acss_call_dt BETWEEN a.activity_dt AND  ADD_MONTHS(a.activity_dt,0)+ 2	TERADATA	HABERER	00:00:00	00:00:00	17809
10/01/2012	11:55:53	NTL_PRD_ALLVM	00:00:00	0	3810		select top 100 a.activity_mth, a.activity_type, a.cust_area, a.cust_region, a.cust_id, a.cust_line_seq_id,  a.fulfillment_ind, a.prod_nm, a.data_tier_fin, a.device_generation, a.prod_nm_prev, a.data_tier_fin_prev, a.device_generation_prev,  a.sls_area_desc, a.sls_region_desc, a.sls_dist_chnl_churn_ctgry, a.outlet, a.emp_nm, a.job_desc, a.hr_employee_id, a.nt_user_id,  ---Calls following the initial call a.acss_call_ctr_cd, a.acss_user_id, a.acss_call_dt, a.acss_call_tm, a.call_duration, a.acss_call_id, a.call_period   from ntl_prd_qmvm.ndcir_detail_v as a  where a.activity_dt between '2012-09-21' and '2012-09-30' and a.sls_area_desc = 'Northeast' and a.sls_dist_chnl_churn_ctgry = 'NonComm' and a.acss_call_ctr_type||a.acss_call_type_cd IN ('v1', 'v7', 'o1', 'o3', 'o7')  AND a.acss_call_dt BETWEEN a.activity_dt AND  ADD_MONTHS(a.activity_dt,0)+ 2	TERADATA	HABERER	00:00:00	00:00:00	17808
10/01/2012	11:55:29	NTL_PRD_ALLVM	00:00:00	0	3810		select top 100 a.activity_mth, a.activity_type, a.cust_area_desc, a.cust_region_desc, a.cust_id, a.cust_line_seq_id,  a.fulfillment_ind, a.prod_nm, a.data_tier_fin, a.device_generation, a.prod_nm_prev, a.data_tier_fin_prev, a.device_generation_prev,  a.sls_area_desc, a.sls_region_desc, a.sls_dist_chnl_churn_ctgry, a.outlet, a.emp_nm, a.job_desc, a.hr_employee_id, a.nt_user_id,  ---Calls following the initial call a.acss_call_ctr_cd, a.acss_user_id, a.acss_call_dt, a.acss_call_tm, a.call_duration, a.acss_call_id, a.call_period   from ntl_prd_qmvm.ndcir_detail_v as a  where a.activity_dt between '2012-09-21' and '2012-09-30' and a.sls_area_desc = 'Northeast' and a.sls_dist_chnl_churn_ctgry = 'NonComm' and a.acss_call_ctr_type||a.acss_call_type_cd IN ('v1', 'v7', 'o1', 'o3', 'o7')  AND a.acss_call_dt BETWEEN a.activity_dt AND  ADD_MONTHS(a.activity_dt,0)+ 2	TERADATA	HABERER	00:00:00	00:00:00	17807
10/01/2012	11:44:53	NTL_PRD_ALLVM	00:00:31	100			select top 100 *  from ntl_prd_qmvm.ndcir_detail_v	TERADATA	HABERER	00:00:31	00:00:00	17806
10/01/2012	11:42:32	NTL_PRD_ALLVM	00:00:05	100			select top 100 a.activity_mth, a.area_desc, a.region_desc, a.cust_id, a.cust_line_seq_id, a.prod_nm, a.prod_nm_prev, a.fulfillment_ind, a.sls_dist_chnl_churn_ctgry, a.addr_line1, a.city_nm, a.hr_employee_id, a.nt_user_id, a.sls_area_desc, a.sls_region_desc,   ---Calls following the initial call a.acss_call_dt, a.acss_call_tm, a.call_duration, a.acss_call_id, a.call_period   from ntl_prd_qmtbls.mrs_ndcir_detail as a  where a.activity_dt between '2012-09-21' and '2012-09-30' and a.sls_area_desc = 'Northeast' and a.sls_dist_chnl_churn_ctgry = 'NonComm' and a.acss_call_ctr_type||a.acss_call_type_cd IN ('v1', 'v7', 'o1', 'o3', 'o7')	TERADATA	HABERER	00:00:05	00:00:00	17805
10/01/2012	11:35:21	NTL_PRD_ALLVM	00:00:07	100			select top 100 a.activity_mth, a.area_desc, a.region_desc, a.cust_id, a.cust_line_seq_id, a.prod_nm, a.prod_nm_prev, a.fulfillment_ind, a.sls_dist_chnl_churn_ctgry, a.hr_employee_id, a.nt_user_id, a.sls_area_desc, a.sls_region_desc,   ---Calls following the initial call a.acss_call_dt, a.acss_call_tm, a.call_duration, a.acss_call_id, a.call_period   from ntl_prd_qmtbls.mrs_ndcir_detail as a  where a.activity_dt between '2012-09-21' and '2012-09-30' and a.sls_area_desc = 'Northeast' and a.sls_dist_chnl_churn_ctgry = 'NonComm' and a.acss_call_ctr_type||a.acss_call_type_cd IN ('v1', 'v7', 'o1', 'o3', 'o7')	TERADATA	HABERER	00:00:07	00:00:00	17804
10/01/2012	11:35:02	NTL_PRD_ALLVM	00:00:00	0	3706		select top 100 a.activity_mth, a.area_desc, a.region_desc, a.cust_id, a.cust_line_seq_id, a.prod_nm, a.prod_nm_prev, a.fulfillment_ind, a.sls_dist_chnl_churn_ctgry, a.hr_employee_id, a.nt_user_id, a.sls_area_desc, a.sls_region_desc,   ---Calls following the initial call a.acss_call_dt, a.acss_call_tm, a.call_duration, a.acss_call_id, a.call_period,   from ntl_prd_qmtbls.mrs_ndcir_detail  where a.activity_dt between '2012-09-21' and '2012-09-30' and a.sls_area_desc = 'Northeast' and a.sls_dist_chnl_churn_ctgry = 'NonComm' and a.acss_call_ctr_type||a.acss_call_type_cd IN ('v1', 'v7', 'o1', 'o3', 'o7')	TERADATA	HABERER	00:00:00	00:00:00	17803
10/01/2012	11:22:08	NTL_PRD_ALLVM	00:00:06	100			select top 100 *   from ntl_prd_qmtbls.mrs_ndcir_detail	TERADATA	HABERER	00:00:06	00:00:00	17802
10/01/2012	11:20:27	NTL_PRD_ALLVM	00:00:00	0	3810		SELECT  a.area_desc,  a.activity_mth,  a.activity_dt,  acall.mtn,  a.cust_id,  a.cust_line_seq_id,  CASE  WHEN x.acct_estb_dt  BETWEEN DATE - 60 AND DATE THEN '0 to 60'                        WHEN x.acct_estb_dt  BETWEEN DATE - 120 AND DATE - 61 THEN '61 to 120'               WHEN x.acct_estb_dt  BETWEEN DATE - 180 AND DATE - 121 THEN '121 to 180'                          WHEN x.acct_estb_dt  BETWEEN DATE - 360 AND DATE - 181 THEN '181 to 360'                          ELSE '>360' END Acct_tenure_in_days,  a.sls_channel,  a.sls_dist_chnl_churn_ctgry,  a.ia_item_class_cd,  a.upg_device,  a.prev_device,  a.invc_num,  a.invc_line_num,  a.sls_prsn_id,   a.fulfillment_ind,  CASE WHEN cc.acss_call_ctr_desc IN ('NE Columbia SC 2', 'NE Columbia SC') THEN 'Columbia'  WHEN cc.acss_call_ctr_desc = 'NE Huntsville AL' THEN 'Huntsville'  WHEN  cc.acss_call_ctr_desc = 'NE Rochester NY' THEN 'Rochester'  WHEN cc.acss_call_ctr_desc = 'NE Wilmington NC' THEN 'Wilmington'  WHEN cc.acss_call_ctr_desc = 'NE Hanover MD' THEN 'Hanover'  WHEN cc.acss_call_ctr_desc = 'NE Charleston SC' THEN 'Charleston'  WHEN  cc.acss_call_ctr_desc = 'NE Charlotte NC' THEN 'Charlotte'  WHEN cc.acss_call_ctr_desc = 'NE Wallingford CT' THEN 'Wallingford'  WHEN cc.acss_call_ctr_desc = 'NE Bangor ME' THEN 'Bangor'  ELSE cc.acss_call_ctr_desc END AS Upgrd_CENTER,  u.nm_last||', '||u.nm_first AS Upgrd_rep_nm,  a.acss_user_id,  a.hr_employee_id,  ad.acss_dept_desc,  acall.acss_call_dt,  acall.acss_call_id,  acall.acss_call_tm,         CASE   WHEN cc.acss_call_ctr_time_zn LIKE 'C%' THEN              acall.acss_call_tm + INTERVAL '1' HOUR          WHEN cc.acss_call_ctr_time_zn LIKE 'M%' THEN              acall.acss_call_tm + INTERVAL '2' HOUR         WHEN cc.acss_call_ctr_time_zn LIKE 'P%' THEN              acall.acss_call_tm +INTERVAL '3' HOUR          WHEN cc.acss_call_ctr_time_zn LIKE 'H%' THEN              acall.acss_call_tm + INTERVAL '5' HOUR          ELSE acall.acss_call_tm       END acss_call_EST_tm,  (acall.call_disconnect_tm - acall.call_start_tm) HOUR TO SECOND (0) AS CALL_DURATION_TM,      CAST(          acall.acss_call_dt ||          ' '             ||          CAST(acss_call_EST_tm AS CHAR(8)) AS TIMESTAMP(0)      ) upgrd_dt_tm    FROM  ntl_prd_qmtbls.mrs_ndcir_detail AS a      LEFT JOIN ntl_prd_allvm.cust_acct_v AS x    ON a.sor_id = x.sor_id  AND a.cust_id = x.cust_id  AND a.acct_num = x.acct_num    INNER JOIN ntl_prd_allvm.acss_call_v AS acall   ON a.sor_id = acall.sor_id AND a.cust_id = acall.cust_id  AND a.cust_line_seq_id = acall.cust_line_seq_id  AND a.acss_user_id = acall.acss_user_id  AND a.pymnt_dt = acall.acss_call_dt  AND acall.acss_call_type_cd IN ('1','7')    JOIN ntl_prd_allvm.acss_user_v AS u     ON acall.acss_user_id =  u.acss_user_id      INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc     ON acall.acss_call_ctr_cd = cc.acss_call_ctr_cd     INNER JOIN ntl_prd_allvm.acss_dept_v AS ad     ON acall.acss_dept_id = ad.acss_dept_id   WHERE a.pymnt_dt BETWEEN '2012-09-15' AND '2012-09-30'  AND a.sls_dist_chnl_churn_ctgry = 'NonComm'  AND  cc.acss_call_ctr_desc = 'NE Wallingford CT'    GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26	TERADATA	HABERER	00:00:00	00:00:00	17801
10/01/2012	11:19:34	NTL_PRD_ALLVM	00:00:01	0	3810		SELECT  a.area_desc,  a.activity_mth,  a.pymnt_dt,  acall.mtn,  a.cust_id,  a.cust_line_seq_id,  CASE  WHEN x.acct_estb_dt  BETWEEN DATE - 60 AND DATE THEN '0 to 60'                        WHEN x.acct_estb_dt  BETWEEN DATE - 120 AND DATE - 61 THEN '61 to 120'               WHEN x.acct_estb_dt  BETWEEN DATE - 180 AND DATE - 121 THEN '121 to 180'                          WHEN x.acct_estb_dt  BETWEEN DATE - 360 AND DATE - 181 THEN '181 to 360'                          ELSE '>360' END Acct_tenure_in_days,  a.sls_channel,  a.sls_dist_chnl_churn_ctgry,  a.ia_item_class_cd,  a.upg_device,  a.prev_device,  a.invc_num,  a.invc_line_num,  a.sls_prsn_id,   a.fulfillment_ind,  CASE WHEN cc.acss_call_ctr_desc IN ('NE Columbia SC 2', 'NE Columbia SC') THEN 'Columbia'  WHEN cc.acss_call_ctr_desc = 'NE Huntsville AL' THEN 'Huntsville'  WHEN  cc.acss_call_ctr_desc = 'NE Rochester NY' THEN 'Rochester'  WHEN cc.acss_call_ctr_desc = 'NE Wilmington NC' THEN 'Wilmington'  WHEN cc.acss_call_ctr_desc = 'NE Hanover MD' THEN 'Hanover'  WHEN cc.acss_call_ctr_desc = 'NE Charleston SC' THEN 'Charleston'  WHEN  cc.acss_call_ctr_desc = 'NE Charlotte NC' THEN 'Charlotte'  WHEN cc.acss_call_ctr_desc = 'NE Wallingford CT' THEN 'Wallingford'  WHEN cc.acss_call_ctr_desc = 'NE Bangor ME' THEN 'Bangor'  ELSE cc.acss_call_ctr_desc END AS Upgrd_CENTER,  u.nm_last||', '||u.nm_first AS Upgrd_rep_nm,  a.acss_user_id,  a.hr_employee_id,  ad.acss_dept_desc,  acall.acss_call_dt,  acall.acss_call_id,  acall.acss_call_tm,         CASE   WHEN cc.acss_call_ctr_time_zn LIKE 'C%' THEN              acall.acss_call_tm + INTERVAL '1' HOUR          WHEN cc.acss_call_ctr_time_zn LIKE 'M%' THEN              acall.acss_call_tm + INTERVAL '2' HOUR         WHEN cc.acss_call_ctr_time_zn LIKE 'P%' THEN              acall.acss_call_tm +INTERVAL '3' HOUR          WHEN cc.acss_call_ctr_time_zn LIKE 'H%' THEN              acall.acss_call_tm + INTERVAL '5' HOUR          ELSE acall.acss_call_tm       END acss_call_EST_tm,  (acall.call_disconnect_tm - acall.call_start_tm) HOUR TO SECOND (0) AS CALL_DURATION_TM,      CAST(          acall.acss_call_dt ||          ' '             ||          CAST(acss_call_EST_tm AS CHAR(8)) AS TIMESTAMP(0)      ) upgrd_dt_tm    FROM  ntl_prd_qmtbls.mrs_ndcir_detail AS a      LEFT JOIN ntl_prd_allvm.cust_acct_v AS x    ON a.sor_id = x.sor_id  AND a.cust_id = x.cust_id  AND a.acct_num = x.acct_num    INNER JOIN ntl_prd_allvm.acss_call_v AS acall   ON a.sor_id = acall.sor_id AND a.cust_id = acall.cust_id  AND a.cust_line_seq_id = acall.cust_line_seq_id  AND a.acss_user_id = acall.acss_user_id  AND a.pymnt_dt = acall.acss_call_dt  AND acall.acss_call_type_cd IN ('1','7')    JOIN ntl_prd_allvm.acss_user_v AS u     ON acall.acss_user_id =  u.acss_user_id      INNER JOIN ntl_prd_allvm.acss_call_center_v AS  cc     ON acall.acss_call_ctr_cd = cc.acss_call_ctr_cd     INNER JOIN ntl_prd_allvm.acss_dept_v AS ad     ON acall.acss_dept_id = ad.acss_dept_id   WHERE a.pymnt_dt BETWEEN '2012-09-15' AND '2012-09-30'  AND a.sls_dist_chnl_churn_ctgry = 'NonComm'  AND  cc.acss_call_ctr_desc = 'NE Wallingford CT'    GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26	TERADATA	HABERER	00:00:01	00:00:00	17800
10/01/2012	10:52:20	NTL_PRD_ALLVM	00:00:04	1			select count(*)   from ntl_prd_qmtbls.after_call_survey_emh_v	TERADATA	HABERER	00:00:04	00:00:00	17799
10/01/2012	10:52:04	NTL_PRD_ALLVM	00:00:02	0	10053		select count(*)   from ntl_prd_qmtbls.after_call_survey_emh_v	TERADATA	HABERER	00:00:02	00:00:00	17798
10/01/2012	10:16:01	NTL_PRD_ALLVM	00:00:08	0	3902		drop table Reporting_Month; drop table nccir_base11; drop table nccir_base1a; drop table nccir_base11b; drop table nccir_acts_v; drop table upcir_base11; drop table upcir_base22; drop table upcir_base33; drop table upcir_base22a; drop table upcir_base22aa; drop table upcir_base22b; drop table upcir_base22bb; drop table upcir_up_v; drop table ndcir_up_nc_emh_v;	TERADATA	HABERER	00:00:08	00:00:00	17797
10/01/2012	08:14:57	NTL_PRD_ALLVM	00:03:13	15031			CREATE VOLATILE TABLE Repeat_Reporting_EMH1 AS (SELECT      acc.acss_call_ctr_desc,      acc.acss_call_ctr_cd,      ac.sor_id,      ac.acss_call_type_cd,     acc.acss_area_cd AS ctr_area,      acc.acss_call_ctr_type,      ac.cust_id,      ac.cust_line_seq_id,          ac.acct_num,      ac.mtn,      ac.acss_user_id,      ac.acss_call_dt,          ac.acss_call_tm,           (ac.call_disconnect_tm - ac.call_start_tm) HOUR TO SECOND (0) AS call_duration_tm,      COALESCE(sed.departmenttype,'Other') depttype,           COALESCE(sed.departmentgroup, 'Other') as dept_group,          CASE  WHEN acc.acss_call_ctr_time_zn LIKE 'C%' THEN                       ac.acss_call_tm + INTERVAL '1' HOUR                          WHEN acc.acss_call_ctr_time_zn LIKE 'M%' THEN               ac.acss_call_tm + INTERVAL '2' HOUR                          WHEN acc.acss_call_ctr_time_zn LIKE 'P%' THEN                 ac.acss_call_tm +INTERVAL '3' HOUR                            WHEN acc.acss_call_ctr_time_zn LIKE 'H%' THEN                ac.acss_call_tm + INTERVAL '5' HOUR                           ELSE ac.acss_call_tm         END acss_call_ad,      CAST(          ac.acss_call_dt ||          ' '             ||          CAST(acss_call_ad AS CHAR(8)) AS TIMESTAMP(0)      ) acss_dt_tm,      ad.acss_dept_desc,      ad.acss_dept_id,      ac.acss_call_id,      ac.area_cd,      RANK() OVER (PARTITION BY cust_id, cust_line_seq_id          ORDER BY ac.acss_call_dt, acss_call_ad, acss_call_id) rnk  FROM ntl_prd_allvm.acss_call_v AS ac  JOIN sys_calendar.calendar AS z        ON calendar_date= DATE   JOIN ntl_prd_allvm.acss_call_center_v AS acc      ON ac.acss_call_ctr_cd = acc.acss_call_ctr_cd  JOIN ntl_prd_allvm.acss_user_v AS au      ON ac.acss_user_id = au.acss_user_id  JOIN ntl_prd_allvm.acss_dept_v AS ad      ON ac.acss_dept_id = ad.acss_dept_id  LEFT JOIN ntl_prd_qmtbls.emh_eccr_dep AS sed    ON ad.acss_dept_id = sed.acssdeptid  LEFT JOIN                  (SELECT a.acss_call_dt,a.acss_call_ctr_cd, a.acss_dept_id FROM                  ntl_prd_allvm.acss_call_v  as a                                  JOIN sys_calendar.calendar AS z                                                                        ON calendar_date= DATE                                   WHERE                  a.acss_call_dt BETWEEN (DATE-(4)) AND (DATE-(2))                   AND a.acss_call_type_cd = '1'                  GROUP BY 1,2,3) r  ON          ac.acss_call_dt = r.acss_call_dt          AND ac.acss_call_ctr_cd = r.acss_call_ctr_cd          AND ac.acss_dept_id = r.acss_dept_id  WHERE ac.acss_call_dt BETWEEN (DATE-(4)) AND (DATE-(2))   AND COALESCE(sed.departmenttype,'Other') <> 'NA'  AND (      (ac.acss_call_type_cd IN ('1','7')) OR      (          ac.acss_call_type_cd = '3'          AND acc.acss_call_ctr_type = 'O'          AND ad.acss_dept_desc NOT LIKE '%offline%'          AND r.acss_dept_id IS NULL ))  ) WITH DATA PRIMARY INDEX (cust_id, cust_line_seq_id, acss_call_dt, acss_call_id, rnk) ON COMMIT PRESERVE ROWS;   CREATE TABLE NTL_PRD_QMTBLS.Repeat_Reporting_EMH21  AS  (  SELECT      a.sor_id,      a.acss_call_id,      a.acss_call_type_cd,      a.ctr_area,      a.acss_call_ctr_type,      m.area_cd,      m.region_desc,      a.cust_id,      a.cust_line_seq_id,      a.mtn,      a.acss_call_dt,          a.acss_call_ad,          a.acss_call_tm,           a.call_duration_tm,      a.rnk,      a.acss_dept_desc as initial_dept_desc,      a.acss_dept_id,      a.acss_user_id,      a.acss_call_ctr_desc,      a.acss_call_ctr_cd,      a.depttype AS orgtype,          a.dept_group as org_dept_group,      b.acss_call_id AS repeat_call_id,      b.acss_dept_desc AS repeat_dept_desc,      b.acss_dept_id AS repeat_dept_id,          b.acss_user_id AS repeat_user_id,          b.acss_call_ctr_desc AS repeat_call_ctr_desc,      b.acss_call_ctr_cd AS repeat_ctr_cd,      b.acss_call_dt AS repeat_dt,          b.acss_call_ad AS repeat_call_ad,         b.acss_call_tm as repeat_call_tm,           b.call_duration_tm as repeat_call_duration_tm,      b.rnk AS repeat_rnk,      b.depttype AS reptype,          b.dept_group as rpt_dept_group,      CASE WHEN b.acss_dt_tm IS NOT NULL THEN        ((b.acss_dt_tm - a.acss_dt_tm) DAY(4) TO MINUTE ) END tsdiff,      CASE WHEN b.acss_dt_tm IS NOT NULL THEN        (EXTRACT(HOUR FROM tsdiff) * 60)        + EXTRACT(MINUTE FROM tsdiff)        + (CAST((CAST ((tsdiff) AS INTERVAL DAY)) AS INTEGER) * 1440) END min_diff  FROM Repeat_Reporting_EMH1 AS a  JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt                 JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)       INNER JOIN Repeat_Reporting_EMH1 AS b          ON  a.cust_id = b.cust_id          AND a.cust_line_seq_id = b.cust_line_seq_id                  AND a.acss_call_dt = b.acss_call_dt                       AND b.rnk = a.rnk + 1          AND b.acss_call_id <> a.acss_call_id                  --AND ( b.acss_call_ad -  a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00'              LEFT JOIN ntl_prd_allvm.acss_call_center_v AS acc      ON b.acss_call_ctr_cd = acc.acss_call_ctr_cd  ) WITH DATA PRIMARY INDEX( sor_id, acss_call_id, acss_call_type_cd, ctr_area, acss_call_ctr_type, area_cd, region_desc, cust_id, cust_line_seq_id, mtn, acss_call_dt, acss_call_ad, acss_call_tm, call_duration_tm, rnk, initial_dept_desc, acss_dept_id, acss_user_id, acss_call_ctr_desc, acss_call_ctr_cd, orgtype, org_dept_group, repeat_call_id, repeat_dept_desc, repeat_dept_id, repeat_user_id, repeat_call_ctr_desc, repeat_ctr_cd, repeat_dt, repeat_call_ad, repeat_call_tm, repeat_call_duration_tm, repeat_rnk, reptype, rpt_dept_group, tsdiff, min_diff);  select a.acss_call_ctr_desc, hr1.nm_last || ', ' || hr1.nm_first AS  AD_Nm,  hr2.nm_last || ', ' || hr2.nm_first AS Supv_Nm,    u.nm_last||', '||u.nm_first AS First_Rep_nm,  a.initial_dept_desc,  a.acss_user_id, a.mtn, a.cust_id, a.area_cd, a.region_desc, CASE WHEN cal.Device_type_cd LIKE '%4GS%'  THEN cal.device_prod_nm  ELSE cal.prod_nm END AS Device_Nm, dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, a.orgtype, a.acss_call_dt, a.acss_call_ad, a.acss_call_tm, a.call_duration_tm, a.repeat_call_ctr_desc, u1.nm_last||', '||u1.nm_first AS Repeat_Rep_nm,  a.repeat_dept_desc, a.reptype, a.repeat_dt, a.repeat_call_ad, a.repeat_call_tm, a.repeat_call_duration_tm, a.tsdiff, a.min_diff, CASE WHEN (a.repeat_call_ad - a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00' THEN  'Y' ELSE 'N' END AS Rpts_2hrs_and_Under   FROM NTL_PRD_QMTBLS.Repeat_Reporting_EMH21 AS a  JOIN sys_calendar.calendar AS z   ON calendar_date= DATE   JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt       LEFT JOIN device_dp_map_v AS dm                     ON (CASE WHEN cal.Device_type_cd LIKE '%4GS%' THEN cal.device_prod_nm ELSE cal.prod_nm END) = dm.prod_nm                JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)  LEFT JOIN ntl_prd_qmtbls.stm_eccr_area AS s    ON a.acss_call_ctr_cd = s.acsscallcentercd    AND a.acss_dept_id = s.acssdeptid      Join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id = u.acss_user_id    JOIN ntl_prd_allvm.hr_employee_v AS hr  ON u.hr_employee_id = hr.emp_id    LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr2              ON hr.SUPER_ID_LVL2_EMP_ID = hr2.emp_id                     LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr1           ON hr.SUPER_ID_LVL1_EMP_ID = hr1.emp_id   Join ntl_prd_allvm.acss_user_v AS u1  on a.repeat_user_id = u1.acss_user_id  WHERE acss_call_dt BETWEEN '2012-09-01' AND ADD_MONTHS('2012-09-01',1)-1 and a.orgtype IN ('CS','WDTS')  and a.reptype IN ('CS','WDTS')  and a.org_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.rpt_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.acss_call_ctr_desc IN('NE Columbia SC',  'NE Huntsville AL',  'NE Hanover MD',  'NE Rochester NY',  'NE Charleston SC',  'NE Charlotte NC',  'NE Wallingford CT',  'NE Wilmington NC',  'NE Bangor ME',  'NE Columbia SC 2')    GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29 ORDER BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29;  DROP TABLE Repeat_Reporting_EMH1; DROP TABLE NTL_PRD_QMTBLS. Repeat_Reporting_EMH21;	TERADATA	HABERER	00:02:58	00:00:15	17796
10/01/2012	07:27:11	NTL_PRD_ALLVM	00:00:55	6978			select  a.activity_mth,  a.activity_dt,  a.activity_type,  a.sls_area_desc as sales_area,  a.sls_region_desc as sales_region,  a.sls_dist_chnl_churn_ctgry,  a.sls_outlet_id,  o.sls_outlet_nm as outlet,   coalesce(case when heh.nm_mdlin is null then   heh.nm_last||', '||heh.nm_first   else heh.nm_last||', '||heh.nm_first||' '||trim(heh.nm_mdlin)||'.' end, 'Unknown') as sls_rep_nm, heh.job_desc, coalesce(case when heh02.nm_mdlin is null then   heh02.nm_last||', '||heh02.nm_first   else heh02.nm_last||', '||heh02.nm_first||' '||trim(heh02.nm_mdlin)||'.' end, 'Unknown') as sls_rep_direct_mgr,  heh02.email_addr as rep_direct_mgr_email,  heh02.job_desc as direct_mgr_job_desc,  coalesce(case when heh01.nm_mdlin is null then   heh01.nm_last||', '||heh01.nm_first   else heh01.nm_last||', '||heh01.nm_first||' '||trim(heh01.nm_mdlin)||'.' end, 'Unknown') as sls_district_mgr_nm,  heh01.email_addr as district_mgr_email,  heh01.job_desc as district_mgr_job_desc,  o.district_cd as Zone_District_cd,  a.area_desc as cust_area_desc,  a.region_desc as cust_region_desc,  cal.nm_first||'   '||cal.nm_last AS cust_name,  a.lang_pref_ind,  coalesce(email.email_addr, 'n/a') as cust_email_addr,   cal.mtn,   a.cust_id,  a.cust_line_seq_id,  a.device_nm_prev,  a.device_nm,  dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, case when a.fulfillement_ind='F' then 'direct' when a.fulfillement_ind='L' then 'local' else 'unknown' end as dfill, case when a.ecpd_liability_type_cd='C' then 'Business' else 'Consumer' end as Consumer_Business, case when dnsh.dns_type_cd is not null then 'Yes' When dnsh.dns_type_cd is null then 'No' end as on_dns_list, case when acs.currentstatus = 'Completed' and acs.mtn is not null then 'Yes'  else 'No' end as After_Cll_Survey  from ndcir_up_nc_emh_v as a  join  ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal ON a.cust_id = cal.cust_id AND a.cust_line_seq_id = cal.cust_line_seq_id AND a.activity_dt  BETWEEN cal.eff_dt AND cal.exp_dt  left join ntl_prd_allvm.cust_acct_line_dns_dly_hist_v as dnsh on a.sor_id = dnsh.sor_id and a.cust_id = dnsh.cust_id and a.cust_line_seq_id = dnsh.cust_line_seq_id and dnsh.dns_type_cd = 'SR' and a.activity_dt + 1 between dnsh.eff_dt and dnsh.exp_dt  left join (select sor_id, cust_id, acct_num, email_addr, email_status_ind,  email_selection_ind, entry_point, opt_in_dt,entry_dt, verify_ind  from ntl_prd_allvm.cust_acct_email_v  where email_selection_ind = 'X' ) as email on cal.sor_id = email.sor_id and cal.cust_id = email.cust_id and cal.acct_num = email.acct_num  left join ntl_prd_qmtbls.after_call_survey_emh_v as acs on cal.mtn = acs.mtn --and cal.cust_id = acs.customerid  left join ntl_prd_allvm.hr_employee_hist_v as heh on a.hr_employee_id = heh.emp_id and a.activity_dt between heh.eff_dt and heh.exp_dt  left join ntl_prd_allvm.hr_employee_hist_v AS heh02              on heh.super_id_lvl2_emp_id = heh02.emp_id and a.activity_dt between heh02.eff_dt and heh02.exp_dt                   left join ntl_prd_allvm.hr_employee_hist_v AS heh01          on heh.super_id_lvl1_emp_id  = heh01.emp_id  and a.activity_dt between heh01.eff_dt and heh01.exp_dt    left join  ntl_prd_allvm.dns_type_v as dnsd on dnsh.dns_type_cd = dnsd.dns_type_cd  left join ntl_prd_allvm.outlet_v as o  on a.sls_outlet_id = o.sls_outlet_id   left join  ntl_prd_allvm.device_dp_map_v AS dm                   ON a.device_nm = dm.prod_nm   where  a.activity_mth = '2012-09-01' and a.sls_area_desc = 'Northeast' and a.sls_region_desc = 'New York Metro' and a.sls_dist_chnl_churn_ctgry = 'Stores' and dfill = 'Local' and cust_email_addr <> 'n/a' and heh.job_cd in ('65045', 'V51103')     and dm.device_tier not in ('Tablet', 'PC Card', 'Other') and on_dns_list <> 'Yes' and After_Cll_Survey <> 'Yes'  qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id order by a.cust_id, a.cust_line_seq_id, a.activity_dt) = 1  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33 order by a.sls_area_desc, a.sls_region_desc, a.activity_dt asc;  --drop table Reporting_Month; --drop table nccir_base11; --drop table nccir_base1a; --drop table nccir_base11b; --drop table nccir_acts_v; --drop table upcir_base11; --drop table upcir_base22; --drop table upcir_base33; --drop table upcir_base22a; --drop table upcir_base22aa; --drop table upcir_base22b; --drop table upcir_base22bb; --drop table upcir_up_v; --drop table ndcir_up_nc_emh_v;	TERADATA	HABERER	00:00:17	00:00:38	17795
10/01/2012	07:23:43	NTL_PRD_ALLVM	00:03:01	7069			create volatile table Reporting_Month as (  select *  from ntl_prd_qmtbls.month_date_emh_v   where date_range = '2012-09-01'  ) with data primary index(month_range, date_range)  index(date_range) order by values(date_range) on commit preserve rows;   --Table one NC create volatile table nccir_base11 as (  select    'NC' as activity_type   ,(dla.activity_dt - (extract(day from dla.activity_dt)-1)) as activity_mth   ,dla.activity_dt   ,mh.area_desc   ,mh.region_desc   ,dla. ...	TERADATA	HABERER	00:02:50	00:00:11	17794
09/28/2012	11:05:30	NTL_PRD_ALLVM	00:31:54	0			create volatile table Reporting_Month as (  select *  from ntl_prd_qmtbls.month_date_emh_v   where date_range = '2012-09-01'  ) with data primary index(month_range, date_range)  index(date_range) order by values(date_range) on commit preserve rows;   --Table one NC create volatile table nccir_base11 as (  select    'NC' as activity_type   ,(dla.activity_dt - (extract(day from dla.activity_dt)-1)) as activity_mth   ,dla.activity_dt   ,mh.area_desc   ,mh.region_desc   ,dla. ...	TERADATA	HABERER	00:31:54	00:00:00	17793
09/28/2012	10:50:57	NTL_PRD_ALLVM	00:00:02	17			select acss_call_dt, count(*) total_calls   from acss_call_v  where acss_call_dt >= '2012-09-01' and acss_call_type_cd in ('1','7') and mtn = '2152058876'  group by 1   order by 1 asc	TERADATA	HABERER	00:00:01	00:00:01	17792
09/28/2012	10:50:42	NTL_PRD_ALLVM	00:00:00	0	3706		select acss_call_dt, count(*) total_calls   from acss_call_v  where acss_call_dt >= '2012-09-01' and acss_call_type_cd in ('1','7') and mtn = '2152058876'  group by 1 asc	TERADATA	HABERER	00:00:00	00:00:00	17791
09/28/2012	10:50:25	NTL_PRD_ALLVM	00:00:00	0	5628		select acss_call_dt, count(*) total_calls   from acss_call_v  where acss_call_dt >= '2012-09-01' and acss_call_type_cd in ('1','7') and mtn = '2152058876'  group by 1 order by acs	TERADATA	HABERER	00:00:00	00:00:00	17790
09/28/2012	10:50:05	NTL_PRD_ALLVM	00:00:01	17			select acss_call_dt, count(*) total_calls   from acss_call_v  where acss_call_dt >= '2012-09-01' and acss_call_type_cd in ('1','7') and mtn = '2152058876'  group by 1	TERADATA	HABERER	00:00:01	00:00:00	17789
09/28/2012	10:48:50	NTL_PRD_ALLVM	00:00:02	25			select acss_call_dt, count(*) total_calls   from acss_call_v  where acss_call_dt > '2012-09-01' and acss_call_type_cd in ('1','7')  group by 1	TERADATA	HABERER	00:00:02	00:00:00	17788
09/28/2012	10:29:38	NTL_PRD_ALLVM	00:00:03	369857			select *  from ntl_prd_qmtbls.after_call_survey_emh_v	TERADATA	HABERER	00:00:02	00:00:01	17787
09/28/2012	10:27:40	NTL_PRD_ALLVM	00:00:05	66227			select *  from ntl_prd_qmtbls.after_call_survey_emh_v	TERADATA	HABERER	00:00:03	00:00:02	17786
09/28/2012	10:27:21	NTL_PRD_ALLVM	00:00:02	1			select max(offerdate)  from ntl_prd_qmtbls.after_call_survey_emh_v	TERADATA	HABERER	00:00:02	00:00:00	17785
09/28/2012	09:34:40	NTL_PRD_ALLVM	00:00:01	1			select max(offerdate)  from NTL_PRD_QMTBLS.AFTER_CALL_SURVEY_EMH_V	TERADATA	HABERER	00:00:01	00:00:00	17784
09/28/2012	09:31:45	NTL_PRD_ALLVM	00:00:02	66227			select *  from NTL_PRD_QMTBLS.AFTER_CALL_SURVEY_EMH_V	TERADATA	HABERER	00:00:01	00:00:01	17783
09/27/2012	08:55:11	NTL_PRD_ALLVM	00:12:09	7098			CREATE VOLATILE TABLE Repeat_Reporting_EMH1 AS (SELECT      acc.acss_call_ctr_desc,      acc.acss_call_ctr_cd,      ac.sor_id,      ac.acss_call_type_cd,     acc.acss_area_cd AS ctr_area,      acc.acss_call_ctr_type,      ac.cust_id,      ac.cust_line_seq_id,          ac.acct_num,      ac.mtn,      ac.acss_user_id,      ac.acss_call_dt,          ac.acss_call_tm,           (ac.call_disconnect_tm - ac.call_start_tm) HOUR TO SECOND (0) AS call_duration_tm,      COALESCE(sed.departmenttype,'Other') depttype,           COALESCE(sed.departmentgroup, 'Other') as dept_group,          CASE  WHEN acc.acss_call_ctr_time_zn LIKE 'C%' THEN                       ac.acss_call_tm + INTERVAL '1' HOUR                          WHEN acc.acss_call_ctr_time_zn LIKE 'M%' THEN               ac.acss_call_tm + INTERVAL '2' HOUR                          WHEN acc.acss_call_ctr_time_zn LIKE 'P%' THEN                 ac.acss_call_tm +INTERVAL '3' HOUR                            WHEN acc.acss_call_ctr_time_zn LIKE 'H%' THEN                ac.acss_call_tm + INTERVAL '5' HOUR                           ELSE ac.acss_call_tm         END acss_call_ad,      CAST(          ac.acss_call_dt ||          ' '             ||          CAST(acss_call_ad AS CHAR(8)) AS TIMESTAMP(0)      ) acss_dt_tm,      ad.acss_dept_desc,      ad.acss_dept_id,      ac.acss_call_id,      ac.area_cd,      RANK() OVER (PARTITION BY cust_id, cust_line_seq_id          ORDER BY ac.acss_call_dt, acss_call_ad, acss_call_id) rnk  FROM ntl_prd_allvm.acss_call_v AS ac  JOIN sys_calendar.calendar AS z        ON calendar_date= DATE   JOIN ntl_prd_allvm.acss_call_center_v AS acc      ON ac.acss_call_ctr_cd = acc.acss_call_ctr_cd  JOIN ntl_prd_allvm.acss_user_v AS au      ON ac.acss_user_id = au.acss_user_id  JOIN ntl_prd_allvm.acss_dept_v AS ad      ON ac.acss_dept_id = ad.acss_dept_id  LEFT JOIN ntl_prd_qmtbls.emh_eccr_dep AS sed    ON ad.acss_dept_id = sed.acssdeptid  LEFT JOIN                  (SELECT a.acss_call_dt,a.acss_call_ctr_cd, a.acss_dept_id FROM                  ntl_prd_allvm.acss_call_v  as a                                  JOIN sys_calendar.calendar AS z                                                                        ON calendar_date= DATE                                   WHERE                  a.acss_call_dt BETWEEN (DATE-(2)) AND (DATE-(2))                   AND a.acss_call_type_cd = '1'                  GROUP BY 1,2,3) r  ON          ac.acss_call_dt = r.acss_call_dt          AND ac.acss_call_ctr_cd = r.acss_call_ctr_cd          AND ac.acss_dept_id = r.acss_dept_id  WHERE ac.acss_call_dt BETWEEN (DATE-(2)) AND (DATE-(2))   AND COALESCE(sed.departmenttype,'Other') <> 'NA'  AND (      (ac.acss_call_type_cd IN ('1','7')) OR      (          ac.acss_call_type_cd = '3'          AND acc.acss_call_ctr_type = 'O'          AND ad.acss_dept_desc NOT LIKE '%offline%'          AND r.acss_dept_id IS NULL ))  ) WITH DATA PRIMARY INDEX (cust_id, cust_line_seq_id, acss_call_dt, acss_call_id, rnk) ON COMMIT PRESERVE ROWS;   CREATE TABLE NTL_PRD_QMTBLS.Repeat_Reporting_EMH21  AS  (  SELECT      a.sor_id,      a.acss_call_id,      a.acss_call_type_cd,      a.ctr_area,      a.acss_call_ctr_type,      m.area_cd,      m.region_desc,      a.cust_id,      a.cust_line_seq_id,      a.mtn,      a.acss_call_dt,          a.acss_call_ad,          a.acss_call_tm,           a.call_duration_tm,      a.rnk,      a.acss_dept_desc as initial_dept_desc,      a.acss_dept_id,      a.acss_user_id,      a.acss_call_ctr_desc,      a.acss_call_ctr_cd,      a.depttype AS orgtype,          a.dept_group as org_dept_group,      b.acss_call_id AS repeat_call_id,      b.acss_dept_desc AS repeat_dept_desc,      b.acss_dept_id AS repeat_dept_id,          b.acss_user_id AS repeat_user_id,          b.acss_call_ctr_desc AS repeat_call_ctr_desc,      b.acss_call_ctr_cd AS repeat_ctr_cd,      b.acss_call_dt AS repeat_dt,          b.acss_call_ad AS repeat_call_ad,         b.acss_call_tm as repeat_call_tm,           b.call_duration_tm as repeat_call_duration_tm,      b.rnk AS repeat_rnk,      b.depttype AS reptype,          b.dept_group as rpt_dept_group,      CASE WHEN b.acss_dt_tm IS NOT NULL THEN        ((b.acss_dt_tm - a.acss_dt_tm) DAY(4) TO MINUTE ) END tsdiff,      CASE WHEN b.acss_dt_tm IS NOT NULL THEN        (EXTRACT(HOUR FROM tsdiff) * 60)        + EXTRACT(MINUTE FROM tsdiff)        + (CAST((CAST ((tsdiff) AS INTERVAL DAY)) AS INTEGER) * 1440) END min_diff  FROM Repeat_Reporting_EMH1 AS a  JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt                 JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)       INNER JOIN Repeat_Reporting_EMH1 AS b          ON  a.cust_id = b.cust_id          AND a.cust_line_seq_id = b.cust_line_seq_id                  AND a.acss_call_dt = b.acss_call_dt                       AND b.rnk = a.rnk + 1          AND b.acss_call_id <> a.acss_call_id                  --AND ( b.acss_call_ad -  a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00'              LEFT JOIN ntl_prd_allvm.acss_call_center_v AS acc      ON b.acss_call_ctr_cd = acc.acss_call_ctr_cd  ) WITH DATA PRIMARY INDEX( sor_id, acss_call_id, acss_call_type_cd, ctr_area, acss_call_ctr_type, area_cd, region_desc, cust_id, cust_line_seq_id, mtn, acss_call_dt, acss_call_ad, acss_call_tm, call_duration_tm, rnk, initial_dept_desc, acss_dept_id, acss_user_id, acss_call_ctr_desc, acss_call_ctr_cd, orgtype, org_dept_group, repeat_call_id, repeat_dept_desc, repeat_dept_id, repeat_user_id, repeat_call_ctr_desc, repeat_ctr_cd, repeat_dt, repeat_call_ad, repeat_call_tm, repeat_call_duration_tm, repeat_rnk, reptype, rpt_dept_group, tsdiff, min_diff);  select a.acss_call_ctr_desc, hr1.nm_last || ', ' || hr1.nm_first AS  AD_Nm,  hr2.nm_last || ', ' || hr2.nm_first AS Supv_Nm,    u.nm_last||', '||u.nm_first AS First_Rep_nm,  a.initial_dept_desc,  a.acss_user_id, a.mtn, a.cust_id, a.area_cd, a.region_desc, CASE WHEN cal.Device_type_cd LIKE '%4GS%'  THEN cal.device_prod_nm  ELSE cal.prod_nm END AS Device_Nm, dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, a.orgtype, a.acss_call_dt, a.acss_call_ad, a.acss_call_tm, a.call_duration_tm, a.repeat_call_ctr_desc, u1.nm_last||', '||u1.nm_first AS Repeat_Rep_nm,  a.repeat_dept_desc, a.reptype, a.repeat_dt, a.repeat_call_ad, a.repeat_call_tm, a.repeat_call_duration_tm, a.tsdiff, a.min_diff, CASE WHEN (a.repeat_call_ad - a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00' THEN  'Y' ELSE 'N' END AS Rpts_2hrs_and_Under   FROM NTL_PRD_QMTBLS.Repeat_Reporting_EMH21 AS a  JOIN sys_calendar.calendar AS z   ON calendar_date= DATE   JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt       LEFT JOIN  ntl_prd_allvm.device_dp_map_v AS dm                     ON (CASE WHEN cal.Device_type_cd LIKE '%4GS%' THEN cal.device_prod_nm ELSE cal.prod_nm END) = dm.prod_nm                JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)  LEFT JOIN ntl_prd_qmtbls.stm_eccr_area AS s    ON a.acss_call_ctr_cd = s.acsscallcentercd    AND a.acss_dept_id = s.acssdeptid      Join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id = u.acss_user_id    JOIN ntl_prd_allvm.hr_employee_v AS hr  ON u.hr_employee_id = hr.emp_id    LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr2              ON hr.SUPER_ID_LVL2_EMP_ID = hr2.emp_id                     LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr1           ON hr.SUPER_ID_LVL1_EMP_ID = hr1.emp_id   Join ntl_prd_allvm.acss_user_v AS u1  on a.repeat_user_id = u1.acss_user_id  WHERE acss_call_dt BETWEEN '2012-09-01' AND ADD_MONTHS('2012-09-01',1)-1 and a.orgtype IN ('CS','WDTS')  and a.reptype IN ('CS','WDTS')  and a.org_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.rpt_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.acss_call_ctr_desc IN('NE Columbia SC',  'NE Huntsville AL',  'NE Hanover MD',  'NE Rochester NY',  'NE Charleston SC',  'NE Charlotte NC',  'NE Wallingford CT',  'NE Wilmington NC',  'NE Bangor ME',  'NE Columbia SC 2')    GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29 ORDER BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29;  DROP TABLE Repeat_Reporting_EMH1; DROP TABLE NTL_PRD_QMTBLS. Repeat_Reporting_EMH21;	TERADATA	HABERER	00:00:33	00:11:36	17782
09/26/2012	11:42:29	NTL_PRD_ALLVM	00:35:32	7191			CREATE VOLATILE TABLE Repeat_Reporting_EMH1 AS (SELECT      acc.acss_call_ctr_desc,      acc.acss_call_ctr_cd,      ac.sor_id,      ac.acss_call_type_cd,     acc.acss_area_cd AS ctr_area,      acc.acss_call_ctr_type,      ac.cust_id,      ac.cust_line_seq_id,          ac.acct_num,      ac.mtn,      ac.acss_user_id,      ac.acss_call_dt,          ac.acss_call_tm,           (ac.call_disconnect_tm - ac.call_start_tm) HOUR TO SECOND (0) AS call_duration_tm,      COALESCE(sed.departmenttype,'Other') depttype,           COALESCE(sed.departmentgroup, 'Other') as dept_group,          CASE  WHEN acc.acss_call_ctr_time_zn LIKE 'C%' THEN                       ac.acss_call_tm + INTERVAL '1' HOUR                          WHEN acc.acss_call_ctr_time_zn LIKE 'M%' THEN               ac.acss_call_tm + INTERVAL '2' HOUR                          WHEN acc.acss_call_ctr_time_zn LIKE 'P%' THEN                 ac.acss_call_tm +INTERVAL '3' HOUR                            WHEN acc.acss_call_ctr_time_zn LIKE 'H%' THEN                ac.acss_call_tm + INTERVAL '5' HOUR                           ELSE ac.acss_call_tm         END acss_call_ad,      CAST(          ac.acss_call_dt ||          ' '             ||          CAST(acss_call_ad AS CHAR(8)) AS TIMESTAMP(0)      ) acss_dt_tm,      ad.acss_dept_desc,      ad.acss_dept_id,      ac.acss_call_id,      ac.area_cd,      RANK() OVER (PARTITION BY cust_id, cust_line_seq_id          ORDER BY ac.acss_call_dt, acss_call_ad, acss_call_id) rnk  FROM ntl_prd_allvm.acss_call_v AS ac  JOIN sys_calendar.calendar AS z        ON calendar_date= DATE   JOIN ntl_prd_allvm.acss_call_center_v AS acc      ON ac.acss_call_ctr_cd = acc.acss_call_ctr_cd  JOIN ntl_prd_allvm.acss_user_v AS au      ON ac.acss_user_id = au.acss_user_id  JOIN ntl_prd_allvm.acss_dept_v AS ad      ON ac.acss_dept_id = ad.acss_dept_id  LEFT JOIN ntl_prd_qmtbls.emh_eccr_dep AS sed    ON ad.acss_dept_id = sed.acssdeptid  LEFT JOIN                  (SELECT a.acss_call_dt,a.acss_call_ctr_cd, a.acss_dept_id FROM                  ntl_prd_allvm.acss_call_v  as a                                  JOIN sys_calendar.calendar AS z                                                                        ON calendar_date= DATE                                   WHERE                  a.acss_call_dt BETWEEN (DATE-(2)) AND (DATE-(2))                   AND a.acss_call_type_cd = '1'                  GROUP BY 1,2,3) r  ON          ac.acss_call_dt = r.acss_call_dt          AND ac.acss_call_ctr_cd = r.acss_call_ctr_cd          AND ac.acss_dept_id = r.acss_dept_id  WHERE ac.acss_call_dt BETWEEN (DATE-(2)) AND (DATE-(2))   AND COALESCE(sed.departmenttype,'Other') <> 'NA'  AND (      (ac.acss_call_type_cd IN ('1','7')) OR      (          ac.acss_call_type_cd = '3'          AND acc.acss_call_ctr_type = 'O'          AND ad.acss_dept_desc NOT LIKE '%offline%'          AND r.acss_dept_id IS NULL ))  ) WITH DATA PRIMARY INDEX (cust_id, cust_line_seq_id, acss_call_dt, acss_call_id, rnk) ON COMMIT PRESERVE ROWS;   CREATE TABLE NTL_PRD_QMTBLS.Repeat_Reporting_EMH21  AS  (  SELECT      a.sor_id,      a.acss_call_id,      a.acss_call_type_cd,      a.ctr_area,      a.acss_call_ctr_type,      m.area_cd,      m.region_desc,      a.cust_id,      a.cust_line_seq_id,      a.mtn,      a.acss_call_dt,          a.acss_call_ad,          a.acss_call_tm,           a.call_duration_tm,      a.rnk,      a.acss_dept_desc as initial_dept_desc,      a.acss_dept_id,      a.acss_user_id,      a.acss_call_ctr_desc,      a.acss_call_ctr_cd,      a.depttype AS orgtype,          a.dept_group as org_dept_group,      b.acss_call_id AS repeat_call_id,      b.acss_dept_desc AS repeat_dept_desc,      b.acss_dept_id AS repeat_dept_id,          b.acss_user_id AS repeat_user_id,          b.acss_call_ctr_desc AS repeat_call_ctr_desc,      b.acss_call_ctr_cd AS repeat_ctr_cd,      b.acss_call_dt AS repeat_dt,          b.acss_call_ad AS repeat_call_ad,         b.acss_call_tm as repeat_call_tm,           b.call_duration_tm as repeat_call_duration_tm,      b.rnk AS repeat_rnk,      b.depttype AS reptype,          b.dept_group as rpt_dept_group,      CASE WHEN b.acss_dt_tm IS NOT NULL THEN        ((b.acss_dt_tm - a.acss_dt_tm) DAY(4) TO MINUTE ) END tsdiff,      CASE WHEN b.acss_dt_tm IS NOT NULL THEN        (EXTRACT(HOUR FROM tsdiff) * 60)        + EXTRACT(MINUTE FROM tsdiff)        + (CAST((CAST ((tsdiff) AS INTERVAL DAY)) AS INTEGER) * 1440) END min_diff  FROM Repeat_Reporting_EMH1 AS a  JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt                 JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)       INNER JOIN Repeat_Reporting_EMH1 AS b          ON  a.cust_id = b.cust_id          AND a.cust_line_seq_id = b.cust_line_seq_id                  AND a.acss_call_dt = b.acss_call_dt                       AND b.rnk = a.rnk + 1          AND b.acss_call_id <> a.acss_call_id                  --AND ( b.acss_call_ad -  a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00'              LEFT JOIN ntl_prd_allvm.acss_call_center_v AS acc      ON b.acss_call_ctr_cd = acc.acss_call_ctr_cd  ) WITH DATA PRIMARY INDEX( sor_id, acss_call_id, acss_call_type_cd, ctr_area, acss_call_ctr_type, area_cd, region_desc, cust_id, cust_line_seq_id, mtn, acss_call_dt, acss_call_ad, acss_call_tm, call_duration_tm, rnk, initial_dept_desc, acss_dept_id, acss_user_id, acss_call_ctr_desc, acss_call_ctr_cd, orgtype, org_dept_group, repeat_call_id, repeat_dept_desc, repeat_dept_id, repeat_user_id, repeat_call_ctr_desc, repeat_ctr_cd, repeat_dt, repeat_call_ad, repeat_call_tm, repeat_call_duration_tm, repeat_rnk, reptype, rpt_dept_group, tsdiff, min_diff);  select a.acss_call_ctr_desc, hr1.nm_last || ', ' || hr1.nm_first AS  AD_Nm,  hr2.nm_last || ', ' || hr2.nm_first AS Supv_Nm,    u.nm_last||', '||u.nm_first AS First_Rep_nm,  a.initial_dept_desc,  a.acss_user_id, a.mtn, a.cust_id, a.area_cd, a.region_desc, CASE WHEN cal.Device_type_cd LIKE '%4GS%'  THEN cal.device_prod_nm  ELSE cal.prod_nm END AS Device_Nm, dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, a.orgtype, a.acss_call_dt, a.acss_call_ad, a.acss_call_tm, a.call_duration_tm, a.repeat_call_ctr_desc, u1.nm_last||', '||u1.nm_first AS Repeat_Rep_nm,  a.repeat_dept_desc, a.reptype, a.repeat_dt, a.repeat_call_ad, a.repeat_call_tm, a.repeat_call_duration_tm, a.tsdiff, a.min_diff, CASE WHEN (a.repeat_call_ad - a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00' THEN  'Y' ELSE 'N' END AS Rpts_2hrs_and_Under   FROM NTL_PRD_QMTBLS.Repeat_Reporting_EMH21 AS a  JOIN sys_calendar.calendar AS z   ON calendar_date= DATE   JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt       LEFT JOIN  ntl_prd_allvm.device_dp_map_v AS dm                     ON (CASE WHEN cal.Device_type_cd LIKE '%4GS%' THEN cal.device_prod_nm ELSE cal.prod_nm END) = dm.prod_nm                JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)  LEFT JOIN ntl_prd_qmtbls.stm_eccr_area AS s    ON a.acss_call_ctr_cd = s.acsscallcentercd    AND a.acss_dept_id = s.acssdeptid      Join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id = u.acss_user_id    JOIN ntl_prd_allvm.hr_employee_v AS hr  ON u.hr_employee_id = hr.emp_id    LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr2              ON hr.SUPER_ID_LVL2_EMP_ID = hr2.emp_id                     LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr1           ON hr.SUPER_ID_LVL1_EMP_ID = hr1.emp_id   Join ntl_prd_allvm.acss_user_v AS u1  on a.repeat_user_id = u1.acss_user_id  WHERE acss_call_dt BETWEEN '2012-09-01' AND ADD_MONTHS('2012-09-01',1)-1 and a.orgtype IN ('CS','WDTS')  and a.reptype IN ('CS','WDTS')  and a.org_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.rpt_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.acss_call_ctr_desc IN('NE Columbia SC',  'NE Huntsville AL',  'NE Hanover MD',  'NE Rochester NY',  'NE Charleston SC',  'NE Charlotte NC',  'NE Wallingford CT',  'NE Wilmington NC',  'NE Bangor ME',  'NE Columbia SC 2')    GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29 ORDER BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29;  DROP TABLE Repeat_Reporting_EMH1; DROP TABLE NTL_PRD_QMTBLS. Repeat_Reporting_EMH21;	TERADATA	HABERER	00:33:22	00:02:10	17781
09/25/2012	15:18:40	NTL_PRD_ALLVM	01:04:42	7059			create volatile table Reporting_Month as (  select *  from ntl_prd_qmtbls.month_date_emh_v   where date_range = '2012-09-01'  ) with data primary index(month_range, date_range)  index(date_range) order by values(date_range) on commit preserve rows;   --Table one NC create volatile table nccir_base11 as (  select    'NC' as activity_type   ,(dla.activity_dt - (extract(day from dla.activity_dt)-1)) as activity_mth   ,dla.activity_dt   ,mh.area_desc   ,mh.region_desc   ,dla. ...	TERADATA	HABERER	01:04:29	00:00:13	17780
09/25/2012	14:12:10	NTL_PRD_ALLVM	00:00:03	0	10053		select  a.activity_mth,  a.activity_dt,  a.activity_type,  a.sls_area_desc as sales_area,  a.sls_region_desc as sales_region,  a.sls_dist_chnl_churn_ctgry,  a.sls_outlet_id,  o.sls_outlet_nm as outlet,   coalesce(case when heh.nm_mdlin is null then   heh.nm_last||', '||heh.nm_first   else heh.nm_last||', '||heh.nm_first||' '||trim(heh.nm_mdlin)||'.' end, 'Unknown') as sls_rep_nm, heh.job_desc, coalesce(case when heh02.nm_mdlin is null then   heh02.nm_last||', '||heh02.nm_first   else heh02.nm_last||', '||heh02.nm_first||' '||trim(heh02.nm_mdlin)||'.' end, 'Unknown') as sls_rep_direct_mgr,  heh02.email_addr as rep_direct_mgr_email,  heh02.job_desc as direct_mgr_job_desc,  coalesce(case when heh01.nm_mdlin is null then   heh01.nm_last||', '||heh01.nm_first   else heh01.nm_last||', '||heh01.nm_first||' '||trim(heh01.nm_mdlin)||'.' end, 'Unknown') as sls_district_mgr_nm,  heh01.email_addr as district_mgr_email,  heh01.job_desc as district_mgr_job_desc,  o.district_cd as Zone_District_cd,   a.area_desc as cust_area_desc,  a.region_desc as cust_region_desc,  cal.nm_first||'   '||cal.nm_last AS cust_name,  cal.home_tel_num,  a.lang_pref_ind,  coalesce(email.email_addr, 'n/a') as cust_email_addr,   cal.mtn,   a.cust_id,  a.cust_line_seq_id,  a.device_nm_prev,  a.device_nm,  dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, case when a.fulfillement_ind='F' then 'direct' when a.fulfillement_ind='L' then 'local' else 'unknown' end as dfill, case when a.ecpd_liability_type_cd='C' then 'Business' else 'Consumer' end as Consumer_Business, case when dnsh.dns_type_cd is not null then 'Yes' When dnsh.dns_type_cd is null then 'No' end as on_dns_list  from ndcir_up_nc_emh_v as a  join  ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal ON a.cust_id = cal.cust_id AND a.cust_line_seq_id = cal.cust_line_seq_id AND a.activity_dt  BETWEEN cal.eff_dt AND cal.exp_dt  left join ntl_prd_allvm.cust_acct_line_dns_dly_hist_v as dnsh on a.sor_id = dnsh.sor_id and a.cust_id = dnsh.cust_id and a.cust_line_seq_id = dnsh.cust_line_seq_id and dnsh.dns_type_cd = 'SR' and a.activity_dt + 1 between dnsh.eff_dt and dnsh.exp_dt  left join (select sor_id, cust_id, acct_num, email_addr, email_status_ind,  email_selection_ind, entry_point, opt_in_dt,entry_dt, verify_ind  from ntl_prd_allvm.cust_acct_email_v  where email_selection_ind = 'X' ) as email on cal.sor_id = email.sor_id and cal.cust_id = email.cust_id and cal.acct_num = email.acct_num  left join ntl_prd_allvm.hr_employee_hist_v as heh on a.hr_employee_id = heh.emp_id and a.activity_dt between heh.eff_dt and heh.exp_dt  left join ntl_prd_allvm.hr_employee_hist_v AS heh02              on heh.super_id_lvl2_emp_id = heh02.emp_id and a.activity_dt between heh02.eff_dt and heh02.exp_dt                   left join ntl_prd_allvm.hr_employee_hist_v AS heh01          on heh.super_id_lvl1_emp_id  = heh01.emp_id  and a.activity_dt between heh01.eff_dt and heh01.exp_dt    left join  ntl_prd_allvm.dns_type_v as dnsd on dnsh.dns_type_cd = dnsd.dns_type_cd  left join ntl_prd_allvm.outlet_v as o  on a.sls_outlet_id = o.sls_outlet_id   left join  ntl_prd_allvm.device_dp_map_v AS dm                   ON a.device_nm = dm.prod_nm   where  a.activity_mth = '2012-09-01' and a.sls_area_desc = 'Northeast' and a.sls_region_desc = 'New York Metro' and a.sls_dist_chnl_churn_ctgry = 'Stores' and dfill = 'Local' and cust_email_addr <> 'n/a' and heh.job_cd in ('65045', 'V51103')     --and heh.job_desc in ('Rep-Retail Customer Support', 'Rep-Retail Sales') and dm.device_tier not in ('Tablet', 'PC Card', 'Other') and on_dns_list <> 'Yes'  qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id order by a.cust_id, a.cust_line_seq_id, a.activity_dt) = 1  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33 order by a.sls_area_desc, a.sls_region_desc, a.activity_dt asc;  --drop table Reporting_Month; --drop table nccir_base11; --drop table nccir_base1a; --drop table nccir_base11b; --drop table nccir_acts_v; --drop table upcir_base11; --drop table upcir_base22; --drop table upcir_base33; --drop table upcir_base22a; --drop table upcir_base22aa; --drop table upcir_base22b; --drop table upcir_base22bb; --drop table upcir_up_v; --drop table ndcir_up_nc_emh_v;	TERADATA	HABERER	00:00:03	00:00:00	17779
09/25/2012	11:52:27	NTL_PRD_ALLVM	00:02:38	7063			select  a.activity_mth,  a.activity_dt,  a.activity_type,  a.sls_area_desc as sales_area,  a.sls_region_desc as sales_region,  a.sls_dist_chnl_churn_ctgry,  a.sls_outlet_id,  o.sls_outlet_nm as outlet,   coalesce(case when heh.nm_mdlin is null then   heh.nm_last||', '||heh.nm_first   else heh.nm_last||', '||heh.nm_first||' '||trim(heh.nm_mdlin)||'.' end, 'Unknown') as sls_rep_nm, heh.job_desc, coalesce(case when heh02.nm_mdlin is null then   heh02.nm_last||', '||heh02.nm_first   else heh02.nm_last||', '||heh02.nm_first||' '||trim(heh02.nm_mdlin)||'.' end, 'Unknown') as sls_rep_direct_mgr,  heh02.email_addr as rep_direct_mgr_email,  heh02.job_desc as direct_mgr_job_desc,  coalesce(case when heh01.nm_mdlin is null then   heh01.nm_last||', '||heh01.nm_first   else heh01.nm_last||', '||heh01.nm_first||' '||trim(heh01.nm_mdlin)||'.' end, 'Unknown') as sls_district_mgr_nm,  heh01.email_addr as district_mgr_email,  heh01.job_desc as district_mgr_job_desc,  o.district_cd as Zone_District_cd,   a.area_desc as cust_area_desc,  a.region_desc as cust_region_desc,  cal.nm_first||'   '||cal.nm_last AS cust_name,  cal.home_tel_num,  a.lang_pref_ind,  coalesce(email.email_addr, 'n/a') as cust_email_addr,   cal.mtn,   a.cust_id,  a.cust_line_seq_id,  a.device_nm_prev,  a.device_nm,  dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, case when a.fulfillement_ind='F' then 'direct' when a.fulfillement_ind='L' then 'local' else 'unknown' end as dfill, case when a.ecpd_liability_type_cd='C' then 'Business' else 'Consumer' end as Consumer_Business, case when dnsh.dns_type_cd is not null then 'Yes' When dnsh.dns_type_cd is null then 'No' end as on_dns_list  from ndcir_up_nc_emh_v as a  join  ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal ON a.cust_id = cal.cust_id AND a.cust_line_seq_id = cal.cust_line_seq_id AND a.activity_dt  BETWEEN cal.eff_dt AND cal.exp_dt  left join ntl_prd_allvm.cust_acct_line_dns_dly_hist_v as dnsh on a.sor_id = dnsh.sor_id and a.cust_id = dnsh.cust_id and a.cust_line_seq_id = dnsh.cust_line_seq_id and dnsh.dns_type_cd = 'SR' and a.activity_dt + 1 between dnsh.eff_dt and dnsh.exp_dt  left join (select sor_id, cust_id, acct_num, email_addr, email_status_ind,  email_selection_ind, entry_point, opt_in_dt,entry_dt, verify_ind  from ntl_prd_allvm.cust_acct_email_v  where email_selection_ind = 'X' ) as email on cal.sor_id = email.sor_id and cal.cust_id = email.cust_id and cal.acct_num = email.acct_num  left join ntl_prd_allvm.hr_employee_hist_v as heh on a.hr_employee_id = heh.emp_id and a.activity_dt between heh.eff_dt and heh.exp_dt  left join ntl_prd_allvm.hr_employee_hist_v AS heh02              on heh.super_id_lvl2_emp_id = heh02.emp_id and a.activity_dt between heh02.eff_dt and heh02.exp_dt                   left join ntl_prd_allvm.hr_employee_hist_v AS heh01          on heh.super_id_lvl1_emp_id  = heh01.emp_id  and a.activity_dt between heh01.eff_dt and heh01.exp_dt    left join  ntl_prd_allvm.dns_type_v as dnsd on dnsh.dns_type_cd = dnsd.dns_type_cd  left join ntl_prd_allvm.outlet_v as o  on a.sls_outlet_id = o.sls_outlet_id   left join  ntl_prd_allvm.device_dp_map_v AS dm                   ON a.device_nm = dm.prod_nm   where  a.activity_mth = '2012-09-01' and a.sls_area_desc = 'Northeast' and a.sls_region_desc = 'New York Metro' and a.sls_dist_chnl_churn_ctgry = 'Stores' and dfill = 'Local' and cust_email_addr <> 'n/a' and heh.job_cd in ('65045', 'V51103')     --and heh.job_desc in ('Rep-Retail Customer Support', 'Rep-Retail Sales') and dm.device_tier not in ('Tablet', 'PC Card', 'Other') and on_dns_list <> 'Yes'  qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id order by a.cust_id, a.cust_line_seq_id, a.activity_dt) = 1  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33 order by a.sls_area_desc, a.sls_region_desc, a.activity_dt asc;  --drop table Reporting_Month; --drop table nccir_base11; --drop table nccir_base1a; --drop table nccir_base11b; --drop table nccir_acts_v; --drop table upcir_base11; --drop table upcir_base22; --drop table upcir_base33; --drop table upcir_base22a; --drop table upcir_base22aa; --drop table upcir_base22b; --drop table upcir_base22bb; --drop table upcir_up_v; --drop table ndcir_up_nc_emh_v;	TERADATA	HABERER	00:02:28	00:00:10	17778
09/25/2012	11:48:18	NTL_PRD_ALLVM	00:00:38	7063			select  a.activity_mth,  a.activity_dt,  a.activity_type,  a.sls_area_desc as sales_area,  a.sls_region_desc as sales_region,  a.sls_dist_chnl_churn_ctgry,  a.sls_outlet_id,  o.sls_outlet_nm as outlet,   coalesce(case when heh.nm_mdlin is null then   heh.nm_last||', '||heh.nm_first   else heh.nm_last||', '||heh.nm_first||' '||trim(heh.nm_mdlin)||'.' end, 'Unknown') as sls_rep_nm, heh.job_desc, heh.dept_id,  coalesce(case when heh02.nm_mdlin is null then   heh02.nm_last||', '||heh02.nm_first   else heh02.nm_last||', '||heh02.nm_first||' '||trim(heh02.nm_mdlin)||'.' end, 'Unknown') as sls_rep_direct_mgr,  heh02.email_addr as rep_direct_mgr_email,  heh02.job_desc as direct_mgr_job_desc,  coalesce(case when heh01.nm_mdlin is null then   heh01.nm_last||', '||heh01.nm_first   else heh01.nm_last||', '||heh01.nm_first||' '||trim(heh01.nm_mdlin)||'.' end, 'Unknown') as sls_district_mgr_nm,  heh01.email_addr as district_mgr_email,  heh01.job_desc as district_mgr_job_desc,  o.district_cd as Zone_District_cd,   a.area_desc as cust_area_desc,  a.region_desc as cust_region_desc,  cal.nm_first||'   '||cal.nm_last AS cust_name,  cal.home_tel_num,  a.lang_pref_ind,  coalesce(email.email_addr, 'n/a') as cust_email_addr,   cal.mtn,   a.cust_id,  a.cust_line_seq_id,  a.device_nm_prev,  a.device_nm,  dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, case when a.fulfillement_ind='F' then 'direct' when a.fulfillement_ind='L' then 'local' else 'unknown' end as dfill, case when a.ecpd_liability_type_cd='C' then 'Business' else 'Consumer' end as Consumer_Business, case when dnsh.dns_type_cd is not null then 'Yes' When dnsh.dns_type_cd is null then 'No' end as on_dns_list  from ndcir_up_nc_emh_v as a  join  ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal ON a.cust_id = cal.cust_id AND a.cust_line_seq_id = cal.cust_line_seq_id AND a.activity_dt  BETWEEN cal.eff_dt AND cal.exp_dt  left join ntl_prd_allvm.cust_acct_line_dns_dly_hist_v as dnsh on a.sor_id = dnsh.sor_id and a.cust_id = dnsh.cust_id and a.cust_line_seq_id = dnsh.cust_line_seq_id and dnsh.dns_type_cd = 'SR' and a.activity_dt + 1 between dnsh.eff_dt and dnsh.exp_dt  left join (select sor_id, cust_id, acct_num, email_addr, email_status_ind,  email_selection_ind, entry_point, opt_in_dt,entry_dt, verify_ind  from ntl_prd_allvm.cust_acct_email_v  where email_selection_ind = 'X' ) as email on cal.sor_id = email.sor_id and cal.cust_id = email.cust_id and cal.acct_num = email.acct_num  left join ntl_prd_allvm.hr_employee_hist_v as heh on a.hr_employee_id = heh.emp_id and a.activity_dt between heh.eff_dt and heh.exp_dt  left join ntl_prd_allvm.hr_employee_hist_v AS heh02              on heh.super_id_lvl2_emp_id = heh02.emp_id and a.activity_dt between heh02.eff_dt and heh02.exp_dt                   left join ntl_prd_allvm.hr_employee_hist_v AS heh01          on heh.super_id_lvl1_emp_id  = heh01.emp_id  and a.activity_dt between heh01.eff_dt and heh01.exp_dt    left join  ntl_prd_allvm.dns_type_v as dnsd on dnsh.dns_type_cd = dnsd.dns_type_cd  left join ntl_prd_allvm.outlet_v as o  on a.sls_outlet_id = o.sls_outlet_id   left join  ntl_prd_allvm.device_dp_map_v AS dm                   ON a.device_nm = dm.prod_nm   where  a.activity_mth = '2012-09-01' and a.sls_area_desc = 'Northeast' and a.sls_region_desc = 'New York Metro' and a.sls_dist_chnl_churn_ctgry = 'Stores' and dfill = 'Local' and cust_email_addr <> 'n/a' and heh.job_cd in ('65045', 'V51103')     --and heh.job_desc in ('Rep-Retail Customer Support', 'Rep-Retail Sales') and dm.device_tier not in ('Tablet', 'PC Card', 'Other') and on_dns_list <> 'Yes'  qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id order by a.cust_id, a.cust_line_seq_id, a.activity_dt) = 1  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34 order by a.sls_area_desc, a.sls_region_desc, a.activity_dt asc;  --drop table Reporting_Month; --drop table nccir_base11; --drop table nccir_base1a; --drop table nccir_base11b; --drop table nccir_acts_v; --drop table upcir_base11; --drop table upcir_base22; --drop table upcir_base33; --drop table upcir_base22a; --drop table upcir_base22aa; --drop table upcir_base22b; --drop table upcir_base22bb; --drop table upcir_up_v; --drop table ndcir_up_nc_emh_v;	TERADATA	HABERER	00:00:35	00:00:03	17777
09/25/2012	11:45:57	NTL_PRD_ALLVM	00:01:10	7167			select  a.activity_mth,  a.activity_dt,  a.activity_type,  a.sls_area_desc as sales_area,  a.sls_region_desc as sales_region,  a.sls_dist_chnl_churn_ctgry,  a.sls_outlet_id,  o.sls_outlet_nm as outlet,   coalesce(case when heh.nm_mdlin is null then   heh.nm_last||', '||heh.nm_first   else heh.nm_last||', '||heh.nm_first||' '||trim(heh.nm_mdlin)||'.' end, 'Unknown') as sls_rep_nm, heh.job_desc, heh.dept_id,  coalesce(case when heh02.nm_mdlin is null then   heh02.nm_last||', '||heh02.nm_first   else heh02.nm_last||', '||heh02.nm_first||' '||trim(heh02.nm_mdlin)||'.' end, 'Unknown') as sls_rep_direct_mgr,  heh02.email_addr as rep_direct_mgr_email,  heh02.job_desc as direct_mgr_job_desc,  coalesce(case when heh01.nm_mdlin is null then   heh01.nm_last||', '||heh01.nm_first   else heh01.nm_last||', '||heh01.nm_first||' '||trim(heh01.nm_mdlin)||'.' end, 'Unknown') as sls_district_mgr_nm,  heh01.email_addr as district_mgr_email,  heh01.job_desc as district_mgr_job_desc,  o.district_cd as Zone_District_cd,   a.area_desc as cust_area_desc,  a.region_desc as cust_region_desc,  cal.nm_first||'   '||cal.nm_last AS cust_name,  cal.home_tel_num,  a.lang_pref_ind,  coalesce(email.email_addr, 'n/a') as cust_email_addr,   cal.mtn,   a.cust_id,  a.cust_line_seq_id,  a.device_nm_prev,  a.device_nm,  dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, case when a.fulfillement_ind='F' then 'direct' when a.fulfillement_ind='L' then 'local' else 'unknown' end as dfill, case when a.ecpd_liability_type_cd='C' then 'Business' else 'Consumer' end as Consumer_Business, case when dnsh.dns_type_cd is not null then 'Yes' When dnsh.dns_type_cd is null then 'No' end as on_dns_list  from ndcir_up_nc_emh_v as a  join  ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal ON a.cust_id = cal.cust_id AND a.cust_line_seq_id = cal.cust_line_seq_id AND a.activity_dt  BETWEEN cal.eff_dt AND cal.exp_dt  left join ntl_prd_allvm.cust_acct_line_dns_dly_hist_v as dnsh on a.sor_id = dnsh.sor_id and a.cust_id = dnsh.cust_id and a.cust_line_seq_id = dnsh.cust_line_seq_id and dnsh.dns_type_cd = 'SR' and a.activity_dt + 1 between dnsh.eff_dt and dnsh.exp_dt  left join (select sor_id, cust_id, acct_num, email_addr, email_status_ind,  email_selection_ind, entry_point, opt_in_dt,entry_dt, verify_ind  from ntl_prd_allvm.cust_acct_email_v  where email_selection_ind = 'X' ) as email on cal.sor_id = email.sor_id and cal.cust_id = email.cust_id and cal.acct_num = email.acct_num  left join ntl_prd_allvm.hr_employee_hist_v as heh on a.hr_employee_id = heh.emp_id and a.activity_dt between heh.eff_dt and heh.exp_dt  left join ntl_prd_allvm.hr_employee_hist_v AS heh02              on heh.super_id_lvl2_emp_id = heh02.emp_id and a.activity_dt between heh02.eff_dt and heh02.exp_dt                   left join ntl_prd_allvm.hr_employee_hist_v AS heh01          on heh.super_id_lvl1_emp_id  = heh01.emp_id  and a.activity_dt between heh01.eff_dt and heh01.exp_dt    left join  ntl_prd_allvm.dns_type_v as dnsd on dnsh.dns_type_cd = dnsd.dns_type_cd  left join ntl_prd_allvm.outlet_v as o  on a.sls_outlet_id = o.sls_outlet_id   left join  ntl_prd_allvm.device_dp_map_v AS dm                   ON a.device_nm = dm.prod_nm   where  a.activity_mth = '2012-09-01' and a.sls_area_desc = 'Northeast' and a.sls_region_desc = 'New York Metro' and a.sls_dist_chnl_churn_ctgry = 'Stores' and dfill = 'Local' and cust_email_addr <> 'n/a' and heh.dept_id in ('2600', '2580') --and heh.job_desc in ('Rep-Retail Customer Support', 'Rep-Retail Sales') and dm.device_tier not in ('Tablet', 'PC Card', 'Other') and on_dns_list <> 'Yes'  qualify row_number() over (partition by a.cust_id, a.cust_line_seq_id order by a.cust_id, a.cust_line_seq_id, a.activity_dt) = 1  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34 order by a.sls_area_desc, a.sls_region_desc, a.activity_dt asc;  --drop table Reporting_Month; --drop table nccir_base11; --drop table nccir_base1a; --drop table nccir_base11b; --drop table nccir_acts_v; --drop table upcir_base11; --drop table upcir_base22; --drop table upcir_base33; --drop table upcir_base22a; --drop table upcir_base22aa; --drop table upcir_base22b; --drop table upcir_base22bb; --drop table upcir_up_v; --drop table ndcir_up_nc_emh_v;	TERADATA	HABERER	00:00:26	00:00:44	17776
09/25/2012	11:45:09	NTL_PRD_ALLVM	00:25:13	3051			CREATE VOLATILE TABLE Repeat_Reporting_EMH1 AS (SELECT      acc.acss_call_ctr_desc,      acc.acss_call_ctr_cd,      ac.sor_id,      ac.acss_call_type_cd,     acc.acss_area_cd AS ctr_area,      acc.acss_call_ctr_type,      ac.cust_id,      ac.cust_line_seq_id,          ac.acct_num,      ac.mtn,      ac.acss_user_id,      ac.acss_call_dt,          ac.acss_call_tm,           (ac.call_disconnect_tm - ac.call_start_tm) HOUR TO SECOND (0) AS call_duration_tm,      COALESCE(sed.departmenttype,'Other') depttype,           COALESCE(sed.departmentgroup, 'Other') as dept_group,          CASE  WHEN acc.acss_call_ctr_time_zn LIKE 'C%' THEN                       ac.acss_call_tm + INTERVAL '1' HOUR                          WHEN acc.acss_call_ctr_time_zn LIKE 'M%' THEN               ac.acss_call_tm + INTERVAL '2' HOUR                          WHEN acc.acss_call_ctr_time_zn LIKE 'P%' THEN                 ac.acss_call_tm +INTERVAL '3' HOUR                            WHEN acc.acss_call_ctr_time_zn LIKE 'H%' THEN                ac.acss_call_tm + INTERVAL '5' HOUR                           ELSE ac.acss_call_tm         END acss_call_ad,      CAST(          ac.acss_call_dt ||          ' '             ||          CAST(acss_call_ad AS CHAR(8)) AS TIMESTAMP(0)      ) acss_dt_tm,      ad.acss_dept_desc,      ad.acss_dept_id,      ac.acss_call_id,      ac.area_cd,      RANK() OVER (PARTITION BY cust_id, cust_line_seq_id          ORDER BY ac.acss_call_dt, acss_call_ad, acss_call_id) rnk  FROM ntl_prd_allvm.acss_call_v AS ac  JOIN sys_calendar.calendar AS z        ON calendar_date= DATE   JOIN ntl_prd_allvm.acss_call_center_v AS acc      ON ac.acss_call_ctr_cd = acc.acss_call_ctr_cd  JOIN ntl_prd_allvm.acss_user_v AS au      ON ac.acss_user_id = au.acss_user_id  JOIN ntl_prd_allvm.acss_dept_v AS ad      ON ac.acss_dept_id = ad.acss_dept_id  LEFT JOIN ntl_prd_qmtbls.emh_eccr_dep AS sed    ON ad.acss_dept_id = sed.acssdeptid  LEFT JOIN                  (SELECT a.acss_call_dt,a.acss_call_ctr_cd, a.acss_dept_id FROM                  ntl_prd_allvm.acss_call_v  as a                                  JOIN sys_calendar.calendar AS z                                                                        ON calendar_date= DATE                                   WHERE                  a.acss_call_dt BETWEEN (DATE-(2)) AND (DATE-(2))                   AND a.acss_call_type_cd = '1'                  GROUP BY 1,2,3) r  ON          ac.acss_call_dt = r.acss_call_dt          AND ac.acss_call_ctr_cd = r.acss_call_ctr_cd          AND ac.acss_dept_id = r.acss_dept_id  WHERE ac.acss_call_dt BETWEEN (DATE-(2)) AND (DATE-(2))   AND COALESCE(sed.departmenttype,'Other') <> 'NA'  AND (      (ac.acss_call_type_cd IN ('1','7')) OR      (          ac.acss_call_type_cd = '3'          AND acc.acss_call_ctr_type = 'O'          AND ad.acss_dept_desc NOT LIKE '%offline%'          AND r.acss_dept_id IS NULL ))  ) WITH DATA PRIMARY INDEX (cust_id, cust_line_seq_id, acss_call_dt, acss_call_id, rnk) ON COMMIT PRESERVE ROWS;   CREATE TABLE NTL_PRD_QMTBLS.Repeat_Reporting_EMH21  AS  (  SELECT      a.sor_id,      a.acss_call_id,      a.acss_call_type_cd,      a.ctr_area,      a.acss_call_ctr_type,      m.area_cd,      m.region_desc,      a.cust_id,      a.cust_line_seq_id,      a.mtn,      a.acss_call_dt,          a.acss_call_ad,          a.acss_call_tm,           a.call_duration_tm,      a.rnk,      a.acss_dept_desc as initial_dept_desc,      a.acss_dept_id,      a.acss_user_id,      a.acss_call_ctr_desc,      a.acss_call_ctr_cd,      a.depttype AS orgtype,          a.dept_group as org_dept_group,      b.acss_call_id AS repeat_call_id,      b.acss_dept_desc AS repeat_dept_desc,      b.acss_dept_id AS repeat_dept_id,          b.acss_user_id AS repeat_user_id,          b.acss_call_ctr_desc AS repeat_call_ctr_desc,      b.acss_call_ctr_cd AS repeat_ctr_cd,      b.acss_call_dt AS repeat_dt,          b.acss_call_ad AS repeat_call_ad,         b.acss_call_tm as repeat_call_tm,           b.call_duration_tm as repeat_call_duration_tm,      b.rnk AS repeat_rnk,      b.depttype AS reptype,          b.dept_group as rpt_dept_group,      CASE WHEN b.acss_dt_tm IS NOT NULL THEN        ((b.acss_dt_tm - a.acss_dt_tm) DAY(4) TO MINUTE ) END tsdiff,      CASE WHEN b.acss_dt_tm IS NOT NULL THEN        (EXTRACT(HOUR FROM tsdiff) * 60)        + EXTRACT(MINUTE FROM tsdiff)        + (CAST((CAST ((tsdiff) AS INTERVAL DAY)) AS INTEGER) * 1440) END min_diff  FROM Repeat_Reporting_EMH1 AS a  JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt                 JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)       INNER JOIN Repeat_Reporting_EMH1 AS b          ON  a.cust_id = b.cust_id          AND a.cust_line_seq_id = b.cust_line_seq_id                  AND a.acss_call_dt = b.acss_call_dt                       AND b.rnk = a.rnk + 1          AND b.acss_call_id <> a.acss_call_id                  --AND ( b.acss_call_ad -  a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00'              LEFT JOIN ntl_prd_allvm.acss_call_center_v AS acc      ON b.acss_call_ctr_cd = acc.acss_call_ctr_cd  ) WITH DATA PRIMARY INDEX( sor_id, acss_call_id, acss_call_type_cd, ctr_area, acss_call_ctr_type, area_cd, region_desc, cust_id, cust_line_seq_id, mtn, acss_call_dt, acss_call_ad, acss_call_tm, call_duration_tm, rnk, initial_dept_desc, acss_dept_id, acss_user_id, acss_call_ctr_desc, acss_call_ctr_cd, orgtype, org_dept_group, repeat_call_id, repeat_dept_desc, repeat_dept_id, repeat_user_id, repeat_call_ctr_desc, repeat_ctr_cd, repeat_dt, repeat_call_ad, repeat_call_tm, repeat_call_duration_tm, repeat_rnk, reptype, rpt_dept_group, tsdiff, min_diff);  select a.acss_call_ctr_desc, hr1.nm_last || ', ' || hr1.nm_first AS  AD_Nm,  hr2.nm_last || ', ' || hr2.nm_first AS Supv_Nm,    u.nm_last||', '||u.nm_first AS First_Rep_nm,  a.initial_dept_desc,  a.acss_user_id, a.mtn, a.cust_id, a.area_cd, a.region_desc, CASE WHEN cal.Device_type_cd LIKE '%4GS%'  THEN cal.device_prod_nm  ELSE cal.prod_nm END AS Device_Nm, dm.device_tier AS Device_Tier,                    dm.data_tier_fin AS Data_Tier, a.orgtype, a.acss_call_dt, a.acss_call_ad, a.acss_call_tm, a.call_duration_tm, a.repeat_call_ctr_desc, u1.nm_last||', '||u1.nm_first AS Repeat_Rep_nm,  a.repeat_dept_desc, a.reptype, a.repeat_dt, a.repeat_call_ad, a.repeat_call_tm, a.repeat_call_duration_tm, a.tsdiff, a.min_diff, CASE WHEN (a.repeat_call_ad - a.acss_call_ad) HOUR TO MINUTE BETWEEN '0:00' AND '02:00' THEN  'Y' ELSE 'N' END AS Rpts_2hrs_and_Under   FROM NTL_PRD_QMTBLS.Repeat_Reporting_EMH21 AS a  JOIN sys_calendar.calendar AS z   ON calendar_date= DATE   JOIN ntl_prd_allvm.cust_acct_line_dly_hist_v  AS cal    ON a.cust_id = cal.cust_id    AND a.cust_line_seq_id = cal.cust_line_seq_id      and a.acss_call_dt BETWEEN cal.eff_dt AND cal.exp_dt       LEFT JOIN  ntl_prd_allvm.device_dp_map_v AS dm                     ON (CASE WHEN cal.Device_type_cd LIKE '%4GS%' THEN cal.device_prod_nm ELSE cal.prod_nm END) = dm.prod_nm                JOIN  ntl_prd_allvm.market_hist_v AS  m                 ON cal.sor_id = m.sor_id                 AND cal.mkt_cd = m.mkt_cd                 AND a.acss_call_dt BETWEEN m.eff_dt AND COALESCE (m.exp_dt, DATE)  LEFT JOIN ntl_prd_qmtbls.stm_eccr_area AS s    ON a.acss_call_ctr_cd = s.acsscallcentercd    AND a.acss_dept_id = s.acssdeptid      Join ntl_prd_allvm.acss_user_v AS u  on a.acss_user_id = u.acss_user_id    JOIN ntl_prd_allvm.hr_employee_v AS hr  ON u.hr_employee_id = hr.emp_id    LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr2              ON hr.SUPER_ID_LVL2_EMP_ID = hr2.emp_id                     LEFT OUTER JOIN ntl_prd_allvm.hr_employee_v AS hr1           ON hr.SUPER_ID_LVL1_EMP_ID = hr1.emp_id   Join ntl_prd_allvm.acss_user_v AS u1  on a.repeat_user_id = u1.acss_user_id  WHERE acss_call_dt BETWEEN '2012-09-01' AND ADD_MONTHS('2012-09-01',1)-1 and a.orgtype IN ('CS','WDTS')  and a.reptype IN ('CS','WDTS')  and a.org_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.rpt_dept_group not in ('BGCO','Fed', 'Prepaid')  and a.acss_call_ctr_desc IN('NE Columbia SC',  'NE Huntsville AL',  'NE Hanover MD',  'NE Rochester NY',  'NE Charleston SC',  'NE Charlotte NC',  'NE Wallingford CT',  'NE Wilmington NC',  'NE Bangor ME',  'NE Columbia SC 2')    GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29 ORDER BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29;  DROP TABLE Repeat_Reporting_EMH1; DROP TABLE NTL_PRD_QMTBLS. Repeat_Reporting_EMH21;	TERADATA	HABERER	00:05:59	00:19:14	17775